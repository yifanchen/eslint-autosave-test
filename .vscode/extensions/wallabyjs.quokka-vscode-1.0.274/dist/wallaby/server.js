/*
 * Wallaby.js - v1.0.816
 * https://wallabyjs.com
 * Copyright (c) 2014-2020 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e){if(this.eat(s.eq)){var t=this._inFieldValue;this._inFieldValue=!0,e.value=this.parseExpression(),this._inFieldValue=t}else e.value=null}var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=e("acorn"),s=o.tokTypes,a=e("./acornPrivateClassElements");t.exports=function(e){return e=a(e),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.parseClassElement=function(t){if(this.options.ecmaVersion>=8&&(this.type==s.name||this.type==this.privateNameToken||this.type==s.bracketL||this.type==s.string)){var n=this._branch();if(n.type==s.bracketL){var i=0;do n.eat(s.bracketL)?++i:n.eat(s.bracketR)?--i:n.next();while(i>0)}else n.next();if(n.type==s.eq||n.canInsertSemicolon()||n.type==s.semi){var o=this.startNode();return this.type==this.privateNameToken?this.parsePrivateClassElementName(o):this.parsePropertyName(o),("Identifier"===o.key.type&&"constructor"===o.key.name||"Literal"===o.key.type&&"constructor"===o.key.value)&&this.raise(o.key.start,"Classes may not have a field called constructor"),r.call(this,o),this.finishNode(o,"FieldDefinition"),this.semicolon(),o}}return e.prototype.parseClassElement.apply(this,arguments)},t.prototype.parseIdent=function(t,n){var r=e.prototype.parseIdent.call(this,t,n);return this._inFieldValue&&"arguments"==r.name&&this.raise(r.start,"A class field initializer may not contain arguments"),r},t}(e)}},{"./acornPrivateClassElements":6,acorn:void 0}],2:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=e("acorn").tokTypes,o=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,s=function(e){o.lastIndex=e.pos;var t=o.exec(e.input),n=e.pos+t[0].length;return"."===e.input.slice(n,n+1)};t.exports=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parseExprAtom=function(t){if(this.type!==i._import||!s(this))return e.prototype.parseExprAtom.call(this,t);this.options.allowImportExportEverywhere||this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'");var n=this.startNode();return n.meta=this.parseIdent(!0),this.expect(i.dot),n.property=this.parseIdent(!0),"meta"!==n.property.name&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is import.meta"),this.containsEsc&&this.raiseRecoverable(n.property.start,'"meta" in import.meta must not contain escape sequences'),this.finishNode(n,"MetaProperty")},t.prototype.parseStatement=function(t,n,r){if(this.type!==i._import||!s(this))return e.prototype.parseStatement.call(this,t,n,r);var o=this.startNode(),a=this.parseExpression();return this.parseExpressionStatement(o,a)},t}(e)}},{acorn:void 0}],3:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.exports=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.readInt=function(t,n){if(null!=n)return e.prototype.readInt.call(this,t,n);for(var r=this.pos,i=0,o=!1;;){var s=this.input.charCodeAt(this.pos),a=void 0;if(s>=97)a=s-97+10;else{if(95==s){o||this.raise(this.pos,"Invalid numeric separator"),++this.pos,o=!1;continue}a=s>=65?s-65+10:s>=48&&s<=57?s-48:1/0}if(a>=t)break;++this.pos,i=i*t+a,o=!0}return this.pos===r?null:(o||this.raise(this.pos-1,"Invalid numeric separator"),i)},t.prototype.readNumber=function(t){var n=e.prototype.readNumber.call(this,t),r=this.end-this.start>=2&&48===this.input.charCodeAt(this.start),i=this.getNumberInput(this.start,this.end);return i.length<this.end-this.start&&(r&&this.raise(this.start,"Invalid number"),this.value=parseFloat(i)),n},t.prototype.getNumberInput=function(e,t){return this.input.slice(e,t).replace(/_/g,"")},t}(e)}},{}],4:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.exports=function(e){return function(t){var n=e.tokTypes;return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.checkLVal=function(t,n,r){switch(t.type){case"ObjectPattern":for(var i=0;i<t.properties.length;i++){var o=t.properties[i];"Property"===o.type&&(o=o.value),"SpreadProperty"!==o.type&&this.checkLVal(o,n,r)}break;case"RestProperty":this.checkLVal(t.argument,n,r);break;default:e.prototype.checkLVal.call(this,t,n,r)}},t.prototype.parseObj=function(e,t){var r=this.startNode(),i=!0,o={};for(r.properties=[],this.next();!this.eat(n.braceR);){if(i)i=!1;else if(this.expect(n.comma),this.afterTrailingComma(n.braceR))break;var s,a,l,c,u=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===n.ellipsis){u=this.parseSpread(),u.type=e?"RestProperty":"SpreadProperty",r.properties.push(u);continue}u.method=!1,u.shorthand=!1,(e||t)&&(l=this.start,c=this.startLoc),e||(s=this.eat(n.star))}this.parsePropertyName(u),e||!(this.options.ecmaVersion>=8)||s||u.computed||"Identifier"!==u.key.type||"async"!==u.key.name||this.type===n.parenL||this.type===n.colon||this.canInsertSemicolon()?a=!1:(a=!0,this.parsePropertyName(u,t)),this.parsePropertyValue(u,e,s,a,l,c,t),this.checkPropClash(u,o),r.properties.push(this.finishNode(u,"Property"))}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")},t.prototype.toAssignable=function(t,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"AssignmentPattern":break;case"Property":this.toAssignable(t.value,n);break;case"SpreadProperty":t.type="RestProperty";break;case"ObjectExpression":t.type="ObjectPattern";for(var r=0;r<t.properties.length;r++){var i=t.properties[r];"SpreadProperty"!==i.type&&("init"!==i.kind&&this.raise(i.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(i.value,n))}break;default:e.prototype.toAssignable.call(this,t,n)}return t},t}(t)}}},{}],5:[function(e,t,n){"use strict";function r(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.readToken_question=function(){var e=this.input.charCodeAt(this.pos+1),t=this.input.charCodeAt(this.pos+2);e===l.questionMark?this.finishOp(s.assign,3):e!==l.dot||t>=l.digit0&&t<=l.digit9?(++this.pos,this.finishToken(s.question)):(this.pos+=2,this.finishToken(this.questionDotToken))},t.prototype.getTokenFromCode=function(t){return t===l.questionMark?this.readToken_question():e.prototype.getTokenFromCode.call(this,t)},t.prototype.parseSubscript=function(t,n,r,i,o){if(this.type===this.questionDotToken){if(i&&this.eat(s.parenL))return t;this.next();var a=this.startNodeAt(n,r);if(this.eat(s.bracketL))return a.object=t,a.property=this.parseExpression(),a.computed=!0,a.optional=!0,this.expect(s.bracketR),this.finishNode(a,"OptionalMemberExpression");if(this.eat(s.parenL))return a.callee=t,a.arguments=this.parseExprList(s.parenR,this.options.ecmaVersion>=8,!1),a.optional=!0,this.finishNode(a,"OptionalCallExpression");if(a.object=t,a.property=this.parseIdent(!0),a.computed=!1,a.optional=!0,this.eat(s.backQuote)){var l=this.start;return this.raise(l,"Template strings cannot be the tail of optional chaining."),t}return this.finishNode(a,"OptionalMemberExpression")}return e.prototype.parseSubscript.call(this,t,n,r,i,o)},t}(e);return t.prototype.questionDotToken=a,t}var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=e("acorn"),s=o.tokTypes,a=new o.TokenType("?."),l={dot:46,digit0:48,digit9:57,equalsTo:61,questionMark:63};t.exports=r},{acorn:void 0}],6:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=e("acorn"),o=i.tokTypes,s=i.TokenType;t.exports=function(e){if(e.prototype.parsePrivateName)return e;for(var t=e;t&&t!==i.Parser;)t=t.__proto__;if(t!==i.Parser)throw new Error("acorn-private-class-elements does not support mixing different acorn copies");return e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._branch=function(){return this.__branch=this.__branch||new t({ecmaVersion:this.options.ecmaVersion},this.input),this.__branch.end=this.end,this.__branch.pos=this.pos,this.__branch.type=this.type,this.__branch.value=this.value,this.__branch.containsEsc=this.containsEsc,this.__branch},t.prototype.parsePrivateClassElementName=function(e){e.computed=!1,e.key=this.parsePrivateName(),"constructor"==e.key.name&&this.raise(e.key.start,"Classes may not have a private element named constructor");var t={get:"set",set:"get"}[e.kind],n=this._privateBoundNamesStack[this._privateBoundNamesStack.length-1];return Object.prototype.hasOwnProperty.call(n,e.key.name)&&n[e.key.name]!==t&&this.raise(e.start,"Duplicate private element"),n[e.key.name]=e.kind||!0,delete this._unresolvedPrivateNamesStack[this._unresolvedPrivateNamesStack.length-1][e.key.name],e.key},t.prototype.parsePrivateName=function(){var e=this.startNode();return e.name=this.value,this.next(),this.finishNode(e,"PrivateName"),"never"==this.options.allowReserved&&this.checkUnreserved(e),e},t.prototype.getTokenFromCode=function(t){if(35===t){++this.pos;var n=this.readWord1();return this.finishToken(this.privateNameToken,n)}return e.prototype.getTokenFromCode.call(this,t)},t.prototype.parseClass=function(t,n){this._privateBoundNamesStack=this._privateBoundNamesStack||[];var r=Object.create(this._privateBoundNamesStack[this._privateBoundNamesStack.length-1]||null);this._privateBoundNamesStack.push(r),this._unresolvedPrivateNamesStack=this._unresolvedPrivateNamesStack||[];var i=Object.create(null);this._unresolvedPrivateNamesStack.push(i);var o=e.prototype.parseClass.call(this,t,n);if(this._privateBoundNamesStack.pop(),this._unresolvedPrivateNamesStack.pop(),this._unresolvedPrivateNamesStack.length)Object.assign(this._unresolvedPrivateNamesStack[this._unresolvedPrivateNamesStack.length-1],i);else{var s=Object.keys(i);s.length&&(s.sort(function(e,t){return i[e]-i[t]}),this.raise(i[s[0]],"Usage of undeclared private name"))}return o},t.prototype.parseSubscript=function(t,n,r,i,s){if(!this.eat(o.dot))return e.prototype.parseSubscript.call(this,t,n,r,i,s);var a=this.startNodeAt(n,r);return a.object=t,a.computed=!1,this.type==this.privateNameToken?(a.property=this.parsePrivateName(),this._privateBoundNamesStack.length&&this._privateBoundNamesStack[this._privateBoundNamesStack.length-1][a.property.name]||(this._unresolvedPrivateNamesStack[this._unresolvedPrivateNamesStack.length-1][a.property.name]=a.property.start)):a.property=this.parseIdent(!0),this.finishNode(a,"MemberExpression")},t.prototype.parseMaybeUnary=function(t,n){var r=e.prototype.parseMaybeUnary.call(this,t,n);return"delete"==r.operator&&"MemberExpression"==r.argument.type&&"PrivateName"==r.argument.property.type&&this.raise(r.start,"Private elements may not be deleted"),r},t}(e),e.prototype.privateNameToken=new s("privateName"),e}},{acorn:void 0}],7:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.exports=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isDirectiveCandidate=function(){return!1},t.prototype.strictDirective=function(){return!1},t.prototype.canDeclareLexicalName=function(){return!0},t.prototype.canDeclareVarName=function(){return!0},t.prototype.isSimpleParamList=function(){return!0},t.prototype.adaptDirectivePrologue=function(){},t.prototype.checkParams=function(){},t.prototype.checkPatternErrors=function(){},t.prototype.checkPatternExport=function(){},t.prototype.checkPropClash=function(){},t.prototype.checkVariableExport=function(){},t.prototype.checkYieldAwaitInDefaultParams=function(){},t.prototype.declareLexicalName=function(){},t.prototype.declareVarName=function(){},t.prototype.enterFunctionScope=function(){},t.prototype.enterLexicalScope=function(){},t.prototype.exitFunctionScope=function(){},t.prototype.exitLexicalScope=function(){},t.prototype.invalidStringToken=function(){},t}(e)}},{}],8:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.exports=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parseMaybeUnary=function(){return this.isContextual("await")?this.parseAwait():e.prototype.parseMaybeUnary.apply(this,arguments)},t}(e)}},{}],9:[function(e,t,n){t.exports=function(e){return e.JSXExpressionContainer=e.ExpressionStatement,e.JSXSpreadChild=e.ExpressionStatement,e.JSXClosingFragment=e.Identifier,e.JSXEmptyExpression=e.Identifier,e.JSXIdentifier=e.Identifier,e.JSXOpeningFragment=e.Identifier,e.JSXText=e.Identifier,e.JSXSpreadAttribute=e.SpreadElement,e.JSXAttribute=function(e,t,n){n(e.name,t),e.value&&n(e.value,t)},e.JSXMemberExpression=function(e,t,n){n(e.object,t),n(e.property,t)},e.JSXNamespacedName=function(e,t,n){n(e.namespace,t),n(e.name,t)},e.JSXOpeningElement=function(e,t,n){n(e.name,t);for(var r=0;r<e.attributes.length;++r)n(e.attributes[r],t)},e.JSXClosingElement=function(e,t,n){n(e.name,t)},e.JSXElement=function(e,t,n){n(e.openingElement,t);for(var r=0;r<e.children.length;++r)n(e.children[r],t);e.closingElement&&n(e.closingElement,t)},e.JSXFragment=function(e,t,n){n(e.openingFragment,t);for(var r=0;r<e.children.length;++r)n(e.children[r],t);n(e.closingFragment,t)},e}},{}],10:[function(e,t,n){e("./global"),process.on("uncaughtException",function(t){if(!(t&&"spawn"===t.syscall&&"OK"===t.code||(t&&t.message&&_.isString(t.message)&&0===t.message.indexOf("payload cannot exceed")&&(t.stack="One of the files specified in your `files`/`tests` list is too large, "+t.stack),t&&t.message&&_.isString(t.message)&&~t.message.indexOf("EADDRINUSE")&&~t.message.indexOf("51245")))){try{if(t instanceof Error){var n=e("path").dirname(process.mainModule.filename);t.stack=_.filter(t.stack.split("\n"),function(e,t){return!t||!_.contains(e,n)}).join("\n")}}catch(r){}console.error(t instanceof Error?t.stack:e("util").inspect(t))}}),t.exports={start:function(t){t.onConnected=function(n){t.Project=e("./project"),t.diffMatchPatch=new(e("./diffMatchPatch"));var r=new t.Receiver(t),i=process.exit,o=function(){l(!0),r.stop(r._emergencyExit),console.log("wallaby.js stopped"),i.apply(process,arguments)},s=process.exit=function(){o.apply(null,arguments)};process.on("SIGINT",function(){s.apply(null,arguments)});var a,l=function(e){clearTimeout(a),e&&(c=function(){})},c=function(e){a=setTimeout(function(){try{n.send({type:"ping"}),u()}catch(t){e?(r._emergencyExit=!0,o()):c(!0)}},e?1e3:1e4)},u=function(){l(),c()};return r.on("message",function(e){if(!e._internal)try{n.send(e)}finally{u()}}),n.receive=function(e){u();var t="unknown";try{if(t=e.type,!("string"==typeof t&&t.length>0&&"_"!==t[0]))throw new Error("Incorrect incoming message format");var n=r[t](e);n&&n["catch"]&&n["catch"](function(e){e.noDetails?console.error(e.message):console.error("Failed to execute "+t+" operation, "+e.stack)})}catch(i){console.error("Failed to start "+t+" operation, "+i.stack)}},r.configure(),r}}}},{"./diffMatchPatch":21,"./global":24,"./project":41,path:void 0,util:void 0}],11:[function(e,t,n){"use strict";var r,i,o=e("path"),s=e("semver"),a=e("./utils"),l=e("./babelVisitor"),c="5.0.9",u="7.0.0-beta.0",h=!0,d="babel",p="babel-core",f="@babel/core",g=function(){function e(e,t,n){_.isEmpty(e)||e.babelrc||(e.babelrc=!1),this._opts=_.extend({filename:t},e||{}),!this._opts.filename&&t&&(this._opts.filename=t),this._opts.filenameRelative||delete this._opts.filenameRelative,this._opts.sourceMaps=this._opts.sourceMap=!0,s.valid(r.version)&&s.gte(r.version,u)&&delete this._opts.sourceMap,this._opts.retainLines=this._opts.retainLines||!1,this._opts.compact=this._opts.compact||!1,this._opts.comments=this._opts.comments!==!1,_.isString(this._opts.plugins)&&(this._opts.plugins=[this._opts.plugins]),this._opts.plugins=(this._opts.plugins||[]).slice(),this._opts.plugins.unshift(new i("wallaby.js",l(_.bind(this._pushRange,this)))),n&&(this._opts.presets=(this._opts.presets||[]).slice(),this._opts.presets.push(n))}return e.prototype._pushRange=function(e){e&&this._ranges.push([e.start.line,e.start.column,e.end.line,e.end.column])},e.prototype.run=function(e){this._ranges=[];var t=r.transform(e.content,this._opts);return"ts"!==e.type&&"tsx"!==e.type||!h||e.changeExt("js"),{map:t.map,code:t.code,ranges:this._ranges}},e}();t.exports=function(t){return function(n){if(n=n||{},process.env.BABEL_ENV&&"undefined"!==process.env.BABEL_ENV||(process.env.BABEL_ENV="test"),a.patchModule("test-exclude",function(){return function(){return{shouldInstrument:_.noop}}}),n.babel)r=n.babel;else{var l=function(){throw new Error("babel, babel-core or @babel/core must be installed locally or babel instance must be passed in opts.babel, for example `wallaby.compilers.babel({ babel: require('@babel/core') })`")};try{var u=e(o.join(t,"package.json")),m=_.find([f,p,"babel-cli",d],function(e){return u.devDependencies[e]||u.dependencies[e]});"babel-cli"===m?r=a.requireModuleFrom(o.join(t,"node_modules/babel-cli"),p):m&&(r=a.requireModuleFrom(t,m))}catch(v){}if(!r)try{r=a.requireModuleFrom(t,f)}catch(y){try{r=a.requireModuleFrom(t,p)}catch(b){try{r=a.requireModuleFrom(t,d)}catch(k){l()}}}}return s.valid(r.version)&&s.lt(r.version,c)?void console.error("Babel version for compiler must be >= "+c):(i=r.Transformer||function(e,t){return _.each(t,function(e,n){t[n]=function(t){return e(t.node)}}),{visitor:{Program:function(e){e.traverse(t)}}}},h=n.renameTypeScriptFiles!==!1,delete n.babel,delete n.renameTypeScriptFiles,function(e){var t=e.additionalPreset;return delete e.additionalPreset,new g(n,e.path,t).run(e)})}}},{"./babelVisitor":12,"./utils":50,path:void 0,semver:void 0}],12:[function(e,t,n){t.exports=function(e,t){var n={Statement:function(t){switch(t.type){case"DoWhileStatement":case"WhileStatement":case"IfStatement":case"ForStatement":t.test&&e(t.test.loc);break;case"ForOfStatement":case"ForInStatement":t.right&&e(t.right.loc);break;case"SwitchStatement":e(t.discriminant.loc);break;case"BreakStatement":case"ContinueStatement":case"ThrowStatement":case"VariableDeclaration":case"ExpressionStatement":case"ReturnStatement":e(t.loc)}},ArrowFunctionExpression:function(t){t.body&&"BlockStatement"!==t.body.type&&e(t.body.loc)},LogicalExpression:function(t){e(t.left.loc),e(t.right.loc)},ConditionalExpression:function(t){e(t.consequent.loc),e(t.alternate.loc)}};return t&&t.visitImports&&(n.ImportDeclaration=function(t){e(t.loc)}),n}},{}],13:[function(e,t,n){var r=e("path"),i=e("compression"),o=e("graceful-fs"),s=e("express"),a=e("./fileCacheMiddleware"),l=e("./utils"),c=o.readFileSync(r.join(__dirname,"runners","browser","sandbox.html")).toString(),u="__wallaby__",h=logger.create("browserRunner").debug,d=function(e,t){var n=this;n._project=e,n._workerPool=t,n._baseDir=n._project._instrumentedRoot+r.sep,n._initializer=e.settings().bootstrap,n._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,n._throwOnBeforeunload=!!e.settings().throwOnBeforeUnload,n._maxLogEntrySize=e.settings().maxLogEntrySize,n._sandboxHtml={},n._report404AsError=e.settings().env.report404AsError,n._lruCache=n._project._lruCache,n._wallabyFileIdPrefix=n._workerPool.wallabyFileIdPrefix(),n._app=s(),n._app.use(i({filter:function(e){return~e.url.indexOf("____wallaby-bundle")}})),n._app.use("/wallaby_sandbox:id.html",function(e,t){t.send(n._sandboxHtml[e.params.id])}),e.settings().testFramework.path&&n._app.use("/"+u+"/"+e.settings().testFramework.version+"/framework.js",a.create({main:{root:r.join(e._localRoot,e.settings().testFramework.path)}})),n._app.use("/"+u+"/tracer.js",a.create({main:{root:r.join(__dirname,"tracer.js")}})),n._app.use("/"+u,a.create({main:{root:r.join(__dirname,"runners","browser")}})),e.settings().middleware(n._app,s),n._project.isNativeBundler()?n._app.use(a.create({main:{root:n._baseDir,cache:n._lruCache},alt:{root:n._project._localProjectDir,read:function(e,t){var i=l.normalizePath(r.relative(n._project._localProjectDir,e));n._project.idByPath(i)?n._project.getLatestOriginalFileContentByPathAsync(i).then(function(e){return t(null,e)})["catch"](function(e){return t(e)}):t(new Error("File '"+i+"' is not registered."))}}},n._report404AsError)):n._app.use(a.create({main:{root:n._baseDir,cache:n._lruCache}},n._report404AsError))};d.prototype={prepareSandbox:function(e,t,n){var r=this;e.allFilesHash=_.reduce(e.allFiles.concat(e.allTestFiles),function(e,t){return e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e},{});var i=e.allFiles.concat(e.allTestFiles),o=e.filesToLoad.concat(e.testFilesToLoad),s=_.reduce(e.testFilesToLoad,function(e,t){return e[t.id]=t,e},{});h("Total files to load in sandbox: "+o.length);var a=r._workerPool.receiverPort();r._anyIncludedEsm=!1;var l=r._project.isNativeBundler();r._sandboxHtml[n]=c.replace("<inject/>",function(){return _.reduce(i,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+a+';window.$_$session="'+t+'";window.$_$baseDir='+JSON.stringify(l?r._project._localProjectDir:r._baseDir)+";window.$_$initialSpecId="+1e5*(n+1)+";window.$_$reportUnhanledPromises="+r._reportUnhandledPromises+";window.$_$throwOnBeforeunload="+r._throwOnBeforeunload+";window.$_$maxLogEntrySize="+r._maxLogEntrySize+";window.$_$traceContext="+JSON.stringify(r._workerPool.traceContext())+";window.$_$coverage=[]; var file, i, len;")+"window.$_$slow="+r._project.settings().slowTestThreshold+";window.$_$expressionsToEvaluate="+JSON.stringify(e.expressionsToEvaluate)+";window.$_$files="+JSON.stringify(e.allFilesHash)+";window.$_$tests="+(e.tests?JSON.stringify(e.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(e.allTestFiles).filter(function(e){return!e.shadowed}).map(function(t){return{path:l?t.normalizedRelativePath:t.relativePath,loaded:t.include&&!!s[t.id],id:(e.allFilesHash[t.normalizedRelativePath]||{}).id}}).value())+';})();</script><script src="'+u+'/tracer.js"></script><script src="'+u+"/"+e.framework.version+'/framework.js"></script><script src="'+u+"/"+e.framework.configurator+'/configurator.js"></script><script src="'+u+"/"+e.framework.reporter+'/reporter.js"></script>'+_.reduce(o,function(e,t){r._anyIncludedEsm=r._anyIncludedEsm||t.esm;var n=t.tmp,i=t.ts+(n?t.originalId?r._wallabyFileIdPrefix+t.originalId:"":r._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"mjs":case"jsx":case"es6":case"es7":return e+"<script "+(t.esm?'type="module"':"")+' src="'+t.normalizedRelativePath+"?"+i+'"></script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+i+'"></link>';default:return e}},"")+(r._initializer?"<script>("+r._initializer+")(window.wallaby);</script>":"")+"<script "+(r._anyIncludedEsm?'type="module"':"")+' src="'+u+"/"+e.framework.starter+'/starter.js"></script>'});var d=r.sandboxRootUrl()+"wallaby_sandbox"+n+".html";return h("Sandbox is generated [%s]: %s",r.sandboxName(n,t),d),Q.when(d)},doesSandboxContainESModules:function(){return this._anyIncludedEsm},sandboxRootUrl:function(){return this._sandboxRootUrl?this._sandboxRootUrl:(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/",this._sandboxRootUrl)},webApp:function(){return this._app},sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=d},{"./fileCacheMiddleware":23,"./utils":50,compression:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],14:[function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=e("chrome-launcher"),s=e("chrome-remote-interface"),a=e("./runWorkerPool"),l=e("./browserEnvironment"),c=logger.create("chromeRunner").debug,u=function(){function t(e){this._screenShotReady=Promise.resolve(),this._project=e;var t=e.settings().env;this._path=t.runner,t.params&&t.params.runner&&(this._flags=t.params.runner.split(" ")),t.keepTabsOpened&&(this._keepTabsOpened=t.keepTabsOpened),this._chromePromise=this._launchChromeInstance(),this._workerPool=new a(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:function(){return!0},prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new l(e,this._workerPool)}return t.prototype.run=function(e){return this._workerPool.run(e)},t.prototype.cancel=function(e){return this._workerPool.cancel(e)},t.prototype.start=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this._workerPool.start(this._browserEnvironment.webApp())];case 1:return e=t.sent(),this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl()),[2,e]}})})},t.prototype.stop=function(){if(this._workerPool.stop(),this._chrome)try{process.kill(this._chrome.pid)}catch(e){}},t.prototype._create=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,this._chromePromise];case 1:return n.sent(),t({workerId:e}),[2]}})})},t.prototype._recycle=function(e){this._closeTab(e)},t.prototype._prepareTab=function(t,n){return r(this,void 0,void 0,function(){var r,o,s,a,l;return i(this,function(i){switch(i.label){case 0:return r=this,o=_.randomId(),s=this._browserEnvironment.sandboxName(n,o),c("Starting sandbox [%s]",s),[4,this._workerPool.getWorker(n)];case 1:return a=i.sent(),this._checkCancelled(),c("Preparing sandbox [%s]",s),[4,this._browserEnvironment.prepareSandbox(t,o,n)];case 2:return l=i.sent(),this._checkCancelled(),c("Prepared sandbox [%s]",s),[2,{name:s,sessionId:o,workerId:n,instance:{resume:function(){r._evaluateOnTab(a.client,function(){$_$tracer.resume()})},ping:function(e){r._evaluateOnTab(a.client,function(){},e)},close:function(){if(t.screen){var e={client:a&&a.client};a&&delete a.client,r._screenShotReady.then(function(){r._closeTab(e)})}else r._closeTab(a)},closing:function(){try{t.screen&&(r._screenShotReady=a.client.Page.captureScreenshot().then(function(n){var r=new Buffer(n.data,"base64");e("fs").writeFileSync(t.screen,r,"base64")}))}catch(n){r._screenShotReady=Promise.resolve()}},start:function(e){r._openTab(a,l,function(t){e(t.status)&&r._evaluateOnTab(a.client,function(){$_$tracer.start()})})}}}]}})})},t.prototype._checkCancelled=function(){if(this._workerPool.cancelled())throw{runCancelled:!0}},t.prototype._connectionOptions=function(e){return void 0===e&&(e={}),_.extend({port:this._chrome.port,host:"127.0.0.1"},e)},t.prototype._evaluateOnTab=function(e,t,n){return void 0===n&&(n=_.noop),r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e.Runtime?[4,e.Runtime.evaluate({expression:"("+t.toString()+")()"})]:[2];case 1:return i.sent(),n(),[3,3];case 2:return r=i.sent(),c("Failed to evaluate code on Chrome Tab: "+r.message),[3,3];case 3:return[2]}})})},t.prototype._openTab=function(e,t,n){return void 0===n&&(n=_.noop),r(this,void 0,void 0,function(){var r,o,a,l,c,u,h,d,p,f,_=this;return i(this,function(i){switch(i.label){case 0:if(i.trys.push([0,18,,19]),!this._chrome)throw new Error("Chrome is not running");return[4,s.New(this._connectionOptions({url:t}))];case 1:return r=i.sent(),e.client={target:{id:r.id}},this._checkCancelled(),[4,s({tab:r})];case 2:o=i.sent(),e.client=o,this._checkCancelled(),a=o.Page,l=o.Network,i.label=3;case 3:return i.trys.push([3,16,,17]),c=!!this._browserEnvironment.doesSandboxContainESModules(),u=[a.enable()],c&&u.push(l.enable()),[4,Promise.all(u)];case 4:if(i.sent(),this._checkCancelled(),!c)return[3,13];l.requestIntercepted(function(e){var t=e.interceptionId,n=e.request;return l.continueInterceptedRequest({interceptionId:t,url:_._updateTrackedFileUrlIfRequired(n.url)})["catch"](function(e){})}),i.label=5;case 5:return i.trys.push([5,7,,12]),[4,o.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"
}]})];case 6:return i.sent(),[3,12];case 7:h=i.sent(),i.label=8;case 8:return i.trys.push([8,10,,11]),[4,l.setRequestInterceptionEnabled({enabled:!0})];case 9:return i.sent(),[3,11];case 10:return d=i.sent(),console.warn("Unable to configure network request interception in Chrome"),[3,11];case 11:return[3,12];case 12:this._checkCancelled(),i.label=13;case 13:return[4,a.navigate({url:t})];case 14:return i.sent(),this._checkCancelled(),[4,a.loadEventFired()];case 15:return i.sent(),this._checkCancelled(),n({status:"success"}),[3,17];case 16:return p=i.sent(),this._closeTab(e),n({status:"failed: "+(p.message||"unknown")}),[3,17];case 17:return[3,19];case 18:return f=i.sent(),n({status:"failed: "+(f.message||"unknown")}),[3,19];case 19:return[2]}})})},t.prototype._closeTab=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:if(!e||!e.client)return[3,6];t=e.client,delete e.client,r.label=1;case 1:return r.trys.push([1,4,,5]),this._keepTabsOpened?[3,3]:[4,s.Close(this._connectionOptions({id:t.target.id}))];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:return n=r.sent(),c("Failed to close Chrome Tab: "+n.message),[3,5];case 5:try{t.close()}catch(i){c("Failed to close Chrome Tab client: "+i.message)}r.label=6;case 6:return[2]}})})},t.prototype._launchChromeInstance=function(){return r(this,void 0,void 0,function(){var t,n,r,s;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=["--headless","--disable-gpu","--deterministic-fetch"],n=e("os"),"Linux"===n.type()&&(t.push("--no-sandbox"),t.push("--disable-setuid-sandbox")),r=this,[4,o.launch({chromeFlags:this._flags||t,chromePath:this._path,logLevel:"silent"})];case 1:return r._chrome=i.sent(),[3,3];case 2:return s=i.sent(),this._handleHostError(s),[3,3];case 3:return[2]}})})},t.prototype._updateTrackedFileUrlIfRequired=function(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;var t=e;if(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""),t===e)return e;var n=t.lastIndexOf("?");n>=0&&(t=t.substring(0,n));var r=t&&this._project.getFileMetadataByPath(t);return r?e+(~n?"&":"?")+r.changeTs+"&wallabyFileId="+r.id:e},t.prototype._handleHostError=function(e){e=e||{},this._project._cleanStack(e);var t="Chrome runner error: "+(e.message||"unknown"),n=e.stack||t;console.error(n),this._project._emitTestRunError(t)},t}();t.exports=u},{"./browserEnvironment":13,"./runWorkerPool":42,"chrome-launcher":void 0,"chrome-remote-interface":void 0,fs:void 0,os:void 0}],15:[function(e,t,n){"use strict";var r,i,o,s=e("path"),a={},l={},c=function(){function e(e){var t=this;this._opts=_.extend({},e||{}),this._noRename=this._opts.noFileRename,delete this._opts.noFileRename,this._nodeVisitor("Block",function(e){_.each(e.expressions,function(e){e.expression?t._pushRange(e.expression):t._pushRange(e)})}),this._nodeVisitor("Op",function(e){"&&"!==e.operator&&"||"!==e.operator&&"?"!==e.operator||(t._pushRange(e.first),t._pushRange(e.second))})}return e.prototype._nodeVisitor=function(e,t){if(l[e]=t,!a[e]){var n=r[e].prototype.compileNode;r[e].prototype.compileNode=function(){return l[e](this),n.apply(this,arguments)},a[e]=!0}},e.prototype._pushRange=function(e){if(e){var t=e.locationData;t?this._ranges.push([t.first_line+1,t.first_column,t.last_line+1,t.last_column+1]):e.args&&e.args.length&&this._pushRange(e.args[0])}},e.prototype.run=function(e){this._ranges=[];var t=i.compile(e.content,_.extend({},this._opts,{filename:e.path,sourceMap:!0,literate:o.isLiterate(e.path)}));return this._noRename||e.changeExt("js"),{map:t.v3SourceMap,code:t.js,ranges:this._ranges}},e}(),u=function(t,n){try{r=e(s.join(t,n)),i=e(t)}catch(o){return!1}return!0};t.exports=function(e){var t=Error.prepareStackTrace;return u(s.join(e,"node_modules","coffeescript"),"lib/coffee-script/nodes")||u(s.join(e,"node_modules","coffee-script"),"lib/coffee-script/nodes")||u(s.join(e,"node_modules","coffeescript"),"lib/coffeescript/nodes")||u("coffee-script","lib/coffee-script/nodes"),Error.prepareStackTrace=t,o=i.helpers,function(e){return function(t){return new c(e).run(t)}}}},{path:void 0}],16:[function(e,t,n){"use strict";var r,i,o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=e("path"),l=e("os"),c=e("minimatch"),u=e("./utils"),h=logger.create("config"),d=h.debug,p=h.trace,f={node:{"mocha@2.1.0":{},"jest@0.4.3":{},"jest@24.8.0":{},"jasmine@2.3.4":{},"ava@0.3.0":{jsPreprocessor:function(e){return e.replace(/import test from ["|']ava["|']/,'var test = require("ava")')}},"tape@4.2.2":{jsPreprocessor:function(e){return e.replace(/import test from ["|']tape["|']/,'var test = require("tape")')}}},browser:{"jasmine@1.3.1":{},"jasmine@2.1.3":{},"jasmine@2.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.3.4":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.4.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.2":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.6.3":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.8.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.4.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"mocha@2.0.1":{},"mocha@2.2.4":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"mocha@3.2.0":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"qunit@1.16.0":{},"qunit@1.18.0":{configurator:"qunit@1.16.0",reporter:"qunit@1.16.0",starter:"qunit@1.16.0"},"qunit@2.4.0":{configurator:"qunit@1.16.0",reporter:"qunit@2.4.0",starter:"qunit@1.16.0"}}},g={typeScript:"**/*.ts?(x)",coffeeScript:"**/*.?(lit)coffee?(.md)"},m=function(){function t(t,n){r={files:{ignore:!1,trigger:!0,load:!0},tests:{ignore:!1,trigger:!0,load:!0}};var i=this._localProjectDir=a.dirname(t);this._configFile=t,this._root=n,this._builtinCompilers={coffeeScript:e("./coffeeScriptCompiler")(i),babel:e("./babelCompiler")(i),typeScript:function(t){return t&&t.isolatedModules?e("./typeScriptCompiler")(i)(t):{replaceWithPostprocessor:!0,localProjectDir:i,opts:t}}},this._builtinPostprocessors={typeScript:e("./typeScriptPostprocessor")(i),webpack:e("./postprocessors/webpack/initialize")(i)}}return t.prototype.load=function(){return o(this,void 0,void 0,function(){var t,n,i,o,h,f,m,v,y,b,k,T,w,S,x,C,F,E,R,P,L,j,I;return s(this,function(s){switch(s.label){case 0:return this._settings?[2,this._settings]:(t={localProjectDir:a.dirname(this._configFile)+a.sep,projectCacheDir:this._root,compilers:this._builtinCompilers,postprocessors:this._builtinPostprocessors,override:function(e){return{override:e}},defaults:{files:_.extend({},r.files),tests:_.extend({},r.tests)}},"auto.detect"===a.basename(this._configFile)?[3,6]:(i=e(this._configFile),i&&i.__esModule&&i["default"]&&(i=i["default"]),_.isFunction(i)?2!==i.length?[3,2]:[4,new Promise(function(e){return i(t,function(t){return e(t)})})]:[3,4]));case 1:return n=s.sent(),[3,3];case 2:n=i(t),s.label=3;case 3:return[3,5];case 4:n=i,s.label=5;case 5:return[3,7];case 6:n={noSettingsFile:!0},s.label=7;case 7:if(n.diagnostics=n.diagnostics||{},n=this._mergePackageFileSettings(n),n.debug&&logger.enableDebug(),n.trace&&logger.enableTrace(),this._settings=n,o=n.noSettingsFile,delete n.noSettingsFile,h="autoDetect"===(_.isString(n.testFramework||"")?n.testFramework:n.testFramework.type)||n.testFramework&&n.testFramework.autoDetected||n.autoDetect,delete n.autoDetect,f={original:void 0,hard:{},soft:{}},!o&&!h)return[3,17];o&&(n.testFramework="autoDetect",h=!0),m=[],v=void 0,y=null;try{p("Detecting Jest."),b=u.loadJest(this._localProjectDir),v=b.jestConfig,y=b.jestCLI.path,d("Detected Jest.")}catch(O){m.push(new Error("Automatic Jest configuration error: "+O.message))}return y&&y.startsWith(this._localProjectDir)?[3,15]:(p("Detecting Angular CLI."),k=e("./configurators/angular-cli/detect"),[4,k(this._localProjectDir)]);case 8:return(T=s.sent())?[3,9]:(y&&this._applyJestAutoConfig(n,f,v),[3,14]);case 9:return d("Detected Angular CLI."),y?[3,11]:[4,this._applyAngularCliAutoConfig(n,m)];case 10:return s.sent(),[3,14];case 11:return y.startsWith(a.dirname(T))?(this._applyJestAutoConfig(n,f,v),[3,14]):[3,12];case 12:return[4,this._applyAngularCliAutoConfig(n,m)];case 13:s.sent(),s.label=14;case 14:return[3,16];case 15:this._applyJestAutoConfig(n,f,v),s.label=16;case 16:if(m.length)throw 1===m.length?m[0]:(w=""+m[0].message+l.EOL+l.EOL+"We've also tried to automatically configure Wallaby.js for other frameworks",m.shift(),m.forEach(function(e){return w+=""+l.EOL+e.message}),new Error(w));s.label=17;case 17:if(S=!1,n.files&&!_.isFunction(n.files.override)||(x=[],S=!0,n.testFramework&&"jest"===n.testFramework.type&&(C=n.testFramework.originalConfig.wallaby,x=_.map(C.watchPathIgnorePatterns,function(e){return{pattern:e,regexp:new RegExp(e),ignore:!0}}),C.roots.length?x=x.concat(_.map(C.roots,function(e){return{pattern:e+"/**"}})):x.push({pattern:"**/**"})),n.files=n.files&&_.isFunction(n.files.override)?n.files.override(x):x),!_.isArray(n.files)||!n.files.length)throw new Error("Files property must be non-empty array of files/file patterns");if(n.tests&&!_.isFunction(n.tests.override)||(F=[],S=!0,"jest"===n.testFramework.type&&(E=n.testFramework.originalConfig.wallaby,F=_.map(E.testPathIgnorePatterns,function(e){return{pattern:e,regexp:new RegExp(e),ignore:!0}}),E.roots.length&&E.testMatch.length&&_.every(E.testMatch,function(e){return _.startsWith(e,"**")})?F=F.concat(_.reduce(E.roots,function(e,t){return e.concat(_.map(E.testMatch,function(e){return t+"/"+e}))},[])):(E.testMatch.length&&(F=F.concat(_.map(E.testMatch,function(e){return{pattern:e}}))),E.testRegex.length&&(F=F.concat(_.map(E.testRegex,function(e){return{pattern:e,regexp:new RegExp(e)}}))))),n.tests=n.tests&&_.isFunction(n.tests.override)?n.tests.override(F):F),!_.isArray(n.tests)||!n.tests.length)throw new Error("Tests property must be non-empty array of test files/file patterns");if(n.filesWithNoCoverageCalculated=n.filesWithNoCoverageCalculated||[],n.runAllTestsInAffectedTestFile=n.runAllTestsInAffectedTestFile||!1,n.compilers=n.compilers||{},!_.isObject(n.compilers))throw new Error("If defined, compilers property must be an object.");if(R=n.postprocessor&&n.postprocessor.bundler&&n.postprocessor.bundler["native"],R||(n.compilers[g.coffeeScript]||f.hard.noCompilers||(n.compilers[g.coffeeScript]=this._builtinCompilers.coffeeScript()),f.hard.noCompilers||n.compilers[g.typeScript]||_.find(_.keys(n.compilers),function(e){return c("a.ts",e)})||n.noDefaultTypeScriptCompiler||(n.compilers[g.typeScript]=this._builtinCompilers.typeScript())),n.preprocessors=n.preprocessors||{},!_.isObject(n.preprocessors))throw new Error("If defined, preprocessors property must be an object.");if(_.values(n.preprocessors).length&&f.hard.noPreprocessors)throw new Error("Preprocessors cannot be set.");if(n.postprocessor&&!_.isFunction(n.postprocessor))throw new Error("Postprocessor must be a function if set");if(n.postprocessor&&f.hard.noPostprocessor)throw new Error("Postprocessor cannot be set.");if(R){if(_.values(n.compilers).length)throw new Error("Compilers cannot be set if built in webpack postprocessor is used.");if(_.values(n.preprocessors).length)throw new Error("Preprocessors cannot be set if built in webpack postprocessor is used.")}if(f.hard.noCompilers||R||this._adjustTypeScriptCompilers(n),_.isFunction(n.middleware)||(n.middleware=_.noop),n.maxConsoleMessagesPerTest=n.maxConsoleMessagesPerTest||100,n.telemetry=n.telemetry!==!1,n.autoConsoleLog=n.autoConsoleLog!==!1,n.delays=n.delays||{},n.delays.run=n.delays.run||0,n.delays.run?n.delays.edit=0:n.delays.edit=n.delays.edit||100,n.delays.update=n.delays.update||0,n.workers=n.workers||{},n.workers.initial=n.workers.initial||0,n.workers.regular=n.workers.regular||0,_.isBoolean(n.workers.restart)?n.workers.recycle=n.workers.restart:n.workers.recycle=!!n.workers.recycle,n.bootstrap&&n.setup)throw new Error("The `setup` and `bootstrap` functions are alias of the same setting, so only one of them is allowed in the config.");if(P=n.bootstrap||n.setup,n.bootstrap=P&&P.toString(),delete n.setup,n.teardown=n.teardown&&n.teardown.toString(),this._normalizeFunction(n,"bootstrap"),this._normalizeFunction(n,"teardown"),n.hints=n.hints||{},n.hints.ignoreCoverage=u.serializeRegExp(n.hints.ignoreCoverage||/ignore coverage|istanbul ignore/),n.hints.ignoreCoverageForFile=u.serializeRegExp(n.hints.ignoreCoverageForFile||/ignore file coverage/),n.hints.commentAutoLog=n.hints.commentAutoLog||"?",n.hints.testFileSelection=n.hints.testFileSelection||{},n.hints.testFileSelection.include=u.serializeRegExp(n.hints.testFileSelection.include||/file\.only/),n.hints.testFileSelection.exclude=u.serializeRegExp(n.hints.testFileSelection.exclude||/file\.skip/),n.automaticTestFileSelection=n.automaticTestFileSelection!==!1,n.runSelectedTestsOnly=n.runSelectedTestsOnly===!0,n.extensions=n.extensions||{},n.env||(n.env=f.hard.env||{type:"browser",kind:"chrome"}),!_.isObject(n.env))throw new Error("Environment is not specified correctly");if(n.env.type=f.hard.env&&f.hard.env.type||n.env.type||"browser",n.env.params=n.env.params||{},"browser"===n.env.type&&(n.env.kind||(n.env.kind="chrome")),n.env.kind&&"phantomjs"!==n.env.kind&&"electron"!==n.env.kind&&"chrome"!==n.env.kind)throw new Error('Specified browser environment kind "'+n.env.kind+'" is not supported');if("node"!==n.env.type||n.env.runner||(n.env.runner=process.execPath),"electron"===n.env.kind&&!n.env.runner)try{try{n.env.runner=u.requireModuleFrom(t.localProjectDir,"electron")}catch(M){n.env.runner=u.requireModuleFrom(t.localProjectDir,"electron-prebuilt")}}catch(B){throw new Error("Electron runner path is not specified and `electron` module was not found.\nEither specify a path in `env.runner` or install the electron module by running `npm install electron --save-dev`")}if("phantomjs"===n.env.kind&&!n.env.runner)try{try{n.env.runner=u.requireModuleFrom(t.localProjectDir,"phantomjs").path}catch(M){n.env.runner=u.requireModuleFrom(t.localProjectDir,"phantomjs-prebuilt").path}}catch(B){throw new Error("From June 2019, Wallaby.js no longer ships with PhantomJs version 2.1.1.\nPhantomJs runner path is not specified and neither `phantomjs` nor `phantomjs-prebuilt` modules were found.\nEither specify a path in `env.runner` or install the phantomjs module by running `npm install phantomjs-prebuilt --save-dev`\nRead more in our docs: https://wallabyjs.com/docs/integration/phantomjs2.html ")}return n.reportUnhandledPromises="node"===n.env.type?n.reportUnhandledPromises!==!1:n.reportUnhandledPromises===!0,"browser"===n.env.type&&(n.throwOnBeforeUnload=n.throwOnBeforeUnload!==!1),n.env.viewportSize=_.extend({width:800,height:600},n.env.viewportSize||{}),n.env.options=_.extend({},n.env.viewportSize,n.env.options||{}),n.env.bundle!==!1&&(n.env.bundle=!0),n.testFramework=n.testFramework||("browser"===n.env.type?"jasmine@3.4.0":"mocha@2.1.0"),n.testFramework=this._normalizeTestFramework(n),_.values(n.compilers).length&&(t.defaults&&t.defaults.files&&t.defaults.files.instrument!==!1&&(t.defaults.files.instrument=!0),t.defaults&&t.defaults.tests&&t.defaults.tests.instrument!==!1&&(t.defaults.files.instrument=!0),r.files.instrument=!0,r.tests.instrument=!0),n.files=_.map(n.files,this._normalizeFileObject.bind(this,t.defaults&&t.defaults.files||_.extend({},r.files))),n.tests=_.map(n.tests,this._normalizeFileObject.bind(this,t.defaults&&t.defaults.tests||_.extend({},r.tests))),S&&_.each(_.filter(n.tests,function(e){return!e.ignore}),function(e){if(!_.find(n.files,function(t){return t.ignore&&t.pattern===e.pattern})){var t=_.clone(e);t.ignore=!0,n.files.push(t)}}),n.slowTestThreshold=n.slowTestThreshold||75,n.lowCoverageThreshold=n.lowCoverageThreshold||80,n.loose=0===n.testFramework.version.indexOf("jest")||R,0!==n.testFramework.version.indexOf("jest")||h||(_.find(n.files,function(e){return e&&_.endsWith(e.pattern,".snap")})||(L=this,_.each(n.tests,function(e){e&&e.pattern&&n.files.push(L._normalizeFileObject({ignore:e.ignore,instrument:!1,trigger:!0,load:!0},e.pattern+".snap"))})),_.find(n.files,function(e){return e&&"package.json"===e.pattern})||n.files.push(this._normalizeFileObject({ignore:!1,instrument:!1,trigger:!0,load:!0},"package.json")),_.isEmpty(n.preprocessors)||(j=e("module").Module.prototype,I=j._compile,j._compile=function(e,t){if(t&&~t.indexOf("babel-plugin-jest-hoist")&&e){var n=e.replace("if (!expr.isCallExpression())",'if(expr.isSequenceExpression()){const expressions = expr.get("expressions");if (!expressions || expressions.length !== 2) return false;expr = expressions[1];}if (!expr.isCallExpression())');n===e&&console.warn("Initialization of babel-plugin-jest-hoist preset has failed."),arguments[0]=n}return I.apply(this,arguments)},global.$_$w||(global.$_$w=global.$_$w_=global.$_$wf=global.$_$wv=global.$_$tracer=!0)),n.preprocessors&&!n.preprocessors["package.json"]&&(n.preprocessors["package.json"]=function(e){var t=JSON.parse(e.content);return delete t.babel,JSON.stringify(t)})),[2,n]}})})},t.prototype._normalizeFunction=function(e,t){if(e[t]&&0!==e[t].indexOf("function")){e[t]="function "+e[t];var n=e[t].split("\n")[0],r=n.indexOf("=>"),i=n.indexOf("{");if(r>0&&(i===-1||r<i)&&(e[t]=e[t].replace("=>","{")+"}"),r>0&&n.indexOf("(")<0){n=e[t].split("\n")[0];var o=n.indexOf("{"),s=n.substring("function ".length,o);e[t]=e[t].replace(s,"("+s+")")}}},t.prototype._normalizeTestFramework=function(e){var t=f[e.env.type];if(!t)throw new Error("Environment ["+e.env.type+"] is not supported");var n=this._resolveTestFrameworkVersion(e,t),r=_.extend({version:n,configurator:n,reporter:n,starter:n},t[n]);return e.testFramework.path&&(r.path=e.testFramework.path),e.testFramework.autoDetected&&(r.autoDetected=!0,delete r.originalConfig),r},t.prototype._resolveTestFrameworkVersion=function(e,t){var n=_.isString(e.testFramework)?e.testFramework:e.testFramework.type;if("jest"!==n||e.testFramework.autoDetected||(n+="@0.4.3"),~n.indexOf("@")){if(!t[n])throw new Error("Test framework ["+n+"] is not supported");return n}var r={};_.each(t,function(e,t){var n=t.substr(0,t.indexOf("@"));r[n]=t});var i=r[n];if(!i)throw new Error("Test framework ["+n+"] is not supported");return i},t.prototype._adjustTypeScriptCompilers=function(e){var t=!!e.postprocessor,n={files:{}};if(_.each(e.compilers,function(r,i){r&&r.replaceWithPostprocessor&&(n.postprocessor=r.postprocessor,delete e.compilers[i],t&&(r.opts=r.opts||{}),n.files[i]=r.opts,r.opts&&r.opts.typescript&&(n.typescript=r.opts.typescript,delete r.opts.typescript))}),!_.isEmpty(n.files)){var r=n.postprocessor||this._builtinPostprocessors.typeScript(n);t?e.postprocessor=[r,e.postprocessor]:e.postprocessor=r}},t.prototype._normalizeFileObject=function(e,t){if(_.isString(t))t={pattern:t};else if(!t.pattern)throw new Error("File/test entry must either be a string or an object that contains pattern property");var n=_.defaults(t,e);return n.regexp||("!"===n.pattern[0]&&(n.ignore=!n.ignore,n.pattern=n.pattern.substring(1)),"/"===n.pattern[0]&&(n.pattern=n.pattern.substring(1)),"."===n.pattern[0]&&"/"===n.pattern[1]&&(n.pattern=n.pattern.substring(2))),n},t.prototype._mergePackageFileSettings=function(t){var n={};try{if(n=e(a.join(this._localProjectDir,"package.json")).wallaby,!n)return t}catch(r){return t}return _.merge(n,t)},t.prototype._applyJestAutoConfig=function(e,t,n){var r=u.escapePathForRegex(a.sep+"node_modules"+a.sep),i=[r,[u.escapePathForRegex("dist"+a.sep),u.escapePathForRegex("build"+a.sep),u.escapePathForRegex("coverage"+a.sep),u.escapePathForRegex(a.sep+".idea"+a.sep),u.escapePathForRegex(a.sep+".vscode"+a.sep),u.escapePathForRegex(a.sep+".git"+a.sep),u.escapePathForRegex(a.sep+".gitlab"+a.sep)].join("|")],o=n.wallaby={roots:[],watchPathIgnorePatterns:i,testPathIgnorePatterns:i,testMatch:[],testRegex:[]},s=(n.configs||[]).length>1,l=this._localProjectDir,c=u.normalizePath(l),h=function(e,t){return t&&~e.indexOf(c)?e.split(c+"/").join("").split(c).join(""):!t&&~e.indexOf(l)?e.split(l+a.sep).join("").split(l).join(""):~e.indexOf(u.replacePathSepForRegex(l))?e.split(u.replacePathSepForRegex(l)).join(""):e},p=function(e,t,n,r){var i=[];return _.each(e,function(e){var o=h(e,n);o&&!~t.indexOf(o)&&(o===e&&r&&(o=r+o),t.push(o),i.push(o))}),i};if(e.filesWithCoverageCalculated=[],_.each(n.configs,function(t){var n="("+p(t.roots,o.roots,!1).map(function(e){return u.escapePathForRegex(u.platformDependentPath(e))}).join("|")+".*)";o.roots.length&&(o.roots=o.roots.map(function(e){return u.normalizePath(e)})),p(t.watchPathIgnorePatterns,o.watchPathIgnorePatterns,!1,s&&n),p(t.testPathIgnorePatterns,o.testPathIgnorePatterns,!1,s&&n),p(t.testMatch,o.testMatch,!0,!1),p(t.testRegex,o.testRegex,!1,s&&n),t.collectCoverageFrom&&(e.filesWithCoverageCalculated=e.filesWithCoverageCalculated.concat(t.collectCoverageFrom))}),(n.globalConfig||{}).collectCoverageFrom&&(e.filesWithCoverageCalculated=e.filesWithCoverageCalculated.concat((n.globalConfig||{}).collectCoverageFrom)),e.filesWithCoverageCalculated=e.filesWithCoverageCalculated.map(function(e){return e.replace("<rootDir>/","")}),!o.testMatch.length&&!o.testRegex.length)throw new Error("Can not autodetect test patterns, neither Jest testMatch nor testRegex is set.");_.isObject(e.testFramework)||(e.testFramework={}),e.testFramework.type="jest",e.testFramework.originalConfig=n,e.testFramework.autoDetected=!0,e.micromatch=!0,t.hard.noCompilers=!0,t.hard.env={type:"node"},d("Configured Jest.")},t.prototype._applyAngularCliAutoConfig=function(t,n){return o(this,void 0,void 0,function(){var r,i;return s(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),r=e("./configurators/angular-cli/configure"),[4,r(this._localProjectDir,t)];case 1:return o.sent(),n.splice(0,n.length),d("Configured Angular CLI."),[3,3];case 2:return i=o.sent(),d(i),n.unshift(new Error("Automatic Angular CLI configuration error: "+i.message)),[3,3];case 3:return[2]}})})},t}();t.exports=function(e,t,n){var r=(void 0===n?{}:n).forceUpdate;return i&&!r?i.load():(i=new m(e,t),i.load())}},{"./babelCompiler":11,"./coffeeScriptCompiler":15,"./configurators/angular-cli/configure":17,"./configurators/angular-cli/detect":18,"./postprocessors/webpack/initialize":32,"./typeScriptCompiler":46,"./typeScriptPostprocessor":47,"./utils":50,minimatch:void 0,module:void 0,os:void 0,path:void 0}],17:[function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=this,s=e("util"),a=e("path"),l=e("fs"),c=e("semver"),u=e("./detect"),h=e("./v8/ProjectConfigurator"),d=e("./v8/WorkspaceConfigurator"),p=s.promisify(l.exists),f=logger.create("angular/cli config").debug,_="8.2.0";t.exports=function(t,n){return r(o,void 0,void 0,function(){var r,o,s,l,g,m,v,y,b;return i(this,function(i){switch(i.label){case 0:return[4,u(t)];case 1:if(r=i.sent(),!r)throw new Error("Unable to locate angular.json file.");o=e(r),n.diagnostics.angular={workspace:o},i.label=2;case 2:if(i.trys.push([2,11,,12]),!o.version||!Object.keys(o.projects||{}).length)throw new Error("'"+r+"' is not a valid Angular CLI file.");return s=a.dirname(r),l=a.join(s,"node_modules","@angular","cli","package.json"),[4,p(l)];case 3:if(!i.sent())throw new Error("Cannot detect @angular/cli package version, is the package installed?");if(g=e(a.resolve(l)),m=g.version,!c.valid(m)||c.lt(m,_))throw new Error("Only Angular CLI v"+_+" or higher is supported.");if(t!==s)return[3,8];if(v=Object.keys(o.projects).map(function(e){return{name:e,configuration:o.projects[e]}}).filter(function(e){return e.configuration.architect&&e.configuration.architect.test&&"@angular-devkit/build-angular:karma"===e.configuration.architect.test.builder}),!v.length)throw new Error("None of your projects are configured with @angular-devkit/build-angular:karma builder for test architect.");return v.length>1?[4,new d(s,o).configure(n)]:[3,5];case 4:return i.sent(),[3,7];case 5:return[4,new h(s,v[0]).configure(!0,n)];case 6:i.sent(),i.label=7;case 7:return[3,10];case 8:if(y=Object.keys(o.projects).map(function(e){return{name:e,configuration:o.projects[e]}}).find(function(e){return a.resolve(a.join(s,e.configuration.root))===t}),!y)throw new Error("A project for '"+t+"' directory cannot be detected.");if(!y.configuration.architect||!y.configuration.architect.test||"@angular-devkit/build-angular:karma"!==y.configuration.architect.test.builder)throw new Error("The project "+y.name+" is not configured with @angular-devkit/build-angular:karma builder for test architect.");return[4,new h(s,y).configure(!1,n)];case 9:i.sent(),i.label=10;case 10:return[3,12];case 11:throw b=i.sent(),f("Angular.json: \n %O",o),b;case 12:return[2]}})})}},{"./detect":18,"./v8/ProjectConfigurator":19,"./v8/WorkspaceConfigurator":20,fs:void 0,path:void 0,semver:void 0,util:void 0}],18:[function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=this,s=e("util"),a=e("path"),l=e("fs"),c="angular.json",u=s.promisify(l.exists);t.exports=function(e){return r(o,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return t=a.parse(e).root,n=e,r=a.join(n,c),[4,u(r)];case 1:if(i.sent())return[3,4];i.label=2;case 2:return n===t?[3,4]:(n=a.resolve(n,".."),r=a.join(n,c),[4,u(r)]);case 3:return i.sent()?[3,4]:(r=null,[3,2]);case 4:return[2,r]}})})}},{fs:void 0,path:void 0,util:void 0}],19:[function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=e("path"),l=e("os"),c=e("fs"),u=e("util"),h=e("lodash"),d=e("../../../utils"),p=u.promisify(c.exists),f=u.promisify(c.readFile),_=logger.create("angular/cli project config"),g=_.debug,m=_.trace,v=function(){function t(e,t){this._workspaceDirPath=d.normalizePath(e),this._project=t}return t.prototype.configure=function(t,n){return i(this,void 0,void 0,function(){function c(e,t){return i(this,void 0,void 0,function(){
var n;return o(this,function(i){switch(i.label){case 0:return e.codeCoverage=!1,[4,j(r({},e,{outputPath:"",budgets:void 0}),t,function(e){return[O(e),B(e),M(e),N(e),D(e)]})];case 1:return n=i.sent().config,q=n[0]||n,[2]}})})}var u,_,v,y,b,k,T,w,S,x,C,F,E,R,P,L,j,I,O,M,B,N,D,q,A,U,W,H,z,Q,V,J,K,Y,G,X,Z,$,ee,te,ne,re,ie,oe,te,se,ae,le,ce,ue,he,de,pe,fe,_e,ge,me,ve,ye,be,ke,Te,we,Se,xe,Ce,Fe,Ee,Re,Pe,Le,je,Ie,Oe,Me,ce,Be,Ne,De,qe,Ae,Be,De,Ue,We,Me,He,ze,Qe,Ve,Je,Ke,Ye,Ge,Ke,Ye,Ge,Xe,Ze;return o(this,function(r){switch(r.label){case 0:return m("Configuring."),n.testFramework={type:"jasmine",autoDetected:!0},n.env||(n.env={kind:"chrome"}),n.bootstrap||n.setup||(n.setup="function(){window.__moduleBundler.loadTests();}"),P={workspace:{root:this._workspaceDirPath,configFile:"angular.json"}},L={name:"test",description:"",options:[],aliases:[],hidden:!1,scope:"default"},j=d.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/build-angular/src/utils/webpack-browser-config",!0).module.generateBrowserWebpackConfigFromContext,I=d.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/build-angular/src/angular-cli-files/models/webpack-configs",!0).module,O=I.getCommonConfig,M=I.getNonAotConfig,B=I.getStylesConfig,N=I.getTestConfig,D=I.getWorkerConfig,q={},A=d.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/core/src/logger/null-logger",!0).module.NullLogger,U=d.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!0).module.TestCommand,W=d.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/architect",!0).module.createBuilder,H=new U(P,L,new A),[4,H.initialize({})];case 1:return r.sent(),H._architectHost.loadBuilder=function(){return new Promise(function(e){return e(W(c))})},m("Calling test command for %s.",this._project.name),[4,H.run({project:this._project.name})];case 2:if(r.sent(),m("Initializing postprocessor."),z=e("../../../postprocessors/webpack/initialize"),Q=z(this._workspaceDirPath),delete q.output,delete q.performance,delete q.optimization,m("Sanitizing style rules."),q.module&&q.module.rules){V=q.module.rules,J=h.flatten(V.filter(function(e){return e.use}).map(function(e){return e.use}));try{for(K=s(J),Y=K.next();!Y.done;Y=K.next())G=Y.value,"string"!=typeof G&&G.options&&("sass-loader"!==G.loader&&"less-loader"!==G.loader&&"stylus-loader"!==G.loader&&"postcss-loader"!==G.loader||(G.options.sourceMap=!1))}catch(i){u={error:i}}finally{try{Y&&!Y.done&&(_=K["return"])&&_.call(K)}finally{if(u)throw u.error}}}if(m("Sanitizing plugins."),q.plugins=q.plugins.filter(function(e){return!e.sourceMappingURLComment&&(!e.patterns&&!(e.options&&e.options.scripts))}),X=this._project.configuration,Z=X.architect.test.options,$=[],m("Setting up polyfills."),ee=q.entry.polyfills,ee&&ee.length){te=[];try{for(ne=s(ee),re=ne.next();!re.done;re=ne.next())ie=re.value,te.push("require('"+d.normalizePath(ie)+"');")}catch(o){v={error:o}}finally{try{re&&!re.done&&(y=ne["return"])&&y.call(ne)}finally{if(v)throw v.error}}te.length&&$.push({path:a.join(this._workspaceDirPath,"wallaby-polyfills.js"),code:te.join(l.EOL)})}if(oe=Z.styles){m("Setting up styles."),te=[];try{for(se=s(oe),ae=se.next();!ae.done;ae=se.next())le=ae.value,ce=!0,"string"!=typeof le&&(ce=void 0===le.inject||le.inject,le=le.input),ce?te.push("require('"+d.normalizePath(a.resolve(a.join(this._workspaceDirPath,le)))+"');"):console.warn("Angular CLI automatic configuration: the style "+le+" has an 'inject' attribute set to false, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.")}catch($e){b={error:$e}}finally{try{ae&&!ae.done&&(k=se["return"])&&k.call(se)}finally{if(b)throw b.error}}te.length&&$.push({path:a.join(this._workspaceDirPath,"wallaby-styles.js"),code:te.join(l.EOL)})}return m("Setting up main file."),ue=d.normalizePath(a.resolve(a.join(this._workspaceDirPath,Z.main))),[4,f(ue,"utf-8")];case 3:return he=r.sent(),de=a.extname(ue),pe=a.posix.basename(ue,de),fe=d.normalizePath(a.resolve(a.join(a.dirname(ue),pe+".wallaby"+de))),[4,p(fe)];case 4:return r.sent()||(fe=null),_e=d.normalizePath(a.resolve(a.join(a.dirname(ue),pe+".base"+de))),[4,p(_e)];case 5:return r.sent()||(_e=null),ge=/const\s+context\s*=\s*require\s*\.\s*context\s*\(\s*'\.\/'\s*,\s*true\s*,\s*\/\\\.spec\\\.ts\$\/\s*\)\s*;/,me=/context\s*\.\s*keys\s*\(\s*\)\s*\.map\s*\(\s*context\s*\)\s*;/,fe?(g("Using physical %s.",fe),[4,f(fe,"utf-8")]):[3,7];case 6:return he=r.sent(),[3,11];case 7:return he.match(ge)&&he.match(me)?(g("Using virtual %s.",ue),he=he.replace(ge,"").replace(me,""),[3,11]):[3,8];case 8:return _e?(g("Using physical %s.",_e),[4,f(_e,"utf-8")]):[3,10];case 9:return he=r.sent(),[3,11];case 10:g("Using default %s.",ue),console.warn("Angular CLI automatic configuration: Wallaby.js cannot use "+ue+" file, the standard test bed initialization code will be used instead. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues."),ve="library"===this._project.configuration.projectType?"import 'zone.js/dist/zone';":"",he="\n            "+ve+"\n            import 'zone.js/dist/zone-testing';  \n            import { getTestBed } from '@angular/core/testing';\n      \n            import {\n              BrowserDynamicTestingModule,\n              platformBrowserDynamicTesting\n            } from '@angular/platform-browser-dynamic/testing'; \n          \n            getTestBed().initTestEnvironment(\n              BrowserDynamicTestingModule,\n              platformBrowserDynamicTesting()\n            );",r.label=11;case 11:if(n.diagnostics.angular.main=he,$.push({path:ue,code:he}),m("Creating postprocessor."),ye=Q(q,{setupFiles:$}),be=ye.owner,ke=be._prepareCompiler.bind(be),be._prepareCompiler=function(e,t){var n,r;ke(e,t);var i=function(n){if(n._compilerHost)return n._firstRun=!e,e?be._affectedFileByFullPath.forEach(function(e){return n._compilerHost.invalidate(e.fullPath)}):(t.watchMode=!0,n._forkTypeChecker=!0),"break"};try{for(var o=s(t.options.plugins),a=o.next();!a.done;a=o.next()){var l=a.value,c=i(l);if("break"===c)break}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}},n.postprocessor=ye,Te=X.sourceRoot?X.sourceRoot:a.join(X.root,"src"),we=t?Te:a.relative(X.root,Te),m("Created postprocessor."),Se=[],xe=[],Se.push({pattern:d.normalizePath(a.join(we,"/**/*.spec.ts")),ignore:!0}),X.architect.test.options.polyfills&&Se.push({pattern:d.normalizePath(t?X.architect.test.options.polyfills:a.relative(X.root,X.architect.test.options.polyfills)),ignore:!0}),X.architect.test.options.main&&Se.push({pattern:d.normalizePath(t?X.architect.test.options.main:a.relative(X.root,X.architect.test.options.main)),ignore:!0}),X.architect.build&&X.architect.build.options&&(X.architect.build.options.main&&Se.push({pattern:d.normalizePath(t?X.architect.build.options.main:a.relative(X.root,X.architect.build.options.main)),ignore:!0}),X.architect.build.options.index&&Se.push({pattern:d.normalizePath(t?X.architect.build.options.index:a.relative(X.root,X.architect.build.options.index)),ignore:!0})),Se.push({pattern:d.normalizePath(a.join(we,"/test.base.ts")),ignore:!0}),Se.push({pattern:d.normalizePath(a.join(we,"/test.wallaby.ts"))}),xe.push({pattern:d.normalizePath(a.join(we,"/**/*.spec.ts")),load:!1}),Ce=[],Fe=Z.scripts,Ee=new Set,Re=[],Pe=new Map,Fe&&Fe.length){m("Setting up scripts."),Le=""+(new Date).getTime(),je=0;try{for(Ie=s(Fe),Oe=Ie.next();!Oe.done;Oe=Ie.next())if(Me=Oe.value,ce=!0,je++,Be=""+Le+je,"string"!=typeof Me&&(Be=Me.bundleName||Be,ce=void 0===Me.inject||Me.inject,Me=Me.input),Ne=d.normalizePath(a.resolve(a.join(this._workspaceDirPath,Me))),t?Ne.startsWith(this._workspaceDirPath):Ne.startsWith(d.normalizePath(a.resolve(a.join(this._workspaceDirPath,X.root))))){if(!ce){console.warn("Angular CLI automatic configuration: the script "+Me+" has an 'inject' attribute set to false, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.");continue}if(Pe.has(Be)||Pe.set(Be,{inject:ce,scripts:[]}),De=Pe.get(Be),De.inject!=ce)throw new Error("The "+Be+" bundle is mixing injected and non-injected scripts.");De.scripts.push(d.normalizePath(a.relative(t?this._workspaceDirPath:a.join(this._workspaceDirPath,X.root),Ne))),Ee.has(Be)||Re.push(Be),Ee.add(Be)}else console.warn("Angular CLI automatic configuration: the script "+Me+" is outside of the "+(t?"workspace":"project folder")+", Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.")}catch(et){T={error:et}}finally{try{Oe&&!Oe.done&&(w=Ie["return"])&&w.call(Ie)}finally{if(T)throw T.error}}}try{for(qe=s(Re),Ae=qe.next();!Ae.done;Ae=qe.next())if(Be=Ae.value,De=Pe.get(Be),De&&De.inject)try{for(Ue=s(De.scripts),We=Ue.next();!We.done;We=Ue.next())Me=We.value,Se.push({pattern:Me,instrument:!1,load:!0})}catch(tt){C={error:tt}}finally{try{We&&!We.done&&(F=Ue["return"])&&F.call(Ue)}finally{if(C)throw C.error}}}catch(nt){S={error:nt}}finally{try{Ae&&!Ae.done&&(x=qe["return"])&&x.call(qe)}finally{if(S)throw S.error}}if(He=Z.assets,ze=new Set,!He||!He.length)return[3,20];m("Setting up assets."),r.label=12;case 12:r.trys.push([12,18,19,20]),Qe=s(He),Ve=Qe.next(),r.label=13;case 13:return Ve.done?[3,17]:(Je=Ve.value,"string"!=typeof Je?[3,15]:(Ke=d.normalizePath(a.resolve(a.join(this._workspaceDirPath,Je))),[4,p(Ke)]));case 14:return r.sent()&&(Ye=""+a.posix.sep+a.basename(Ke),Ge=""+Ye+Ke,ze.has(Ge)||(Ce.push({path:{virtual:Ye,physical:Ke}}),ze.add(Ge))),[3,16];case 15:Je&&Je.input&&Je.output&&(Ke=d.normalizePath(a.resolve(a.join(this._workspaceDirPath,Je.input))),Ye=Je.output.startsWith(a.posix.sep)?Je.output:""+a.posix.sep+Je.output,Ge=""+Ye+Ke,ze.has(Ge)||(Ce.push({path:{virtual:Ye,physical:Ke}}),ze.add(Ge))),r.label=16;case 16:return Ve=Qe.next(),[3,13];case 17:return[3,20];case 18:return Xe=r.sent(),E={error:Xe},[3,20];case 19:try{Ve&&!Ve.done&&(R=Qe["return"])&&R.call(Qe)}finally{if(E)throw E.error}return[7];case 20:return Ce.length&&(Ze=function(e,t){var n,r;try{for(var i=s(Ce),o=i.next();!o.done;o=i.next()){var a=o.value;e.use(a.path.virtual,t["static"](a.path.physical))}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}},n.middleware?h.isFunction(n.middleware.override)&&(n.middleware=n.middleware.override(Ze)):n.middleware=Ze),Se.push({pattern:d.normalizePath(a.join(we,"/**/*.+(ts|js)")),load:!1}),Se.push({pattern:d.normalizePath(a.join(we,"/**/*.+(css|less|scss|sass|styl|html|json|svg)")),instrument:!1,load:!1}),n.files?h.isFunction(n.files.override)&&(n.files=n.files.override(Se)):n.files=Se,n.tests?h.isFunction(n.tests.override)&&(n.tests=n.tests.override(xe)):n.tests=xe,m("Configured."),[2]}})})},t}();t.exports=v},{"../../../postprocessors/webpack/initialize":32,"../../../utils":50,fs:void 0,lodash:void 0,os:void 0,path:void 0,util:void 0}],20:[function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s},l=e("path"),c=e("os"),u=e("fs"),h=e("util"),d=e("lodash"),p=e("../../../utils"),f=h.promisify(u.exists),_=h.promisify(u.readFile),g=logger.create("angular/cli workspace config"),m=g.debug,v=g.trace,y=function(){function t(e,t){this._workspaceDirPath=p.normalizePath(e),this._workspaceConfig=t}return t.prototype.configure=function(t){return i(this,void 0,void 0,function(){function n(e,t){return i(this,void 0,void 0,function(){var n;return o(this,function(i){switch(i.label){case 0:return e.codeCoverage=!1,e.tsConfig=N,d.flatten(j.filter(function(e){return e.name!==I.name}).map(function(e){return e.configuration}).filter(function(e){return e.architect.test.options.fileReplacements}).map(function(e){return e.architect.test.options.fileReplacements})).forEach(function(t){return e.fileReplacements.push(t)}),[4,w(r({},e,{outputPath:"",budgets:void 0}),t,function(e){return[x(e),F(e),C(e),E(e),R(e)]})];case 1:return n=i.sent().config,D=n[0]||n,[2]}})})}var a,c,h,_,g,y,b,k,T,w,S,x,C,F,E,R,P,L,j,I,O,M,B,N,D,q,A,U,W,H,z,Q,V,J,K,Y,G,X,Z,$,ee,te,ne,re,ie,oe,se,ae,le,ce,ue,he,de,pe,fe,_e,ge,me,ve,ye,be=this;return o(this,function(r){switch(r.label){case 0:return v("Configuring."),t.testFramework={type:"jasmine",autoDetected:!0},t.env||(t.env={kind:"chrome"}),t.setup||t.setup||(t.setup="function(){window.__moduleBundler.loadTests();}"),b={workspace:{root:this._workspaceDirPath,configFile:"angular.json"}},k={name:"test",description:"",options:[],aliases:[],hidden:!1,scope:"default"},T=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"typescript",!0).module,w=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/build-angular/src/utils/webpack-browser-config",!0).module.generateBrowserWebpackConfigFromContext,S=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/build-angular/src/angular-cli-files/models/webpack-configs",!0).module,x=S.getCommonConfig,C=S.getNonAotConfig,F=S.getStylesConfig,E=S.getTestConfig,R=S.getWorkerConfig,P=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/compiler-cli/src/ngtsc/file_system",!0).module.getFileSystem,L=P(),j=Object.keys(this._workspaceConfig.projects).map(function(e){return{name:e,configuration:be._workspaceConfig.projects[e]}}).filter(function(e){return e.configuration.architect&&e.configuration.architect.test&&"@angular-devkit/build-angular:karma"===e.configuration.architect.test.builder}),O=j.filter(function(e){return"application"===e.configuration.projectType}),O.length>1?(M=O.filter(function(e){return""===e.configuration.root}),M.length?I=M[0]:(B=O.filter(function(e){return e.name===be._workspaceConfig.defaultProject}),I=B.length?B[0]:O[0])):I=O.length?O[0]:j.find(function(e){return"library"===e.configuration.projectType}),N="tsconfig.wallaby.spec.json",[4,f(l.join(this._workspaceDirPath,N))];case 1:return r.sent()?[3,3]:(N="tsconfig.workspace.spec.json",[4,f(l.join(this._workspaceDirPath,N))]);case 2:r.sent()||(N="tsconfig.wallaby.spec.json"),r.label=3;case 3:return D={},q=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/core/src/logger/null-logger",!0).module.NullLogger,A=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!0).module.TestCommand,U=p.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-devkit/architect",!0).module.createBuilder,W=new A(b,k,new q),[4,W.initialize({})];case 4:return r.sent(),W._architectHost.loadBuilder=function(){return new Promise(function(e){return e(U(n))})},[4,this._generateMainFiles(j)];case 5:return H=r.sent(),z=l.join(this._workspaceDirPath,N),v("Calling test command for %s.",I.name),[4,f(z)];case 6:return r.sent()?[3,9]:(m("Using virtual %s.",z),Q=L.lstat,V=T.sys.readFile,J=u.statSync,[4,this._generateTsConfigFile(j,1===H.length?H[0].path:null)]);case 7:return K=r.sent(),t.diagnostics.angular.tsConfig=K,Y=p.normalizePath(z),L.lstat=function(e){return e===Y?{isDirectory:function(){return!1}}:Q(e)},T.sys.readFile=function(e){return e===Y?K:V(e)},u.statSync=function(e,t){return e===z?{isFile:function(){return!0}}:J(e,t)},[4,W.run({project:I.name})];case 8:return r.sent(),u.statSync=J,[3,11];case 9:return m("Using physical %s.",z),[4,W.run({project:I.name})];case 10:r.sent(),r.label=11;case 11:return v("Initializing postprocessor."),G=e("../../../postprocessors/webpack/initialize"),X=G(this._workspaceDirPath),delete D.output,delete D.performance,delete D.optimization,this._fixStyleRules(j,D),v("Sanitizing plugins."),D.plugins=D.plugins.filter(function(e){return!e.sourceMappingURLComment&&(!e.patterns&&!(e.options&&e.options.scripts))}),Z=I.configuration.architect.test.options.polyfills?l.resolve(l.join(this._workspaceDirPath,I.configuration.architect.test.options.polyfills)):null,$=(D.entry.polyfills||[]).filter(function(e){return null==Z||Z!==e}),[4,this._generatePolyfillFile(j,$)];case 12:ee=r.sent(),te=this._generatesStyleFile(j),ne=[],ee&&(t.diagnostics.angular.polyfill=ee,ne.push(ee)),t.diagnostics.angular.main=[];try{for(re=s(H),ie=re.next();!ie.done;ie=re.next())oe=ie.value,void 0===oe.code?ne.push(oe.path):(t.diagnostics.angular.main.push(oe),ne.push(oe))}catch(i){a={error:i}}finally{try{ie&&!ie.done&&(c=re["return"])&&c.call(re)}finally{if(a)throw a.error}}return te&&ne.push(te),[4,this._generatesAssetRoutes(j)];case 13:se=r.sent(),se.length&&(ae=function(e,t){var n,r;try{for(var i=s(se),o=i.next();!o.done;o=i.next()){var a=o.value;e.use(a.path.virtual,t["static"](a.path.physical))}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}},t.middleware?d.isFunction(t.middleware.override)&&(t.middleware=t.middleware.override(ae)):t.middleware=ae),v("Creating postprocessor."),le=X(D,{setupFiles:ne}),ce=le.owner,ue=ce._prepareCompiler.bind(ce),ce._prepareCompiler=function(e,t){var n,r;ue(e,t);var i=function(n){if(n._compilerHost)return n._firstRun=!e,e?ce._affectedFileByFullPath.forEach(function(e){return n._compilerHost.invalidate(e.fullPath)}):(t.watchMode=!0,n._forkTypeChecker=!0),"break"};try{for(var o=s(t.options.plugins),a=o.next();!a.done;a=o.next()){var l=a.value,c=i(l);if("break"===c)break}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}},t.postprocessor=le,he=[],de=[];try{for(pe=s(this._generatesScripts(j)),fe=pe.next();!fe.done;fe=pe.next())_e=fe.value,he.push({pattern:_e,instrument:!1,load:!0})}catch(o){h={error:o}}finally{try{fe&&!fe.done&&(_=pe["return"])&&_.call(pe)}finally{if(h)throw h.error}}try{for(ge=s(j.map(function(e){return e.configuration})),me=ge.next();!me.done;me=ge.next())ve=me.value,ye=ve.sourceRoot?ve.sourceRoot:l.join(ve.root,"src"),ve.architect.test.options.polyfills&&he.push({pattern:p.normalizePath(ve.architect.test.options.polyfills),ignore:!0}),ve.architect.test.options.main&&he.push({pattern:p.normalizePath(ve.architect.test.options.main),ignore:!0}),ve.architect.build&&ve.architect.build.options&&(ve.architect.build.options.main&&he.push({pattern:p.normalizePath(ve.architect.build.options.main),ignore:!0}),ve.architect.build.options.index&&he.push({pattern:p.normalizePath(ve.architect.build.options.index),ignore:!0})),he.push({pattern:p.normalizePath(l.join(ye,"/test.base.ts")),ignore:!0}),he.push({pattern:p.normalizePath(l.join(ye,"/test.wallaby.ts")),ignore:!0}),he.push({pattern:p.normalizePath(l.join(ye,"/**/*.spec.ts")),ignore:!0}),he.push({pattern:p.normalizePath(l.join(ye,"/**/*.+(ts|js)")),load:!1}),he.push({pattern:p.normalizePath(l.join(ye,"/**/*.+(css|less|scss|sass|styl|html|json|svg)")),instrument:!1,load:!1}),de.push({pattern:p.normalizePath(l.join(ye,"/**/*.spec.ts")),load:!1})}catch(ke){g={error:ke}}finally{try{me&&!me.done&&(y=ge["return"])&&y.call(ge)}finally{if(g)throw g.error}}return t.files?d.isFunction(t.files.override)&&(t.files=t.files.override(he)):t.files=he,t.tests?d.isFunction(t.tests.override)&&(t.tests=t.tests.override(de)):t.tests=de,v("Configured."),[2]}})})},t.prototype._generateMainFiles=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,a,c,u,h,d,g,v,y,b,k,T,w,S,x,C;return o(this,function(o){switch(o.label){case 0:return r="test.wallaby.ts",i=l.join(this._workspaceDirPath,r),[4,f(i)];case 1:return o.sent()?(m("Using physical %s.",r),[2,[{path:i}]]):(r="test.workspace.ts",i=l.join(this._workspaceDirPath,r),[4,f(i)]);case 2:if(o.sent())return m("Using physical %s.",r),[2,[{path:i}]];a=/const\s+context\s*=\s*require\s*\.\s*context\s*\(\s*'\.\/'\s*,\s*true\s*,\s*\/\\\.spec\\\.ts\$\/\s*\)\s*;/,c=/context\s*\.\s*keys\s*\(\s*\)\s*\.map\s*\(\s*context\s*\)\s*;/,u=[],o.label=3;case 3:o.trys.push([3,16,17,18]),h=s(e),d=h.next(),o.label=4;case 4:return d.done?[3,15]:(g=d.value,v=g.configuration.architect.test.options,y=p.normalizePath(l.resolve(l.join(this._workspaceDirPath,v.main))),[4,_(y,"utf-8")]);case 5:return b=o.sent(),k=l.extname(y),T=l.posix.basename(y,k),w=p.normalizePath(l.resolve(l.join(l.dirname(y),T+".wallaby"+k))),[4,f(w)];case 6:return o.sent()||(w=null),S=p.normalizePath(l.resolve(l.join(l.dirname(y),T+".base"+k))),[4,f(S)];case 7:return o.sent()||(S=null),w?(m("Using physical %s.",w),[4,_(w,"utf-8")]):[3,9];case 8:return b=o.sent(),[3,13];case 9:return b.match(a)&&b.match(c)?(m("Using virtual %s.",y),b=b.replace(a,"").replace(c,""),[3,13]):[3,10];case 10:return S?(m("Using physical %s.",S),[4,_(S,"utf-8")]):[3,12];case 11:return b=o.sent(),[3,13];case 12:m("Using default %s.",i),console.warn("Angular CLI automatic configuration: Wallaby.js cannot use "+y+" file, the standard test bed initialization code will be used instead. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues."),x="library"===g.configuration.projectType?"import 'zone.js/dist/zone';":"",b="\n              "+x+"\n              import 'zone.js/dist/zone-testing';  \n              import { getTestBed } from '@angular/core/testing';\n      \n              import {\n                BrowserDynamicTestingModule,\n                platformBrowserDynamicTesting\n              } from '@angular/platform-browser-dynamic/testing'; \n          \n              getTestBed().initTestEnvironment(\n                BrowserDynamicTestingModule,\n                platformBrowserDynamicTesting()\n              );",o.label=13;case 13:u.push({path:y,code:u.length>0?this._deduplicateMainFileContent(b):b}),o.label=14;case 14:return d=h.next(),[3,4];case 15:return[3,18];case 16:return C=o.sent(),t={error:C},[3,18];case 17:try{d&&!d.done&&(n=h["return"])&&n.call(h)}finally{if(t)throw t.error}return[7];case 18:return[2,u]}})})},t.prototype._generateTsConfigFile=function(t,n){return i(this,void 0,void 0,function(){var r,i,a,c,u,h,d,_,g,m,v,y,b,k,T,w,S,x,C,F,E,R,P,L,j,I,O,M,B,N,D,q,A,U,W,H;return o(this,function(z){switch(z.label){case 0:return v=l.resolve(l.join(this._workspaceDirPath,"tsconfig.json")),[4,f(v)];case 1:if(!z.sent())throw new Error(v+" file does not exist.");y=e(v),y.compilerOptions=y.compilerOptions||{},y.compilerOptions.paths=y.compilerOptions.paths||{},y.compilerOptions.types=y.compilerOptions.types||[],b=[],k=[],T=[],w=y.compilerOptions.paths,S=new Set,x=function(t){var n,r,i,a,c,u,h,d,_,g,m,v,y,x,F,E,R,P,L,j,I,O,M,B,N,D,q,A,U;return o(this,function(o){switch(o.label){case 0:return _=w[t.name],g=w[t.name+"/*"],(_||g)&&t.configuration.architect.build&&t.configuration.architect.build.options&&t.configuration.architect.build.options.project?(m=l.resolve(l.join(C._workspaceDirPath,t.configuration.architect.build.options.project)),[4,f(m)]):[3,2];case 1:o.sent()&&(v=e(m),v.dest&&v.lib&&v.lib.entryFile&&(y=p.normalizePath(l.relative(C._workspaceDirPath,l.resolve(l.join(l.dirname(m),v.dest)))),_&&_.find(function(e){return e.includes(y)})&&(_.splice(0,_.length),_.push(l.posix.join(t.configuration.root,v.lib.entryFile))),g&&g.find(function(e){return e.includes(y)})&&(g.splice(0,g.length),x=t.configuration.sourceRoot?t.configuration.sourceRoot:l.join(t.configuration.root,"src"),g.push(l.posix.join(x,"*"))))),o.label=2;case 2:return F=l.resolve(l.join(C._workspaceDirPath,t.configuration.architect.test.options.tsConfig)),E=l.dirname(F),[4,f(F)];case 3:if(o.sent()){if(R=e(F),R.compilerOptions&&R.compilerOptions.types)try{for(P=s(R.compilerOptions.types),L=P.next();!L.done;L=P.next())j=L.value,S.add(j)}catch(W){n={error:W}}finally{try{L&&!L.done&&(r=P["return"])&&r.call(P)}finally{if(n)throw n.error}}if(R.files)try{for(I=s(R.files),O=I.next();!O.done;O=I.next())M=O.value,l.isAbsolute(M)?b.push(M):(M=p.normalizePath(l.join(l.relative(C._workspaceDirPath,E),M)),b.push(M))}catch(H){i={error:H}}finally{try{O&&!O.done&&(a=I["return"])&&a.call(I)}finally{if(i)throw i.error}}if(R.include)try{for(B=s(R.include),N=B.next();!N.done;N=B.next())D=N.value,k.push(p.normalizePath(l.join(l.relative(C._workspaceDirPath,E),D)))}catch(z){c={error:z}}finally{try{N&&!N.done&&(u=B["return"])&&u.call(B)}finally{if(c)throw c.error}}if(R.exclude)try{for(q=s(R.exclude),A=q.next();!A.done;A=q.next())U=A.value,T.push(p.normalizePath(l.join(l.relative(C._workspaceDirPath,E),U)))}catch(Q){h={error:Q}}finally{try{A&&!A.done&&(d=q["return"])&&d.call(q)}finally{if(h)throw h.error}}}return[2]}})},C=this,z.label=2;case 2:z.trys.push([2,7,8,9]),F=s(t),E=F.next(),z.label=3;case 3:return E.done?[3,6]:(R=E.value,[5,x(R)]);case 4:z.sent(),z.label=5;case 5:return E=F.next(),[3,3];case 6:return[3,9];case 7:return P=z.sent(),r={error:P},[3,9];case 8:try{E&&!E.done&&(i=F["return"])&&i.call(F)}finally{if(r)throw r.error}return[7];case 9:b.length&&(y.files=[]);try{for(L=s(b),j=L.next();!j.done;j=L.next())I=j.value,y.files.push(I)}catch(Q){a={error:Q}}finally{try{j&&!j.done&&(c=L["return"])&&c.call(L)}finally{if(a)throw a.error}}return n&&y.files.push(n),O=l.join(this._workspaceDirPath,"polyfills.wallaby.ts"),[4,f(O)];case 10:return z.sent()?(y.files.push(O),[3,13]):[3,11];case 11:return O=l.join(this._workspaceDirPath,"polyfills.workspace.ts"),[4,f(O)];case 12:z.sent()&&y.files.push(O),z.label=13;case 13:k.length&&(y.include=[]);try{for(M=s(k),B=M.next();!B.done;B=M.next())N=B.value,y.include.push(N)}catch(V){u={error:V}}finally{try{B&&!B.done&&(h=M["return"])&&h.call(M)}finally{if(u)throw u.error}}T.length&&(y.exclude=[]);try{for(D=s(T),q=D.next();!q.done;q=D.next())A=q.value,y.exclude.push(A)}catch(J){d={error:J}}finally{try{q&&!q.done&&(_=D["return"])&&_.call(D)}finally{if(d)throw d.error}}S.size&&(y.compilerOptions.types=[]);try{for(U=s(S),W=U.next();!W.done;W=U.next())H=W.value,y.compilerOptions.types.push(H)}catch(K){g={error:K}}finally{try{W&&!W.done&&(m=U["return"])&&m.call(U)}finally{if(g)throw g.error}}return[2,JSON.stringify(y)]}})})},t.prototype._generatePolyfillFile=function(e,t){return i(this,void 0,void 0,function(){var n,r,i,a,u,h,d,g,m,y,b,k,T,w,S,x;return o(this,function(o){switch(o.label){case 0:u=l.join(this._workspaceDirPath,"polyfills.wallaby.ts"),h=[];try{for(d=s(t),g=d.next();!g.done;g=d.next())m=g.value,h.push("require('"+p.normalizePath(m)+"');")}catch(C){n={error:C}}finally{try{g&&!g.done&&(r=d["return"])&&r.call(d)}finally{if(n)throw n.error}}return[4,f(u)];case 1:return o.sent()?(h.push("require('"+p.normalizePath(u)+"');"),[3,13]):[3,2];case 2:return u=l.join(this._workspaceDirPath,"polyfills.workspace.ts"),[4,f(u)];case 3:return o.sent()?(h.push("require('"+p.normalizePath(u)+"');"),[3,13]):[3,4];case 4:y=new Set,o.label=5;case 5:o.trys.push([5,11,12,13]),b=s(e),k=b.next(),o.label=6;case 6:return k.done?[3,10]:(T=k.value,T.configuration.architect.test.options.polyfills?(v("Setting up polyfills for %s.",T.name),w=l.resolve(l.join(this._workspaceDirPath,T.configuration.architect.test.options.polyfills)),[4,f(w)]):[3,9]);case 7:return o.sent()?[4,_(w,"utf-8")]:[3,9];case 8:S=o.sent(),y.has(S)||(y.add(S),h.push("require('"+p.normalizePath(w)+"');")),o.label=9;case 9:return k=b.next(),[3,6];case 10:return[3,13];case 11:return x=o.sent(),i={error:x},[3,13];case 12:try{k&&!k.done&&(a=b["return"])&&a.call(b)}finally{if(i)throw i.error}return[7];case 13:return h.length?[2,{path:l.join(this._workspaceDirPath,"wallaby-polyfills.js"),code:h.join(c.EOL)}]:[2,null]}})})},t.prototype._generatesStyleFile=function(e){var t,n,r,i,o=[];try{for(var a=s(e),u=a.next();!u.done;u=a.next()){var h=u.value,d=h.configuration.architect.test.options,f=d.styles;if(f){v("Setting up styles for %s.",h.name);try{for(var _=s(f),g=_.next();!g.done;g=_.next()){var m=g.value,y=!0;"string"!=typeof m&&(y=void 0===m.inject||m.inject,m=m.input),y?o.push("require('"+p.normalizePath(l.resolve(l.join(this._workspaceDirPath,m)))+"');"):console.warn("Angular CLI automatic configuration: the style "+m+" has an 'inject' attribute set to false, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.")}}catch(b){r={error:b}}finally{try{g&&!g.done&&(i=_["return"])&&i.call(_)}finally{if(r)throw r.error}}}}}catch(k){t={error:k}}finally{try{u&&!u.done&&(n=a["return"])&&n.call(a)}finally{if(t)throw t.error}}return o.length?{path:l.join(this._workspaceDirPath,"wallaby-styles.js"),code:o.join(c.EOL)}:null},t.prototype._generatesAssetRoutes=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,a,c,u,h,d,_,g,m,y,b,k,T,b,k,T,w,S;return o(this,function(o){switch(o.label){case 0:a=[],o.label=1;case 1:o.trys.push([1,13,14,15]),c=s(e),u=c.next(),o.label=2;case 2:if(u.done)return[3,12];if(h=u.value,d=new Set,_=h.configuration.architect.test.options.assets,!_||!_.length)return[3,11];v("Setting up assets for %s.",h.name),o.label=3;case 3:o.trys.push([3,9,10,11]),g=s(_),m=g.next(),o.label=4;case 4:return m.done?[3,8]:(y=m.value,"string"!=typeof y?[3,6]:(b=p.normalizePath(l.resolve(l.join(this._workspaceDirPath,y))),[4,f(b)]));case 5:return o.sent()&&(k=""+l.posix.sep+l.basename(b),T=""+k+b,d.has(T)||(a.push({path:{virtual:k,physical:b}}),d.add(T))),[3,7];case 6:y&&y.input&&y.output&&(b=p.normalizePath(l.resolve(l.join(this._workspaceDirPath,y.input))),k=y.output.startsWith(l.posix.sep)?y.output:""+l.posix.sep+y.output,T=""+k+b,d.has(T)||(a.push({path:{virtual:k,physical:b}}),d.add(T))),o.label=7;case 7:return m=g.next(),[3,4];case 8:return[3,11];case 9:return w=o.sent(),r={error:w},[3,11];case 10:try{m&&!m.done&&(i=g["return"])&&i.call(g)}finally{if(r)throw r.error}return[7];case 11:return u=c.next(),[3,2];case 12:return[3,15];case 13:return S=o.sent(),t={error:S},[3,15];case 14:try{u&&!u.done&&(n=c["return"])&&n.call(c)}finally{if(t)throw t.error}return[7];case 15:return[2,a]}})})},t.prototype._generatesScripts=function(e){var t,n,r,i,o,a,c,u,h=new Set,d=[],f=new Set,_=[],g=new Map;try{for(var m=s(e),y=m.next();!y.done;y=m.next()){var b=y.value,k=b.configuration.architect.test.options.scripts;if(k&&k.length){v("Setting up scripts for %s.",b.name);var T=""+(new Date).getTime(),w=0;
try{for(var S=s(k),x=S.next();!x.done;x=S.next()){var C=x.value,F=!0;w++;var E=""+b.name+T+w;"string"!=typeof C&&(E=C.bundleName?""+b.name+C.bundleName:E,F=void 0===C.inject||C.inject,C=C.input);var R=p.normalizePath(l.resolve(l.join(this._workspaceDirPath,C)));if(R.startsWith(this._workspaceDirPath)){if(!F){console.warn("Angular CLI automatic configuration: the script "+C+" has an 'inject' attribute set to false, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.");continue}g.has(E)||g.set(E,{inject:F,scripts:[]});var P=g.get(E);if(P.inject!=F)throw new Error("The "+E+" bundle is mixing injected and non-injected scripts.");P.scripts.push(p.normalizePath(l.relative(this._workspaceDirPath,R))),f.has(E)||_.push(E),f.add(E)}else console.warn("Angular CLI automatic configuration: the script "+C+" is outside of the workspace, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.")}}catch(L){r={error:L}}finally{try{x&&!x.done&&(i=S["return"])&&i.call(S)}finally{if(r)throw r.error}}}}}catch(j){t={error:j}}finally{try{y&&!y.done&&(n=m["return"])&&n.call(m)}finally{if(t)throw t.error}}try{for(var I=s(_),O=I.next();!O.done;O=I.next()){var E=O.value,P=g.get(E);if(P&&P.inject)try{for(var M=s(P.scripts),B=M.next();!B.done;B=M.next()){var C=B.value;h.has(C)||(d.push(C),h.add(C))}}catch(N){c={error:N}}finally{try{B&&!B.done&&(u=M["return"])&&u.call(M)}finally{if(c)throw c.error}}}}catch(D){o={error:D}}finally{try{O&&!O.done&&(a=I["return"])&&a.call(I)}finally{if(o)throw o.error}}return d},t.prototype._fixStyleRules=function(e,t){var n,r,i,o,c,u,h,f,_,g,m,y,b,k,T=this;if(v("Sanitizing style rules."),t.module&&t.module.rules){var w=t.module.rules,S=d.flatten(w.filter(function(e){return e.use}).map(function(e){return e.use}));try{for(var x=s(S),C=x.next();!C.done;C=x.next()){var F=C.value;"string"!=typeof F&&F.options&&("sass-loader"!==F.loader&&"less-loader"!==F.loader&&"stylus-loader"!==F.loader&&"postcss-loader"!==F.loader||(F.options.sourceMap=!1))}}catch(E){n={error:E}}finally{try{C&&!C.done&&(r=x["return"])&&r.call(x)}finally{if(n)throw n.error}}for(var R=new Map,P=0;P<w.length;P++){var L=w[P];if(L.use&&L.use.length){var F=L.use[L.use.length-1];"string"!=typeof F&&("sass-loader"!==F.loader&&"less-loader"!==F.loader&&"stylus-loader"!==F.loader&&"postcss-loader"!==F.loader||R.set(P,L))}}var j=0;try{for(var I=s(R),O=I.next();!O.done;O=I.next()){var M=a(O.value,1),B=M[0];w.splice(B-j,1),j++}}catch(N){i={error:N}}finally{try{O&&!O.done&&(o=I["return"])&&o.call(I)}finally{if(i)throw i.error}}var D=new Map;try{for(var q=s(R),A=q.next();!A.done;A=q.next()){var U=a(A.value,2),L=U[1],W={test:L.test,oneOf:[]};D.has(L.test.toString())?W=D.get(L.test.toString()):D.set(L.test.toString(),W);var H=function(t){var n,r,i,o,a={use:[]};try{for(var c=s(L.use),u=c.next();!u.done;u=c.next()){var h=u.value;if("string"!=typeof h){var d={loader:h.loader,options:h.options?Object.assign({},h.options):void 0};if(d.options){var f=null,_=t.configuration.architect.test.options.stylePreprocessorOptions;if(_&&_.includePaths){f=[];try{for(var g=s(_.includePaths),m=g.next();!m.done;m=g.next()){var v=m.value;f.push(p.normalizePath(l.resolve(l.join(z._workspaceDirPath,v))))}}catch(y){i={error:y}}finally{try{m&&!m.done&&(o=g["return"])&&o.call(g)}finally{if(i)throw i.error}}}"less-loader"!==h.loader&&"stylus-loader"!==h.loader||(d.options.paths=f),"sass-loader"===h.loader&&(d.options.includePaths=f)}a.use.push(d)}else a.use.push(h)}}catch(b){n={error:b}}finally{try{u&&!u.done&&(r=c["return"])&&r.call(c)}finally{if(n)throw n.error}}var k=t.configuration.architect.test.options.styles||[];if(L.include&&L.include.length){if(a.include=[],!k.length)return"continue";k.forEach(function(e){return a.include.push(l.resolve(l.join(T._workspaceDirPath,"string"==typeof e?e:e.input)))})}else a.exclude=[],k.forEach(function(e){return a.exclude.push(l.resolve(l.join(T._workspaceDirPath,"string"==typeof e?e:e.input)))}),e.filter(function(e){return e.name!==t.name}).forEach(function(e){a.exclude.push(l.resolve(l.join(T._workspaceDirPath,e.configuration.root))),(e.configuration.architect.test.options.styles||[]).forEach(function(e){return a.exclude.push(l.resolve(l.join(T._workspaceDirPath,"string"==typeof e?e:e.input)))})});W.oneOf.push(a)},z=this;try{for(var Q=s(e),V=Q.next();!V.done;V=Q.next()){var J=V.value;H(J)}}catch(K){h={error:K}}finally{try{V&&!V.done&&(f=Q["return"])&&f.call(Q)}finally{if(h)throw h.error}}}}catch(Y){c={error:Y}}finally{try{A&&!A.done&&(u=q["return"])&&u.call(q)}finally{if(c)throw c.error}}try{for(var G=s(R),X=G.next();!X.done;X=G.next()){var Z=a(X.value,2),L=Z[1];if((!L.include||!L.include.length)&&D.has(L.test.toString())){var W=D.get(L.test.toString()),$={use:[]};try{for(var ee=s(L.use),te=ee.next();!te.done;te=ee.next()){var F=te.value;if("string"!=typeof F){var ne={loader:F.loader,options:F.options?Object.assign({},F.options):void 0};ne.options&&("less-loader"!==F.loader&&"stylus-loader"!==F.loader||delete ne.options.paths,"sass-loader"===F.loader&&delete ne.options.includePaths),$.use.push(ne)}else $.use.push(F)}}catch(re){m={error:re}}finally{try{te&&!te.done&&(y=ee["return"])&&y.call(ee)}finally{if(m)throw m.error}}W.oneOf.push($)}}}catch(ie){_={error:ie}}finally{try{X&&!X.done&&(g=G["return"])&&g.call(G)}finally{if(_)throw _.error}}try{for(var oe=s(D),se=oe.next();!se.done;se=oe.next()){var ae=a(se.value,2),W=ae[1];w.push(W)}}catch(le){b={error:le}}finally{try{se&&!se.done&&(k=oe["return"])&&k.call(oe)}finally{if(b)throw b.error}}}},t.prototype._deduplicateMainFileContent=function(e){var t=/import\s*'zone\.js\/dist\/zone'\s*;/,n=/import\s*'zone\.js\/dist\/zone-testing'\s*;/,r=/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,i=/declare\s+const\s+require\s*:\s*any\s*;/,o=/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,s=/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)\s*\)\s*;/;return e.replace(t,"").replace(n,"").replace(r,"").replace(i,"").replace(o,"").replace(s,"")},t}();t.exports=y},{"../../../postprocessors/webpack/initialize":32,"../../../utils":50,fs:void 0,lodash:void 0,os:void 0,path:void 0,util:void 0}],21:[function(e,t,n){function r(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var i=-1,o=1,s=0;r.Diff,r.prototype.diff_main=function(e,t,n,r){"undefined"==typeof r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=r;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[s,e]]:[];"undefined"==typeof n&&(n=!0);var o=n,a=this.diff_commonPrefix(e,t),l=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var c=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var u=this.diff_compute_(e,t,o,i);return l&&u.unshift([s,l]),c&&u.push([s,c]),this.diff_cleanupMerge(u),u},r.prototype.diff_compute_=function(e,t,n,r){var a;if(!e)return[[o,t]];if(!t)return[[i,e]];var l=e.length>t.length?e:t,c=e.length>t.length?t:e,u=l.indexOf(c);if(u!=-1)return a=[[o,l.substring(0,u)],[s,c],[o,l.substring(u+c.length)]],e.length>t.length&&(a[0][0]=a[2][0]=i),a;if(1==c.length)return[[i,e],[o,t]];var h=this.diff_halfMatch_(e,t);if(h){var d=h[0],p=h[1],f=h[2],_=h[3],g=h[4],m=this.diff_main(d,f,n,r),v=this.diff_main(p,_,n,r);return m.concat([[s,g]],v)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},r.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var a=r.lineArray,l=this.diff_main(e,t,!1,n);this.diff_charsToLines_(l,a),this.diff_cleanupSemantic(l),l.push([s,""]);for(var c=0,u=0,h=0,d="",p="";c<l.length;){switch(l[c][0]){case o:h++,p+=l[c][1];break;case i:u++,d+=l[c][1];break;case s:if(u>=1&&h>=1){l.splice(c-u-h,u+h),c=c-u-h;for(var r=this.diff_main(d,p,!1,n),f=r.length-1;f>=0;f--)l.splice(c,0,r[f]);c+=r.length}h=0,u=0,d="",p=""}c++}return l.pop(),l},r.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,s=t.length,a=Math.ceil((r+s)/2),l=a,c=2*a,u=new Array(c),h=new Array(c),d=0;d<c;d++)u[d]=-1,h[d]=-1;u[l+1]=0,h[l+1]=0;for(var p=r-s,f=p%2!=0,_=0,g=0,m=0,v=0,y=0;y<a&&!((new Date).getTime()>n);y++){for(var b=-y+_;b<=y-g;b+=2){var k,T=l+b;k=b==-y||b!=y&&u[T-1]<u[T+1]?u[T+1]:u[T-1]+1;for(var w=k-b;k<r&&w<s&&e.charAt(k)==t.charAt(w);)k++,w++;if(u[T]=k,k>r)g+=2;else if(w>s)_+=2;else if(f){var S=l+p-b;if(S>=0&&S<c&&h[S]!=-1){var x=r-h[S];if(k>=x)return this.diff_bisectSplit_(e,t,k,w,n)}}}for(var C=-y+m;C<=y-v;C+=2){var x,S=l+C;x=C==-y||C!=y&&h[S-1]<h[S+1]?h[S+1]:h[S-1]+1;for(var F=x-C;x<r&&F<s&&e.charAt(r-x-1)==t.charAt(s-F-1);)x++,F++;if(h[S]=x,x>r)v+=2;else if(F>s)m+=2;else if(!f){var T=l+p-C;if(T>=0&&T<c&&u[T]!=-1){var k=u[T],w=l+k-T;if(x=r-x,k>=x)return this.diff_bisectSplit_(e,t,k,w,n)}}}}return[[i,e],[o,t]]},r.prototype.diff_bisectSplit_=function(e,t,n,r,i){var o=e.substring(0,n),s=t.substring(0,r),a=e.substring(n),l=t.substring(r),c=this.diff_main(o,s,!1,i),u=this.diff_main(a,l,!1,i);return c.concat(u)},r.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,o=-1,s=r.length;o<e.length-1;){o=e.indexOf("\n",n),o==-1&&(o=e.length-1);var a=e.substring(n,o+1);n=o+1,(i.hasOwnProperty?i.hasOwnProperty(a):void 0!==i[a])?t+=String.fromCharCode(i[a]):(t+=String.fromCharCode(s),i[a]=s,r[s++]=a)}return t}var r=[],i={};r[0]="";var o=n(e),s=n(t);return{chars1:o,chars2:s,lineArray:r}},r.prototype.diff_wordMode=function(e,t){var n=this.diff_linesToWords_(e,t),r=n.chars1,i=n.chars2,o=n.lineArray,s=this.diff_main(r,i,!1);return this.diff_charsToLines_(s,o),s},r.prototype.diff_linesToWords_=function(e,t){function n(e){for(var t=e.split(/(\s+|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&s.test(t[n])&&s.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}function r(e){for(var t="",r=n(e),s=i.length,a=0,l=r.length;a<l;a++){var c=r[a];(o.hasOwnProperty?o.hasOwnProperty(c):void 0!==o[c])?t+=String.fromCharCode(o[c]):(t+=String.fromCharCode(s),o[c]=s,i[s++]=c)}return t}var i=[],o={};i[0]="";var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,a=r(e),l=r(t);return{chars1:a,chars2:l,lineArray:i}},r.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],o=0;o<r.length;o++)i[o]=t[r.charCodeAt(o)];e[n][1]=i.join("")}},r.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(o,i)==t.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},r.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},r.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var o=0,s=1;;){var a=e.substring(i-s),l=t.indexOf(a);if(l==-1)return o;s+=l,0!=l&&e.substring(i-s)!=t.substring(0,s)||(o=s,s++)}},r.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var r,i,o,a,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";(c=t.indexOf(l,c+1))!=-1;){var h=s.diff_commonPrefix(e.substring(n),t.substring(c)),d=s.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<d+h&&(u=t.substring(c-d,c)+t.substring(c,c+h),r=e.substring(0,n-d),i=e.substring(n+h),o=t.substring(0,c-d),a=t.substring(c+h))}return 2*u.length>=e.length?[r,i,o,a,u]:null}if(this.Diff_Timeout<=0)return null;var r=e.length>t.length?e:t,i=e.length>t.length?t:e;if(r.length<4||2*i.length<r.length)return null;var o,s=this,a=n(r,i,Math.ceil(r.length/4)),l=n(r,i,Math.ceil(r.length/2));if(!a&&!l)return null;o=l?a&&a[4].length>l[4].length?a:l:a;var c,u,h,d;e.length>t.length?(c=o[0],u=o[1],h=o[2],d=o[3]):(h=o[0],d=o[1],c=o[2],u=o[3]);var p=o[4];return[c,u,h,d,p]},r.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,a=null,l=0,c=0,u=0,h=0,d=0;l<e.length;)e[l][0]==s?(n[r++]=l,c=h,u=d,h=0,d=0,a=e[l][1]):(e[l][0]==o?h+=e[l][1].length:d+=e[l][1].length,a&&a.length<=Math.max(c,u)&&a.length<=Math.max(h,d)&&(e.splice(n[r-1],0,[i,a]),e[n[r-1]+1][0]=o,r--,r--,l=r>0?n[r-1]:-1,c=0,u=0,h=0,d=0,a=null,t=!0)),l++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),l=1;l<e.length;){if(e[l-1][0]==i&&e[l][0]==o){var p=e[l-1][1],f=e[l][1],_=this.diff_commonOverlap_(p,f),g=this.diff_commonOverlap_(f,p);_>=g?(_>=p.length/2||_>=f.length/2)&&(e.splice(l,0,[s,f.substring(0,_)]),e[l-1][1]=p.substring(0,p.length-_),e[l+1][1]=f.substring(_),l++):(g>=p.length/2||g>=f.length/2)&&(e.splice(l,0,[s,p.substring(0,g)]),e[l-1][0]=o,e[l-1][1]=f.substring(0,f.length-g),e[l+1][0]=i,e[l+1][1]=p.substring(g),l++),l++}l++}},r.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),i=t.charAt(0),o=n.match(r.nonAlphaNumericRegex_),s=i.match(r.nonAlphaNumericRegex_),a=o&&n.match(r.whitespaceRegex_),l=s&&i.match(r.whitespaceRegex_),c=a&&n.match(r.linebreakRegex_),u=l&&i.match(r.linebreakRegex_),h=c&&e.match(r.blanklineEndRegex_),d=u&&t.match(r.blanklineStartRegex_);return h||d?5:c||u?4:o&&!a&&l?3:a||l?2:o||s?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==s&&e[n+1][0]==s){var i=e[n-1][1],o=e[n][1],a=e[n+1][1],l=this.diff_commonSuffix(i,o);if(l){var c=o.substring(o.length-l);i=i.substring(0,i.length-l),o=c+o.substring(0,o.length-l),a=c+a}for(var u=i,h=o,d=a,p=t(i,o)+t(o,a);o.charAt(0)===a.charAt(0);){i+=o.charAt(0),o=o.substring(1)+a.charAt(0),a=a.substring(1);var f=t(i,o)+t(o,a);f>=p&&(p=f,u=i,h=o,d=a)}e[n-1][1]!=u&&(u?e[n-1][1]=u:(e.splice(n-1,1),n--),e[n][1]=h,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},r.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,r.whitespaceRegex_=/\s/,r.linebreakRegex_=/[\r\n]/,r.blanklineEndRegex_=/\n\r?\n$/,r.blanklineStartRegex_=/^\r?\n\r?\n/,r.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],r=0,a=null,l=0,c=!1,u=!1,h=!1,d=!1;l<e.length;)e[l][0]==s?(e[l][1].length<this.Diff_EditCost&&(h||d)?(n[r++]=l,c=h,u=d,a=e[l][1]):(r=0,a=null),h=d=!1):(e[l][0]==i?d=!0:h=!0,a&&(c&&u&&h&&d||a.length<this.Diff_EditCost/2&&c+u+h+d==3)&&(e.splice(n[r-1],0,[i,a]),e[n[r-1]+1][0]=o,r--,a=null,c&&u?(h=d=!0,r=0):(r--,l=r>0?n[r-1]:-1,h=d=!1),t=!0)),l++;t&&this.diff_cleanupMerge(e)},r.prototype.diff_cleanupMerge=function(e){e.push([s,""]);for(var t,n=0,r=0,a=0,l="",c="";n<e.length;)switch(e[n][0]){case o:a++,c+=e[n][1],n++;break;case i:r++,l+=e[n][1],n++;break;case s:r+a>1?(0!==r&&0!==a&&(t=this.diff_commonPrefix(c,l),0!==t&&(n-r-a>0&&e[n-r-a-1][0]==s?e[n-r-a-1][1]+=c.substring(0,t):(e.splice(0,0,[s,c.substring(0,t)]),n++),c=c.substring(t),l=l.substring(t)),t=this.diff_commonSuffix(c,l),0!==t&&(e[n][1]=c.substring(c.length-t)+e[n][1],c=c.substring(0,c.length-t),l=l.substring(0,l.length-t))),0===r?e.splice(n-a,r+a,[o,c]):0===a?e.splice(n-r,r+a,[i,l]):e.splice(n-r-a,r+a,[i,l],[o,c]),n=n-r-a+(r?1:0)+(a?1:0)+1):0!==n&&e[n-1][0]==s?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,a=0,r=0,l="",c=""}""===e[e.length-1][1]&&e.pop();var u=!1;for(n=1;n<e.length-1;)e[n-1][0]==s&&e[n+1][0]==s&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),u=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),u=!0)),n++;u&&this.diff_cleanupMerge(e)},r.prototype.diff_xIndex=function(e,t){var n,r=0,s=0,a=0,l=0;for(n=0;n<e.length&&(e[n][0]!==o&&(r+=e[n][1].length),e[n][0]!==i&&(s+=e[n][1].length),!(r>t));n++)a=r,l=s;return e.length!=n&&e[n][0]===i?l:l+(t-a)},r.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,r=/</g,a=/>/g,l=/\n/g,c=0;c<e.length;c++){var u=e[c][0],h=e[c][1],d=h.replace(n,"&amp;").replace(r,"&lt;").replace(a,"&gt;").replace(l,"&para;<br>");switch(u){case o:t[c]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case i:t[c]='<del style="background:#ffe6e6;">'+d+"</del>";break;case s:t[c]="<span>"+d+"</span>"}}return t.join("")},r.prototype.diff_prettyCompactHtml=function(e){for(var t=[],n=0;n<e.length;n++){var r=0===n,a=n===e.length-1,l=e[n][0],c=e[n][1];switch(l){case o:t[n]='<ins style="background:#e6ffe6;">'+this.prepare_text_(c)+"</ins>";break;case i:t[n]='<del style="background:#ffe6e6;">'+this.prepare_text_(c)+"</del>";break;case s:t[n]="<span>"+this.truncate_context_(c,r,a)+"</span>"}}return t.join("")},r.prototype.prepare_text_=function(e){var t=/&/g,n=/</g,r=/>/g,i=/\n/g;return e.replace(t,"&amp;").replace(n,"&lt;").replace(r,"&gt;").replace(i,"&para;<br>")},r.prototype.truncate_context_=function(e,t,n){var r=e.split(/\r\n|\r|\n/),i='<span class="dots">...</span>',o=r.length,s=4;return o<=s?this.prepare_text_(e):!t&&!n&&o<=2*s?this.prepare_text_(e):t?i+this.prepare_text_("\n"+r.slice(-s).join("\n")):n?this.prepare_text_(r.slice(0,s).join("\n")+"\n")+i:this.prepare_text_(r.slice(0,s).join("\n")+"\n")+i+this.prepare_text_("\n"+r.slice(-s).join("\n"))},r.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==o&&(t[n]=e[n][1]);return t.join("")},r.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==i&&(t[n]=e[n][1]);return t.join("")},r.prototype.diff_levenshtein=function(e){for(var t=0,n=0,r=0,a=0;a<e.length;a++){var l=e[a][0],c=e[a][1];switch(l){case o:n+=c.length;break;case i:r+=c.length;break;case s:t+=Math.max(n,r),n=0,r=0}}return t+=Math.max(n,r)},r.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case o:t[n]="+"+encodeURI(e[n][1]);break;case i:t[n]="-"+e[n][1].length;break;case s:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},r.prototype.diff_fromDelta=function(e,t){for(var n=[],r=0,a=0,l=t.split(/\t/g),c=0;c<l.length;c++){var u=l[c].substring(1);switch(l[c].charAt(0)){case"+":try{n[r++]=[o,decodeURI(u)]}catch(h){throw new Error("Illegal escape in diff_fromDelta: "+u)}break;case"-":case"=":var d=parseInt(u,10);if(isNaN(d)||d<0)throw new Error("Invalid number in diff_fromDelta: "+u);var p=e.substring(a,a+=d);"="==l[c].charAt(0)?n[r++]=[s,p]:n[r++]=[i,p];break;default:if(l[c])throw new Error("Invalid diff operation in diff_fromDelta: "+l[c])}}if(a!=e.length)throw new Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return n},r.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},r.prototype.match_bitap_=function(e,t,n){function r(e,r){var i=e/t.length,s=Math.abs(n-r);return o.Match_Distance?i+s/o.Match_Distance:s?1:i}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),o=this,s=this.Match_Threshold,a=e.indexOf(t,n);a!=-1&&(s=Math.min(r(0,a),s),a=e.lastIndexOf(t,n+t.length),a!=-1&&(s=Math.min(r(0,a),s)));var l=1<<t.length-1;a=-1;for(var c,u,h,d=t.length+e.length,p=0;p<t.length;p++){for(c=0,u=d;c<u;)r(p,n+u)<=s?c=u:d=u,u=Math.floor((d-c)/2+c);d=u;var f=Math.max(1,n-u+1),_=Math.min(n+u,e.length)+t.length,g=Array(_+2);g[_+1]=(1<<p)-1;for(var m=_;m>=f;m--){var v=i[e.charAt(m-1)];if(0===p?g[m]=(g[m+1]<<1|1)&v:g[m]=(g[m+1]<<1|1)&v|((h[m+1]|h[m])<<1|1)|h[m+1],g[m]&l){var y=r(p,m-1);if(y<=s){if(s=y,a=m-1,!(a>n))break;f=Math.max(1,2*n-a)}}}if(r(p+1,n)>s)break;h=g}return a},r.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},r.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var i=t.substring(e.start2-r,e.start2);i&&e.diffs.unshift([s,i]);var o=t.substring(e.start2+e.length1,e.start2+e.length1+r);o&&e.diffs.push([s,o]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+o.length,e.length2+=i.length+o.length}},r.prototype.patch_make=function(e,t,n){var a,l;if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof n)a=e,l=this.diff_main(a,t,!0),l.length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof n)l=e,a=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof n)a=e,l=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");a=e,l=n}if(0===l.length)return[];for(var c=[],u=new r.patch_obj,h=0,d=0,p=0,f=a,_=a,g=0;g<l.length;g++){var m=l[g][0],v=l[g][1];switch(h||m===s||(u.start1=d,u.start2=p),m){case o:u.diffs[h++]=l[g],u.length2+=v.length,_=_.substring(0,p)+v+_.substring(p);break;case i:u.length1+=v.length,u.diffs[h++]=l[g],_=_.substring(0,p)+_.substring(p+v.length);break;case s:v.length<=2*this.Patch_Margin&&h&&l.length!=g+1?(u.diffs[h++]=l[g],u.length1+=v.length,u.length2+=v.length):v.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(u,f),c.push(u),u=new r.patch_obj,h=0,f=_,d=p)}m!==o&&(d+=v.length),m!==i&&(p+=v.length)}return h&&(this.patch_addContext_(u,f),c.push(u)),c},r.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],o=new r.patch_obj;o.diffs=[];for(var s=0;s<i.diffs.length;s++)o.diffs[s]=i.diffs[s].slice();o.start1=i.start1,o.start2=i.start2,o.length1=i.length1,o.length2=i.length2,t[n]=o}return t},r.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var r=0,a=[],l=0;l<e.length;l++){var c,u=e[l].start2+r,h=this.diff_text1(e[l].diffs),d=-1;if(h.length>this.Match_MaxBits?(c=this.match_main(t,h.substring(0,this.Match_MaxBits),u),c!=-1&&(d=this.match_main(t,h.substring(h.length-this.Match_MaxBits),u+h.length-this.Match_MaxBits),(d==-1||c>=d)&&(c=-1))):c=this.match_main(t,h,u),c==-1)a[l]=!1,r-=e[l].length2-e[l].length1;else{a[l]=!0,r=c-u;var p;if(p=d==-1?t.substring(c,c+h.length):t.substring(c,d+this.Match_MaxBits),h==p)t=t.substring(0,c)+this.diff_text2(e[l].diffs)+t.substring(c+h.length);else{var f=this.diff_main(h,p,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(f)/h.length>this.Patch_DeleteThreshold)a[l]=!1;else{this.diff_cleanupSemanticLossless(f);for(var _,g=0,m=0;m<e[l].diffs.length;m++){var v=e[l].diffs[m];v[0]!==s&&(_=this.diff_xIndex(f,g)),v[0]===o?t=t.substring(0,c+_)+v[1]+t.substring(c+_):v[0]===i&&(t=t.substring(0,c+_)+t.substring(c+this.diff_xIndex(f,g+v[1].length))),v[0]!==i&&(g+=v[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,a]},r.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",r=1;r<=t;r++)n+=String.fromCharCode(r);for(var r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var i=e[0],o=i.diffs;if(0==o.length||o[0][0]!=s)o.unshift([s,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>o[0][1].length){var a=t-o[0][1].length;o[0][1]=n.substring(o[0][1].length)+o[0][1],i.start1-=a,i.start2-=a,i.length1+=a,i.length2+=a}if(i=e[e.length-1],o=i.diffs,0==o.length||o[o.length-1][0]!=s)o.push([s,n]),i.length1+=t,i.length2+=t;else if(t>o[o.length-1][1].length){var a=t-o[o.length-1][1].length;o[o.length-1][1]+=n.substring(0,a),i.length1+=a,i.length2+=a}return n},r.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var a=e[n];e.splice(n--,1);for(var l=a.start1,c=a.start2,u="";0!==a.diffs.length;){var h=new r.patch_obj,d=!0;for(h.start1=l-u.length,h.start2=c-u.length,""!==u&&(h.length1=h.length2=u.length,h.diffs.push([s,u]));0!==a.diffs.length&&h.length1<t-this.Patch_Margin;){var p=a.diffs[0][0],f=a.diffs[0][1];p===o?(h.length2+=f.length,c+=f.length,h.diffs.push(a.diffs.shift()),d=!1):p===i&&1==h.diffs.length&&h.diffs[0][0]==s&&f.length>2*t?(h.length1+=f.length,l+=f.length,d=!1,h.diffs.push([p,f]),a.diffs.shift()):(f=f.substring(0,t-h.length1-this.Patch_Margin),h.length1+=f.length,l+=f.length,p===s?(h.length2+=f.length,c+=f.length):d=!1,h.diffs.push([p,f]),f==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(f.length))}u=this.diff_text2(h.diffs),u=u.substring(u.length-this.Patch_Margin);var _=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);""!==_&&(h.length1+=_.length,h.length2+=_.length,0!==h.diffs.length&&h.diffs[h.diffs.length-1][0]===s?h.diffs[h.diffs.length-1][1]+=_:h.diffs.push([s,_])),d||e.splice(++n,0,h)}}},r.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},r.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),a=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<n.length;){var c=n[a].match(l);if(!c)throw new Error("Invalid patch string: "+n[a]);var u=new r.patch_obj;for(t.push(u),u.start1=parseInt(c[1],10),""===c[2]?(u.start1--,u.length1=1):"0"==c[2]?u.length1=0:(u.start1--,u.length1=parseInt(c[2],10)),u.start2=parseInt(c[3],10),""===c[4]?(u.start2--,u.length2=1):"0"==c[4]?u.length2=0:(u.start2--,u.length2=parseInt(c[4],10)),a++;a<n.length;){var h=n[a].charAt(0);try{var d=decodeURI(n[a].substring(1))}catch(p){throw new Error("Illegal escape in patch_fromText: "+d)}if("-"==h)u.diffs.push([i,d]);else if("+"==h)u.diffs.push([o,d]);else if(" "==h)u.diffs.push([s,d]);else{if("@"==h)break;if(""!==h)throw new Error('Invalid patch mode "'+h+'" in: '+d)}a++}}return t},r.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},r.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,r=["@@ -"+e+" +"+t+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case o:n="+";break;case i:n="-";break;case s:n=" "}r[a+1]=n+encodeURI(this.diffs[a][1])+"\n"}return r.join("").replace(/%20/g," ")},t.exports=r},{}],22:[function(e,t,n){var r=logger.create("electronRunner").debug,i=e("path"),o=e("child_process"),s=e("./runWorkerPool"),a=e("./browserEnvironment"),l=0,c=function(e){var t=this;t._project=e,t._screenShotReady=Q.when(!0),t._params=e.settings().env.params,t._runner=e.settings().env.runner,t._envOptions=e.settings().env.options,t._clearMemoryCache=e.settings().env.clearMemoryCache,t._host=void 0,t._callbacks=Object.create(null),t._hostPromise=Q.promise(function(e,n){try{var r=_.extend({},process.env,t._params.env?_.reduce(t._params.env.split(";"),function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{}):{});delete r.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete r.ELECTRON_RUN_AS_NODE,r.ELECTRON_DISABLE_SECURITY_WARNINGS=!0,t._host=o.fork(i.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:t._runner,env:r,execArgv:t._params.runner?t._params.runner.split(" "):[]}),t._host.on("error",function(e){t._handleHostError(e)}),t._host.on("message",function(n){try{n.id?t._responseWithCorrelationId(n):"ready"===n.type?e(t._host):"error"===n.type&&t._handleHostError(n.error)}catch(r){t._handleHostError(r)}})}catch(s){n(s)}})["catch"](function(e){t._handleHostError(e)}),t._workerPool=new s(t._project,{create:_.bind(t._create,t),recycle:_.bind(t._recycle,t),healthy:function(){return!0},prepare:_.bind(t._prepare,t)}),t._browserEnvironment=new a(e,t._workerPool)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_handleHostError:function(e){var t=this;e=e||{},t._project._cleanStack(e);var n="Electron runner error: "+(e.message||"unknown"),r=e.stack||n;console.error(r),t._project._emitTestRunError(n)},_create:function(e,t){var n=this;n._hostPromise.then(function(){t({pageId:e})})},_recycle:function(e){var t=this;t._host&&t._host.send({type:"closePage",pageId:e.pageId})},_evaluateOnPage:function(e,t,n){var r=this,i={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};r._requestWithCorrelationId(i,n||_.noop)},_openPage:function(e,t,n,r){var i=this,o={type:"openPage",pageId:e,url:t,options:n};i._requestWithCorrelationId(o,r||_.noop)},_closePage:function(e){var t=this;t._host.send({type:"closePage",pageId:e})},_capturePage:function(e,t){var n=this,r=Q.defer();try{n._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){r.resolve()}),n._screenShotReady=r.promise}catch(i){r.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",i.message)}},_prepare:function(e,t){var n=this,i=_.randomId(),o=n._browserEnvironment.sandboxName(t,i);return r("Starting sandbox [%s]",o),n._workerPool.getWorker(t).then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Preparing sandbox [%s]",o),n._browserEnvironment.prepareSandbox(e,i,t))}).then(function(e){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Prepared sandbox [%s]",o),Q.when({instance:{resume:function(){n._evaluateOnPage(t,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnPage(t,function(){},e)},close:function(){n._closePage(t)},closing:function(){n._screenShotReady=Q.when()},start:function(r){n._openPage(t,e,n._envOptions,function(e){r(e.status)&&n._evaluateOnPage(t,function(){$_$tracer.start()})})}},name:o,sessionId:i,workerId:t}))})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp()).then(function(t){return e._workerPool.setFileRoot(e._browserEnvironment.sandboxRootUrl()),Q.when(t)})},stop:function(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()},_requestWithCorrelationId:function(e,t){var n=this,r=++l,i=n._callbacks[r]={done:t};e.id=r,n._host.send(e),i.timeout=setTimeout(function(){delete n._callbacks[r]},12e5)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}},t.exports=c},{"./browserEnvironment":13,"./runWorkerPool":42,child_process:void 0,path:void 0}],23:[function(e,t,n){var r=e("path"),i=e("parseurl"),o=e("mime"),s=e("graceful-fs"),a=new Map,l=function(e,t,n){e.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),e.type(o.lookup(n,"text/plain")),e.status(200).end(t)};t.exports={create:function(e,t){var n=logger.create("middleware").trace,o=e.main.cache?e.main.cache:a;return e.main.read=e.main.read?e.main.read:s.readFile,e.alt&&(e.alt.cache||(e.alt.cache={get:function(){return null},set:function(){return null}}),e.alt.read=e.alt.read?e.alt.read:s.readFile),function(s,a){var c=i(s).pathname;"/"===c&&(c="");var u=e.main.root;n("Preparing to serve %s",c||u);var h=r.normalize(r.join(u,c)),d=o.get(h);if(_.isString(d)||d instanceof Buffer)n("Serving %s from cache",c||u),l(a,d,h);else{var p=function(e,i,o,s){o?e?(u=e.root,n("Serving %s from disk (alt. location)",c||u),h=r.normalize(r.join(u,c)),e.read(h,p.bind(null,null,e.cache))):(n("Error when reading file %s, %s",h,o&&o.message||"unknown"),t&&console.error("Trying to access missing resource or API: "+c),a.status(404).end()):(i.set(h,s),l(a,s,h))};n("Serving %s from disk",c||u),e.main.read(h,p.bind(null,e.alt,o))}}}}},{"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],24:[function(e,t,n){global._=e("lodash"),
global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!1,global.Promise||(global.Promise=Q.Promise),_.extend(_,e("./utils")),_.str=e("underscore.string"),_.mixin(_.str.exports()),global.logger=e("./logger"),_["_"+["5ub","r95","bho","b"].join("")]=["5ub","r95","bho","b"].join("")},{"./logger":26,"./utils":50,events:void 0,lodash:void 0,q:void 0,"underscore.string":void 0}],25:[function(e,t,n){var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=e("acorn");o=o.Parser.extend(e("./acornTolerancePlugin"),e("./acornTopLevelAwaitPlugin"),e("./acornObjectSpreadPlugin")(o),e("./acornClassFieldsPlugin"),e("./acornImportMetaPlugin"),e("./acornNumericSeparatorPlugin.js"),e("./acornOptionalChainingPlugin"),e("acorn-jsx")());var s=e("escodegen-wallaby"),a=40,l="Babel.objectSpread",c="Babel.React.createElement",u="#LOG#",h=function(e){if(0===e.indexOf("__REGEXP ")){var t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);return new RegExp(t[1],t[2]||"")}return e},d=function(e){var t=this;if(this._commentAutoLogHints={},this._ignoreCoverageHints=[],this._ignoreFileCoverage=!1,this._ignoreCoverageHints.lastHintPosition=-1,e.hints&&(e.hints.ignoreCoverage&&(this._hintRegExp=h(e.hints.ignoreCoverage)),e.hints.ignoreCoverageForFile&&(this._hintFileRegExp=h(e.hints.ignoreCoverageForFile)),e.hints.commentAutoLog&&(_.isString(e.hints.commentAutoLog)?this._commentAutoLog=e.hints.commentAutoLog:(this._commentAutoLog=e.hints.commentAutoLog.value,this._commentAutoLogExp=e.hints.commentAutoLog.exp)),e.hints.testFileSelection&&(e.hints.testFileSelection.include&&(this._includeTestFileRegExp=h(e.hints.testFileSelection.include)),e.hints.testFileSelection.exclude&&(this._excludeTestFileRegExp=h(e.hints.testFileSelection.exclude)))),this._opts=_.defaults(e||{},{}),this._opts.recordValues||(this._wrapExpressionStatementExpressionIntoVisitor=function(e){return e}),t._opts.test){var n=t._opts.testFileChangeStart;t._commentAutoLog&&t._opts.virtualLog&&(n={line:t._opts.virtualLog.range[0],column:t._opts.virtualLog.range[1]}),t._containsChangePosition=n&&n.line?function(e){return e&&e.loc.start.line<=n.line&&e.loc.end.line>=n.line&&(n.line>e.loc.start.line||n.column>e.loc.start.column)&&(n.line<e.loc.end.line||n.column<e.loc.end.column)}:function(e){return e&&e.start<t._opts.testFileChangeStart&&e.end>t._opts.testFileChangeStart}}else t._containsChangePosition=function(){return!1};t._visitor=this._createVisitor(),t._opts.sequenceExpressionToDiff||(t._replaceSequenceWithDiff=function(){}),t._opts.automaticTestFileSelection&&t._visitor.CallExpression.add(function(e){e.arguments&&e.arguments[0]&&"Literal"===e.arguments[0].type&&(e.callee&&"Identifier"===e.callee.type&&"fit"===e.callee.name&&2===e.arguments.length?t._includedTestFile=!0:e.callee&&"MemberExpression"===e.callee.type&&e.callee.property&&"Identifier"===e.callee.property.type&&"only"===e.callee.property.name&&(2===e.arguments.length||3===e.arguments.length)&&(t._includedTestFile=!0))}),t._visitor.IfStatement.add(function(e){e.consequent&&"BlockStatement"!==e.consequent.type&&(e.consequent=t._wrapInBlock([e.consequent])),e.alternate&&"BlockStatement"!==e.alternate.type&&"IfStatement"!==e.alternate.type&&(e.alternate=t._wrapInBlock([e.alternate]))}),t._visitor.add([this._visitor.DoWhileStatement,this._visitor.WhileStatement,this._visitor.IfStatement,this._visitor.ForStatement],function(e,n){if(e.test&&(e.test=t._instructionValueSequence([t._instruction(e.test,n,"TST"),e.test],n,void 0,!0)),e.update){var r=t._wrapIfCommentedForAutoLog(e.update,n);r&&(e.update=r)}}),t._visitor.add([this._visitor.ForOfStatement,this._visitor.ForInStatement],function(e,n){e.right&&(e.right=t._instructionValueSequence([t._instruction(e.right,n,"FR"),e.right],n))}),t._visitor.SwitchStatement.add(function(e,n){e.discriminant=t._instructionValueSequence([t._instruction(e.discriminant,n,"SWT"),e.discriminant],n)}),t._visitor.SwitchCase.add(function(e){e.consequent&&e.consequent.length>0&&(1!=e.consequent.length||"BlockStatement"!==e.consequent[0].type)&&(e.consequent=[t._wrapInBlock(e.consequent)])}),t._visitor.add([t._visitor.DoWhileStatement,t._visitor.ForInStatement,t._visitor.ForStatement,t._visitor.ForOfStatement,t._visitor.LabeledStatement,t._visitor.WhileStatement,t._visitor.WithStatement],function(e){e.body&&"BlockStatement"!==e.body.type&&("LabeledStatement"!==e.type||"DoWhileStatement"!==e.body.type&&"ForInStatement"!==e.body.type&&"ForStatement"!==e.body.type&&"WhileStatement"!==e.body.type)&&"ForOfStatement"!==e.body.type&&(e.body=t._wrapInBlock([e.body]))}),t._visitor.add([t._visitor.BreakStatement,t._visitor.ContinueStatement,t._visitor.ThrowStatement],function(e,n){if(!n.parentNode||"ForStatement"!==n.parentNode.type&&"ForInStatement"!==n.parentNode.type&&"ForOfStatement"!==n.parentNode.type&&"ExportDeclaration"!==n.parentNode.type){var r=[t._instructionStatement(e,n,"S"),e];n.replacement=t._wrapInBlock(r)}}),t._visitor.VariableDeclaration.add(function(e,n){if((!n.parentNode||"ForStatement"!==n.parentNode.type&&"ForInStatement"!==n.parentNode.type&&"ForOfStatement"!==n.parentNode.type&&"ExportDeclaration"!==n.parentNode.type&&"ExportNamedDeclaration"!==n.parentNode.type)&&e.declarations&&e.declarations.length&&"VariableDeclarator"===e.declarations[0].type){var r=e.declarations[0],i=t._instruction(e,n,"S");!r.init||"FunctionExpression"!==r.init.type&&"ArrowFunctionExpression"!==r.init.type&&"ClassExpression"!==r.init.type?r.init=r.init?t._instructionValueSequence([i,r.init],n,[e].concat("VariableDeclarator"===r.type&&"Identifier"===(r.id||{}).type?[r.id]:[])):"var"===e.kind?{type:"LogicalExpression",operator:"||",left:{type:"Identifier",name:r.id.name},right:i}:i:"Literal"!==i.type&&e.declarations.unshift({type:"VariableDeclarator",id:{type:"Identifier",name:"$_$wvd"+t._ranges.length},init:i})}}),t._visitor.ExpressionStatement.add(function(e,n){t._replaceConsoleLog(e.expression,n);var r=[],i=e.expression,o=t._replaceSequenceWithDiff(e);if(o&&r.push(i),!e._systemJsRegisterCall){var s=n.hinted?e.expression:t._wrapExpressionStatementExpressionIntoVisitor(e.expression,e);s===e.expression&&r.push(e),e.expression=t._instructionValueSequence([t._instruction(e,n,"S"),s],n,r)}}),t._visitor.ReturnStatement.add(function(e,n){t._replaceConsoleLog(e.argument,n),e.argument=e.argument?t._instructionValueSequence([t._instruction(e,n,"R"),e.argument],n,[e]):t._instruction(e,n,"R")}),t._visitor.ConditionalExpression.add(function(e,n){e.consequent=t._instructionValueSequence([t._instruction(e.consequent,n,"CDC"),e.consequent],n),e.alternate=t._instructionValueSequence([t._instruction(e.alternate,n,"CDA"),e.alternate],n)}),t._visitor.LogicalExpression.add(function(e,n){e.left=t._instructionValueSequence([t._instruction(e.left,n,"LGL"),e.left],n),e.right=t._instructionValueSequence([t._instruction(e.right,n,"LGR"),e.right],n)}),t._visitor.Program.add(function(e,n){var r;_.isEmpty(t._commentAutoLogHints)&&(t._visitor.removeVisitorsAddedForAutoLogCommentsOnly(),t._getFunctionParameterLogInstructions=function(){return[]}),e.body=e.body||[];var o=e.body[0],s=1===e.body.length&&t._isSystemJsModule(o),a=t._scopeStartVariableDeclaration("P");t._needsToStayFirst(o)?e.body.splice(0,1,t._firstNode(o),a):s&&s.length?(o._systemJsRegisterCall=!0,(r=e.body).splice.apply(r,i([1,0],[a,t._instructionStatement(e.body[0],n,"S")]))):e.body.unshift(a),e.body.push(t._instructionStatement(e,n,"PE"))}),t._visitor.add([t._visitor.FunctionDeclaration,t._visitor.FunctionExpression,t._visitor.ArrowFunctionExpression],function(e,n){var r,o;t._numberOfFunctions++,t._tryFindTestName(e,n),"ArrowFunctionExpression"===e.type&&e.expression&&(e.body=t._wrapInBlock([t._return(t._instructionValueSequence([t._instruction(e.body,n,"R"),e.body],n))]),e.expression=!1);var s=t._scopeStartVariableDeclaration("F"),a=t._getFunctionParameterLogInstructions(e,n),l=e.body.body[0],c=t._needsToStayFirst(l),u=t._isSuperCall(l);c?(e.body.body.splice(0,1,t._firstNode(l),s),(r=e.body.body).splice.apply(r,i([2,0],a))):u?t._handleSuperCall(e.body.body,n,s,a):(o=e.body.body).unshift.apply(o,i([s],a))}),t._visitor.ImportBatchSpecifier.add(function(e){e.type="ImportNamespaceSpecifier",e.id=e.name,delete e.name}),t._visitor.ImportSpecifier.add(function(e){e["default"]&&(e.type="ImportDefaultSpecifier")}),t._visitor.AssignmentPattern.add(function(e){"="===e.operator&&(e.type="AssignmentExpression")}),t._visitor.add([t._visitor.ExportNamedDeclaration,t._visitor.ExportDefaultDeclaration,t._visitor.ExportAllDeclaration,t._visitor.ImportDeclaration],function(){t._esm=!0}),t._visitor.CatchClause.addForAutoLogCommentsOnly(function(e,n){if(e.body&&e.body.body&&e.param&&"Identifier"===e.param.type){var r=t._getLiveCommentHint(e.param);r&&e.param.name&&e.body.body.unshift({type:"ExpressionStatement",expression:t._generateUndefinedAutoLogNode(e.param,n,r.exp)})}}),t._visitor.ObjectPattern.addForAutoLogCommentsOnly(function(e,t){e.properties.forEach(function(e){e.ignore=!0})}),t._visitor.Property.addForAutoLogCommentsOnly(function(e,n){if(!e.ignore&&e.value&&"ObjectPattern"!==n.parentNode.type){var r=t._wrapIfCommentedForAutoLog(e.value,n);r&&(e.value=r)}}),t._visitor.MemberExpression.addForAutoLogCommentsOnly(function(e,n){if(e.object){var r=t._wrapIfCommentedForAutoLog(e.object,n);r&&(e.object=r)}if(e.property)if(e.computed){var r=t._wrapIfCommentedForAutoLog(e.property,n);r&&(e.property=r)}else if(n.parentNode&&2===n.parentNode.length||"MemberExpression"===n.parentNode.type){var r=t._wrapIfCommentedForAutoLog(e,n,!1,[e.property]);r&&(n.replacement=r)}}),t._visitor.BinaryExpression.addForAutoLogCommentsOnly(function(e,n){if(e.left){var r=t._wrapIfCommentedForAutoLog(e.left,n);r&&(e.left=r)}if(e.right){var i=t._wrapIfCommentedForAutoLog(e.right,n);i&&(e.right=i)}}),t._visitor.CallExpression.addForAutoLogCommentsOnly(function(e,n){if(e.arguments&&e.arguments.length)for(var r=0,i=e.arguments.length;r<i;r++){var o=t._wrapIfCommentedForAutoLog(e.arguments[r],n);o&&(e.arguments[r]=o)}}),t._visitor.NewExpression.addForAutoLogCommentsOnly(function(e,n){if(e.arguments&&e.arguments.length)for(var r=0,i=e.arguments.length;r<i;r++){var o=t._wrapIfCommentedForAutoLog(e.arguments[r],n);o&&(e.arguments[r]=o)}}),t._visitor.ArrayExpression.addForAutoLogCommentsOnly(function(e,n){if(e.elements&&e.elements.length)for(var r=0,i=e.elements.length;r<i;r++){var o=t._wrapIfCommentedForAutoLog(e.elements[r],n);o&&(e.elements[r]=o)}}),t._visitor.AwaitExpression.addForAutoLogCommentsOnly(function(e,n){if(e.argument){var r=t._wrapIfCommentedForAutoLog(e.argument,n);r&&(e.argument=r)}}),t._visitor.SequenceExpression.addForAutoLogCommentsOnly(function(e,n){if(e.expressions&&e.expressions.length)for(var r=0,i=e.expressions.length;r<i;r++){var o=e.expressions[r],s=t._wrapIfCommentedForAutoLog(o,n);s&&(e.expressions[r]=s)}}),t._visitor.ConditionalExpression.addForAutoLogCommentsOnly(function(e,n){if(e.test){var r=t._wrapIfCommentedForAutoLog(e.test,n);r&&(e.test=r)}})};d.prototype={instrument:function(e){var t=this;t._ranges=[],t._code=e,t._numberOfFunctions=0;var n=t._parse(e);t._ignoreCoverageHints.length||(t._nextHint=function(){}),t._commentAutoLog&&t._opts.virtualLog&&t._createLiveCommentPositionsFromRange(n,t._opts.virtualLog.range,t._commentAutoLogHints);var r=t._generate(t._change(n,t._visitor));return delete t._code,{code:r.code,map:r.map.toString(),ranges:t._ranges,numberOfFunctions:t._numberOfFunctions,testName:t._testName,esm:t._esm,includedTestFile:t._includedTestFile,excludedTestFile:t._excludedTestFile}},_createLiveCommentPositionsFromRange:function(t,n,r){var i=e("./acornWalkJsxPlugin")(e("acorn-walk").base);i.MemberExpression=function(e,t,n){n(e.object,t,"Expression"),n(e.property,t,"Expression")};var o=this._findNodes(t,n,i);if(o.length){var s=function(e){return e.end-e.start},a=o.reduce(function(e,t){return s(e)>=s(t)?e:t},o[0]);r[a.end]={exp:u,start:a.start}}},_findNodes:function(e,t,n){var i=r(t,4),o=i[0],s=i[1],a=i[2],l=i[3],c=[];return function u(e,t,r){var i=r||e.type;if(e.loc.start.line<=o){e.loc.start.line===o&&(e.loc.start.column===s||0===s)&&e.loc.end.line<=a&&(e.loc.end.line<a||e.loc.end.column<=l)&&t.indexOf(e)<0&&t.push(e);var c=n[i];c&&c(e,t,u)}}(e,c),c},_tryFindTestName:function(e,t){var n=this;if(n._containsChangePosition(e.body)&&t.parentContext&&!n._saveTestNameIfTestFunctionCall(t,e,t.parentNode)&&!n._tryFindTestNameFromWrappedFunction(e,t)&&t.parentContext.parentContext){var r=t.parentNode;if(_.isArray(r)&&(r[0]===e||r[1]===e)){var i=t.parentContext,o=i.parentNode;o&&"CallExpression"===o.type&&i.parentContext&&n._tryFindTestNameFromWrappedFunction(t.parentContext.parentNode,t.parentContext.parentContext)}}},_tryFindTestNameFromWrappedFunction:function(e,t){var n=this,r=t.parentNode;if(_.isArray(r)&&(r[0]===e||r[1]===e)){var i=t.parentContext,o=i.parentNode;if(o&&"CallExpression"===o.type&&i.parentContext)return n._saveTestNameIfTestFunctionCall(i.parentContext,o,i.parentContext.parentNode)}},_createVisitor:function(){var e=[],t={removeVisitorsAddedForAutoLogCommentsOnly:function(){_.each(e,function(e){t[e].clearAutoLogCommentsActions()})}};return t.add=function(e,t){for(var n=0,r=e.length;n<r;n++)e[n].add(t)},_.each(["AssignmentExpression","AssignmentPattern","ArrayExpression","ArrayPattern","ArrowFunctionExpression","AwaitExpression","BlockStatement","BinaryExpression","BreakStatement","CallExpression","CatchClause","ClassBody","ClassDeclaration","ClassExpression","ComprehensionBlock","ComprehensionExpression","ConditionalExpression","ContinueStatement","DoWhileStatement","DebuggerStatement","EmptyStatement","ExportBatchSpecifier","ExportDeclaration","ExportSpecifier","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration","ExpressionStatement","FieldDefinition","ForOfStatement","ForStatement","ForInStatement","FunctionDeclaration","FunctionExpression","GeneratorExpression","Identifier","IfStatement","ImportBatchSpecifier","ImportDeclaration","ImportSpecifier","Literal","LabeledStatement","LogicalExpression","MemberExpression","MethodDefinition","ModuleDeclaration","NewExpression","ObjectExpression","ObjectPattern","Program","Property","ReturnStatement","SequenceExpression","SpreadElement","SwitchStatement","SwitchCase","Super","TaggedTemplateExpression","TemplateElement","TemplateLiteral","ThisExpression","ThrowStatement","TryStatement","UnaryExpression","UpdateExpression","VariableDeclaration","VariableDeclarator","WhileStatement","WithStatement","YieldExpression","JSXIdentifier","JSXNamespacedName","JSXMemberExpression","JSXElement","JSXOpeningElement","JSXClosingElement","JSXEmptyExpression","JSXExpressionContainer","JSXSpreadAttribute","JSXAttribute"],function(n){var r=[];t[n]=function(e,t){for(var n=0,i=r.length;n<i;n++)r[n](e,t)};var i=t[n];i.add=function(e){r.push(e)},i.addForAutoLogCommentsOnly=function(t){t.removeIfNoAutoLogComments=!0,e.push(n),r.push(t)},i.clearAutoLogCommentsActions=function(){r=_.filter(r,function(e){return!e.removeIfNoAutoLogComments})},i.clear=function(){r.length=0}}),t},_change:function(e,t,n){var r,i,o=this;if(n||(n={}),e.type){if(e.loc){var s=t[e.type];if(s){if(n.hinted||(n.hinted=o._nextHint(e)),n.hinted)return e;t[e.type](e,n)}}if("Identifier"===e.type||"Literal"===e.type||"ThisExpression"===e.type||"DebuggerStatement"===e.type||"EmptyStatement"===e.type||"BreakStatement"===e.type||"ContinueStatement"===e.type)return}for(var a in e)e.hasOwnProperty(a)&&"loc"!==a&&"type"!==a&&"start"!==a&&"end"!==a&&"name"!==a&&(r=e[a],r&&_.isObject(r)&&(i={parentContext:n,parentNode:e,hinted:n.hinted},o._change(r,t,i),i.replacement&&(e[a]=i.replacement)));return e},_parse:function(e){var t=this,n={locations:!0,ecmaVersion:11,allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,allowAwaitOutsideFunction:!0,plugins:{jsx:!0,objectSpread:!0,dynamicImport:!0,topLevelAwait:!0,tolerance:!0}},r=[];if(t._hintRegExp&&r.push(function(e,n,r,i){n&&n.match(t._hintRegExp)&&t._ignoreCoverageHints.push(i)}),t._hintFileRegExp&&r.push(function(e,n){!t._ignoreFileCoverage&&n&&n.match(t._hintFileRegExp)&&(t._ignoreFileCoverage=!0,t._wrapExpressionStatementExpressionIntoVisitor=function(e){return e},t._commentAutoLogHints={})}),t._includeTestFileRegExp&&r.push(function(e,n,r,i){!t._includedTestFile&&n&&n.match(t._includeTestFileRegExp)&&(t._includedTestFile=!0)}),t._excludeTestFileRegExp&&r.push(function(e,n,r,i){!t._excludedTestFile&&n&&n.match(t._excludeTestFileRegExp)&&(t._excludedTestFile=!0)}),t._commentAutoLog&&r.push(function(n,r,i,o){if(r&&!t._ignoreFileCoverage){var s=r.indexOf(t._commentAutoLog);if(0===s||1===s&&" "===r[0]){var a=r.substr(t._commentAutoLog.length+s).trim(),l=t._commentAutoLogHints[i]={exp:a},c=function(n,r,i,o){for(var s,a=n;a>=0;a--)if(s=e[a],!i.test(s)){a++;break}return a<r&&!t._commentAutoLogHints[a]&&(t._commentAutoLogHints[a]=l,o&&o(a)),a};c(c(i-1,i,/\s/)-1,i,/[\s,)]/,function(e){l.bracelessIndex=e})}}}),t._opts.preserveComments){n.ranges=!0,n.onComment=[],n.onToken=[];var i=o.parse(e,n);return _.each(n.onComment,function(e){_.each(r,function(t){t("Block"===e.type,e.value,e.start,e.end)})}),s.attachComments(i,n.onComment,n.onToken)}r.length&&(n.onComment=function(e,t,n,i){_.each(r,function(r){r(e,t,n,i)})});var i=o.parse(e,n);return i},_nextHint:function(e,t){var n=this,r=e.start,i=e.end;!t&&_.isNumber(n._ignoreCoverageHints.prevLastHintPosition)&&(n._ignoreCoverageHints.lastHintPosition=n._ignoreCoverageHints.prevLastHintPosition,delete n._ignoreCoverageHints.prevLastHintPosition);for(var o=n._ignoreCoverageHints.lastHintPosition,s=n._ignoreCoverageHints.lastHintPosition+1,a=!1,l=!1,c=!1;s<n._ignoreCoverageHints.length;){var u=n._ignoreCoverageHints[s];if(u<=r||c&&u<i)a=!0,n._ignoreCoverageHints.lastHintPosition=s,s++,c=!0;else{if(!(t&&u<i))break;l=!0,n._ignoreCoverageHints.lastHintPosition=s,s++}}return l&&(n._ignoreCoverageHints.prevLastHintPosition=o),a},_generate:function(e){var t={sourceMap:this._opts.fileName||"original",sourceMapWithCode:!0};return this._opts.preserveComments&&(t.comment=!0),s.generate(e,t)},_wrapInBlock:function(e){return{type:"BlockStatement",body:e}},_instructionValueSequence:function(e,t,n,r){var i=e[1],o=this._wrapIfCommentedForAutoLog(i,t,!0,n,r);return o&&(e[1]=o),_.isEmpty(this._commentAutoLogHints)&&(this._instructionValueSequence=_.bind(this._sequence,this)),this._sequence(e)},_wrapIfCommentedForAutoLog:function(e,t,n,r,i){if(e&&!t.hinted){var o=this._getLiveCommentHint(e,i);if(!o&&r&&r.length)for(var s=0;s<r.length&&!(o=this._getLiveCommentHint(r[s]));s++);if(o)return n?this._wrapIntoVisitor(e,this._generateNodeContext(e),!0,o.exp):this._generateUndefinedAutoLogNode(e,t,o.exp)}},_generateUndefinedAutoLogNode:function(e,t,n){var r=this._ranges.length-1,i=this._instruction(e,t,"U",function(e){r=e}),o=this._wrapIntoVisitor(e,this._generateNodeContext(e),!0,n,void 0,function(){return r});return this._sequence([i,o])},_getLiveCommentHint:function(e,t){var n=e.end+(t?1:0),r=this._commentAutoLogHints[n];return r&&r.start>=0&&e.start!==r.start&&(r=void 0),r?(r.bracelessIndex&&delete this._commentAutoLogHints[r.bracelessIndex],r):t?this._getLiveCommentHint(e):void 0},_sequence:function(e){return{type:"SequenceExpression",expressions:e}},_literal:function(e){return{type:"Literal",value:e}},_delayedLiteral:function(e){return{type:"Literal",get value(){return _.isUndefined(this._value)?(this._value=e(),this._value):this._value}}},_return:function(e){return{type:"ReturnStatement",argument:e}},_firstNode:function(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e&&e.expression&&e.expression.value||""}}},_handleSuperCall:function(e,t,n,r){var o=e[0],s=this._instructionStatement(o,t,"S");delete o.loc,delete o.expression.loc,e.splice.apply(e,i([1,0],[n,s].concat(r)))},_replaceConsoleLog:function(e,t){var n=this;e&&!t.hinted&&("CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"console"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&"log"===e.callee.property.name?(e.callee.object.name="$_$tracer",e.arguments||(e.arguments=[]),e.arguments.push(n._literal(n._generateNodeContext(e.arguments[0]))),e.arguments.push(n._literal(n._opts.file)),e.arguments.push(n._literal(n._ranges.length))):e.arguments&&e.arguments.length&&n._replaceConsoleLog(e.arguments[0],t))},_generateNodeContext:function(e){if(e&&"Literal"!==e.type)try{var t=_.truncate(s.generate(e,{}),a).toString().replace("$_$tracer.log","console.log");return~t.indexOf("$_$tracer")?"":t}catch(n){}return""},_replaceSequenceWithDiff:function(e){var t=this,n=e;if(e=n.expression,e&&"SequenceExpression"===e.type&&e.expressions&&2===e.expressions.length){var r=e.expressions[0],i=e.expressions[1],o="";if(r&&"Literal"!==r.type)try{o=_.truncate(s.generate(r,{}),a).toString()+" vs "+_.truncate(s.generate(i,{}),a).toString()}catch(l){}return n.expression={type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"diff"}},arguments:[r,i,t._literal(o),t._literal(t._opts.file),t._literal(t._ranges.length)]},!0}},_needsToStayFirst:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"Literal"===e.expression.type&&("use strict"===e.expression.value||"use babel"===e.expression.value||"ngInject"===e.expression.value)},_isSystemJsModule:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"MemberExpression"===e.expression.callee.type&&e.expression.callee.object&&e.expression.callee.property&&"Identifier"===e.expression.callee.object.type&&"Identifier"===e.expression.callee.property.type&&"System"===e.expression.callee.object.name&&"register"===e.expression.callee.property.name&&e.expression.arguments},_isSuperCall:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"Super"===e.expression.callee.type},_instruction:function(e,t,n,r){var i=this,o=e.loc,s="",a=[];switch(n){case"PE":a=[this._literal(this._opts.file)];case"FE":s=n.toLowerCase();break;default:if(this._ignoreFileCoverage||t.hinted||this._nextHint(e,!0))return{type:"Literal",value:1};s="";var u=function(){var t=[o.start.line,o.start.column,o.end.line,o.end.column];if("R"===n){var r=1;if(e.argument&&"CallExpression"===e.argument.type&&e.argument.callee){var s=e.argument.callee;"SequenceExpression"===s.type&&s.expressions&&s.expressions.length&&(s=s.expressions[s.expressions.length-1]),"Identifier"===s.type?r=i._isObjectSpread(s)?l:s.name:"MemberExpression"===s.type&&(s.property&&"Identifier"===s.property.type&&"createElement"===s.property.name&&s.object&&(i._isReactObject(s.object)||"MemberExpression"===s.object.type&&i._isReactObject(s.object.object))?r=c:s.object&&i._isObjectSpread(s.object)&&(r=l))}t.push(r)}i._ranges.push(t)};"U"!==n?(a=[this._literal(this._opts.file),this._literal(this._ranges.length)],u()):(s="_",a=[this._literal(this._opts.file),this._delayedLiteral(function(){var e=i._ranges.length;return u(),r&&r(e),e})]),a.push({type:"Identifier",name:"$_$c"})}return this._instructionCallExpression(s,a)},_isReactObject:function(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("react")},_isObjectSpread:function(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("objectspread")},_wrapExpressionStatementExpressionIntoVisitor:function(e,t){if(!e||"Identifier"!==e.type)return e;var n=this._getLiveCommentHint(t);n||(n=this._getLiveCommentHint(e));var r=n||{exp:""};return this._wrapIntoVisitor(e,void 0,!1,r.exp,n)},_wrapIntoVisitor:function(e,t,n,r,i,o){var s=this,l=s._ranges.length-(n?1:0),c=s._commentAutoLogExp&&n||s._commentAutoLogExp&&!n&&i;c&&(r="");var h=r&&("."===r[0]||".+"===r.substr(0,2)||"+."===r.substr(0,2)),d=r&&("+"===r[0]||".+"===r.substr(0,2)||"+."===r.substr(0,2));h&&(r=r.substr(1).trim()),d&&(r=r.substr(1).trim());var p;if(s._commentAutoLog&&s._opts.virtualLog)r===u&&(d=s._opts.virtualLog.expanded,p={changeId:s._opts.virtualLog.changeId,traceId:s._opts.virtualLog.traceId},r="");else{var f=/^#COPY:(.*)#/,g=r.match(f);g&&g[1]&&(p={changeId:g[1]},r=r.replace(f,""))}var m=[s._literal(s._opts.file),o?s._delayedLiteral(function(){return o()}):s._literal(l),o?s._delayedLiteral(function(){return s._opts.file+","+o()}):s._literal(s._opts.file+","+l),{type:"Identifier",name:"$_$c"}];if(h&&!r)return m.push(s._literal(t||e.name||"")),m.push(s._tracerMethodCall("_time")),m.push(e),m.push(s._tracerMethodCall("_time")),this._tracerMethodCall("_logTime",m);if(m.push(s._literal(r?_.truncate(r,a):t||e.name||"")),m.push(h?s._wrapIntoVisitor(e,t,n,"."):e),c?m.push(s._evalExpressionNode(s._commentAutoLogExp)):m.push(r?s._evalExpressionNode(r):s._literal("$_$ne")),m.push(s._literal(n||s._commentAutoLog&&!n&&i?0:1)),m.push(s._literal(d?1:0)),p){var v={type:"ObjectExpression",properties:[]};p.traceId&&v.properties.push(s._propertyNode("traceId",p.traceId)),p.changeId&&v.properties.push(s._propertyNode("changeId",p.changeId)),(p.traceId||p.changeId)&&m.push(v)}return this._instructionCallExpression("v",m)},_propertyNode:function(e,t){return{type:"Property",key:{type:"Identifier",name:e},value:{type:"Literal",value:t}}},_tracerMethodCall:function(e,t){return{type:"CallExpression",callee:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:e}},arguments:t||[]}},_evalExpressionNode:function(e){return{type:"FunctionExpression",id:null,params:[{type:"Identifier",name:"$"}],body:{type:"BlockStatement",body:[{type:"TryStatement",block:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:"eval"},arguments:[{type:"Literal",value:e}]}}]},handler:{type:"CatchClause",param:{type:"Identifier",name:"__e"},body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"Literal",value:""}}]}},finalizer:null}]},generator:!1,expression:!1}},_instructionCallExpression:function(e,t){return{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e},arguments:t}},_getFunctionParameterLogInstructions:function(e,t){var n=[],r=this;return e.params.forEach(function(e){if("Identifier"===e.type){var i=r._getLiveCommentHint(e);i&&e.name&&n.push(r._generateUndefinedAutoLogNode(e,t,i.exp))}else if("AssignmentPattern"===e.type&&e.left&&e.right&&e.left.name){var o=[r._getLiveCommentHint(e.left),r._getLiveCommentHint(e.right),r._getLiveCommentHint(e)].find(function(e){return e});o&&n.push(r._generateUndefinedAutoLogNode(e.left,t,o.exp))}else if("ObjectPattern"===e.type&&e.properties){var s=r._getLiveCommentHint(e);e.properties.forEach(function(e){if(e.key&&e.value&&e.value.name){var i=[r._getLiveCommentHint(e.value),r._getLiveCommentHint(e.key),r._getLiveCommentHint(e),s].find(function(e){return e});i&&n.push(r._generateUndefinedAutoLogNode(e.value,t,i.exp))}})}else if("ArrayPattern"===e.type&&e.elements){var a=r._getLiveCommentHint(e);e.elements.forEach(function(e){if(e.name){var i=[r._getLiveCommentHint(e),a].find(function(e){return e});i&&n.push(r._generateUndefinedAutoLogNode(e,t,i.exp))}})}else if("RestElement"===e.type&&e.argument&&e.argument.name){var o=r._getLiveCommentHint(e);o&&n.push(r._generateUndefinedAutoLogNode(e.argument,t,o.exp))}}),n.map(function(e){return{type:"ExpressionStatement",expression:e}})},_instructionStatement:function(e,t,n){return{type:"ExpressionStatement",expression:this._instruction(e,t,n)}},_scopeStartVariableDeclaration:function(e){return{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"$_$c"},init:{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e.toLowerCase()},arguments:[this._literal(this._opts.file)]}}]}},_saveTestNameIfTestFunctionCall:function(e,t,n){var r=this;if(_.isArray(n)&&n.length>=2&&n[1]===t&&n[0]){var i=void 0;if("Literal"===n[0].type)i=n[0].value;else{if("TemplateLiteral"!==n[0].type)return;var o=n[0];if(o.expressions&&o.expressions.length)return;if(!o.quasis||1!==o.quasis.length)return;var s=o.quasis[0];if(!s||!s.value)return;i=s.value.cooked}var a=e.parentContext.parentNode;if(a&&"CallExpression"===a.type){var l=a.callee;if("SequenceExpression"===l.type&&l.expressions&&(l=l.expressions[l.expressions.length-1]),l&&("it"===l.name||"test"===l.name||"asyncTest"===l.name||l.property&&"Identifier"===l.property.type&&("it"===l.property.name||"test"===l.property.name||"asyncTest"===l.property.name)))return r._testName=i,!0}}}},t.exports=function(e,t){return new d(t).instrument(e)}},{"./acornClassFieldsPlugin":1,"./acornImportMetaPlugin":2,"./acornNumericSeparatorPlugin.js":3,"./acornObjectSpreadPlugin":4,"./acornOptionalChainingPlugin":5,"./acornTolerancePlugin":7,"./acornTopLevelAwaitPlugin":8,"./acornWalkJsxPlugin":9,acorn:void 0,"acorn-jsx":void 0,"acorn-walk":void 0,"escodegen-wallaby":void 0}],26:[function(e,t,n){function r(e){var t=this.namespace;e[0]=i()+t+" "+e[0]}function i(){return _.inspectOpts.hideDate?"":(new Date).toISOString()+" "}function o(e){return process.stdout.write(e)}function s(e){function t(e,n){function r(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(r.enabled){var o=r,s=Number(new Date),a=s-(i||s);o.diff=a,o.prev=i,o.curr=s,i=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");var u=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var s=e[u];n=i.call(o,s),e.splice(u,1),u--}return n}),t.formatArgs.call(o,e);var h=c.format.apply(c,l(e))+"\n";o.isDebug?(d.add(h),p&&t.log.call(o,h)):t.log.call(o,h)}}var i;return r.isDebug="debug"===n,r.isTrace="trace"===n,r.namespace=e,r.enabled=r.isTrace&&f||r.isDebug,t.instances.push(r),r}function n(e){return e instanceof Error?e.stack||e.message:e}return t.debug=t,t["default"]=t,t.coerce=n,t.instances=[],Object.keys(e).forEach(function(n){t[n]=e[n]}),t.formatters={},t}var a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=e("util"),u=new(e("lru-cache"))({max:2097152,length:function(e){return e.length}}),h=0,d={add:function(e){u.set(h++,e)},values:function(){var e=u.values();return e.reverse(),e}},p=process.env.WALLABY_DEBUG_ENABLED||!1,f=process.env.WALLABY_TRACE_ENABLED||!1,_={};_.log=o,_.formatArgs=r,_.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var n=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{depth:25,maxArrayLength:100,breakLength:200});var g=s(_),m=g.formatters;m.o=function(e){return c.inspect(e,_.inspectOpts).replace(/\s*\n\s*/g," ")},m.O=function(e){return c.inspect(e,_.inspectOpts)},t.exports={create:function(e){return{debug:g(e,"debug"),trace:g(e,"trace")}},enableDebug:function(){p||(process.env.WALLABY_DEBUG_ENABLED="true",p=!0,d.values().forEach(function(e){_.log(e)}))},getDebugLog:function(){return d.values()},enableTrace:function(){f||(process.env.WALLABY_TRACE_ENABLED="true",f=!0,g.instances.forEach(function(e){e.isTrace&&(e.enabled=!0);
})),this.enableDebug()}}},{"lru-cache":void 0,util:void 0}],27:[function(e,t,n){var r=(e("fs"),e("path")),i=e("child_process").spawn,o=logger.create("nodeRunner").debug,s=e("./runWorkerPool"),a=e("./utils"),l="###wpm###",c=function(e){var t=this;t._project=e,t._nodePath=e.settings().env.runner,t._initializer=e.settings().bootstrap,t._teardown=e.settings().teardown,t._slowTestThreshold=e.settings().slowTestThreshold,t._zeroConfigJest=e.isZeroConfigJest(),t._nodeModules=r.join(e._localRoot,"node_modules");try{t._regeneratorRuntime=r.join(r.dirname(a.resolveModulePathFrom(t._nodeModules,"regenerator-runtime")),"runtime.js")}catch(n){}t._params=e.settings().env.params,t._recycle=e.settings().workers.recycle,t._testFramework=e.settings().testFramework,t._cwd=process.env.quokka||t._zeroConfigJest?process.cwd():e._instrumentedRoot,t._localProjectDir=e._localProjectDir,t._originalCacheRoot=e._originalRoot,t._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,t._maxLogEntrySize=e.settings().maxLogEntrySize,t._workerPool=new s(t._project,{create:_.bind(t._createNodeInstance,t),recycle:_.bind(t._recycleNodeInstance,t),healthy:_.bind(t._isNodeInstanceHealthy,t),prepare:_.bind(t._prepare,t)}),t._workerPool.setFileRoot(t._cwd)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start()},stop:function(){var e=this;e._workerPool.stop()},_createNodeInstance:function(e,t){var n=this;setImmediate(function(){try{process.env.quokka&&(n._params=n._project.settings().env.params,n._recycle=n._project.settings().workers.recycle);var r=(n._params.runner?_.map(n._params.runner.replace(/"([^"]+)"/g,function(e){return e.replace(/\s/g,"_space_token_")}).split(" "),function(e){return _.trim(e.replace(/_space_token_/g," "),'"')}):[]).concat([process.mainModule.filename,"runner",e,n._workerPool.receiverPort(),n._testFramework.version+(n._testFramework.autoDetected?",autoDetected":""),n._testFramework.path||"",n._nodeModules,n._originalCacheRoot,process.env.BABEL_ENV&&n._regeneratorRuntime||""]),s=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("="),r=_.trimLeft(n[0]);return e[r]=t.substring(n[0].length+1),e},{}):{});delete s.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete s.ELECTRON_RUN_AS_NODE;var a={process:i(n._nodePath,r,{cwd:n._cwd,env:s}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};a.process.stderr.on("data",function(e){var t=e.toString("utf8");o("Error in worker: %s",t),console.error(t)}),t(a)}catch(l){o("Error while creating worker #%s: %s",e,l&&(l.stack||l.message)),t()}})},_recycleNodeInstance:function(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process.kill()}},_isNodeInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(e,t){var n=this,r=_.randomId(),i=n._sandboxName(t,r);return o("Starting sandbox [%s]",i),Q.when().then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(o("Preparing sandbox [%s]",i),n._workerPool.getWorker(t))}).then(function(s){return o("Prepared sandbox [%s]",i),Q.when({instance:{resume:function(){s.channel.send(JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(e){var t=_.uniqueId(),n=function(r){var i;try{i=JSON.parse(r)}catch(o){return}"pong"===i.type&&i.data===t&&(s.channel.removeListener("message",n),e())};s.channel.on("message",n),s.channel.send(JSON.stringify({type:"in:ping",data:t}))},close:function(){n._recycle?(n._workerPool.recycleWorker(t),n._workerPool.getWorker(t).then(_.noop)):s.channel.send(JSON.stringify({type:"in:stop",data:{}}))},closing:_.noop,start:function(t,i){if(t("success")){try{s.process.stdout.removeAllListeners("data"),s.process.stdout.on("data",function(e){try{e=e&&e.toString("utf8"),~e.indexOf(l)&&(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{JSON.parse(e);s.channel.emit("message",e)}catch(t){o("Error while processing STDOUT message: "+t.message)}}))}catch(t){o("Error while processing STDOUT message: "+t.message)}})}catch(a){o("Error while subscribing to process STDOUT: "+a.message)}s.process.stderr.removeAllListeners("data"),s.process.stderr.on("data",function(e){if(e=e&&e.toString("utf8"),!e||0!==e.indexOf("Debugger listening on port")){var t="";if(~e.indexOf(l)){var n;e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{n=JSON.parse(e)}catch(t){o("Error while processing STDERR message: "+t.message)}}),n&&i(n.message,n.stack,n.actual,n.expected)}else{if(e){var r=e.split("\n"),s=[];_.each(r,function(e){return!_.startsWith(_.trimLeft(e),"at")&&void s.push(e)}),t=s.join("\n")}i(t,e)}}});var c={sessionId:r,tests:e.tests,files:_.reduce(e.allFiles.concat(e.allTestFiles),function(t,r){if(_.isNumber(r.id)){var i={id:r.id,rangesLength:r.rangesLength};if(t.push(i),n._zeroConfigJest&&(i.path=r.normalizedRelativePath,i.parentFilePath=r.parentFilePath,i.childFilePath=r.childFilePath,i.numberOfFunctions=r.numberOfFunctions,i.ts=r.ts,i.inOriginalFilesCache=r.inOriginalFilesCache,i.instrument=r.instrument,i.transientChange=r.transientChange,r.test)){i.test=!0;var o=r.changeStart&&r.changePosition&&!r.relatedFilesWithTests&&!n._project.hadGlobalErrorsPreviousRun()&&!n._project.settings().runAllTestsInAffectedTestFile&&!e.fullRun;o&&(i.allowedToRunChangedTestOnly=!0,i.changeStart=r.changeStart,i.changePosition=r.changePosition)}}return t},[]),testFiles:_.map(e.testFilesToLoad,function(e){var t;if(0===n._testFramework.version.indexOf("jest")){var r=n._project._getFileMetadataById(e.originalId||e.id);t=r&&r.getFileLineMap()}return{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:process.env.quokka?e.content:void 0,lineMap:t}}),root:n._cwd,localProjectDir:n._localProjectDir,flushCache:!1,initializer:n._initializer,teardown:n._teardown,slowTestThreshold:n._slowTestThreshold,manualTestRun:e.manualRun,reportUnhandledPromises:n._reportUnhandledPromises,maxLogEntrySize:n._maxLogEntrySize,expressionsToEvaluate:e.expressionsToEvaluate,hints:n._project.settings().hints,autoConsoleLog:n._project.settings().autoConsoleLog,preserveComments:n._project.settings().preserveComments,reportConsoleErrorAsError:n._project.settings().reportConsoleErrorAsError,suppressClearingRequireCache:n._zeroConfigJest||void 0,traceContext:e.traceContext||void 0};s.channel.send(JSON.stringify({type:"in:run",data:c}))}}},name:i,sessionId:r,workerId:t})})},_sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=c},{"./runWorkerPool":42,"./utils":50,child_process:void 0,fs:void 0,path:void 0}],28:[function(e,t,n){var r=e("path"),i=e("util"),o=e("ws"),s=e("./utils"),a=JSON.stringify,l=JSON.parse,c=process.stderr.write.bind(process.stderr),u=function(e){e||(e="");var t="";"string"!=typeof e?(t=e.stack||e.message||e.toString&&e.toString()||"",e.message&&!~t.indexOf(e.message)&&(t=e.message+"\n"+t)):t=e,c(t)},h=process.stdout.write.bind(process.stdout),d={send:function(e){h(e)}};process.exit=function(){};var p=e("module").Module,f=p._cache,_=process.cwd(),g=[],m=e("timers").setTimeout,v=process.nextTick;e("timers").setTimeout=global.setTimeout=function(){var e=m.apply(this,arguments);return g.push(e),e};try{i.promisify.custom&&i.promisify.custom&&(global.setTimeout[i.promisify.custom]=m[i.promisify.custom])}catch(y){}var b=function(){g.forEach(function(e){clearTimeout(e)}),g.length=0},k=function(e){if("string"==typeof e)u(e);else{var t="";e||u("");try{global.$_$tracer&&(e.stack||e.message)&&(t=JSON.stringify(global.$_$tracer.setAssertionData({actual:e.actual,expected:e.expected,showDiff:!0},{message:e.message,stack:e.stack,_p:"###wpm###"})))}catch(n){}u(t||e&&(e.stack||e.message||e.toString())||"")}};process.on("uncaughtException",function(e){k(e),process.env.quokka&&process.emit("beforeExit")});var T=function(){process.on("unhandledRejection",function(e){throw e})},w=function(t,n,r,o,a,l,c){var u=this;u._port=n,u._id=parseInt(t,10),u._connect(function(){global.$_$reuseableTracer=!0,e("./tracer"),global.$_$tracer._utils=s,~r.indexOf("jest")&&(global._=e("lodash"),global._.extend(global._,e("./utils")),global._.str=e("underscore.string"),global._.mixin(global._.str.exports()),s.instrument=e("./instrumentor"),global.$_$tracer.workerId=u._id),global.wallaby._frameworks={chai:{},sinon:{},quibble:{}},global.wallaby._originalCacheRoot=l,global.wallaby._localNodeModules=a,global.wallaby._testFrameworkPath=o,global.wallaby._fileExtensionsAdded=!1,global.wallaby._regeneratorRuntime=c,process.stderr.write=function(e){console.error(e)},u._testFrameworkInitializer=e("./runners/node/"+r.split(",")[0]+"/initializer.js")}),global.$_$tracer._highPriorityReceiver=d,global.$_$tracer._onReceiverClosed=function(e){e?global.$_$tracer._onReceiverClosedCallback=e:global.$_$tracer._onReceiverClosedCallback&&(global.$_$tracer._onReceiverClosedCallback(),delete global.$_$tracer._onReceiverClosedCallback)},global.$_$tracer.disconnect=function(){global.$_$tracer._receiverClosing=!0,u._channel.on("close",function(){global.$_$tracer._onReceiverClosed(),delete global.$_$tracer._receiverClosing}),u._channel.close(),delete u._channel,global.$_$tracer._receiver=void 0},global.$_$tracer.reconnect=function(e){u._onConnected=function(){global.$_$tracer._receiver=u._channel,e()},global.$_$tracer._receiverClosing?global.$_$tracer._onReceiverClosed(function(){return u._connect()}):u._connect()},global.$_$tracer._nodeUtil=i,u._patchFrameworks()};w.prototype={send:function(e){var t=this;t._channel.send(a(e))},_connect:function(e){var t=this;t._channel=new o("ws://127.0.0.1:"+t._port),global.$_$receiver=t._channel,e&&e(),t._channel.on("open",function(){t.send({worker:t._id.toString()})}),t._channel.on("message",function(e){e=l(e),t[e.type](e.data)})},"in:connected":function(){this._onConnected&&this._onConnected(),delete this._onConnected},"in:run":function(t){var n=this;t.reportUnhandledPromises&&T&&(T(),T=void 0),global.$_$coverage=[],t.suppressClearingRequireCache||Object.keys(f).forEach(function(e){var n=f[e];(n.filename&&~n.filename.indexOf(t.root)||t.flushCache)&&delete f[e]}),global.$_$tracer._filePathToFileData={},global.$_$tracer._hints=t.hints,global.$_$tracer._autoConsoleLog=t.autoConsoleLog,global.$_$tracer._preserveComments=t.preserveComments,global.$_$tracer._reportConsoleErrorAsError=t.reportConsoleErrorAsError;for(var i=0,o=t.files.length;i<o;i++){for(var s=t.files[i],a=global.$_$coverage[s.id]=[],l=0;l<s.rangesLength;l++)a[l]={};s.path&&(global.$_$tracer._filePathToFileData[s.path]=s)}global.$_$baseDir=t.root+r.sep,global.$_$slow=t.slowTestThreshold,global.$_$tests=t.tests;var c=(t.testFiles||[]).map(function(e){return e.path});global.$_$testFiles=t.testFiles,global.wallaby.tests=c,global.$_$session=t.sessionId,global.$_$initialSpecId=1e5*(n._id+1)||1,global.$_$traceContext=t.traceContext,global.$_$tracer._shouldReportProgramScope=!0,global.$_$tracer.initLoadingPhase(),global.$_$tracer._maxLogEntrySize=t.maxLogEntrySize||global.$_$tracer._maxLogEntrySize;try{global.wallaby.testFramework=n._testFrameworkInitializer.init(c)}catch(h){k(h)}global.$_$tracer.reportGlobalError=u,global.wallaby.localProjectDir=t.localProjectDir,global.wallaby.projectCacheDir=_,global.wallaby.sessionId=t.sessionId,global.wallaby.workerId=n._id,global.$_$tracer._manualTestRun=t.manualTestRun,global.$_$tracer._expressionsToEvaluate=t.expressionsToEvaluate||{};try{console._times&&console._times.clear()}catch(h){}try{e("./runners/node/bootstrap")(t.initializer),global.$_$tracer.start(),n._teardown=t.teardown}catch(h){k(h)}},"in:stop":function(){try{process.nextTick!==v&&(process.nextTick=v),global.$_$tracer.reset(),global.$_$tracer.resetEnvGlobal();try{console._times&&console._times.clear()}catch(t){}e("./runners/node/teardown")(this._teardown),delete this._teardown}catch(t){k(t)}b(),delete global.$_$coverage,delete global.$_$tests,delete global.$_$session,delete global.$_$initialSpecId},"in:ping":function(e){this.send({type:"pong",data:e})},"in:tracer.resume":function(){global.$_$tracer.resume()},_patchFrameworks:function(){s.patchModule("resolve",function(e){var t=e("resolve"),n=t.sync;return t.sync=function(){var e=arguments[1]=arguments[1]||{};return e.paths=e.paths||[],e.paths=e.paths.concat([global.wallaby._localNodeModules]).concat(process.env.NODE_PATH?process.env.NODE_PATH.split(r.delimiter):[]),n.apply(this,arguments)},t}),s.patchModule("./util/core/wrap-method",function(e){var t=e("./util/core/wrap-method");return t&&t.toString&&~t.toString().indexOf("sinon")?function(e){var n=t.apply(this,arguments);return wallaby._frameworks.sinon.stubs.push(n),n}:t})}},t.exports=function(e,t,n,r,i,o,s){new w(e,t,n,r,i,o,s)}},{"./instrumentor":25,"./tracer":44,"./utils":50,lodash:void 0,module:void 0,path:void 0,timers:void 0,"underscore.string":void 0,util:void 0,ws:void 0}],29:[function(e,t,n){var r=logger.create("phantomRunner").debug,i=e("phantom"),o=e("./runWorkerPool"),s=e("./browserEnvironment"),a=!1,l=function(e){var t=this;t._project=e,t._screenShotReady=Q.when(!0),t._params=e.settings().env.params,t._viewportSize=e.settings().env.viewportSize,t._clearMemoryCache=e.settings().env.clearMemoryCache,t._phantomjsPath=e.settings().env.runner,t._workerPool=new o(t._project,{create:_.bind(t._createPhantomInstance,t),recycle:_.bind(t._recyclePhantomInstance,t),healthy:_.bind(t._isPhantomInstanceHealthy,t),prepare:_.bind(t._prepare,t)}),t._browserEnvironment=new s(e,t._workerPool)};l.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_createPhantomInstance:function(e,t){var n=this;try{var o={dnodeOpts:{weak:!1}};n._phantomjsPath&&(o.binary=n._phantomjsPath),o.onExit=function(t,n){return"SIGSEGV"!==n||a||(console.error("Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"),a=!0),r("Signal killed phantomjs #%s: %s, exit code: %s",e,n,t)};var s=["--disk-cache=yes","--web-security=false"];n._params.runner&&(s=s.concat(_.filter(n._params.runner.split(" "),function(e){return e&&!(~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))})));var l=!1;s.push(function(i){if(!l){if(!i)return l=!0,r("Additional attempt to create phantom instance #%s",e),n._createPhantomInstance(e,t);i.set("onError",function(t){r("PhantomJs failure: %s, recycling phantom instance #%s",t,e),n._workerPool.recycleWorker(e)}),l=!0,t(i)}}),s.push(o),i.create.apply(i,s)}catch(c){r("Error while creating worker #%s: %s",e,c&&(c.stack||c.message)),t()}},_recyclePhantomInstance:function(e){e.exit(),e.process.kill()},_isPhantomInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(t,n){var i=this,o=_.randomId(),s=i._browserEnvironment.sandboxName(n,o);return r("Starting sandbox [%s]",s),Q.when().then(function(){return i._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Preparing sandbox [%s]",s),Q.all([i._getPage(n),i._browserEnvironment.prepareSandbox(t,o,n)]))}).then(function(a){r("Prepared sandbox [%s]",s);var l=a[0],c=a[1];return Q.when({instance:{resume:function(){l.evaluate(function(){$_$tracer.resume()})},ping:function(e){l.evaluate(function(){},e)},close:function(){t=null,l.stop&&l.stop(),l.close()},closing:function(){i._captureScreenShot(t.screen,l)},start:function(n,r){i._clearMemoryCache&&l.onResourceRequested(function(t,n,r){try{var i=global._urlUtil=global._urlUtil||e("url"),o=t.url;if(!o)return;if(0===o.indexOf("data:"))return;if(~o.indexOf("wallabyFileId"))return;var s=i.parse(t.url),a="/"===s.pathname.charAt(0)?s.pathname.substr(1):s.pathname,c=a&&r[a];if(!c)return;var u=s.search&&s.search.length;n.changeUrl(o+(u?"&":"?")+c.ts+"&wallabyFileId="+c.id),l.clearMemoryCache()}catch(h){console.log(h&&h.message)}},_.noop,t.allFilesHash),l.set("onError",r),l.open(c,function(e){n(e)&&l.evaluate(function(){$_$tracer.start()})})}},name:s,sessionId:o,workerId:n})})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp())},stop:function(){var e=this;e._workerPool.stop()},_captureScreenShot:function(e,t){var n=this;if(e){var r=Q.defer();try{t.render(e,function(){r.resolve()}),n._screenShotReady=r.promise}catch(i){r.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",i.message)}}},_getPage:function(e){var t=this;return t._workerPool.getWorker(e).then(function(n){return t._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Creating page for worker #"+e),t._createPage(n,e))})},_createPage:function(e,t){var n=this;return Q.promise(function(i,o){var s=!1,a=setTimeout(function(){s||(l(),n._workerPool.recycleWorker(t),r("Phantom page is not created in time, recycling it"),o({runCancelled:!0,rerun:!0}))},400),l=function(){s=!0,clearTimeout(a)};try{e.createPage(function(e){s||(l(),r("Phantom page created"),e.set("viewportSize",n._viewportSize||{width:800,height:600}),i(e))})}catch(c){l(),o(c)}})}},t.exports=l},{"./browserEnvironment":13,"./runWorkerPool":42,phantom:void 0,url:void 0}],30:[function(e,t,n){t.exports=function(){function e(e,t){this._read=e,this._fs=t}return e.prototype.stat=function(){return this._fs.stat.apply(this._fs,arguments)},e.prototype.statSync=function(){return this._fs.statSync.apply(this._fs,arguments)},e.prototype.readdir=function(){return this._fs.readdir.apply(this._fs,arguments)},e.prototype.readdirSync=function(){return this._fs.readdirSync.apply(this._fs,arguments)},e.prototype.readlink=function(){return this._fs.readlink.apply(this._fs,arguments)},e.prototype.readlinkSync=function(){return this._fs.readlinkSync.apply(this._fs,arguments)},e.prototype.readFile=function(e,t,n){var r=this._read(e);r?("function"==typeof t&&(n=t,t=null),r.getContent().then(function(e){t?n(null,e):n(null,Buffer.from(e))})["catch"](function(e){n(e)})):this._fs.readFile.apply(this._fs,arguments)},e.prototype.readFileSync=function(e,t){var n=this._read(e);if(n){var r=n.getContentSync();return t?r:Buffer.from(r)}return this._fs.readFileSync.apply(this._fs,arguments)},e.prototype.readJson=function(e,t){this.readFile(e,function(e,n){if(e)t(e);else{var r=void 0;try{r=JSON.parse(n.toString("utf-8"))}catch(i){return void t(i)}t(null,r)}})},e.prototype.readJsonSync=function(e){var t=this.readFileSync(e);return JSON.parse(t.toString("utf-8"))},e.prototype.purge=function(){return this._fs.purge.apply(this._fs,arguments)},e}()},{}],31:[function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},s=e("path"),a=e("os"),l=e("util.promisify"),c=e("./InputFileSystem"),u=e("./templates"),h=e("./loader"),d=e("../../utils"),p="WallabyPlugin",f="wallaby-webpack-entry.js",_=s.join(process.cwd(),f),g=function(){function e(e,t,n){var o=this;if(!e)throw new Error("webpack parameter is mandatory.");this._webpack=e,this._configuration=t||{},n=n||{},Array.isArray(n.setupFiles)||(n.setupFiles=[]),this._setupFiles=[],this._setupFileByFullPath=new Map;for(var a=function(e){var t=n.setupFiles[e];if("string"==typeof t){if(!l._setupFileByFullPath.get(t)){var a=s.resolve(t);l._setupFiles.push(a),l._setupFileByFullPath.set(a,a)}}else if(t.code&&t.path){var c={fullPath:s.resolve(t.path),getContent:function(){return r(o,void 0,void 0,function(){return i(this,function(e){return[2,t.code]})})},getContentSync:function(){return t.code}};l._setupFileByFullPath.get(c.fullPath)||(l._setupFiles.push(c),l._setupFileByFullPath.set(c.fullPath,c))}},l=this,c=0;c<n.setupFiles.length;c++)a(c)}return e.prototype.process=function(e){return r(this,void 0,void 0,function(){function t(e){return e.buildMeta&&e.buildMeta["aurelia-id"]?e.buildMeta["aurelia-id"]:e.id}var n,r,c,h,d,p,f,g,m,v,y,b,k,T,w,S,x,C,F,E,R,P,L,j,I,O,w,M;return i(this,function(i){switch(i.label){case 0:return this._logger=e.logger,this._logger.debug("Processing started."),this._settings=e.settings,d=new Map,p=this._compilation&&!e.anyFilesAdded&&!e.anyFilesDeleted,p?(f=this._compilation.compiler,e.affectedFiles.forEach(function(e){return d.set(e.fullPath,e)}),this._affectedFileByFullPath=d):(this._logger.debug("Initializing."),e.allFiles.forEach(function(e){return d.set(e.fullPath,e)}),this._fileByFullPath=d,this._affectedFileByFullPath=d,this._dependecyFileIdsByFileId={},this._moduleIdByFileFullPath=new Map,this._testFilePathByModuleId={},this._testFileModuleIdByPath={},this._compilation=null,this._initializeEntry(e.allTestFiles),this._sanitizeConfiguration(),this._adjustConfiguration(),f=this._createCompiler(),this._customizeCompiler(f)),this._prepareCompiler(p,f),g=l(f.compile).bind(f),this._logger.debug("Compilation started."),[4,g()];case 1:if(i.sent(),m=this._compilation,m.errors.length)throw m.errors[0].error||m.errors[0];this._logger.debug("Compilation finished."),v=m.wallaby.modules,y=[];try{for(b=o(v),k=b.next();!k.done;k=b.next())T=k.value,T.resource!==_&&(this._logger.trace("Processing module %s (%s).",T.id,T.resource||T.userRequest),w=this._affectedFileByFullPath.get(T.resource)||this._fileByFullPath.get(T.resource),S=T.wallaby||{},x=this._renderModule(m,T),C=void 0,C=3===x.children.length?x.children[1]:x.children[2],F=C.source(),E=C.map(),R=t(T),w&&w.test&&(P=[],this._traverseDependencies(m,T,P),this._dependecyFileIdsByFileId[w.id]=P),y.push(e.createFile({path:w?""+w.path+(w.test?"":"."+T.id)+".wbp.js":s.join("__modules",T.id+".js"),original:w,content:"window.__moduleBundler.modules["+JSON.stringify(R)+"] = function(module, exports, __webpack_exports__, __webpack_require__) {"+(T.strict?'"use strict";':"")+F+a.EOL+"};",sourceMap:E,ranges:S.ranges,extra:{sourceMap:S.map,testName:S.testName,numberOfFunctions:S.numberOfFunctions,includedTestFile:S.includedTestFile,excludedTestFile:S.excludedTestFile}})),w||(w=this._setupFileByFullPath.get(T.resource),w&&"string"==typeof w&&(w={fullPath:w})),w&&(this._moduleIdByFileFullPath.set(w.fullPath,R),w.test&&(this._testFilePathByModuleId[T.id]=w.path,this._testFileModuleIdByPath[w.path]=T.id)))}catch(B){n={error:B}}finally{try{k&&!k.done&&(r=b["return"])&&r.call(b)}finally{if(n)throw n.error}}if(!p){y.push(e.createFile({order:-1,path:"____wallaby-webpack.js",content:u.webpack()})),y.push(e.createFile({order:-.99,path:"____wallaby-webpack-bootstrapper.js",content:u.bootstrapper(this._testFileModuleIdByPath,this._testFilePathByModuleId)})),L=[];try{for(j=o(this._setupFiles),I=j.next();!I.done;I=j.next())O=I.value,w=void 0,"string"==typeof O?(w=this._fileByFullPath.get(O),w||(w={fullPath:O})):w=O,w&&!w.test&&(M=this._moduleIdByFileFullPath.get(w.fullPath),M&&L.push("window.__moduleBundler.require("+JSON.stringify(M)+");"))}catch(N){c={error:N}}finally{try{I&&!I.done&&(h=j["return"])&&h.call(j)}finally{if(c)throw c.error}}L.length&&y.push(e.createFile({path:"____wallaby-webpack-setup.js",order:1/0,content:L.join(a.EOL)}))}return this._logger.debug("Emitting %s files.",y.length),[4,Promise.all(y)];case 2:return i.sent(),this._logger.debug("Processing finished."),[2,{testDependencies:this._dependecyFileIdsByFileId}]}})})},e.prototype._initializeEntry=function(e){var t,n,r,i;this._logger.debug("Initializing entry.");var s=[];try{for(var l=o(this._setupFiles),c=l.next();!c.done;c=l.next()){var u=c.value,h=void 0;"string"==typeof u?(h=this._fileByFullPath.get(u),h||(h={fullPath:u})):h=u,h&&!h.test&&s.push("require('"+d.normalizePath(h.fullPath)+"');")}}catch(p){t={error:p}}finally{try{c&&!c.done&&(n=l["return"])&&n.call(l)}finally{if(t)throw t.error}}try{for(var f=o(e),_=f.next();!_.done;_=f.next()){var h=_.value;s.push("require('./"+h.path+"');")}}catch(g){r={error:g}}finally{try{_&&!_.done&&(i=f["return"])&&i.call(f)}finally{if(r)throw r.error}}this._entry=s.join(a.EOL)},e.prototype._sanitizeConfiguration=function(){this._logger.debug("Sanitizing configuration.");var e=this._configuration;e.module||(e.module={}),e.plugins||(e.plugins=[]),e.resolve||(e.resolve={}),e.resolveLoader||(e.resolveLoader={}),e.resolve.plugins||(e.resolve.plugins=[]),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.optimization||(e.optimization={}),e.entry={main:_},e.mode="none",e.devtool="source-map"},e.prototype._adjustConfiguration=function(){var e=this;this._logger.debug("Adjusting configuration.");var t=this._configuration,n=t.plugins,o=function(t){if(t===_)return{getContent:function(){return r(e,void 0,void 0,function(){return i(this,function(e){return[2,this._entry]})})},getContentSync:function(){return e._entry}};var n=e._setupFileByFullPath.get(t);return n&&"string"!=typeof n?n:e._affectedFileByFullPath.get(t)||e._fileByFullPath.get(t)};n.unshift(function(e){e.inputFileSystem=new c(o,e.inputFileSystem)}),t.resolve.plugins.unshift(new m(this._setupFileByFullPath)),t.resolveLoader.plugins.unshift(new v);var s=t.optimization;void 0===s.removeAvailableModules&&(s.removeAvailableModules=!1),void 0===s.removeEmptyChunks&&(s.removeEmptyChunks=!1),void 0===s.mergeDuplicateChunks&&(s.mergeDuplicateChunks=!1),void 0===s.providedExports&&(s.providedExports=!1),void 0===s.splitChunks&&(s.splitChunks=!1)},e.prototype._createCompiler=function(){return this._logger.debug("Creating compiler."),this._webpack(this._configuration)},e.prototype._customizeCompiler=function(e){var t=this;this._logger.debug("Customizing compiler."),e.hooks.normalModuleFactory.tap(p,function(e){t._customizeNormalModuleFactory(e)}),e.hooks.thisCompilation.tap(p,function(e){t._initializeCompilation(e),t._customizeCompilation(e)})},e.prototype._customizeNormalModuleFactory=function(e){e.hooks.createModule.tap(p,function(e){var t=e.loaders;if(e.loaders.length>0){var n=t[0].loader,r=t[t.length-1].loader;n!==h.post.id&&t.unshift({loader:h.post.id,options:null}),r!==h.pre.id&&t.push({loader:h.pre.id,options:null})}else t.push({loader:h.single.id,options:null})})},e.prototype._initializeCompilation=function(e){throw new Error("Not implemented abstract member.")},e.prototype._customizeCompilation=function(e){var t=this;e.wallaby={load:function(e){return t._affectedFileByFullPath.get(e)||t._fileByFullPath.get(e)},settings:this._settings,logger:this._logger,files:new Set,modules:[]},e.hooks.buildModule.tap(p,function(n){t._logger.trace("Compiled %s.",n.resource||n.userRequest),e.wallaby.modules.push(n)}),e.hooks.shouldGenerateChunkAssets.tap(p,function(){return!1})},e.prototype._prepareCompiler=function(e,t){},e.prototype._renderModule=function(e,t){throw new Error("Not implemented abstract member.")},e.prototype._traverseDependencies=function(e,t,n,r){throw new Error("Not implemented abstract member.")},e}(),m=function(){function e(e){this._setupFileByFullPath=e}return e.prototype.apply=function(e){var t=this,n=e.ensureHook("file");n.tapAsync(p,function(e,n,r){if(e.path===_)return r(null,{path:_});var i=t._setupFileByFullPath.get(e.path);return i&&"string"!=typeof i?r(null,{path:i.fullPath}):void r()})},e}(),v=function(){function e(){}return e.prototype.apply=function(e){var t="./node_modules/"+h.pre.id,n="./node_modules/"+h.post.id,r="./node_modules/"+h.single.id,i=e.ensureHook("file");i.tapAsync(p,function(e,i,o){return e.relativePath===t?o(null,{path:h.pre.id}):e.relativePath===n?o(null,{path:h.post.id}):e.relativePath===r?o(null,{path:h.single.id}):void o()})},e}();t.exports=g},{"../../utils":50,"./InputFileSystem":30,"./loader":33,"./templates":35,os:void 0,path:void 0,"util.promisify":void 0}],32:[function(e,t,n){var r=e("semver"),i=e("../../utils"),o=e("./loader"),s=e("./locator"),a="4.36.1";t.exports=function(t){return function(n,l,c){c=c?c:s.load(t),i.patchModule(o.single.id,function(){return o.single}),i.patchModule(o.pre.id,function(){return o.pre}),i.patchModule(o.post.id,function(){return o.post});var u=c.version;if(!r.valid(u)||r.lt(u,a))throw new Error("Only Webpack v"+a+" or higher is supported.");var h=r.major(u),d=e(4===h?"./v4/Postprocessor":"./v5/Postprocessor"),p=new d(c,n,l),f=p.process.bind(p);return f.owner=p,f.bundler={"native":!0},f}}},{"../../utils":50,"./loader":33,"./locator":34,"./v4/Postprocessor":36,"./v5/Postprocessor":37,semver:void 0}],33:[function(e,t,n){function r(e,t,n,r){var a=this._compilation.wallaby,l=a.load,c=a.settings,u=a.logger,h=a.files,d=l(this.resource);if(d&&d.instrument)if(r||this.cacheable.verified)if(h.has(d.id))u.trace("Skipping instrumentation of '%s': file is already instrumented.",d.path);else{u.trace("Instrumenting '%s' [content %s, source-map %s].",d.path,!!e,!!t);var p=i.extend({},c.hints);d.test?p.allowIgnoringCoverageInTests||(p=i.omit(p,"ignoreCoverage","ignoreCoverageForFile")):p=i.omit(p,"testFileSelection");var f=void 0;try{var _=t&&(d.changeStart||d.transientChange)&&new o.SourceMapConsumer(t);f=s(e,{file:d.id,test:d.test,testFileChangeStart:t?o.mapTextPosition(d.changeStart&&d.changePosition,_):d.changeStart,virtualLog:d.transientChange&&d.transientChange.range?{changeId:d.transientChange.id,traceId:d.transientChange.traceId,expanded:d.transientChange.expanded,range:o.mapOriginalRangeToTransformed(_,d.transientChange.range)}:void 0,hints:p,recordValues:c.autoConsoleLog,preserveComments:c.preserveComments||!1,automaticTestFileSelection:d.test&&c.automaticTestFileSelection,sequenceExpressionToDiff:!1})}catch(g){throw o.formatInstrumentationError(g,e,d.path)}h.add(d.id),this._module.wallaby={ranges:f.ranges,map:t,testName:f.testName,numberOfFunctions:f.numberOfFunctions,includedTestFile:f.includedTestFile,excludedTestFile:f.excludedTestFile},e=f.code,t=t?o.combineSourceMaps(t,f.map):f.map,u.trace("Instrumented '%s'.",d.path)}else u.trace("Skipping instrumentation of '%s': file is wrapped by some loader.",d.path);this.callback(null,e,t,n)}var i=e("lodash"),o=e("../../utils"),s=e("../../instrumentor");t.exports.pre=function(e,t,n){this.callback(null,e,t,n)},t.exports.pre.pitch=function(){this.cacheable.verified=!0},t.exports.pre.id="wallaby-pre-loader",t.exports.post=function(e,t,n){r.apply(this,[e,t,n,!1])},t.exports.post.id="wallaby-post-loader",t.exports.single=function(e,t,n){r.apply(this,[e,t,n,!0])},t.exports.single.id="wallaby-loader"},{"../../instrumentor":25,"../../utils":50,lodash:void 0}],34:[function(e,t,n){var r=this&&this.__values||function(e){
var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},i=e("path"),o=e("../../utils");t.exports={load:function(e){var t,n,s=[];s.length||(s.push(i.join(e,"node_modules/@angular-devkit/build-angular")),s.push(i.join(e,"node_modules/react-scripts")),s.push(i.join(e)));var a;try{for(var l=r(s),c=l.next();!c.done;c=l.next()){var u=c.value,h=o.tryRequireModuleWithPathFrom(u,"webpack");if(h&&(a=h.module))return a}}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=l["return"])&&n.call(l)}finally{if(t)throw t.error}}throw new Error("Unable to load webpack module.")}}},{"../../utils":50,path:void 0}],35:[function(e,t,n){t.exports={webpack:function(){return"\n    window.__moduleBundler = {};\n    window.__moduleBundler.modules = {};\n    window.__moduleBundler.installedModules = {};\n    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {};\n    window.__moduleBundler.require = function(moduleId, suppressTestVerification) {    \n      // Check if module is in cache\n      if(window.__moduleBundler.installedModules[moduleId]) {\n          return window.__moduleBundler.installedModules[moduleId].exports;\n      }\n      \n      window.__moduleBundler.assert(moduleId, suppressTestVerification);\n      \n      // Create a new module (and put it into the cache)\n      var module = window.__moduleBundler.installedModules[moduleId] = {\n          i: moduleId,\n          l: false,\n          exports: {}\n      };\n \n      const executor = window.__moduleBundler.modules[moduleId];\n \n      if(!executor) {\n        throw new Error('Cannot find module ' + moduleId + '.');\n      }\n \n      // Execute the module function\n      executor.call(module.exports, module, module.exports, module.exports, window.__moduleBundler.require);\n  \n      // Flag the module as loaded\n      module.l = true;\n  \n      // Return the exports of the module\n      return module.exports;\n    };\n    \n    // expose the modules object (__webpack_modules__)\n    window.__moduleBundler.require.m = window.__moduleBundler.modules;\n    \n    // expose the module cache\n    window.__moduleBundler.require.c = window.__moduleBundler.installedModules;\n    \n    (function() {  \n      var hasOwnProperty = Object.prototype.hasOwnProperty;\n        \n      // define getter function for harmony exports\n      window.__moduleBundler.require.d = function(exports, name, getter) {\n        if(!hasOwnProperty.call(exports, name)) {\n            Object.defineProperty(exports, name, { enumerable: true, get: getter });\n        }\n      };\n    })();\n    \n    // define __esModule on exports\n    window.__moduleBundler.require.r = function(exports) {\n      if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n          Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n      }\n      Object.defineProperty(exports, '__esModule', { value: true });\n    };\n\n    // create a fake namespace object\n    // mode & 1: value is a module id, require it\n    // mode & 2: merge all properties of value into the ns\n    // mode & 4: return value when already ns object\n    // mode & 8|1: behave like require\n    window.__moduleBundler.require.t = function(value, mode) {\n      if(mode & 1) value = window.__moduleBundler.require(value);\n      if(mode & 8) return value;\n      if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n      var ns = Object.create(null);\n      window.__moduleBundler.require.r(ns);\n      Object.defineProperty(ns, 'default', { enumerable: true, value: value });\n      if(mode & 2 && typeof value != 'string') for(var key in value) window.__moduleBundler.require.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n      return ns;\n    };\n    \n    // getDefaultExport function for compatibility with non-harmony modules\n    window.__moduleBundler.require.n = function(module) {\n        var getter = module && module.__esModule ?\n            function getDefault() { return module['default']; } :\n            function getModuleExports() { return module; };\n        window.__moduleBundler.require.d(getter, 'a', getter);\n        return getter;\n    };\n\n    window.__moduleBundler.require.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n        \n    // __webpack_public_path__\n    window.__moduleBundler.require.p = \"\";\n    \n    // on error function for async loading\n    window.__moduleBundler.require.oe = function(err) { console.error(err); throw err; };\n    \n    window.__moduleBundler.require.i = function(value) { return value; };\n    \n    window.__moduleBundler.require.e = function() { return Promise.resolve(); };\n  "},bootstrapper:function(e,t){return"\n    window.__moduleBundler.testFileModuleIdByPath = "+JSON.stringify(e)+";\n    window.__moduleBundler.testFilePathByModuleId = "+JSON.stringify(t)+';\n    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {\n      if(!suppressTestVerification) {\n        var path = window.__moduleBundler.testFilePathByModuleId[moduleId];\n        if(path) {\n          throw new Error("Test file " + path + " is being imported from other test files.\\nThis may cause tests in the file to be executed more than once (when the test file runs and every time it gets imported).\\nIf the test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new helper file where required.");\n        }\n      }\n    };\n    window.__moduleBundler.loadTests = function () { \n      window.wallaby._startWhenReceiverIsReady(function() {\n        for(var i = 0, len = wallaby.loadedTests.length; i < len; i++)\n        {\n          var path = wallaby.loadedTests[i];\n          if (path && path.length > 7 && path.substr(-7) === ".wbp.js") {\n            window.__moduleBundler.require(window.__moduleBundler.testFileModuleIdByPath[path.substr(0, path.length - 7)], true);      \n          }\n        }\n      });\n    };    \n  '}}},{}],36:[function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},o=e("../Postprocessor"),s=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t.prototype._adjustConfiguration=function(){e.prototype._adjustConfiguration.call(this);var t=this._configuration;t.cache=!1,void 0===t.module.unsafeCache&&(t.module.unsafeCache=!0)},t.prototype._initializeCompilation=function(e){var t=this;if(this._compilation)e.cache=this._compilation.cache;else{e.cache={};var n=e.fileTimestamps.get.bind(e.fileTimestamps);e.fileTimestamps.get=function(e){var t=n(e);return t?t:1};var r=e.contextTimestamps.get.bind(e.contextTimestamps);e.contextTimestamps.get=function(e){var t=r(e);return t?t:1}}this._affectedFileByFullPath.forEach(function(t){e.fileTimestamps.set(t.fullPath,t.ts),e.contextTimestamps.set(t.fullPath,t.ts)}),e.createHash=function(){return t.hash=""},e.sortItemsWithModuleIds=function(){},e.sortItemsWithChunkIds=function(){},this._compilation=e},t.prototype._renderModule=function(e,t){var n=e.moduleTemplates.javascript;return n.render(t,e.dependencyTemplates,{})},t.prototype._traverseDependencies=function(e,t,n,r){var o,s;if(r||(r=new Set),t.dependencies)try{for(var a=i(t.dependencies),l=a.next();!l.done;l=a.next()){var c=l.value;if(c&&c.module&&c.module.resource){var u=c.module.resource;if(!r.has(u)){r.add(u);var h=this._fileByFullPath.get(u);h&&(n.push(h.id),this._traverseDependencies(e,c.module,n,r))}}}}catch(d){o={error:d}}finally{try{l&&!l.done&&(s=a["return"])&&s.call(a)}finally{if(o)throw o.error}}},t}(o);t.exports=s},{"../Postprocessor":31}],37:[function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},o=e("../Postprocessor"),s=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t.prototype._adjustConfiguration=function(){e.prototype._adjustConfiguration.call(this);var t=this._configuration;t.cache&&"object"==typeof t.cache||(t.cache={type:"memory"})},t.prototype._initializeCompilation=function(e){e.compiler.fileTimestamps=e.fileSystemInfo._fileTimestamps,e.compiler.contextTimestamps=e.fileSystemInfo._contextTimestamps,this._affectedFileByFullPath.forEach(function(t){e.compiler.fileTimestamps.set(t.fullPath,{safeTime:t.ts,timestamp:t.ts})}),this._compilation=e},t.prototype._renderModule=function(e,t){var n=e.moduleTemplates.javascript,r={dependencyTemplates:e.dependencyTemplates,runtimeTemplate:e.runtimeTemplate,moduleGraph:e.moduleGraph,chunkGraph:e.chunkGraph};return n.render(t,r)},t.prototype._traverseDependencies=function(e,t,n,r){var o,s;r||(r=new Set);try{for(var a=i(e.moduleGraph.getOutgoingConnections(t)),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.module&&c.module.resource){var u=c.module.resource;if(!r.has(u)){r.add(u);var h=this._fileByFullPath.get(u);h&&(n.push(h.id),this._traverseDependencies(e,c.module,n,r))}}}}catch(d){o={error:d}}finally{try{l&&!l.done&&(s=a["return"])&&s.call(a)}finally{if(o)throw o.error}}},t}(o);t.exports=s},{"../Postprocessor":31}],38:[function(e,t,n){"use strict";var r=function(){function e(e,t,n){this.type=e.type,this.path=e.path,this.content=t,this.maps=[],this.config=n}return e.prototype.rename=function(e){return this.newPath=e,this},e.prototype.changeExt=function(e){var t=this.newPath||this.path;return this.newPath=t.substr(0,t.lastIndexOf(".")+1)+e,this},e}();t.exports=r},{}],39:[function(e,t,n){function r(e){this.process=o.fork(e,["worker"]),this.pid=this.process.pid,this.status=WorkerState.STARTING,this.process.once("message",this.onReady.bind(this)),s.EventEmitter.call(this)}function i(e,t){function n(){var t=new r(e);t.on("ready",i._run.bind(i)),t.process.on("exit",function(e){if(0!==e){for(var r=0;r<i.workers.length;r++)i.workers[r].pid===t.pid&&i.workers.splice(r,1);n()}}),i.workers.push(t)}this.workers=[],this.queue=[];var i=this;t=t||a.cpus().length;for(var o=0;o<t;o++)n()}var o=e("child_process"),s=e("events"),a=e("os"),l=e("util");WorkerState={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"},l.inherits(r,s.EventEmitter),r.prototype.onReady=function(){this.status===WorkerState.STARTING&&(this.status=WorkerState.READY,this.emit("ready",this))},r.prototype.onMessage=function(e,t){e(t),this.status=WorkerState.READY,this.emit("ready",this)},r.prototype.send=function(e,t){this.status=WorkerState.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},i.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},i.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},i.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===WorkerState.READY){e=this.workers[t];break}if(e){var n=this.queue.shift();e.send(n.task,n.callback)}}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new i(e))},started:function(){return!!this._queue},run:function(e){var t=this;return t._queue?Q.promise(function(n,r){try{t._queue.enqueue(e,function(e){n(e)})}catch(i){r(i)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],40:[function(e,t,n){"use strict";var r,i=e("path"),o=e("minimatch"),s=e("./config"),a=e("./utils"),l=e("./preprocessedFile"),c=logger.create("processor"),u=c.debug,h=c.trace,d=!1,p="Processor must pass a string, an object with code property or an error to done function.",f="Processor must be an async function with two params, where last param is done callback, or sync function with one param and returning the result.",g=function(){function e(e,t){this._config=e,this._settingsAreReady=_.isObject(this._config),this._root=t,this._localRoot=this._settingsAreReady?process.cwd():i.dirname(e)}return e.prototype.run=function(e,t,n){var r=this,i=this;return(this._settingsAreReady?Q.when(this._config):s(this._config,this._root)).then(function(o){var s=i._processors(o,t,n);if(!s.length)return h("No %s found for %s",n?"compilers":"preprocessors",t.path),Q.when({content:e,noProcessors:!0});n&&(s=[s[0]]);var a=new l(t,e,o);a.additionalPreset=r._additionalPreset(o);var c=Q.when(a);return h("Running %s processor(s) for %s",s.length,t.path),s.forEach(function(e){c=c.then(function(n){return Q.promise(function(r,i){try{var o=function(e){h("Finished running one processor for %s",t.path);var o;if(e instanceof Error)return void i(e);if(_.isObject(e)){if(!_.isString(e.code))return void i(new Error(p));o=e.code;var s=e.map||e.sourceMap;s&&(!s.version&&s._mappings&&s.toString&&(s=s.toString()),n.maps.push(s)),e.ranges&&(n.ranges=e.ranges),e.scriptRange&&(n.scriptRange=e.scriptRange),e.noScript&&(n.noScript=e.noScript)}else{if(!_.isString(e))return void i(new Error(p));o=e}n.content=o,r(n)};if(1===e.length){var s=void 0;try{s=e(n)}catch(a){s=a}finally{o(s)}}else 2===e.length?e(n,o):i(new Error(f))}catch(l){i(l)}})})}),c})},e.prototype._additionalPreset=function(e){if(!d){if(e.testFramework&&e.testFramework.version&&0===e.testFramework.version.indexOf("jest"))try{r=a.requireModuleFrom(this._localRoot,"babel-preset-jest")}catch(t){try{r=a.requireModuleFrom(this._localRoot,"react-scripts/node_modules/babel-preset-jest")}catch(n){u("WARNING: could not find and load babel-preset-jest preset, it is required for correct jest.mock(...) calls hoisting")}}d=!0}return r},e.prototype._processors=function(e,t,n){var r=[],s=n?e.compilers:e.preprocessors;return _.each(s,function(n,s){if(!_.isString(s))throw new Error("Processor patterns object keys must be strings.");if(!_.isArray(n)&&!_.isFunction(n))throw new Error('Processor(s) for "'+s+'" is specified incorrectly, must be an array of functions or a function.');_.isFunction(n)&&(n=[n]),o(0===(t.path||"").indexOf("..")?i.basename(t.path):t.path,s,{dot:e.dot})&&(r=r.concat(_.map(n,function(e){if(!_.isFunction(e))throw new Error('Processor for "'+s+'" is specified incorrectly, must be an array of functions or a function.');return e})))}),r},e}();t.exports=function(e){return new g(e.config,e.root).run(e.content,e.file,"compiler"===e.type)}},{"./config":16,"./preprocessedFile":38,"./utils":50,minimatch:void 0,path:void 0}],41:[function(require,module,exports){var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},path=require("path"),configure=require("./config"),utils=require("./utils"),instrument=require("./instrumentor"),processor=require("./processor"),TestTask=require("./testTask").TestTask,Tracker=require("./tracking"),runPriority=require("./testTask").runPriority,_a=logger.create("project"),debug=_a.debug,trace=_a.trace,cp=require("child_process"),spawn=cp.spawn,spawnedProcesses={};cp.spawn=function(){"cmd"===arguments[0]&&arguments[1]&&arguments[1].length>=3&&"/d"===arguments[1][0]&&"/c"===arguments[1][1]&&(arguments[0]=arguments[1][2],arguments[1].splice(0,3));var e=spawn.apply(this,arguments);try{var t=e.pid;e.on("exit",function(){t&&delete spawnedProcesses[t]}),spawnedProcesses[t]=e}catch(n){}return e};var testPathSeparator="^#^",runAlways=1,runOneTime=2,bundleFileId="bundle",suggestConfigAutoDetectionNotificationIdBase="suggestConfigAutoDetection",Project=function(e){var t=this;t._structureFileFormatVersion=18,t._wallabyEmail="wallabyjs@gmail.com",t._diffMatchPatch=e.diffMatchPatch,t._processorPool=e.processorPool,t._runnerResolver=e.runnerResolver,t._fileStructureCachePromise=e.fileStructureCachePromise,t._fileStatPromise=e.fileStatPromise,t._readFilePromise=e.readFilePromise,t._writeFilePromise=e.writeFilePromise,t._unlinkFilePromise=e.unlinkFilePromise,t._unlinkFileSync=e.unlinkFileSync,t._readFileSync=e.readFileSync,t._writeFileSync=e.writeFileSync,t._fileExistsSync=e.fileExistsSync,t._dirRemovePromise=e.dirRemovePromise,t._dirRemoveSync=e.dirRemoveSync,t._dirEnsurePromise=e.dirEnsurePromise,t._dirEnsureSync=e.dirEnsureSync,t._lruCache=require("lru-cache")({max:52428800,length:function(e){return e.length}});var n,r;t._configFile=e.configPath,t._structureFile="structure.json",t._allowAutomaticConfigNotification=!0;var i=suggestConfigAutoDetectionNotificationIdBase+"_"+(e.projectCachePath&&path.basename(e.projectCachePath)),o=e.homeDir||require("os").homedir();if(t._globalSettingsDir=path.join(o,process.env.quokka?".quokka":".wallaby"),e.dirEnsureSync(t._globalSettingsDir),t._notificationSettingsFile=path.join(t._globalSettingsDir,"notifications.json"),t._fileExistsSync(t._notificationSettingsFile))t._allowAutomaticConfigNotification=!t.isNotificationMuted(i),t.muteNotification(i);else{var s={};s[i]={},t._writeFileSync(t._notificationSettingsFile,JSON.stringify(s))}if(process.env.quokka){var a,l,c;try{t._globalSettingsDir=path.join(e.homeDir,".quokka"),t._quokkaTempDir=path.join(t._globalSettingsDir,"data",utils.randomId()),t._quokkaGlobalSettingsFile=path.join(t._globalSettingsDir,"config.json"),t._quokkaGlobalPackageFile=path.join(t._globalSettingsDir,"package.json"),a=!0,t._root="quokka_fake_path",t._localRoot=process.cwd(),t._quokkaLocalSettingsFile=path.join(t._localRoot,".quokka"),t._originalRoot=path.join("quokka_fake_path","original"),t._instrumentedRoot=path.join("quokka_fake_path","instrumented"),t._editorTypeScript=e.editorTypeScript,l=!0,e.useMemoryFs(t._root),e.useMemoryFs(t._originalRoot),e.useMemoryFs(t._instrumentedRoot),e.useMemoryFs(path.join(t._root,t._structureFile)),t._quokkaFileName=e.quokka;var u=path.join(t._localRoot,t._quokkaFileName),h=path.join(t._originalRoot,path.basename(t._quokkaFileName));e.useMemoryFs(u),e.useMemoryFs(h,utils.isLevelUpRelativePath(t._quokkaFileName)),c=!0,t._writeFileSync(u," "),t._writeFileSync(h," "),e.useMemoryFs(path.join(t._instrumentedRoot,t._quokkaFileName)),t._fullInstrumentedPathForTestRunner=function(e){return utils.isLevelUpRelativePath(t._quokkaFileName)?path.relative(t._localRoot,t._quokkaFileName):e.instrumentedPath.replace(t._instrumentedRoot,t._localRoot)}}catch(d){throw new Error("Failed to initialize Quokka paths\n    homeDir: "+e.homeDir+", \n    cwd: "+process.cwd()+"\n    globalSettingsDir: "+t._globalSettingsDir+"\n    localSettingsFile: "+t._quokkaLocalSettingsFile+"\n    quokkaFileName: "+e.quokka+"\n    init status: "+a+", "+l+", "+c+"\n"+d.stack)}}else t._root=e.projectCachePath,t._configFile=e.configPath,t._localRoot=path.dirname(t._configFile),t._originalRoot=path.join(t._root,"original"),t._instrumentedRoot=path.join(t._root,"instrumented");if(n=path.join(t._localRoot,"node_modules"),t._nodeModules=t._fileExistsSync(n)?n:void 0,t._packageJson=path.join(t._localRoot,"package.json"),t._babelrc=path.join(t._localRoot,".babelrc"),t._babelrcjs=path.join(t._localRoot,".babelrc.js"),t._localProjectDir=t._localRoot+path.sep,r=path.join(t._instrumentedRoot,"node_modules"),t._screenPath=path.join(t._instrumentedRoot,"screen.png"),!process.env.quokka&&t._nodeModules&&e.nodeModulesLookup(function(e){e.push(n)},function(e){return e.replace(r,n)}),process.env.quokka){var p=path.join(t._globalSettingsDir,"node_modules");e.dirEnsureSync(t._quokkaTempDir),t._writeFileSync(path.join(t._quokkaTempDir,"package.json"),"{}"),e.dirEnsureSync(path.join(t._quokkaTempDir,"node_modules")),e.cidFile=path.join(t._globalSettingsDir,".qid"),e.lkp=path.join(t._globalSettingsDir,".qlc"),t._fileExistsSync(t._quokkaGlobalSettingsFile)||t._writeFileSync(t._quokkaGlobalSettingsFile,"{}"),t._fileExistsSync(t._quokkaGlobalPackageFile)||t._writeFileSync(t._quokkaGlobalPackageFile,"{}"),t._loadQuokkaSettings(),e.edition=t._quokkaSettings.quokka.edition||"",e.nodeModulesLookup(function(e){e.push(p)})}t._live=!1,t._sourceFileCache={},t._changeQueue={},t._testTask=new TestTask(t),t._tracker=new Tracker(e,process.env.quokka?path.dirname(process.mainModule.filename):t._root),t._init=e._init,t._coreVersion=e.coreVersion,t._allowedToSendBusy=!0};Project.prototype=_.extend(Object.create(EventEmitter.prototype),{configure:function(){var e=this;return(process.env.quokka?Q.when(e._quokkaSettings):configure(e._configFile,e._instrumentedRoot,{forceUpdate:e._forceConfigUpdate})).then(function(t){if(e._settings=t,process.env.quokka)e._settings.extensions={};else{if(debug("Wallaby Node version: %s",process.version),debug("Wallaby config: %s",e._configFile),e.runOnSave="onsave"===e._settings.runMode,e._settings.screenshot||(e._screenPath=void 0),!e.isNativeBundler()){var n=t.postprocessor;_.isArray(t.postprocessor)?(n=t.postprocessor[0],t.postprocessor=e.isZeroConfigJest()?t.postprocessor[1]:e._combinePostprocessors(t.postprocessor)):e.isZeroConfigJest()&&delete t.postprocessor,n&&n.ts&&n.filePatterns&&_.filter(n.filePatterns,function(e){return e&&!_.endsWith(e,"*.ts?(x)")&&!_.endsWith(e,"*.ts")}).length>0&&(e._overrideFileTypesIncludedInTypeScriptCompiler=!0,e._overrideFileType=function(t,r,i){if("ts"!==t&&"tsx"!==t&&e._overrideFileTypesIncludedInTypeScriptCompiler&&r!==i)return n.filePatterns&&_.find(n.filePatterns,function(t){return utils.pathMatchesPattern(0===r.indexOf("..")?path.basename(r):r,t,{dot:e._settings.dot,micromatch:e._settings.micromatch})})?"ts":void 0})}if(t.configCode=e._fileExistsSync(e._configFile)&&e._readFileSync(e._configFile)||"auto.detect","auto.detect"===t.configCode)try{t.configCode+="#"+utils.quickHash(JSON.stringify({files:t.files,tests:t.tests}))}catch(r){}}if(t.telemetry&&e._tracker.start(t),!t.testFramework.autoDetected&&e._allowAutomaticConfigNotification&&0===t.testFramework.version.indexOf("jest")){var i=function(){try{return utils.loadJest(e._localRoot),!0}catch(t){return!1}};i()&&e._emit({type:"autoConfigurationAvailable"})}if(t.env.phantomDefault)throw new Error("Your wallaby.js configuration is using a deprecated default `env.kind` setting of `phantomjs`.\nTo continue using PhantomJs you must configure this setting explicitly.\nPlease refer to our PhantomJs docs at https://wallabyjs.com/docs/integration/phantomjs2.html for more information.");var o=t.files.length;e._emit({type:"projectConfigured",name:t.name,browser:"browser"===t.env.type,kind:t.env.kind,phantomDefault:t.env.phantomDefault,screenshot:!!t.screenshot,editDelay:t.delays.edit,files:_.map(t.files.concat(t.tests),function(e,t){return t>=o&&(e.test=!0),e})})})["catch"](function(t){e._cleanStack(t,e._configFile),console.error("Failed to load configuration file:",t&&(t.stack||t.message)),e._emitTestRunError(t&&(t.stack||t.message))})},reloadQuokkaSettings:function(){this._loadQuokkaSettings((this._settings||{})._currentInlineQuokkaConfig),this._settings=this._quokkaSettings,this._recycleRunner=!0},_loadQuokkaSettings:function(e){var t=this;try{var n={globalConfigFile:this._quokkaGlobalSettingsFile,tempDir:this._quokkaTempDir};try{_.merge(n,JSON.parse(this._readFileSync(this._quokkaGlobalSettingsFile)))}catch(r){}try{_.merge(n,JSON.parse(this._readFileSync(this._packageJson)).quokka)}catch(r){}try{_.merge(n,JSON.parse(this._readFileSync(this._quokkaLocalSettingsFile)))}catch(r){}e&&_.merge(n,e),this._quokkaSettings={quokka:{globalSettingsDir:this._globalSettingsDir,globalSettingsFile:this._quokkaGlobalSettingsFile,edition:n.pro?"pro":"",installPackage:{command:n.installPackageCommand||"npm install {packageName}",dir:n.tempDir,allowToInstallImportedModules:!0},ignoreExternalFileChanges:n.ignoreExternalFileChanges},files:[],tests:[{pattern:this._quokkaFileName,ignore:!1,instrument:!0,trigger:!0,load:!0}],env:{type:"node",runner:process.execPath,params:n.env&&n.env.params||{}},compilers:{},preprocessors:{},testFramework:{version:"quokka@1.0.0",configurator:"",reporter:"",starter:""},delays:{run:n.delay||0,edit:0},workers:{recycle:!!n.recycle,regular:1,initial:1},maxConsoleMessagesPerTest:1/0,autoConsoleLog:!0,debug:n.debug,reportConsoleErrorAsError:!0,telemetry:!0,hints:{ignoreCoverage:"ignore coverage"},dot:!0},"string"==typeof this._quokkaSettings.env.params.env&&_.each(this._quokkaSettings.env.params.env.split(";"),function(e){var t=e.split("="),n=t[0];process.env[n]=e.substring(n.length+1)});var i=function(e){(!e&&n.stdEsm!==!1||e&&n.stdEsm===!0)&&(n.stdEsm=n.stdEsm||!0,t._quokkaSettings.env.params.runner=t._quokkaSettings.env.params.runner?t._quokkaSettings.env.params.runner+" ":"",t._quokkaSettings.env.params.runner+='-r "'+path.join(path.dirname(process.mainModule.filename),"node_modules/esm")+'"',t._quokkaSettings.env.params.env+=";ESM_OPTIONS="+JSON.stringify({await:!0}))},o=n.babel&&n.babel.ts===!0;if(!_.endsWith(this._quokkaFileName,".ts")&&!_.endsWith(this._quokkaFileName,".tsx")||o)if(n.babel){delete n.babel.ts,delete n.ts,process.env.VUE_CLI_BABEL_TRANSPILE_MODULES=!0,_.isObject(n.babel)||(n.babel={}),process.env.BABEL_ENV||(process.env.BABEL_ENV=n.babel.env||"test");var s;try{var a=[path.join(this._localRoot,"node_modules","@babel/core"),path.join(this._localRoot,"node_modules","babel-core"),path.join(this._globalSettingsDir,"node_modules","@babel/core"),path.join(this._globalSettingsDir,"node_modules","babel-core")];n.babel.path&&path.resolve(n.babel.path)&&a.unshift(path.resolve(n.babel.path));var l=_.find(a,function(e){return t._fileExistsSync(e)});if(!l)throw new Error("Babel core is not found");~l.indexOf("@babel")&&utils.patchBabelResolve(l),s=require(l),n.babel.path=l}catch(r){return void(this._quokkaSettings.error="Configured to use babel, but can not find babel-core or @babel/core module\n"+r.message+"\n\nTried to search for babel core in these folders:\n"+_.map(a,function(e){return"  "+e}).join("\n"))}this._quokkaSettings.compilers[this._quokkaFileName]=require("./babelCompiler")(this._localRoot)(_.extend({babel:s,renameTypeScriptFiles:!1},_.omit(n.babel,"env","path","polyfill","ignore"))),n.babel.version=s.version,i(!0)}else i();else delete n.babel,n.ts=n.ts||{},i(!0);if(n.ts){_.isObject(n.ts)||(n.ts={});var c,u=n.ts.compilerOptions||null;if(null===u){u={};for(var h=path.join(this._localRoot,this._quokkaFileName),d=!0;d&&h!==path.dirname(h);){h=path.dirname(h);var p=path.join(h,"tsconfig.json");if(this._fileExistsSync(p)){try{u=require("./typeScriptUtils").getCompilerOptions(require("typescript"),p)}catch(r){throw new Error("Error while loading "+p+":\n"+r.message)}d=!1}h===process.cwd()&&(d=!1)}}var f=n.ts.path;if(f){f=path.resolve(f);try{c=require(f),n.ts.path=f}catch(r){return void(this._quokkaSettings.error='Configured to use "'+f+'" as TypeScript path, but can not find the `typescript` module')}}if(!c)try{f=path.join(this._localRoot,"node_modules","typescript"),c=require(f)}catch(g){try{f=path.join(this._globalSettingsDir,"node_modules","typescript"),c=require(f)}catch(m){try{f=path.resolve(this._editorTypeScript),c=require(f)}catch(v){c=require("typescript"),f=path.join(path.dirname(process.mainModule.filename),"node_modules/typescript")}}}u.module="commonjs",u.jsx="react",u.noEmit=!1,u.noEmitOnError=!1,delete u.removeComments,process.env.TS_NODE_COMPILER=f,process.env.TS_NODE_COMPILER_OPTIONS=JSON.stringify(__assign({jsx:"react"},n.ts.compilerOptions,{module:"commonjs"}));var y={typescript:c,files:{"**/*.ts?(x)":u}};this._quokkaSettings.postprocessor=require("./typeScriptPostprocessor")(this._localRoot)(y),n.ts.path=f,n.ts.version=c.version;var b=path.join(this._globalSettingsDir,"node_modules","ts-node"),k=path.join(this._localRoot,"node_modules","ts-node");if(this._globalSettingsDir!==this._localRoot||this._fileExistsSync(b)){var T=b;this._fileExistsSync(T)||(T=k,this._fileExistsSync(T)||(n.ts.tsNode=!1,T=!1)),T&&(n.ts.tsNode={path:T})}else n.ts.tsNode=!1}n.plugins&&n.plugins.length&&(n.plugins=_.uniq(n.plugins)),process.env.quokka=JSON.stringify(n)}catch(r){this._quokkaSettings=this._quokkaSettings||{},this._quokkaSettings.error=r.message}this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},n,{nodeVersion:process.version}))},_combinePostprocessors:function(e){var t=this;if(2!==e.length)throw new Error("Only TypeScript postprocessor chaining is supported.");var n=e[0],r=e[1];return function(e){return _.each(e.affectedFiles,function(e){var n=t._structure.filesById[e.id];n&&!t._isOriginallyVue(n)&&t._deleteDependantFilesMetadata(n)}),n(e).then(function(n){if(n.removePostprocessor)t._settings.postprocessor=r,debug("TypeScript postprocessor is removed as requested by itself"),t._overrideFileTypesIncludedInTypeScriptCompiler=!1;else{var i=function(e){var n=t._createPostProcessorInputFile(!1,e);return e.originalId&&(n.id=e.originalId,n.originalType=e.originalType),n},o=function(e){return e&&(_.isEmpty(e.dependant)&&(!e.tmp||e.originalId&&!t._isOriginallyVue(t._structure.filesById[e.originalId]))||t._isOriginallyVue(e))},s=function(e){var n=t._structure.filesById[e.id];return!n||_.isEmpty(n.dependant)||t._isOriginallyVue(n)?n:_.values(n.dependant)[0]};t._updateFileOrder();var a=_.chain(t._structure.testFilesInOrder).filter(o).map(i).value(),l=_.chain(t._structure.sourceFilesInOrder).filter(o).map(i).value().concat(a),c=_.chain(e.affectedFiles).map(s).filter(o).map(i).value(),u=_.chain(e.affectedTestFiles).map(s).filter(o).map(i).value();e=_.extend(e,{allTestFiles:a,allFiles:l,affectedFiles:c,affectedTestFiles:u})}return r(e)})}},configFilePath:function(){return this._configFile},coreVersion:function(){return this._coreVersion},projectName:function(){return this._settings.name||path.basename(this._localRoot)},preloadStructure:function(){var e=this;return this._fileStructureCachePromise(path.join(this._root,this._structureFile)).then(function(t){
return e._preloadedStructure=t,t})["catch"](function(){return{}})},start:function(e){var t=this,n=t._init(e,t);return t._emitInternal({type:"starting",files:e.files}),n.then(function(){return t._live&&t.stop(),Q.when(!0)}).then(function(){return debug("File cache: %s",t._root),t._live=!1,Q.all([t._dirEnsurePromise(t._originalRoot),t._dirEnsurePromise(t._instrumentedRoot)])})["catch"](function(e){return t._cleanStack(e),t._emitTestRunError(e.stack||e.message),Q.reject({error:e})}).then(function(){return this._preloadedStructure||t._fileStructureCachePromise(path.join(t._root,t._structureFile))})["catch"](function(e){return e&&e.error?Q.reject(e.error):Q.when({})}).then(function(e){var n=function(){return t._dirRemovePromise(t._instrumentedRoot).then(function(){return t._dirEnsurePromise(t._instrumentedRoot)})};return Q.all([t._fileStatPromise(t._packageJson).then(function(e){return Q.when(e.mtime.getTime())})["catch"](function(){return Q.when(0)}),t._fileStatPromise(t._babelrc).then(function(e){return Q.when(e.mtime.getTime())})["catch"](function(){return Q.when(0)}),t._fileStatPromise(t._babelrcjs).then(function(e){return Q.when(e.mtime.getTime())})["catch"](function(){return Q.when(0)})]).then(function(r){var i=r[0],o=r[1],s=r[2];return e.invalidateCache?(debug("Invalidating local cache as requested"),n().then(function(){return Q.when({packageJsonTimestamp:i,babelrcTimestamp:o,babelrcJsTimestamp:s})})):i!==e.packageJsonTimestamp?(debug("package.json file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:i,babelrcTimestamp:o,babelrcJsTimestamp:s})})):o!==e.babelrcTimestamp?(debug(".babelrc file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:i,babelrcTimestamp:o,babelrcJsTimestamp:s})})):s!==e.babelrcJsTimestamp?(debug(".babelrc.js file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:i,babelrcTimestamp:o,babelrcJsTimestamp:s})})):e.configCode!==t._settings.configCode||t._structureFileFormatVersion!==e.version?(debug("Config file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:i,babelrcTimestamp:o,babelrcJsTimestamp:s})})):(e.packageJsonTimestamp=i,e.babelrcTimestamp=o,e.babelrcJsTimestamp=s,Q.when(e))})}).then(function(n){t._structure=_.extend({filesByPath:{},filesRenamed:{},filesById:{},testFilesById:{},testFileSelectionById:{included:{},excluded:{}},awaitingFiles:[],configCode:t._settings.configCode},n),t._structure.awaitingFiles=[],t._structure.sourceFilesInOrder=[],t._structure.testFilesInOrder=[],t._structure.notifiedAboutWallabyApp||(process.env.quokka||console.log("Wallaby App (realtime reports) is available at: http://localhost:51245"),t._structure.notifiedAboutWallabyApp=!0);var r=_.reduce(e.files,function(e,t){return e[t.path]=!0,e},{});_.each(t._structure.filesByPath,function(e){if(!r[e.path]){var n=t._deleteFileMetadata(e);n&&(t.isZeroConfigJest()&&!n.inOriginalFilesCache||t._unlinkFilePromise(n.originalPath),t.isZeroConfigJest()||t.isNativeBundler()||t._unlinkFilePromise(n.instrumentedPath))}});var i=[],o=!!process.env.quokka;_.each(e.files,function(e){var n=e.path,r=0===n.indexOf("..")?path.basename(e.path):e.path;if(e.test||_.find(t._settings.tests,function(e){return e.ignore&&utils.pathMatchesPattern(r,e.regexp||e.pattern,!e.regexp&&{dot:t._settings.dot,micromatch:t._settings.micromatch})}))o=!0;else{var s=_.find(t._settings.tests,function(e){return!e.ignore&&utils.pathMatchesPattern(r,e.regexp||e.pattern,!e.regexp&&{dot:t._settings.dot,micromatch:t._settings.micromatch})});s&&console.error("File/pattern "+e.path+" is specified in the files list but also found in the tests list: "+s.pattern+".\r\n\tIf it's a test, make sure to exclude it from the files list, for example by adding { pattern: '"+s.pattern+"', ignore: true } to the files list.\r\n\tIf it's not a test, remove it from the tests list.")}var a=t._structure.filesByPath[n],l=a&&a.id===e.id,c=!1;a?(a=t._createFileMetadata(a,e.id),e.order&&(a.order=e.order),a.ts===e.ts||t.isZeroConfigJest()&&!a.test||(t._structure.awaitingFiles.push(e.id),c=!0)):(a=t._createFileMetadata(e,e.id),t.isZeroConfigJest()&&!a.test||(t._structure.awaitingFiles.push(e.id),c=!0)),t.isZeroConfigJest()&&(a.validSyntax=!0,l||(a.changeTs=+new Date),a.ts!==a.lastTs&&(a.ts=+new Date,a.changeTs=a.ts)),c||t.isZeroConfigJest()&&!a.test||i.push(t._readFilePromise(a.originalPath)["catch"](function(){return trace("No cached file "+e.path+", requesting it from IDE"),t._structure.awaitingFiles.push(e.id),Q.when(!1)}).then(function(n){return n===!1?Q.when(!1):(a.inOriginalFilesCache=!0,t.isZeroConfigJest()||t.isNativeBundler()?Q.when(!1):(n=n?a.binary?n.toString("base64"):n.toString():"",l?t._readFilePromise(a.instrumentedPath)["catch"](function(){return trace("No instrumented file "+e.path+", re-instrumenting original file"),t._processFile(a,n,void 0,!0,!1)}):(trace("Re-instrumenting original file because its ID has changed"),t._processFile(a,n,void 0,!0,!1))))}))}),o||console.error("No files with tests found, check your tests list patterns."),t._fileOrderUpdatePending=!0;var s=t._runnerResolver(t._settings.env.type,t._settings.env.kind);return t._testRunner=new s(t),Q.all(i.concat([t._testRunner.start()]))})["catch"](function(e){return t._signalIfBecameLive(),t._emitTestRunError(e.message),t._cleanStack(e),Q.reject(e)}).then(function(){t._signalIfBecameLive()?(debug("File cache is up-to-date, starting full test run"),t._queueTestRunFromFileChanges(null,!0),t._scheduleTestRun()):(debug("File cache requires some updates, waiting required files from IDE"),t._emit({type:"filesRequired",files:t._structure.awaitingFiles}))})},file:function(e){var t=this;return t._emitInternal({type:"file",file:e.file,"delete":e["delete"],inEditor:e.inEditor,transientChange:e.transientChange}),process.env.quokka&&!e.inEditor?void(t._structure&&t._filesAreUpToDate([e.file.id])):((e.inEditor||process.env.WALLABY_INTEGRATION_TEST_RUN)&&(this._hasAnyPendingInEditorFileChanges=!0),e.inEditor&&!e.transientChange&&(this._hasAnyPendingNonTransientFileChanges=!0),Q.promise(function(n,r){try{t._isTestTriggeringFileChange(e)&&t._tryCancelActiveTestRun(runPriority.fileChangePriority),t._queueFileChange(e),t.runOnSave&&e.inEditor?(debug("File changed in editor and set to only run on save, will not schedule test run"),t._emitInternal({type:"fileMarkersInvalid"})):t._scheduleChangedQueueProcessing(),n()}catch(i){r(i)}}))},scheduleChangeQueueProcessingIfPendingChanges:function(){this.hasAnyPendingInEditorFileChanges()&&this._scheduleChangedQueueProcessing()},hasAnyPendingInEditorFileChanges:function(){return this._hasAnyPendingInEditorFileChanges},runTests:function(e){var t=this,n=t.settings().quokka;if(!(n&&n.ignoreExternalFileChanges&&e.externalFileChange)){if(t._tryCancelActiveTestRun(e.notManualRun?runPriority.fileChangePriority:runPriority.testRunPriority),e.tests)t._queueRequestedTestRun(e.tests);else if(e.catchup){if(!this._catchupTestTask)throw new Error("Invalid run tests request");t._testTask=this._catchupTestTask}else t._queueFullTestRun(!0);e.notManualRun&&t._testTask.setEditorRequestedRun(),e.evaluateExpression&&t._testTask.setEvaluatedExpressionRun(),e.initialTraceRun&&t._testTask.setInitialTraceRun(e.initialTraceRun),t._scheduleTestRun()}},screen:function(e){var t=this;return t._settings&&"browser"===t._settings.env.type?t._testRunner._screenShotReady.then(function(){return t._readFilePromise(t._screenPath)})["catch"](function(){return trace("Unable to load test run screen shot"),Q.when(!1)}).then(function(n){n&&t._emit({type:"screen",screen:new Buffer(n).toString("base64")},e)}):Q.when(!1)},expressionsToEvaluate:function(e){this._emitInternal({type:"expressionsToEvaluateReceived",expressionsToEvaluate:e.expressionsToEvaluate}),this._expressionsToEvaluate=e.expressionsToEvaluate},traceContext:function(e){this._traceContext=e,e||delete this._catchupTestTask},stop:function(e){var t=this;if(t._live=!1,t._tracker.dispose(),clearTimeout(t._emitBusyTimeout),t._quokkaTempDir)try{t._dirRemoveSync(t._quokkaTempDir)}catch(n){}debug("Stopping wallaby.js");try{t._unlinkFileSync(path.join(t._root,t._structureFile))}catch(n){}if(debug("Killing %s spawned process(es)",_.keys(spawnedProcesses).length),_.each(spawnedProcesses,function(e){try{e.kill()}catch(t){}}),t._multicaster&&t._multicaster.stop(),!e&&t._flushSourceFileCacheSync(),t._uiService&&t._uiService.stop(),debug("Stopping test runner"),t._testRunner&&t._testRunner.stop(),!e&&t._structure){var r={version:t._structureFileFormatVersion,filesByPath:t._structure.filesByPath,configCode:t._structure.configCode,packageJsonTimestamp:t._structure.packageJsonTimestamp,babelrcTimestamp:t._structure.babelrcTimestamp,babelrcJsTimestamp:t._structure.babelrcJsTimestamp,invalidateCache:t._invalidateCache,notifiedAboutWallabyApp:t._structure.notifiedAboutWallabyApp};_.each(r.filesByPath,function(e,n){delete e.changeTs,delete e.changeStart,delete e.changePosition,delete e.transientChange,delete e.numberOfFunctionsChanged,delete e.lastChangeIsComplex,delete e.relatedFilesWithTests,delete e.lastSingleChangeTest,delete e.dependant,delete e.parentFilePath,delete e.childFilePath,delete e.inOriginalFilesCache,delete e.tmpLineMap,delete e.compiledTmpLineMap,delete e.noCompilers,delete e.noPreprocessors,delete e.sourceMap,delete e.testFilesLoadedFrom,delete e.hadTransientChange,delete e.tests,e.tmp&&(delete r.filesByPath[n],e.notStored||t._unlinkFileSync(e.instrumentedPath))});var i=JSON.stringify(r);debug("Saving file structure"),t._writeFileSync(path.join(t._root,t._structureFile),i)}},idByPath:function(e){var t=this._structure.filesByPath[e];if(t)return t.id},invalidateCache:function(){this._invalidateCache=!0},settings:function(){return this._settings},_cleanStack:function(e,t){if(e){var n;if(t){if(e.stack&&_.isString(e.stack)){var r=path.basename(t),i=e.stack.toString().match(new RegExp("[\\s\\S]*"+r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"[^\\)]*\\)","i"));i&&i[0]?(n=i[0],e.message&&!~n.indexOf(e.message)&&(n=e.message+"\n"+n)):n=""}}else if(e.stack&&_.isString(e.stack)){var o=path.dirname(process.mainModule.filename),s=!1;n=this._cleanMessage(_.filter(e.stack.split("\n"),function(e,t){return s||(s=_.contains(e,"quokkaStackTraceMarker")),!(s||t&&(_.contains(e,o)||_.contains(e,"From previous event:")))}).join("\n"))}else n="";if(!_.isUndefined(n)){e.stack=n;try{Object.defineProperty(e,"stack",{value:n})}catch(a){}}return e}},_cleanMessage:function(e,t){return e&&_.isString(e)?t?e.split(t).join("."):e.split(this._instrumentedRoot).join(".").split(this._localRoot).join("."):e},_startProcessorPool:function(){var e=this;trace("Starting processor pool (if not yet started)"),e._processorPool.start(process.mainModule.filename)},_tryCancelActiveTestRun:function(e){var t=this;process.env.quokka&&(e=runPriority.fileChangePriority),t._runCancelRequester=e;var n=t._testRunner&&t._testRunner.cancel(e);n?debug("Test run was cancelled"):n===!1&&debug("Test run is not cancelled because cancel requester does not have enough priority to cancel the run")},_originalLineByFileId:function(e,t,n){var r=this,i=r._structure.filesById[e];return i&&i.getFileLineMap()?utils.getOriginalLineByGeneratedLine(i.getFileLineMap(),t,n):t},_originalLineByFilePath:function(e,t,n){var r=this,i=r._structure.filesByPath[e];return i&&i.getFileLineMap()?utils.getOriginalLineByGeneratedLine(i.getFileLineMap(),t,n):t},stackEntryByFileId:function(e,t,n){var r=this;if(e===bundleFileId){var i=r._structure.filesById[bundleFileId];if(!i)return;var o=i.fileAndLineByLine(t);if(!o||!_.isNumber(o[0])||!r._structure.filesById[o[0]])return;e=o[0],t=o[1]}var s={file:e};return s.line=r._originalLineByFileId(s.file,t,n),s},stackEntryByFilePath:function(e,t,n){var r=this,i=r._structure.filesByPath[e]||r._structure.filesByPath[r._structure.filesRenamed[e]||""];if(i&&(!i.tmp||(i=r._structure.filesById[i.originalId]))&&(!i.childFilePath||(i=r.getFileMetadataByPath(i.childFilePath)))){e=i.path;var o={file:i.id};return o.line=r._originalLineByFilePath(e,t,n),o}},copyToClipboard:function(e){if("string"==typeof e.data)return utils.copyToClipboard(e.data);var t=this._buildObject(e.data),n=require("util");utils.copyToClipboard(n.formatWithOptions?n.formatWithOptions({depth:null},t):n.format(t))},_buildObject:function(e){var t,n=this,r=e.type.toLowerCase();switch(r){case"date":return new Date(e.value).toJSON();case"regexp":return new RegExp(e.value.replace(/^\//,"").replace(/\/$/,""));case"symbol":case"boolean":case"string":case"number":return e.capped?e.capped+"...":e.nan?NaN:e.positiveInfinity?1/0:e.negativeInfinity?-(1/0):e.value;case"null":return null;case"undefined":return;case"array":t=[];break;default:t={}}return _.each(e.props,function(e){return n._handleProperty(e,t)}),t},_handleProperty:function(e,t){var n=this;return e.rangeNode||e.functionsNode?_.each(e.props,function(e){return n._handleProperty(e,t)}):void(e.getter||e.type&&"function"!==e.type&&("symbol"===e.type||e.symbol||(t[e.name]=this._buildObject(e))))},isNotificationMuted:function(e){try{return!!JSON.parse(this._readFileSync(this._notificationSettingsFile))[e]}catch(t){console.warn("Unable to read notification settings file: "+(t&&t.message))}},muteNotification:function(e){try{var t=JSON.parse(this._readFileSync(this._notificationSettingsFile));t[e]={},this._writeFileSync(this._notificationSettingsFile,JSON.stringify(t))}catch(n){console.warn("Unable to read/write notification settings file: "+(n&&n.message))}},_emit:function(e,t){t&&t.id&&(e.id=t.id),this.emit("message",e)},_emitInternal:function(e,t){e._internal=!0,this._emit(e,t)},_isJavaScript:function(e){var t=this;return this._isOriginallyJavaScript(e)||utils.isJavaScript(e.instrumentedType,this._settings&&this._settings.extensions&&this._settings.extensions.javascript)||_.find(e.dependant,function(e){return t._isJavaScript(e)})||e.instrumentedByTestingFramework},_isOriginallyJavaScript:function(e){return utils.isJavaScript(e.type,this._settings&&this._settings.extensions&&this._settings.extensions.javascript)},_isOriginallyVue:function(e){return e&&utils.isVue(e.type)},_isOriginallyCoffeeScript:function(e){return utils.isCoffeeScript(e.type,e.originalPath)},_isOriginallyTypeScript:function(e){return utils.isTypeScript(e.type)},_runTests:function(e){var t=this;this._traceContext&&this._traceContext.test?(e.setRegularTraceRunTest(this._traceContext.test),this._catchupTestTask.mergeTask(e)):e.isInitialTraceRun()?this._catchupTestTask=new TestTask(this):delete this._catchupTestTask;var n=e.isFullRun(),r=e.isManualRun(),i=e.isFileChangedRun(),o=e.files(),s=e.testData(),a=this._expressionsToEvaluate,l=s&&s.files,c=s&&s.names,u=e.getPriority(),h=this._hasAnyPendingNonTransientFileChanges;if(i&&(delete this._hasAnyPendingInEditorFileChanges,delete this._hasAnyPendingNonTransientFileChanges),n&&debug("Running all tests"),i&&l&&_.isEmpty(l)&&!_.find(o,function(e){return t._isJavaScript(e)}))return Q.when({queueAgain:!0});t._updateFileOrder();var d=t._structure.sourceFilesInOrder,p=l?t._orderFilesByConfig(t._expandDependantFiles(l)):t._structure.testFilesInOrder,f=_.find(d.concat(p),function(e){return t._isJavaScript(e)&&!e.validSyntax&&e.coverable});if(f)return Q.when({queueAgain:!0,file:f.path});var g=t._selectRunnerFiles(p),m=t._selectRunnerFiles(d);if(!g.length&&o){var v=_.map(o,function(e){return e.id});if(_.isEqual(v,t._lastChangedFileIds)||(t._lastChangedFileIds=v),t._settings.loose||t.hasSomeSelectedTestFiles())return console.log("Can't determine tests to run for the change."),Q.when({queueAgain:!0});console.log("Can't determine tests to run for the change, re-running all tests.\nTo prevent the full test run when can not determine tests to run, use `loose: true` configuration option."),g=t._selectRunnerFiles(t._structure.testFilesInOrder),c=void 0,n=!0,u=e.getFullRunPriority(),debug("Test task priority upgraded to full run")}else delete t._lastChangedFileIds;var y;process.env.quokka&&t._recycleRunner&&(delete t._recycleRunner,y=!0);var b=this.selectedTestFiles();this.settings().runSelectedTestsOnly&&!b.hasSomeIncludedTestFiles&&(m.length=0,g.length=0);var k=b.hasSomeIncludedTestFiles||e.isInitialTraceRun()||e.isRegularTraceRun();return t._emitInternal({type:"runningTests",hasAnyPendingNonTransientFileChanges:h,changeRun:i,fullRun:n,recordTrace:k,userRequestedInitialTraceRun:e.isInitialTraceRun()&&e.initialTraceRunData(),tests:e.tests()}),t._testRunner.run({framework:t._settings.testFramework,fullRun:n,screen:t._screenPath,filesToLoad:_.filter(m,function(e){return e.include}),allFiles:m,testFilesToLoad:_.filter(g,function(e){return e.include}),allTestFiles:g,tests:c,priority:u,manualRun:r,recycleBeforeRun:y,expressionsToEvaluate:a,traceContext:k&&(this._traceContext||{})}).then(function(e){return e.globalErrors&&e.globalErrors.length||_.each(o,function(e){delete e.testFilesLoadedFrom}),e.testFiles=_.filter(g,function(e){return!e.tmp}),Q.when(e)})},_expandDependantFiles:function(e){return _.each(e,function(t){_.extend(e,t.dependant||{})}),e},_fullInstrumentedPathForTestRunner:function(e){return e.instrumentedPath},_fullLocalPathForTestRunner:function(e){return path.join(this._localRoot,e.path)},_selectRunnerFiles:function(e){var t=this;return _.map(e,function(e){var n=path.relative(t._instrumentedRoot,e.instrumentedPath);return{path:t.isZeroConfigJest()?t._fullLocalPathForTestRunner(e):t._fullInstrumentedPathForTestRunner(e),relativePath:n,normalizedRelativePath:t.normalizePath(n),ts:e.changeTs,id:e.id,tmp:e.tmp,test:e.test,instrument:e.coverable,changeStart:e.changeStart,changePosition:e.changePosition,transientChange:e.transientChange,relatedFilesWithTests:e.relatedFilesWithTests,parentFilePath:e.parentFilePath,numberOfFunctions:e.numberOfFunctions,childFilePath:e.childFilePath,inOriginalFilesCache:e.inOriginalFilesCache,originalId:e.originalId,originalType:e.originalType||e.type,include:e.include,esm:e.esm,type:e.instrumentedType||e.type,rangesLength:e.ranges&&e.ranges.length||0,shadowed:!_.isEmpty(e.dependant),content:process.env.quokka?t._getInstrumentedFileContent(e):void 0}})},_queueFileChange:function(e){var t=this;if(!e.file)throw new Error("File is missing");var n=e.file.id;if(!n)throw new Error("File id is missing");var r=t._changeQueue[n]=t._changeQueue[n]||[];r.push(e),t._changeQueue.containsTestTriggeringFileChanges=t._changeQueue.containsTestTriggeringFileChanges||t._isTestTriggeringFileChange(e)},_emitBusy:function(e){var t=this;e&&(this._allowedToSendBusy=!0),this._allowedToSendBusy&&(this._emit({type:"busy"}),this._tracker.busy(),this._allowedToSendBusy=!1,this._emitBusyTimeout=setTimeout(function(){t._allowedToSendBusy=!0,clearTimeout(t._emitBusyTimeout)},100))},_scheduleChangedQueueProcessing:function(e){var t=this;e=e||t._settings.delays.update,t._emitBusy(!0),t._changedQueueTimeout&&clearTimeout(t._changedQueueTimeout),t._changedQueueTimeout=setTimeout(function(){if(t._fileChangesInProcess||t._testRunInProgress||!t._structure)return void t._scheduleChangedQueueProcessing(Math.max(e,50));t._emitBusy(),delete t._changedQueueTimeout,t._fileChangesInProcess=!0;var n=!t._live;t._processChangedQueue().then(function(e){t._fileChangesInProcess=!1;var r=n&&t._live;e.length&&(r||_.find(e,function(e){return t._isTestTriggeringFileChange(e)}))?(t._queueTestRunFromFileChanges(e,r),!t._testTriggeringPendingChanges()&&t._live&&t._scheduleTestRun()):(debug("Changes did not trigger any tests"),t._emit({type:"testRunReQueued"}))})["catch"](function(e){debug("Test queueing failure: "+e&&(e.stack||e.message)),t._cleanStack(e),t._emitTestRunError(e&&e.message)})},e)},_isTestTriggeringFileChange:function(e){var t="snap"===e.file.type&&!e.inEditor;return e.file.triggersTests&&!t},_testTriggeringPendingChanges:function(){return!_.isEmpty(this._changeQueue)&&this._changeQueue.containsTestTriggeringFileChanges},_queueTestRunFromFileChanges:function(e,t){var n=this;if(t)n._queueFullTestRun();else if(!n._testTask.isFullRun()){n._testTask.setFileChangeRunPriority(),n._traceContext&&n._traceContext.test&&n._testTask.setRegularTraceRunTest(n._traceContext.test);var r=!1,i=!1;_.each(e,function(e){r=r||e.added,i=i||e.deleted;var t=e.file;e.deleted?n._testTask.addTests(e.tests):n._testTask.addChangedFile(t,e.tests)}),r&&n._testTask.filesAdded(),i&&n._testTask.filesDeleted()}},_queueRequestedTestRun:function(e){var t=this;t._testTask.addTests(e),t._testTask.setTestRunPriority()},_queueFullTestRun:function(e){var t=this;t._testTask=new TestTask(t),t._testTask.setFullRunPriority(),e&&t._testTask.setManuallyRequestedRun()},_scheduleTestRun:function(e){var t=this;t._emitBusy(!0),void 0===e&&(!t._firstScheduleTestRunComplete&&process.env.quokka?(t._firstScheduleTestRunComplete=!0,e=0):e=t._settings.delays.run),t._testTask&&process.env.quokka&&t._testTask.setFileChangeRunPriority(),t._testRunTimeout&&clearTimeout(t._testRunTimeout),t._testRunTimeout=setTimeout(function(){if(t._fileChangesInProcess||t._testRunInProgress)return void t._scheduleTestRun(Math.max(e,t._firstScheduleTestRunComplete?e:50));t._emitBusy(),t._emitTestRunStarted(),delete t._testRunTimeout,delete t._runCancelRequester,t._testRunInProgress=!0;var n=t._testTask;t._testTask=new TestTask(t),n&&n.anyFilesAdded()&&t._removedPostprocessor&&!t._settings.postprocessor&&_.find(n.files(),function(e){return t._isOriginallyTypeScript(e)})&&(debug("TypeScript file has been added, re-activating TypeScript postprocessor"),t._settings.postprocessor=t._removedPostprocessor,t._overrideFileTypesIncludedInTypeScriptCompiler=!0,delete t._removedPostprocessor);var r={},i=[];(t._settings.postprocessor?Q.promise(function(e,r){try{if((n.isManualRun()||n.isEditorRequestedRun())&&!n.isFullRun())return void e();debug("Running postprocessor");var o=n.testData(),s=t._settings.env.bundle&&(n.anyFilesAdded()||n.anyFilesDeleted()),a=t._createPostProcessorArgument({"native":t.isNativeBundler(),bundleAllowed:s,affectedFiles:_.values(n.files()),affectedTestFiles:o&&o.files,anyFilesAdded:n.anyFilesAdded(),anyFilesDeleted:n.anyFilesDeleted(),logger:{error:function(e){var n={stack:e};t._cleanStack(n),i.push({message:n.stack})}},dot:t.settings().dot});!a.anyFilesAdded&&!a.anyFilesDeleted||t._settings.postprocessor.ts||t._deleteTmpFiles(),e(t._settings.postprocessor(a).then(function(e){return s&&a.bundle.length?t._buildBundle(a.bundle).then(function(){return e}):e})["catch"](function(e){return Q.reject(e)}))}catch(l){r(l)}})["catch"](function(e){return t._runCancelRequester>=n.getPriority()?Q.reject({runCancelled:!0}):(debug("Postprocessor run failure: "+e&&(e.stack||e.message)),e.postprocessor=!0,Q.reject(e))}).then(function(e){return t._runCancelRequester>=n.getPriority()?Q.reject({runCancelled:!0}):(e&&(debug("Postprocessor execution finished"),e.removePostprocessor&&(debug("Postprocessor is removed as requested by itself"),t._removedPostprocessor=t._settings.postprocessor,t._removedPostprocessor&&t._removedPostprocessor.ts&&(t._overrideFileTypesIncludedInTypeScriptCompiler=!1),delete t._settings.postprocessor),_.isEmpty(e.testDependencies)||(r=e.testDependencies)),Q.when(!0))}):Q.when(!0)).then(function(){return t._testSelectionChanged&&(delete t._testSelectionChanged,n.isFileChangedRun()&&delete t._hasAnyPendingInEditorFileChanges,n.setFullRunPriority()),debug("Test run started; run priority: %s",n.getPriority()),t._runTests(n)})["catch"](function(e){return e.runCancelled?(debug("Test run cancelled, re-queueing run data"),Q.when({queueAgain:!0,rerun:e.rerun})):e.postprocessor?(t.isNativeBundler()?t._emitTestRunError(t._cleanStack({stack:utils.removeAnsi(e.message)}).stack):t._emitTestRunError("Postprocessor run failure: "+e.message),Q.when({queueAgain:!0,testErrorReported:!0})):(t._emitTestRunError((process.env.quokka?"":"Test run failure: ")+(e&&e.message)),Q.when(!1))}).then(function(o){if(debug("Test run finished"),_.isEmpty(r)||_.each(o.loadingSequence,function(e,t){o.loadingSequence[t]=_.keys(_.reduce((e||[]).concat(r[t]||[]),function(e,t){return e[t]=!0,e},{}))}),delete t._runCancelRequester,o)if(i.length&&(o.globalErrors=(o.globalErrors||[]).concat(i)),o.queueAgain)o.file&&(debug("File has invalid syntax: "+o.file),t._emitTestRunError("Test run failure: file "+o.file+" has invalid syntax"),o.testErrorReported=!0),o.file&&!n.hasFiles()||(t._testTask.mergeTask(n),debug("Test run data re-queued"),t._emit({type:"testRunReQueued",rerunScheduled:o.rerun,testErrorReported:o.testErrorReported})),o.rerun&&t._scheduleTestRun(e);else{var s=o.globalErrors&&o.globalErrors.length,a=s||t._hadGlobalErrorsPreviousRun;t._hadGlobalErrorsPreviousRun=s,s&&o.testFiles&&(t._lastAffectedTestFileIds=_.map(o.testFiles,function(e){return e.id})),o.changed=!!n.isFullRun()||_.reduce(n.files(),function(e,t){var n=!!t.lastSingleChangeTest;return delete t.lastSingleChangeTest,e[t.id]={singleTestChange:!a&&n},e},{}),t._emit(t._processCoverageResult({time:o.time,type:"testResults",fullRun:n.isFullRun()},o)),debug("Test run result processed and sent to IDE")}})["catch"](function(e){t._testRunInProgress=!1,t._testRunTimeout&&(clearTimeout(t._testRunTimeout),t._scheduleTestRun(100)),debug("Failed to process test run results",e.stack),console.error("Failed to process test run results",e.message)}).then(function(){t._testRunInProgress=!1,t._testRunTimeout&&(clearTimeout(t._testRunTimeout),t._scheduleTestRun(100))})},e)},_buildBundle:function(e){var t=this,n=1/0,r="",i=[],o=1;_.each(e,function(e){e.file.include=!1,e.file.notStored=!0;var t=e.content+"\n";n=Math.min(n,e.file.order);var s=utils.textLines(t).length,a=o,l=o-1+s-1,c=[a,l];c.file=e.file.originalId,i.push(c),o=l+1,r+=t});var s={id:bundleFileId,path:"____wallaby-bundle.js",ts:+new Date,tmp:!0,type:"js",instrumentedType:"js",include:!0,order:n-.1,test:!1},a=t._createFileMetadata(s,s.id);return a.originalId=s.id,a.fileAndLineByLine=function(e){for(var t,n=0,r=i.length-1;n<=r;){t=Math.floor((r+n)/2);var o=i[t];if(e>=o[0]&&e<=o[1])return[o.file,e-o[0]+1];e>o[1]?n=t+1:r=t-1}},t._fileOrderUpdatePending=!0,t._doWriteFileWithLruCache(a.instrumentedPath,r)},hadGlobalErrorsPreviousRun:function(){return this._hadGlobalErrorsPreviousRun},_emitTestRunError:function(e){var t=this;t._emit({type:"testRunError",message:t._cleanMessage(e)})},_emitTestRunStarted:function(){this._emit({type:"testRunStarted"})},_deleteDependantFiles:function(e,t){var n=this;return t||(t=[]),_.each(e.dependant,function(e){t.push(n._unlinkFilePromise(e.instrumentedPath)["catch"](function(){return Q.when()})),n._deleteDependantFiles(e,t)}),t},_processChangedQueue:function(){var e=this,t=[],n=[];_.each(e._changeQueue,function(r,i){i=parseInt(i,10);var o=!1,s=!1,a=e._structure.filesById[i],l=[],c=[],u=!1;if(_.each(r,function(e){return e["delete"]?void(o=e):(l.push(e),c=c.concat(e.file.affectedTests||[]),s=e.file.test||a&&a.test,void(u=u||e.inEditor))}),c.length||s&&o||(c=s?[[i]]:a&&_.map(a.tests,function(e,t){return e===runOneTime&&delete a.tests[t],t.split(testPathSeparator)})||[]),s&&(e._lastAffectedTestFileIds=o?void 0:[i]),o){var h=e._structure.filesByPath[o.file.path];if(h){if(t=t.concat(e._deleteDependantFiles(h)),e._deleteFileMetadata(o.file),s){var d=h.path;_.each(e._structure.filesById,function(e){_.each(e.tests,function(t){(t===d||_.startsWith(t,d+testPathSeparator))&&delete e.tests[t]})})}e.isZeroConfigJest()&&!h.inOriginalFilesCache||t.push(e._deleteSourceFile(h.originalPath)),e.isZeroConfigJest()||e.isNativeBundler()||t.push(e._unlinkFilePromise(h.instrumentedPath)),n.push({file:h,deleted:!0,tests:h.test?[]:c})}}else if(l.length){var p=_.last(l),f=e._getOrCreateFileMetadata(p.file);f.transientChange=p.transientChange,t.push(e._writeFileChanges(f,_.map(l,function(e){return e.file.content}),p.file.ts)),n.push({file:f,tests:c,added:!a,inEditor:u})}}),e._changeQueue={};var r=function(){e._filesAreUpToDate(_.map(n,function(e){return e.file.id}))};return Q.all(t).then(function(){return r(),Q.when(n)})["catch"](function(t){return debug("File system update failure: "+t&&(t.stack||t.message)),r(),e._cleanStack(t),e._emitTestRunError(t&&t.message),Q.when([])})},normalizePath:function(e){return utils.normalizePath(e)},_createPostProcessorArgument:function(e){var t=this;e=e||{};var n=t._createPostProcessorInputFile.bind(t,e["native"]),r=function(e){return!e.tmp};t._updateFileOrder();var i=_.chain(t._structure.testFilesInOrder).filter(r).map(n).value(),o=_.chain(t._structure.sourceFilesInOrder).filter(r).map(n).value().concat(i),s=e.affectedFiles&&e.affectedFiles.length&&_.chain(e.affectedFiles).filter(r).map(n).value()||o,a=e.affectedTestFiles&&e.affectedTestFiles.length&&_.chain(e.affectedTestFiles).filter(r).map(n).value()||i;delete e.affectedFiles,delete e.affectedTestFiles;var l=e.bundleAllowed;return _.extend({},{bundle:[],anyFilesAdded:!0,anyFilesDeleted:!1,allFiles:o,allTestFiles:i,affectedFiles:s,affectedTestFiles:a,nodeModulesDir:t._nodeModules,baseDir:e["native"]?t._localProjectDir:t._instrumentedRoot,tsPostprocessorOnly:t._settings.postprocessor.ts,settings:t._settings,setFileOrder:function(e){if(e.file&&e.file.id){t._fileOrderUpdatePending=!0;var n=t._getFileMetadataById(e.file.id);n&&(n.order=e.order)}return Q.when(e.order)},createFile:function(e){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,s,a,c,u,h,d,p,f,g,m,v,y,b;return __generator(this,function(k){switch(k.label){case 0:return n=this,r=_.ltrim(path.extname(e.path),"."),i=t.normalizePath(e.path),o=_.extend(e,{id:i,path:i,ts:e.ts||+new Date,tmp:!0,type:r,instrumentedType:r,include:e.load!==!1,order:e.order||0,test:e.test||e.test!==!1&&e.original&&e.original.test}),s=t._getFileMetadataById(o.id)||{},a=s.includedTestFile,c=s.excludedTestFile,o.includedTestFile=!!a,o.excludedTestFile=!!c,u=t.isNativeBundler(),h=t._createFileMetadata(o,o.id),t._fileOrderUpdatePending=!0,d=!1,d=u?l&&!h.test&&"original"in e:l&&!h.test&&"original"in e&&e.content&&0===e.content.indexOf("window.__moduleBundler.cache"),u?[3,7]:(g=e.original&&e.original.id&&e.ranges&&e.sourceMap,e.original&&e.original.id&&(p=t._structure.filesById[e.original.id],h.originalId=p.id,h.originalType=p.originalType||p.type,h.ranges=p.ranges,p.dependant||(p.dependant={}),delete p.dependant[h.id],m=_.values(p.dependant)[0],m&&(m.noCompilers===!1?t._deleteFileMetadata(m):m=void 0),p.dependant[h.id]=h,e.sourceMap&&!g&&(p.tmpLineMap=utils.updateFileMap(m&&(p.compiledTmpLineMap||p.tmpLineMap)||p.lineMap,[e.sourceMap])),g&&(h.noCompilers=!1,h.sourceMap=e.sourceMap,h.ranges=e.ranges,h.type="js",h.lineMap=utils.updateFileMap(h.lineMap,[e.sourceMap]),h.coverable=p.coverable,h.numberOfFunctions=p.numberOfFunctions,h.changePosition=_.textIndexPosition(t._getInstrumentedFileContent(p),p.changeStart),h.transientChange=p.transientChange)),g?[4,t._processFile(h,e.content,void 0,!1,!0,d)]:[3,2]);case 1:return f=k.sent(),p.tmpLineMap=h.lineMap,p.compiledTmpLineMap=h.lineMap,p.ranges=h.ranges,p.validSyntax=h.validSyntax,p.include=!1,p.numberOfFunctionsChanged=h.numberOfFunctionsChanged,p.numberOfFunctions=h.numberOfFunctions,p.lastSingleChangeTest=h.lastSingleChangeTest,delete h.lineMap,[3,6];case 2:return d?[3,4]:[4,t._doWriteFileWithLruCache(h.instrumentedPath,e.content)];case 3:return v=k.sent(),[3,5];case 4:v=e.content,k.label=5;case 5:f=v,k.label=6;case 6:return[3,11];case 7:if(e.original&&e.original.id&&(p=t._structure.filesById[e.original.id],h.originalId=p.id,h.originalType=p.originalType||p.type,p.dependant||(p.dependant={}),p.dependant[h.id]=h,h.ranges)){if(e.sourceMap&&(p.lineMap=utils.updateFileMap({},[e.sourceMap])),p.ranges=[],e.extra.sourceMap)try{y=new utils.SourceMapConsumer(e.extra.sourceMap),_.each(h.ranges||[],function(e){var t=utils.mapTransformedRangeToOriginal(y,e);t&&t[3]===1/0&&(t[3]=t[1]+1),p.ranges.push(t||[])})}catch(T){debug("Failed to map ranges for [%s], error: %s",p.path,T.message)}else p.ranges=h.ranges;p.numberOfFunctionsChanged=p.numberOfFunctions!==e.extra.numberOfFunctions,
p.numberOfFunctions=e.extra.numberOfFunctions,p.lastSingleChangeTest=p.test&&!p.numberOfFunctionsChanged&&e.extra.testName,p.lastSingleChangeTest&&debug("Detected single test [%s] change",e.extra.testName),p.include=!1,t._updateTestFileSelection(p,{includedTestFile:e.extra.includedTestFile,excludedTestFile:e.extra.excludedTestFile})}return d?[3,9]:[4,t._doWriteFileWithLruCache(h.instrumentedPath,e.content)];case 8:return b=k.sent(),[3,10];case 9:b=e.content,k.label=10;case 10:f=b,k.label=11;case 11:return d&&n.bundle.push({file:h,content:f}),[2]}})})}},e,{logger:t._createLogger("postprocessor",e.logger)})},_createLogger:function(e,t){t=t||{};var n=logger.create(e);return{debug:n.debug,trace:n.trace,error:t.error||console.error.bind(console),log:t.log||console.log.bind(console)}},_createPostProcessorInputFile:function(e,t){var n=this;return{path:e?t.path:n.normalizePath(path.relative(n._instrumentedRoot,t.instrumentedPath)),fullPath:e?path.resolve(path.join(n._localProjectDir,t.path)):t.instrumentedPath,binary:t.binary,ts:t.changeTs,id:t.id,type:e?t.type:t.instrumentedType||t.type,load:t.include,initialLoad:t.initialInclude,instrument:t.coverable,test:t.test,order:t.order,changeStart:t.changeStart,changePosition:t.changePosition,transientChange:t.transientChange,getContent:function(){if(e)return n.getLatestOriginalFileContentByPathAsync(t.path);var r=n._lruCache.get(t.instrumentedPath);return r?Q.when(r):n._readFilePromise(t.instrumentedPath)},getContentSync:function(){return e?n.getLatestOriginalFileContentByPath(t.path):n._getInstrumentedFileContent(t)},setOrder:function(e,r){n._fileOrderUpdatePending=!0,r&&_.each(t.dependant,function(t){t.order=e}),t.order=e}}},_getInstrumentedFileContent:function(e){var t=this,n=t._lruCache.get(e.instrumentedPath);return n||t._readFileSync(e.instrumentedPath)},getInstrumentedJavaScriptFileContentByPath:function(e){var t=this._structure.filesByPath[e];if(t){var n={};return n[t.path]=t,t=_.find(this._expandDependantFiles(n),function(e){return _.isEmpty(e.dependant)&&"js"===e.type})||t,t&&this._getInstrumentedFileContent(t)}},getLatestOriginalFileContentByPath:function(e){var t=this._structure.filesByPath[e];if(t){var n=this._sourceFileCache[t.originalPath];return n?n.content:!this.isZeroConfigJest()||t.inOriginalFilesCache?this._readFileSync(t.originalPath):this._readFileSync(path.join(this._localRoot,t.path))}},getLatestOriginalFileContentByPathAsync:function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return(t=this._structure.filesByPath[e])?(n=this._sourceFileCache[t.originalPath])?(r=n.content,[3,6]):[3,1]:[2];case 1:return this.isZeroConfigJest()&&!t.inOriginalFilesCache?[3,3]:[4,this._readFilePromise(t.originalPath)];case 2:return i=o.sent(),[3,5];case 3:return[4,this._readFilePromise(path.join(this._localRoot,t.path))];case 4:i=o.sent(),o.label=5;case 5:r=i,o.label=6;case 6:return[2,r]}})})},findTestFile:function(e){for(var t,n=this,r=e.files||[],i=0,o=r.length;i<o;i++){var s=r[i];if(t=n._structure.testFilesById[s])return t}if(e.testFile&&(t=n._structure.testFilesById[e.testFile]))return t;if(s=n._structure.filesById[r[0]]){var a=_.keys(s.testFilesLoadedFrom||{})[0];if(a)return t=n._structure.testFilesById[a],t&&debug('Test "%s" without test file id mapped to %s (%s)',e.name,t.path,JSON.stringify({log:e.log,filesInvolved:_.map(e.files,function(e){var t=n._structure.filesById[e];return t?t.path:"unknown or deleted file"})})),t}},resolveLogEntryRange:function(e){var t=this;if(("log"===e.type||"autoLog"===e.type||"diff"===e.type)&&_.isNumber(e.file)&&_.isNumber(e.range)){var n=this._getFileMetadataById(e.file),r=e.range;return n&&(e.range=n.ranges[r],e.range.length||(e.range=t._findPreviousValidRange(n.ranges,r)),e.range&&e.range.length||delete e.range),!0}return!1},_findPreviousValidRange:function(e,t){for(;t>0;){var n=e[--t];if(n&&n.length)return n}},_processCoverageResult:function(e,t){var n=this;e.ts=Date.now(),e.files=[],e.tests=[],e.log=t.log,e.globalErrors=t.globalErrors,e.additionalHeaderMessage=this._additionalHeaderMessage();var r=n._settings.reportConsoleErrorAsError&&{},i={};e.log=_.filter(e.log,function(t){if(!n.resolveLogEntryRange(t)&&"error"===t.type&&r){var o={message:"\n"!==t.text&&t.text||"[console.error without any message]",stack:[]};if(t.spec){var s=r[t.spec]=r[t.spec]||[];s.push(o)}else e.globalErrors||(e.globalErrors=[]),e.globalErrors.push(o);return!1}return!(t&&"autoLog"===t.type&&t.valueBag&&t.valueBag.traceId&&t.valueBag.data&&t.valueBag.data.id)||(i[t.valueBag.data.id]=t,!1)}),e.log=e.log.concat(_.values(i)),debug("Processed console.log entries"),_.each(t.loadingSequence,function(t,r){_.each(t,function(t){var i=n._structure.filesById[t];i&&!n.settings().ignoreFileLoadingDependencyTracking&&(i.testFilesLoadedFrom=i.testFilesLoadedFrom||{},i.testFilesLoadedFrom[r]=runAlways);var o=n._structure.testFilesById[t];if(r!==t&&o){var s=n._structure.testFilesById[r];s&&e.globalErrors.push({message:"Test file '"+s.path+"' is importing or is causing import of another test file '"+o.path+"'.\nThis may cause tests in the '"+o.path+"' file to be executed more than once (when the test file runs and every time it gets imported).\nIf the '"+o.path+"' test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new file into '"+s.path+"' and '"+o.path+"' test files."})}})}),debug("Processed loading sequences");var o={},s={},a=!1;_.each(t.tests,function(t){if(!t.skipped&&!o[t.id]){if(r){var i=r[t.id];i&&(t.log=(t.log||[]).concat(i))}for(var l=e.tests,c=e,u=0,h=t.suite.length;u<h;u++){var d=t.suite[u];c=_.find(l,function(e){return e.name===d&&e.tests}),c||(c={name:d,tests:[]},l.push(c)),l=c.tests}var p=!(!t.log||!t.log.length),f=n.findTestFile(t);if(!f)return console.warn("Test without test file id, most likely the test did not run, OR the test/test body is in the file that is not in the `tests` list in the configuration file",{testFileIdCanNotBeDetermined:t.name,id:t.id,log:t.log,filesInvolved:_.map(t.files,function(e){var t=n._structure.filesById[e];return t?t.path:"unknown or deleted file"})}),void(p&&(a=!0));var g=f.id,m=t.suite.slice();m.unshift(f.path),m.push(t.name);var v=m.join(testPathSeparator);p&&n._testTask.failingTest(g,m);var y=s[v];y?(debug("Test name duplicate: "+t.name),t.name+=" #"+y,s[v]=y+1):s[v]=1;var b={name:t.name,id:t.id,fileId:g,log:t.log,time:t.time,slow:t.slow};c.tests.push(b),o[t.id]={out:b,timeRange:t.timeRange},_.each(t.files,function(e){var t=n._structure.filesById[e];t&&(t.tests[v]=runAlways)});var k=[];_.each(b.log,function(e){e.external&&e.stack&&(_.each(e.stack,function(t){var r=n._structure.filesById[t[0]];r&&(r.tests[v]=r.tests[v]||runOneTime,r.test&&r.id!==g&&(e._global=!0))}),e._global&&k.push(e),delete e.external),e.snapshot=!(!e.message||!~e.message.indexOf(".toMatchSnapshot()"))}),k.length&&(e.globalErrors=(e.globalErrors||[]).concat(k),b.log=_.filter(b.log,function(e){return!e._global}))}}),a&&(e.globalErrors||(e.globalErrors=[]),e.globalErrors.unshift({message:"Some of the failing tests can not be reported, check the wallaby console for more details"})),debug("Processed executed tests"),n._updateFileOrder(),_.each(t.changed===!0?n._structure.sourceFilesInOrder.concat(n._structure.testFilesInOrder):_.map(t.changed,function(e,t){return n._getFileMetadataById(t)}),function(e){if(e){var r=e.id;_.isNumber(r)&&!t.coverage[r]&&n._isJavaScript(e)&&(t.coverage[r]=[])}});var l={};if(_.each(t.coverage,function(r,i){i=parseInt(i,10);var s=t.changed[i],a={id:i,ranges:[],changed:t.changed===!0||!!s,singleTestChanged:!(!s||!s.singleTestChange)||void 0};l[i]=a;var c=n._getFileMetadataById(i);c.instrumentedByTestingFramework&&(a.instrumentedByTestingFramework=!0);var u,h=c.ranges,d={},p={};_.each(h,function(t,s){if(t.length){var l=t.join("."),h=!1,f=r[s],g=_.map(f,function(r,s){if(s=parseInt(s,10),!s)return null;var a=o[s];if(!a)return null;var l=a.timeRange;return l?(l[0]===r&&(c.test&&n._looksLikeTestDeclarationRange(u,t)&&(e.log.push({type:"autoLog",text:_.isNumber(a.out.time)?a.out.time+"ms":"",file:i,range:u,context:""}),a.out.declaration=u&&u[0]),a.out.start=t[0],i!==a.out.fileId&&(p[a.out.fileId]=!0)),h=!0,s):s});if(u=t,a.changed||g.length||c.relatedFilesWithTests){var m={items:t,hits:g},v=d[l];v?h&&(v.hits=g):(d[l]=m,a.ranges.push(m))}}}),_.isEmpty(p)||(c.relatedFilesWithTests=p,_.each(p,function(e,t){var r=n._getFileMetadataById(t);r&&(r.relatedFilesWithTests=r.relatedFilesWithTests||{},r.relatedFilesWithTests[c.id]=!0)})),e.files.push(a)}),_.isObject(t.changed)){var c=function(e){var t=l[e];t&&(t.changed=!0,t.singleTestChanged=void 0)},u={},h=function(e){if(!u[e]){u[e]=!0;var t=n._getFileMetadataById(e);t&&t.relatedFilesWithTests&&(c(t.id),_.each(t.relatedFilesWithTests,function(e,t){c(t),h(t)}))}};_.each(t.changed,function(e,t){h(t)})}if(debug("Processed code coverage"),t.trace){e.trace={sequence:[],callStack:t.trace.callStack,tests:t.trace.tests,files:{}};var d=_.values(t.trace.tests),p=void 0,f=d.shift();_.each(t.trace.sequence,function(t){var r=n._getFileMetadataById(t[0]);p&&p.end===e.trace.sequence.length&&(p=void 0),f&&f.start===e.trace.sequence.length&&(p=f,f=d.shift());var i=!!p;if(r&&!r.test){var o=e.trace.files[r.path];o?!o.hitFromTest&&i&&(o.hitFromTest=!0,o.start=e.trace.sequence.length):e.trace.files[r.path]={start:e.trace.sequence.length,hitFromTest:i,name:r.path}}e.trace.sequence.push(t)}),debug("Processed code trace")}return e},_looksLikeTestDeclarationRange:function(e,t){return e&&t&&e[0]<=t[0]&&(e[2]>=t[2]||this.isZeroConfigJest()||this.isNativeBundler())},_filesAreUpToDate:function(e){var t=this;return t._structure.awaitingFiles=_.without.bind(null,t._structure.awaitingFiles).apply(null,e),t._signalIfBecameLive()},_filesAreRequired:function(e){var t=this;t._structure.awaitingFiles=_.union(t._structure.awaitingFiles,e),t._structure.awaitingFiles.length&&(t._live=!0,t._emit({type:"filesRequired",files:t._structure.awaitingFiles}))},_signalIfBecameLive:function(){var e=this;if(e._structure&&!e._structure.awaitingFiles.length&&!e._live){e._live=!0;var t={type:"live"};return e._emit(t),process.env.quokka&&this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},JSON.parse(process.env.quokka),{nodeVersion:process.version})),debug("Stopping process pool"),e._processorPool.stop(),!0}},_writeFileChanges:function(e,t,n){var r=this;e.inOriginalFilesCache=!0,e.changeTs=+new Date;var i,o=[];_.each(t,function(e){var t=_.isPatch(e);t?o.push(e):(i=e,o.length=0)});var s=o.length===t.length;return trace("File %s changes are patches only: %s",e.path,s),Q.all([s?r._readOriginalSourceFile(e.id,e.originalPath):Q.when(!1),r._dirEnsurePromise(path.dirname(e.originalPath)),r._dirEnsurePromise(path.dirname(e.instrumentedPath))]).then(function(t){s&&(i=t[0]);var n=void 0;return delete e.lastChangeIsComplex,_.each(o,function(t){var s=r._diffMatchPatch.patch_fromText(t),a=1===o.length&&3===t.split("@@").length;a?e.test&&_.each(s,function(e){e.diffs&&e.diffs.length&&2===e.diffs[0].length&&!e.diffs[0][0]&&(n=e.start2+e.diffs[0][1].length)}):e.lastChangeIsComplex=!0,i=r._diffMatchPatch.patch_apply(s,i)[0]}),process.env.quokka&&r._quokkaFileChanged(i),Q.all([e.binary?r._doWriteFile(e.originalPath,new Buffer(i,"base64")):r._writeSourceFile(e.originalPath,i),r._processFile(e,i,n,!r._live,!1)])}).then(function(){return e.ts=n,trace("File %s changes saved, store ts: %s, change ts: %s",e.path,e.ts,e.changeTs),Q.when(!0)})},_quokkaFileChanged:function(content){var inlineConfig,inlineConfigString;if(content){var match=/^[\s;]*(\s*\/\/.*?\r?\n)*\s*\(\s*?{/.exec(content);if(match&&match[0]){for(var braceStack=[],start=match[0].length-1,i=start,len=content.length;i<len;i++){var character=content[i];if("{"===character?braceStack.push(character):"}"===character&&braceStack.pop(),!braceStack.length)break}try{inlineConfig=eval("("+content.substring(start,i+1)+")"),inlineConfigString=JSON.stringify(inlineConfig)}catch(e){}}}if(this._settings._currentInlineQuokkaConfigString!==inlineConfigString){this._loadQuokkaSettings(inlineConfig),this._settings=this._quokkaSettings,this._settings._currentInlineQuokkaConfigString=inlineConfigString,this._settings._currentInlineQuokkaConfig=inlineConfig;var file=this._structure.filesByPath[this._quokkaFileName];delete file.noCompilers,delete file.noPreprocessors,this._recycleRunner=!0}},isZeroConfigJest:function(){return this._settings.testFramework.version&&0===this._settings.testFramework.version.indexOf("jest")&&this._settings.testFramework.autoDetected},isNativeBundler:function(){return this._settings.postprocessor&&this._settings.postprocessor.bundler&&this._settings.postprocessor.bundler["native"]},_notInstrumented:function(e,t,n){if(trace("File "+e.path+" is not instrumented by core"),e.validSyntax=!0,this.isZeroConfigJest()){if(e.changeStart=n,e.changeStart?e.changePosition=_.textIndexPosition(t,e.changeStart):delete e.changePosition,!e.binary&&e.test&&!process.env.quokka){var r=utils.deserializeRegExp(this._settings.hints.testFileSelection.include),i=utils.deserializeRegExp(this._settings.hints.testFileSelection.exclude);if(_.isString(r)){var o=r;r={test:function(e){return!!~e.indexOf(o)}}}if(_.isString(i)){var s=i;i={test:function(e){return!!~e.indexOf(s)}}}this._updateTestFileSelection(e,utils.testFileSelection(t,r,i,this._settings.automaticTestFileSelection))}}else e.ranges=[],this.isNativeBundler()&&(e.changeStart=n,e.changeStart?e.changePosition=_.textIndexPosition(t,e.changeStart):delete e.changePosition);return Q.when({code:t})},_processFile:function(e,t,n,r,i,o){var s=this;t=t&&t.toString()||"";var a=t;if(s.isZeroConfigJest()||s.isNativeBundler())return this._notInstrumented(e,a,n);if(process.env.quokka&&(r=!1,s._settings.error))throw new Error(s._settings.error);if(e.changeStart=n,trace("Preparing to process %s",e.path),"node"===s.settings().env.type&&(s._isJavaScript(e)||s._isOriginallyTypeScript(e))&&((e.coverable||e.test)&&(t=t.replace(/^\#\!.*/,"")),s._isJavaScript(e)&&s._settings.testFramework.jsPreprocessor&&(t=s._settings.testFramework.jsPreprocessor(t))),s._settings.testFramework.version&&0===s._settings.testFramework.version.indexOf("jest")&&(s._isOriginallyTypeScript(e)||s._isJavaScript(e))&&(e.originalId?e.docBlockComment=(s._structure.filesById[e.originalId]||{}).docBlockComment:e.docBlockComment=utils.docBlockComment(t).replace(/\r?\n|\r/g," ")||void 0),e.originalId){var l=s._structure.filesById[e.originalId];l&&(e.includedTestFile=l.includedTestFile,e.excludedTestFile=l.excludedTestFile)}if("snap"===e.type){var c=s._structure.filesByPath[path.join(path.dirname(e.path),"..",path.basename(e.path,".snap"))];c&&(e.testFilesLoadedFrom=e.testFilesLoadedFrom||{},e.testFilesLoadedFrom[c.id]=runAlways)}return r&&s._startProcessorPool(),!e.changeStart||e.noCompilers||e.binary||(e.changePosition=_.textIndexPosition(t,e.changeStart)),(e.binary||!e.coverable&&!e.test?Q.fcall(function(){return s._notInstrumented(e,a,n)}):(i?Q.when(t):s._runThroughProcessors(e,t,r,!0)["catch"](function(t){return s._cleanStack(t),Q.reject(new Error("Failed to run compilers on "+e.path+", "+(t&&(t.stack||t.message))))})).then(function(t){if(e.noScript)return Q.fcall(function(){return s._notInstrumented(e,a,n)});if(!e.noCompilers){trace("Processing compiled "+e.path),e.instrumentedType="js";var i=e.sourceMap,o=new utils.SourceMapConsumer(i);delete e.sourceMap;var l=_.reduce(e.ranges,function(e,t){var n=e[t[0]]=e[t[0]]||[];return n.push(t),e},{});if(e.changePosition){e.changePosition.source=i.sources&&i.sources[0]||".";var c=s._findClosestRange(l,e.changePosition,!0);c&&(e.changePosition.column=c[1]),e.changePosition.bias=2,e.changeStart=o.generatedPositionFor(e.changePosition)}e.transientChange&&e.transientChange.range&&(e.transientChange.range=utils.mapOriginalRangeToTransformed(o,e.transientChange.range));var u=s._isOriginallyCoffeeScript(e),h=function(e){_.each(e,function(e){var t={line:e[0],column:e[1]},n=o.originalPositionFor(t);if(5===e.length){var r="_extends"===e[4]||"Babel.React.createElement"===e[4]||"Babel.objectSpread"===e[4];if(e.length=4,n.source&&!r){var i={line:e[0],column:e[1],bias:2},a=o.originalPositionFor(i);a.source&&n.line<a.line&&(n=a)}n.source||(t.column+=7,n=o.originalPositionFor(t),n.source||(u?(t.column+=7,n=o.originalPositionFor(t)):(t.column+=26,n=o.originalPositionFor(t))))}if(n.source)var c=s._findClosestRange(l,n);c?(e[0]=c[0],e[1]=c[1],e[2]=c[2],e[3]=c[3]):e.length=0})}}if(!s._isOriginallyJavaScript(e)&&e.noCompilers)return Q.fcall(function(){return s._notInstrumented(e,a,n)});trace("Instrumenting "+e.path+", via process pool: "+r);var d=_.extend({},s._settings.hints);e.test?process.env.quokka||d.allowIgnoringCoverageInTests||(d=_.omit(d,"ignoreCoverage","ignoreCoverageForFile")):d=_.omit(d,"testFileSelection");var p=e.scriptRange?t.substring(e.scriptRange.start,e.scriptRange.end):t;return s._instrument(p,{file:e.tmp?e.originalId:e.id,test:e.test,testFileChangeStart:e.changeStart,virtualLog:e.transientChange&&e.transientChange.range?{changeId:e.transientChange.id,traceId:e.transientChange.traceId,expanded:e.transientChange.expanded,range:e.transientChange.range}:void 0,hints:d,recordValues:s._settings.autoConsoleLog,preserveComments:s._settings.preserveComments||!1,automaticTestFileSelection:!process.env.quokka&&e.test&&s._settings.automaticTestFileSelection,sequenceExpressionToDiff:!!process.env.quokka},r).then(function(n){if(n.error)throw n.error;return h&&h(n.ranges),s._updateTestFileSelection(e,n),e.esm=n.esm,e.validSyntax=!0,e.ranges=n.ranges,e.lineMap=utils.updateFileMap(e.noCompilers?{}:e.lineMap,[JSON.parse(n.map)]),delete e.tmpLineMap,e.numberOfFunctionsChanged=e.numberOfFunctions!==n.numberOfFunctions,e.numberOfFunctions=n.numberOfFunctions,e.lastSingleChangeTest=e.test&&!e.numberOfFunctionsChanged&&n.testName,e.lastSingleChangeTest&&debug("Detected single test [%s] change",n.testName),e.docBlockComment&&n.code&&(debug("Re-attaching document block comment"),n.code=e.docBlockComment+n.code),e.scriptRange&&(n.code=t.substring(0,e.scriptRange.start)+n.code+t.substring(e.scriptRange.end)),Q.when(n)})["catch"](function(t){return e.validSyntax=!1,s._cleanStack(t),Q.when(utils.formatInstrumentationError(t,p,e.path))})})).then(function(t){return t instanceof Error?Q.when(t):s._runThroughProcessors(e,t.code,r,!1).then(function(t){return o?Q.when(t):(trace("Writing to disk and caching processed file %s",e.path),e.binary?s._doWriteFile(e.instrumentedPath,new Buffer(t,"base64")):s._doWriteFileWithLruCache(e.instrumentedPath,t))})["catch"](function(t){return s._cleanStack(t),Q.when(new Error("Failed to run preprocessors on "+e.path+", "+(t&&(t.stack||t.message))))})}).then(function(e){return e instanceof Error?Q.reject(e):Q.when(e)})},testRunnerTransformedFile:function(e){var t=this._getFileMetadataById(e.id);if(t){if(t.ranges=[],e.transformed.map)try{var n=new utils.SourceMapConsumer(e.transformed.map);_.each(e.instrumented.ranges||[],function(e){var r=utils.mapTransformedRangeToOriginal(n,e);r&&(r[3]===1/0&&(r[3]=r[1]+1),r[2]>=r[0]||(r[2]=r[0]),r[3]>=r[1]||(r[3]=r[1]+1)),t.ranges.push(r||[])})}catch(r){debug("Failed to map ranges for [%s], error: %s",t.path,r.message)}else t.ranges=e.instrumented.ranges;if(t.lineMap=e.lineMap,t.lastSingleChangeTest=e.instrumented.testName,t.numberOfFunctions=e.instrumented.numberOfFunctions,e.parentFilePath){var i=this.getFileMetadataByPath(e.parentFilePath);i&&(t.parentFilePath=e.parentFilePath,i.childFilePath=t.path)}t.instrumentedByTestingFramework=!0,t.lastTs=e.ts}},_updateTestFileSelection:function(e,t){if(e){t.includedTestFile&&t.excludedTestFile&&delete t.includedTestFile;var n=e.includedTestFile,r=e.excludedTestFile;e.includedTestFile=t.includedTestFile,e.excludedTestFile=t.excludedTestFile,e.originalId||this._updateFileStructure(e),!!e.includedTestFile==!!n&&!!e.excludedTestFile==!!r||(this._testSelectionChanged=!0),e.originalId&&this._updateTestFileSelection(this._structure.filesById[e.originalId],t)}},_findClosestRange:function(e,t,n){var r=e[t.line];if(r)for(var i,o=1/0,s=0;s<r.length;s++){var a=r[s],l=Math.abs(a[1]-t.column);l<o&&(!n||a[1]<=t.column)&&(o=l,i=a)}return i},_runThroughProcessors:function(e,t,n,r){var i=this;if(!Object.keys(r?i._settings.compilers:i._settings.preprocessors).length||(r?e.noCompilers:e.noPreprocessors))return trace("No %s configured for %s",r?"compilers":"preprocessors",e.path),r?e.noCompilers=!0:e.noPreprocessors=!0,Q.when(t);var o={content:t,config:process.env.quokka?i._settings:i._configFile,file:e,root:i._instrumentedRoot,type:r?"compiler":"preprocessor"};return(n&&i._processorPool.started()?i._processorPool.run(o):processor(o)).then(function(t){if(t.error)throw t.error;return r?e.noCompilers=t.noProcessors:e.noPreprocessors=t.noProcessors,i._updateInstrumentedFile(t,e,r&&!e.noCompilers),Q.when(t.content)})},_updateInstrumentedFile:function(e,t,n){var r=this;n&&delete t.lineMap,e.maps&&e.maps.length&&(t.lineMap=utils.updateFileMap(t.lineMap,e.maps)),e.newPath&&(t.instrumentedPath=path.resolve(r._instrumentedRoot,e.newPath),t.instrumentedType=_.trim(path.extname(t.instrumentedPath),"."),r._structure.filesRenamed[e.newPath]=t.path),n&&(t.ranges=e.ranges,t.scriptRange=e.scriptRange,t.noScript=e.noScript,t.sourceMap=e.maps&&e.maps[0],t.ranges&&t.ranges.length||t.noScript||debug("Compiler did not set ranges for file [%s]",t.path),t.sourceMap||t.noScript||debug("Compiler did not set source map for file [%s]",t.path))},_instrument:function(e,t,n){var r=this;return n&&r._processorPool.started()?r._processorPool.run({content:e,opts:t,type:"instrumentor"}):Q.fcall(function(){return instrument(e,t)})},_writeSourceFile:function(e,t){var n=this,r=n._sourceFileCache[e];return r&&(r.content=t),n.isZeroConfigJest()||!r?n._doWriteFile(e,t):Q.when(!0)},_doWriteFile:function(e,t){var n=this;return n._dirEnsurePromise(path.dirname(e)).then(function(){return n._writeFilePromise(e,t)})},_doWriteFileWithLruCache:function(e,t){var n=this;return n._dirEnsurePromise(path.dirname(e)).then(function(){return n._writeFilePromise(e,t)}).then(function(){return n._lruCache.set(e,t),Q.when(!0)})},_deleteSourceFile:function(e){var t=this;return delete t._sourceFileCache[e],t._unlinkFilePromise(e)},_readOriginalSourceFile:function(e,t){var n=this,r=n._sourceFileCache[t];return r?(trace("Returning previously cached file [%s] from memory",e),Q.when(r.content)):n._readFilePromise(t).then(function(r){var i=Q.when(!0),o=_.keys(n._sourceFileCache);if(o.length>=2){var s=o[0],a=n._sourceFileCache[s];delete n._sourceFileCache[s],n._structure.filesById[a.id]?(i=n._doWriteFile(s,a.content),trace("Writing previously cached file [%s] to disk",s)):trace("Previously cached file [%s] was deleted and does not need saving to disk",s)}return trace("Caching file [%s] in memory",e),n._sourceFileCache[t]={content:r,id:e},i.then(function(){return Q.when(r)})})},_flushSourceFileCacheSync:function(){var e=this;try{_.each(e._sourceFileCache,function(t,n){e._dirEnsureSync(path.dirname(n)),e._writeFileSync(n,t.content)})}catch(t){_.each(e._sourceFileCache,function(t){var n=e._structure.filesById[t.id];n&&(n.ts=0)})}},_getOrCreateFileMetadata:function(e){var t=this,n=t._structure.filesByPath[e.path];if(!n){var r=t._createFileMetadata(e,e.id);return t._fileOrderUpdatePending=!0,r}return n},_getFileMetadataById:function(e){var t=this;return t._structure.filesById[e]},getFileMetadataByPath:function(e){var t=this;return t._structure.filesByPath[e]},_overrideFileType:function(e,t,n){},_createFileMetadata:function(e,t){var n=this;if(!process.env.quokka&&path.resolve(e.path)===path.normalize(e.path).replace(new RegExp(path.sep+"$"),""))throw new Error("Configured file paths must be relative: "+e.path);var r=path.join(n._originalRoot,process.env.quokka?path.basename(e.path):e.path),i=path.join(n._instrumentedRoot,e.path);if(e.instrumentedPath&&i!==e.instrumentedPath){i=e.instrumentedPath,e.instrumentedType=_.trim(path.extname(i),".");var o=path.relative(n._instrumentedRoot,i);o!==e.path&&(n._structure.filesRenamed[o]=e.path)}var s=e.type,a=n._overrideFileType(e.type,e.path,e.id)||e.type,l={id:t,path:e.path,type:a||"js",originalType:e.originalType||s||a,binary:e.binary||void 0,tmp:e.tmp||void 0,instrumentedType:e.instrumentedType||a||"js",order:e.order,originalPath:r,instrumentedPath:i,ts:e.ts,changeTs:e.ts,lastTs:e.lastTs,triggersTests:e.triggersTests,include:e.include,initialInclude:_.isBoolean(e.initialInclude)?e.initialInclude:e.include,esm:e.esm,includedTestFile:e.includedTestFile,excludedTestFile:e.excludedTestFile,coverable:e.coverable,test:e.test,tests:e.tests||{},ranges:e.ranges||void 0,lineMap:e.lineMap||void 0,tmpLineMap:e.tmpLineMap||void 0,validSyntax:e.validSyntax||void 0,numberOfFunctions:e.numberOfFunctions||void 0,docBlockComment:e.docBlockComment||void 0,instrumentedByTestingFramework:e.instrumentedByTestingFramework||void 0,getFileLineMap:function(){return this.tmpLineMap||this.lineMap}};return n._updateFileStructure(l),l},_deleteTmpFiles:function(){var e=this;this._deleteDependantFilesMetadata(),_.each(e._structure.filesByPath,function(t){return t.tmp&&e._deleteFileMetadata(t)}),e._fileOrderUpdatePending=!0},_deleteDependantFilesMetadata:function(e){var t=this;e?(_.each(e.dependant,function(e){return t._deleteFileMetadata(e)}),e.dependant={}):_.each(t._structure.filesByPath,function(e){return t._deleteDependantFilesMetadata(e)})},_deleteFileMetadata:function(e){var t=this,n=t._structure.filesByPath[e.path];if(n)return t._updateFileStructure(n,!0),t._fileOrderUpdatePending=!0,n},_updateFileStructure:function(e,t){var n=this;t?(n._deleteDependantFilesMetadata(e),delete n._structure.filesById[e.id],delete n._structure.testFilesById[e.id],delete n._structure.filesByPath[e.path],delete n._structure.testFileSelectionById.excluded[e.id],delete n._structure.testFileSelectionById.included[e.id]):(n._structure.filesById[e.id]=e,n._structure.filesByPath[e.path]=e,e.test&&(n._structure.testFilesById[e.id]=e,delete n._structure.testFileSelectionById.included[e.id],delete n._structure.testFileSelectionById.excluded[e.id],e.includedTestFile&&(n._structure.testFileSelectionById.included[e.id]=e),e.excludedTestFile&&(n._structure.testFileSelectionById.excluded[e.id]=e)))},selectedTestFiles:function(){var e=!_.isEmpty(this._structure.testFileSelectionById.included),t=!_.isEmpty(this._structure.testFileSelectionById.excluded);return{hasSomeIncludedTestFiles:e,hasSomeExcludedTestFiles:t}},hasSomeSelectedTestFiles:function(){var e=this.selectedTestFiles();return e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles},isExcludedTestFile:function(e){return!!this._structure.testFileSelectionById.excluded[e]},isIncludedTestFile:function(e){return!!this._structure.testFileSelectionById.included[e]},getIncludedTestFiles:function(){return _.values(this._structure.testFileSelectionById.included)},getNotExcludedTestFiles:function(){var e=this;return _.filter(this._structure.testFilesInOrder,function(t){return!t.originalId&&!e.isExcludedTestFile(t.id)})},_getExcludedTestFiles:function(){return _.values(this._structure.testFileSelectionById.excluded)},_additionalHeaderMessage:function(){var e=this.selectedTestFiles();if(this._settings.runSelectedTestsOnly||e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles){var t="";return this._settings.runSelectedTestsOnly&&!e.hasSomeIncludedTestFiles?t="no test files selected":e.hasSomeIncludedTestFiles&&(t="only executed "+_.map(this.getIncludedTestFiles(),function(e){return e.path}).join(", ")),!t&&e.hasSomeExcludedTestFiles&&(t="skipped "+_.map(this._getExcludedTestFiles(),function(e){return e.path}).join(", ")),"("+t+")"}},_updateFileOrder:function(){var e=this;e._fileOrderUpdatePending&&(e._structure.testFilesInOrder=[],e._structure.sourceFilesInOrder=[],_.each(e._orderFilesByConfig(e._structure.filesByPath),function(t){t.test?e._structure.testFilesInOrder.push(t):e._structure.sourceFilesInOrder.push(t)}),delete e._fileOrderUpdatePending)},_orderFilesByConfig:function(e){return _.chain(e).sortBy(function(e){return e.path}).sortBy(function(e){return e.order}).value()}}),module.exports=Project},{"./babelCompiler":11,"./config":16,"./instrumentor":25,"./processor":40,"./testTask":43,"./tracking":45,"./typeScriptPostprocessor":47,"./typeScriptUtils":48,"./utils":50,child_process:void 0,"lru-cache":void 0,os:void 0,path:void 0,typescript:void 0,util:void 0}],42:[function(e,t,n){var r=e("os"),i=e("path"),o=e("http"),s=e("./utils"),a=logger.create("workers").debug,l=e("ws").Server,c=/^win/.test(process.platform),u=5e3,h=200,d="&wallabyFileId=",p="Wallaby.js cache is corrupted, please restart wallaby.js",f=function(e,t){var n=this;n._project=e,n._opts=e.settings(),n._extension=t,process.env.quokka&&(n.reportConsoleOutput=function(t){var n=_.extend({},t);e.resolveLogEntryRange(n),e._emitInternal({type:"consoleOutput",data:n})},n.reportIntermediateResult=function(e){}),n._sessions={},n._executedTestNumber=0,n._workers={},n._connectingWorkers={},n._workerPendingCleanup={},n._calculateNumberOfParallelWorkers();for(var r=0;r<Math.max(n._maxWorkers,n._minWorkers);r++)n.getWorker(r);n._normalizedWallabyServerPath=this._project.normalizePath(i.dirname(process.mainModule.filename)),n._normalizedLocalRoot=this._project.normalizePath(this._project._localRoot),n._zeroConfigJest=this._project.isZeroConfigJest()};f.prototype={"worker:transformedFile":function(e){this._project.testRunnerTransformedFile(e)},start:function(e){var t=this,n=t._httpServer=e?o.createServer(e):o.createServer();return n.listen(0),Q.promise(function(e,r){n.on("listening",function(){try{t._receiverPort=n.address().port,a("Web server is listening at "+t._receiverPort),t._wss=new l({server:n,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),t._wss.on("connection",function(e){e.on("message",function(n){var r;try{r=JSON.parse(n)}catch(i){return void console.error("Failed to deserialize message from worker: "+n+", "+(i&&i.message))}if(t["worker:"+r.type])return t["worker:"+r.type](r.data);if(r.worker){var o=t._workers[r.worker];if(!o)return;if(o.onConnected)o.onConnected(e);else if(process.env.quokka&&o.instance){if(o.instance.channel)try{o.instance.channel.close(),o.instance.channel.removeAllListeners()}catch(i){}o.instance.channel=e}try{e.send(JSON.stringify({type:"in:connected"}))}catch(i){console.error('Failed to send the "connected" message to worker. '+i.message)}}else if(r.session){var s=t._sessions[r.session],l=!s||s._disposing||t._cancelled;if("console"===r.type&&r.data){if("debugLog"===r.data.type)return void a(r.data.text);(r.data.spec||process.env.quokka)&&!l||"autoLog"===r.data.type||console.log("console."+r.data.type+": "+r.data.text)}if(l)return;try{s[r.type](r.data)}catch(i){console.error("Failed to process message "+r.type+" from worker, "+(i&&i.message)),s.reject(i)}}})}),e()}catch(i){r(i)}})})},wallabyFileIdPrefix:function(){return d},traceContext:function(){return this._traceContext},receiverPort:function(){return this._receiverPort},setFileRoot:function(e){this._fileRoot=this._project.normalizePath(e)},run:function(e){var t=this;return t._cancelled=!1,t._executedTestNumber=0,t._runPriority=e.priority,t._traceContext=e.traceContext,e.recycleBeforeRun&&_.each(t._workers,function(e,n){t.recycleWorker(n)}),a("Starting test run, priority: "+t._runPriority),t._startTime=(new Date).getTime(),(e.fullRun&&t._maxWorkers>1&&e.testFilesToLoad.length>1?t._runInParallel(e,t._maxWorkers):t._minWorkers>1&&e.testFilesToLoad.length>1&&!(e.fullRun&&t._maxWorkers<t._minWorkers)?t._runInParallel(e,t._minWorkers):t._extension.prepare(e,0).then(function(e){return t._runTests(e)})).then(function(e){if(t._executedTestNumber){t._endTime=(new Date).getTime();var n=t._endTime-t._startTime,r="millisecond(s)";n>1e3&&(n/=1e3,r="second(s)",n>60&&(n/=60,r="minute(s)")),console.log("Finished executing "+t._executedTestNumber+" affected test(s) in "+Math.round(100*n)/100+" "+r);
}return Q.when(e)})},_handleError:function(e,t,n,r,i,o,s){var l=this;o===s&&(o=s=void 0),a("Sandbox (%s) [%s] error: %s",e.active()?"active":"inactive",t,n);var c=l._reportableError(n,r),u="SyntaxError: Parse error"===n&&_.isEmpty(r);if(l._corruptedCache(c))return l._project.invalidateCache(),e.reject(new Error(p)),void e.recycleWorker();if(process.env.quokka?a("Runtime error: "+c):console.error("Runtime error: "+c),e.active()){if(e.scheduleCompleteIfNotActiveFor(100),!r)return void e.reject(new Error(n));if(!u)try{var h={message:n,stack:_.isString(r)?r:_.reduce(r,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:o,expected:s};l._zeroConfigJest&&(h.delayStackMapping=!0,e._notMappedStackEntries.push(h));var d=[h];l._processTestLog(d),h.stack&&h.stack.length||(~h.message.indexOf("Cannot find module")||(h.message=c),h.stack=[]),!i&&e._executingTest?e.addToTestLog(h):e._globalErrors.push(h)}catch(f){e.reject(new Error(n+", "+(f&&f.message)))}}},_runTests:function(e){var t=this;if(t.cancelled())return Q.reject({runCancelled:!0});a("[%s] Running tests in sandbox",e.name);var n=e.sessionId,r=e.workerId;return Q.promise(function(i,o){t.cancelled()&&o({runCancelled:!0});try{var s=function(){var s=t._createSession(n,r,e.instance,i,o);e.instance.start(function(e){return t.cancelled()?(s.reject({runCancelled:!0}),!1):"success"===e||(s.reject(new Error("Sandbox load failed, status: "+e)),!1)},function(e,r,i,o){t._handleError(s,n,e,r,!1,i,o)})},l=t._workerPendingCleanup[r];l?(a("[%s] Sandbox is waiting for worker cleanup",n),l.onDone=function(e){return t.cancelled()?(a("[%s] Sandbox run is canceled while it was waiting for worker cleanup",n),o({runCancelled:!0})):e?(a("[%s] Sandbox worker requires recycling",n),o({runCancelled:!0,rerun:!0})):void s()}):s()}catch(c){o(c)}}).then(function(e){if(e.session){var n=e.session,r=t._createRunResult(n,e.time);return _.each(_.keys(n),function(e){e&&"_"===e[0]&&!_.isFunction(n[e])&&"_disposing"!==e&&delete n[e]}),delete e.session,Q.when(r)}return Q.when(e)})},_createRunResult:function(e,t){var n=this,r=e._coverage,i=e._trace,o=e._loadingSequence,s=e._tests,a=e._log,l=e._globalErrors.concat(e._executingTestLog);return _.each(l,function(e){return n._removeAnsi(e)}),l.length||(l=void 0),e._notMappedStackEntries.length&&(_.each(e._notMappedStackEntries,function(e){delete e.delayStackMapping,n._mapStackEntries(e)}),e._notMappedStackEntries.length=0),{coverage:r,trace:i,tests:s,log:a,globalErrors:l,loadingSequence:o,time:t}},_removeAnsi:function(e){return!s.hasAnsi(e.message)||s.hasAnsi(e.actual)||s.hasAnsi(e.expected)||(e.message=s.removeAnsi(e.message)),e},_reportableError:function(e,t){var n=this;if(_.isString(t)){var r={stack:t};return n._project._cleanStack(r),t=r.stack}return e},cancel:function(e){var t=this;if(!_.isEmpty(t._sessions))return e>=t._runPriority&&(_.each(t._sessions,function(e){e.reject({runCancelled:!0})}),t._cancelled=!0,a("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,t._runPriority),!0)},cancelled:function(){return this._cancelled},_createSession:function(e,t,n,r,i){var o=this;return o._sessions[e]={_coverage:{},_tests:[],_loadingSequence:{},_log:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:n.closing,_messagesPerTest:{},_closeByErrorTimeout:0,_longRunningWarningTimeout:0,_longRunningPingTimeout:0,_executingFiles:{},_executingTest:void 0,_notMappedStackEntries:[],started:function(t){var n=this;a("[%s] Loaded %s test(s)",e,t.total),this._total=t.total,_.each(t.loadingSequence,function(e){n._loadingSequence[e[0]]=e.slice(1)})},active:function(){return!this._disposing&&!o._cancelled},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&this._areLogEntryMessagesEqual(t.message||void 0,e.message||void 0)&&t.stack&&e.stack&&t.stack.length>0&&e.stack.length>0&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},_areLogEntryMessagesEqual:function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),e===t||(o._opts.testFramework&&o._opts.testFramework.version&&0===o._opts.testFramework.version.indexOf("mocha")?e.indexOf(":")>0&&_.contains(e,t)||t.indexOf(":")>0&&_.contains(t,e):void 0)},intermediateComplete:function(){o.reportIntermediateResult&&o.reportIntermediateResult(o._createRunResult(this))},trace:function(e){var t=this;this._trace=e.trace,this._trace&&_.each(this._trace.callStack,function(e){e.delayStackMapping=!0,t._notMappedStackEntries.push(e)})},complete:function(t){var n=this;clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),n._onFinished(),this._dispose(function(){o._cancelled?i({runCancelled:!0}):r({session:n,time:t&&t.time})}),a("[%s] Run %s test(s), skipped %s test(s)",e,this._tests.length-this._skipped,this._skipped)},globalError:function(t){o._handleError(this,e,t.message,t.stack,t.declaration,t.actual,t.expected)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._setTimeoutForLongRunningOperation(),this._executingTest=e},postTest:function(){delete this._executingTest},_setTimeoutForLongRunningOperation:function(){if(!process.env.quokka){var e=this;clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),this._longRunningWarningTimeout=setTimeout(function(){var t="Some long running code has been detected: ",r=e._executingTest,i=!_.isEmpty(e._executingFiles);if(t+=(r?'test "'+r+'"':"one of your "+(i?"files":"tests"))+" is taking more than "+u+"ms to execute.",i&&(t+="\nExecution of the following files has started but has not finished:",_.each(e._executingFiles,function(e,n){var r=o._project._getFileMetadataById(n);t+="\n- "+(r?r.path:"unknown")})),e._log.length&&(t+="\nThe last recorded console.log: "+_.last(e._log).text),r||i){t+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",r&&(t+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),t+="\nPinging test runner sandbox...";try{n.ping(function(){clearTimeout(e._longRunningPingTimeout),e.active()&&console.warn("Sandbox is responsive. The issue may have the asynchronous nature, like a missing callback.")}),e._longRunningPingTimeout=setTimeout(function(){console.warn("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},h)}catch(s){t+="\nThe sandbox ping failed: "+s.message}}console.warn(t)},u)}},module:function(e){o._project._emitInternal({type:"moduleLoaded",path:e.path,session:this})},test:function(t){var n=this;return delete this._executingTest,clearTimeout(this._closeByErrorTimeout),this._setTimeoutForLongRunningOperation(),t.hook&&t.log?(o._processTestLog(t.log),_.isString(t.hook)&&_.each(t.log,function(e){e.message=t.hook+(e.message?": ":"")+e.message}),void(this._globalErrors=this._globalErrors.concat(t.log))):(t.skipped?(this._skipped++,o._processTestLog(t.log)):(a("[%s] Test executed: "+t.name,e),o._processTestLog(t.log),t.log&&_.each(t.log,function(e){return n.addToTestLog(e)}),this._executingTestLog.length&&(t.log=this._executingTestLog.slice()),_.isUndefined(t.slow)&&(t.slow=t.time>o._opts.slowTestThreshold),t.slow=t.slow||void 0,this._executingTestLog.length=0,++o._executedTestNumber%50||console.log("Execution progress: "+o._executedTestNumber+" tests"),process.env.WALLABY_INTEGRATION_TEST_RUN&&(t.time=1)),void this._tests.push(t))},coverage:function(e){this._coverage[e.id]=e.ranges},console:function(e){var t=o._opts.maxConsoleMessagesPerTest,n=this._messagesPerTest[e.spec]=(this._messagesPerTest[e.spec]||0)+1;n===t+1?console.warn("Number of console messages per test exceeded maximum allowed value ("+t+"), current test console messages recording stopped.\nYou may increase the limit by adding `maxConsoleMessagesPerTest` setting to your config file."):n<=t&&this._log.push(e),o.reportConsoleOutput(e)},resume:function(){a("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,n.resume()},reject:function(e){this._disposing||this._dispose(function(){i(o._cancelled?{runCancelled:!0}:e)})},recycleWorker:function(){o.recycleWorker(t)},_dispose:function(r){this._disposing=!0,clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout);var i=o._workerPendingCleanup[t]={},s=!1,l=!1,c=function(n){l=!0,s&&clearTimeout(s),delete o._sessions[e],i.onDone&&i.onDone(n),delete o._workerPendingCleanup[t],r()},u=function(){l||(a("[%s] Sandbox is not responsive, recycling worker instance",e),o._tryClosingSandbox(n.close,e),o.recycleWorker(t),c(!0))};try{n.ping(function(){l||(a("[%s] Sandbox is responsive, closing it",e),o._tryClosingSandbox(n.close,e),c())})}catch(h){return a("[%s] Sandbox can not be pinged: %s",e,h&&h.message),void u()}s=setTimeout(function(){u()},1e3)}}},_tryClosingSandbox:function(e,t){try{e()}catch(n){a("[%s] Sandbox closing error, %s",t,n.message)}},_corruptedCache:function(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)},_processTestLog:function(e){var t=this;_.each(e,function(e){var n=e.message&&e.message.indexOf(" in file:///")||-1;~n&&(e.message=e.message.substring(0,n)),t._corruptedCache(e.message)&&(t._project.invalidateCache(),e.message=p),t._removeAnsi(e),t._mapStackEntries(e),process.env.quokka&&e.message&&(e.message=e.message.replace(t._normalizedLocalRoot,".").replace(t._project._localRoot,"."))})},_mapStackEntries:function(e){var t=this,n=d.length;if(e.stack&&_.isString(e.stack)&&!e.delayStackMapping){var r,i,o=[],l={},c=e.stack.split("\n");c&&t._corruptedCache(c[0])&&(t._project.invalidateCache(),e.message=p),_.each(c,function(e){var a=e.lastIndexOf(d);if(~a){var c=e.substr(a+n).split(":");c.length>=2&&(r=t._project.stackEntryByFileId(parseInt(c[0],10)||c[0],parseInt(c[1],10),parseInt(c[2],10)),r&&r.line&&(i=t._extractBrowserStackLineContext(e),i&&(l[o.length]=i),o.push([r.file,r.line])))}else if(process.env.quokka){if(process.env.quokka)if(e=t._project.normalizePath(e),_.contains(e,t._normalizedWallabyServerPath)){if(_.contains(e,"quokkaStackTraceMarker"))return!1}else{var u,h,p=e;e=e.replace(t._normalizedLocalRoot,".");var f;if(p!==e?(f=p.lastIndexOf(t._normalizedLocalRoot),v=e.substr(f).split(":")):(f=e.lastIndexOf("(")+1,0!==f?v=e.substring(f,e.lastIndexOf(")")-1).split(":"):(f=e.lastIndexOf("at ")+3,v=2!==f?e.substr(f).split(":"):[])),3===v.length){i=t._extractNodeStackLineContext(e,f);var g=parseInt(v[1],10);r=t._project.stackEntryByFilePath(t._project.normalizePath(s.isLevelUpRelativePath(v[0])?v[0]:_.ltrim(v[0],"./")),g,parseInt(v[1],10)),r&&r.line?(u=r.file,h=r.line):(!r||r&&!r.file)&&(u=v[0],h=g),u&&(i&&(l[o.length]=i),o.push([u,h]))}}}else{e=t._project.normalizePath(e);var m=t._fileRoot?e.lastIndexOf(t._fileRoot):-1;if(~m){var v=_.rtrim(e.substr(m+t._fileRoot.length),")").split(":");3!==v.length&&2!==v.length||(r=t._project.stackEntryByFilePath(t._project.normalizePath(_.ltrim(v[0],"/")),parseInt(v[1],10),parseInt(v[2],10)),r&&r.line&&(i=t._extractNodeStackLineContext(e,m),i&&(l[o.length]=i),o.push([r.file,r.line])))}}}),o.length||a("Failed to map the stack to user code, entry message: %s, stack: %s",e.message&&e.message.substring(0,1024),e.stack.substring(0,1024)),e.message=t._project._cleanMessage(e.message),"node"===t._project.settings().env.type&&e.message&&~e.message.indexOf("Cannot find module")&&(e.message=t._project._cleanMessage(e.message,t._project._root)),e.stack=o,_.isEmpty(l)||(e.context=l),e.stackMapped=!0}},_extractNodeStackLineContext:function(e,t){if(t>4&&"("===e[t-1]){var n=e.substr(0,t-2)||"";return n.split("at ")[1]}},_extractBrowserStackLineContext:function(e){var t=e.split(" (http");return t.length>=2?(t[0]||"").split("at ")[1]:(t=e.split("@http"),t.length>=2?t[0]:void 0)},_runInParallel:function(e,t){var n=this,r=e.testFilesToLoad,i={};a("Distributing tests between %s workers",t);for(var o=0;o<t;o++){var s=_.omit(e,"testFiles");s.testFilesToLoad=[],i[o]={opts:s,workerId:o,ranges:0}}return _.each(r,function(e){var t=_.chain(i).sortBy(function(e){return e.ranges}).sortBy(function(e){return e.opts.testFilesToLoad.length}).value()[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength}),a("Running tests in parallel"),Q.all(_.chain(i).filter(function(e){return e.ranges||e.opts.testFilesToLoad.length}).map(function(e){return n._extension.prepare(e.opts,e.workerId).then(function(e){return n._runTests(e)})}).value()).then(function(e){a("Merging parallel test run results");var t=_.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{});var n=e.coverage;return _.isEmpty(n)?(e.coverage=t.coverage,e):(_.each(t.coverage,function(e,t){var r=n[t];return r?void _.each(e,function(e,t){var n=r[t];return n?void _.extend(n,e):void(r[t]=e)}):void(n[t]=e)}),e)},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{}});return t.runCancelled?Q.reject(t):t.error?Q.reject(t.error):Q.when(t)})},getWorker:function(e){var t=this,n=t._workers[e];return n||(n=t._workers[e]={id:e,promise:Q.promise(function(n,r){var i=t._workers[e];if(i)if(i.instance){if(t._extension.healthy(i.instance))return void n(i);a("Found inactive run worker instance #%s, recycling",e),t.recycleWorker(e)}else if(i.promise)return i.promise;a("Starting run worker instance #"+e);try{t._extension.create(e,function(i){if(!i)return void r(new Error("Failed to create worker instance"));var o=t._workers[e]=t._workers[e]||{id:e};if(i.onConnected){o.onConnected=_.bind(i.onConnected,o),delete i.onConnected;var s,l;o.promise=Q.promise(function(e,t){s=e,l=t});var c=!1,u=setTimeout(function(){if(!c){h();var n=t._workers[e];n&&n._connected?t._extension.recycle(i):t.recycleWorker(e),a("Worker is not created in time, recycling it"),l&&l({runCancelled:!0,rerun:!0}),r({runCancelled:!0,rerun:!0})}},1e4),h=function(){c=!0,clearTimeout(u)},d=t._connectingWorkers[e];d&&t._extension.recycle(d),t._connectingWorkers[e]=i,o.onConnected(function(r){delete t._connectingWorkers[e],c||(h(),a("Started run worker instance (delayed) #"+e),o.instance=i,o._connected=!0,i.channel=r,o.promise=Q.when(i),s&&s(i),n(i))})}else a("Started run worker instance (immediate) #"+e),o.instance=i,o.promise=Q.when(i),n(i)})}catch(o){r(o)}})}),n.promise},reportConsoleOutput:function(e){},recycleWorker:function(e){var t=this;try{var n=t._workers[e];n&&n.instance&&t._extension.recycle(n.instance)}catch(r){a("Error while recycling run worker instance #%s: %s",e,r&&(r.stack||r.message))}finally{delete t._workers[e],delete t._workerPendingCleanup[e]}},stop:function(){var e=this;_.each(e._workers,function(t,n){e.recycleWorker(n)});try{e._wss&&e._wss.close()}catch(t){}try{e._httpServer&&e._httpServer.close()}catch(t){}},_calculateNumberOfParallelWorkers:function(){var e=this;e._maxWorkers=Math.max(1,e._opts.workers.initial||Math.max(r.cpus().length-2,2)),c&&!e._opts.workers.initial&&"phantomjs"===e._opts.env.kind&&(e._maxWorkers=Math.min(16,e._maxWorkers)),e._minWorkers=Math.max(1,e._opts.workers.regular||Math.max(Math.floor(e._maxWorkers/2),2)),a("Parallelism for initial run: %s, for regular run: %s",e._maxWorkers,e._minWorkers)}},t.exports=f},{"./utils":50,http:void 0,os:void 0,path:void 0,ws:void 0}],43:[function(e,t,n){"use strict";var r={testRunPriority:1,fileChangePriority:2,fullRunPriority:3},i=logger.create("testTask").debug,o=function(){function e(e){this._filesAndAffectedTests={},this._failingTests={},this._tests=[],this._priority=0,this._project=e}return e.prototype.files=function(){return _.reduce(this._filesAndAffectedTests,function(e,t){return e[t.file.id]=t.file,e},{})},e.prototype.tests=function(){return this._tests},e.prototype.hasFiles=function(){return _.keys(this._filesAndAffectedTests).length>1},e.prototype.addTests=function(e){this._tests=this._tests.concat(e)},e.prototype.addChangedFile=function(e,t){this._mergeAffectedTests(e.id,{file:e,tests:t,testFilesLoadedFrom:e.testFilesLoadedFrom})},e.prototype.setTestRunPriority=function(){this._priority=r.testRunPriority},e.prototype.setFileChangeRunPriority=function(){this._priority=r.fileChangePriority},e.prototype.setFullRunPriority=function(){this._priority=r.fullRunPriority},e.prototype.setEditorRequestedRun=function(){this._editorRequestedRun=!0},e.prototype.setEvaluatedExpressionRun=function(){this._editorRequestedRun=!0},e.prototype.setInitialTraceRun=function(e){this._initialTraceRun=e},e.prototype.setRegularTraceRunTest=function(e){this._traceTest=e},e.prototype.setManuallyRequestedRun=function(){this._manuallyRequestedRun=!0},e.prototype.getFullRunPriority=function(){return r.fullRunPriority},e.prototype.getPriority=function(){return this._priority},e.prototype.isFullRun=function(){return this._priority===r.fullRunPriority},e.prototype.isFileChangedRun=function(){return this._priority===r.fileChangePriority},e.prototype.isManualRun=function(){return(this._priority===r.testRunPriority||this._manuallyRequestedRun)&&!this._editorRequestedRun},e.prototype.isEditorRequestedRun=function(){return this._priority===r.testRunPriority&&this._editorRequestedRun},e.prototype.initialTraceRunData=function(){return this._initialTraceRun},e.prototype.isInitialTraceRun=function(){return!!this._initialTraceRun},e.prototype.isRegularTraceRun=function(){return!!this._traceTest},e.prototype.filesAdded=function(){this._anyFilesAdded=!0},e.prototype.filesDeleted=function(){this._anyFilesDeleted=!0},e.prototype.anyFilesAdded=function(){return this.isFullRun()||this._anyFilesAdded},e.prototype.anyFilesDeleted=function(){return this._anyFilesDeleted},e.prototype.mergeTask=function(e){var t=this;t._priority=Math.max(t._priority,e._priority),_.each(e._filesAndAffectedTests,function(e,n){t._mergeAffectedTests(n,e)}),t._failingTests=_.extend({},e._failingTests,t._failingTests),t._tests=t._tests.concat(e._tests),t._anyFilesAdded=t._anyFilesAdded||e._anyFilesAdded,t._anyFilesDeleted=t._anyFilesDeleted||e._anyFilesDeleted},e.prototype._mergeAffectedTests=function(e,t){var n=this,r=n._filesAndAffectedTests[e];r?(r.tests=r.tests?r.tests.concat(t.tests):t.tests,r.testFilesLoadedFrom=_.extend(r.testFilesLoadedFrom||{},t.testFilesLoadedFrom||{})):n._filesAndAffectedTests[e]=t},e.prototype.failingTest=function(e,t){var n=this._failingTests[e]=this._failingTests[e]||[];n.push(t)},e.prototype._getAllTests=function(){var e=this,t=[];if(this._traceTest)t=[this._traceTest];else{var n=!1,r={},o={},s=0,a=0,l=0,c=0,u=0;if(_.each(e._filesAndAffectedTests,function(i){var a=i.file;i.tests=_.map(i.tests,function(t){var n=e._getTestFileId(t);return r[n]||(r[n]=1,s++),i.testFilesLoadedFrom&&i.testFilesLoadedFrom[n]||a.numberOfFunctionsChanged||a.lastChangeIsComplex||a.relatedFilesWithTests?[t[0]]:t}),a.test&&(n=!0),a.test&&a.lastSingleChangeTest&&!a.relatedFilesWithTests&&!e._project.hadGlobalErrorsPreviousRun()&&(i.tests=[[a.id,"?",a.lastSingleChangeTest]]),t=t.concat(i.tests),_.extend(o,i.testFilesLoadedFrom||{})}),_.each(e._tests,function(t){var n=e._getTestFileId(t);r[n]||(r[n]=1,a++)}),t=t.concat(e._tests),_.each(o,function(e,n){n=parseInt(n,10),r[n]||(r[n]=1,t.push([n]),c++)}),!t.length&&e._project._lastAffectedTestFileIds&&e._project.hasAnyPendingInEditorFileChanges()&&(t=t.concat(_.map(e._project._lastAffectedTestFileIds,function(e){return r[e]||(r[e]=1,l++),[e]}))),!(n&&1===_.size(e._filesAndAffectedTests)||e.isManualRun())){var h=[],d={};_.each(t,function(t){var n=e._getTestFileId(t);if(!d[n]){var i=e._failingTests[n];i&&(h=h.concat(i),r[n]=1,d[n]=1,u++)}}),t=t.concat(h)}i("Test files from affected: %s, from deleted or manually requested: %s, from recently changed: %s, from loaded by: %s, from failing: %s",s,a,l,c,u)}this._project.settings().runAllTestsInAffectedTestFile&&_.each(t,function(e){e&&(e.length=1)});var p=this._project.selectedTestFiles();return this._project.settings().runSelectedTestsOnly&&!p.hasSomeIncludedTestFiles?t=[]:(p.hasSomeIncludedTestFiles||p.hasSomeExcludedTestFiles)&&(t=_.filter(t,function(t){var n=e._getTestFileId(t);return(!p.hasSomeExcludedTestFiles||!e._project.isExcludedTestFile(n))&&(!p.hasSomeIncludedTestFiles||e._project.isIncludedTestFile(n))})),t},e.prototype.testData=function(){return this._getTestRunData()},e.prototype._getTestRunData=function(){var e=this;if(this.isFullRun()){var t=this._project.selectedTestFiles();if(this._project.settings().runSelectedTestsOnly&&!t.hasSomeIncludedTestFiles)return;if(t.hasSomeIncludedTestFiles)return{files:_.reduce(e._project.getIncludedTestFiles(),function(e,t){return e[t.id]=t,e},{}),names:"*"};if(t.hasSomeExcludedTestFiles)return{files:_.reduce(e._project.getNotExcludedTestFiles(),function(e,t){return e[t.id]=t,e},{}),names:"*"}}else{var n=e._getAllTests();if(n){var r={},i={};return _.each(n,function(t){var n=r,o=e._getTestFileId(t);if(o){var s=e._project._structure.testFilesById[o];if(s&&(i[s.id]=s,1===t.length&&(r="*"),"*"!==r))for(var a=1,l=t.length;a<l;a++){var c=t[a],u=n[":"+c],h=a===l-1;if(u&&!h||(u=n[":"+c]=h?"*":{}),"*"===u)break;n=u}}}),{files:i,names:r}}}},e.prototype._getTestFileId=function(e){var t=e&&e[0];if(t)return _.isNumber(t)?t:(this._project._structure.filesByPath[t]||{}).id},e}();t.exports={TestTask:o,runPriority:r}},{}],44:[function(e,t,n){!function(e){e.addEventListener&&(e.addEventListener("beforeunload",function(){if(!(e.$_$tracer&&e.$_$tracer._finished||e.navigator&&e.navigator.userAgent&&!/PhantomJS/.test(e.navigator.userAgent)&&!/Electron/.test(e.navigator.userAgent)&&!e.$_$tracer._startRequested)&&e.$_$throwOnBeforeunload)throw new Error("One of your tests is trying to unload window object.")}),e.$_$reportUnhanledPromises&&e.addEventListener("unhandledrejection",function(e){if(e&&e.reason){var t=new Error;throw e.reason.stack&&(t.stack=e.reason.stack),t.message="Unhandled promise rejection: "+(e.reason.message||e.reason),t}}));var t,n=/%[sdjc%]/g,r=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,i=/^(0|[1-9][0-9]*)$/,o=/'([^\\']|\\')*'/;"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||{},t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype||{},i.prototype=new r,i});var s=function(){var t=this;t._noOp=function(){},t._maxLogEntrySize=e.$_$maxLogEntrySize||16384,t._evaluatedExpressionPerRangeLimit=10,t._undefined=e.undefined,t._setTimeout=e.setTimeout,t._Date=e.Date,t._Error=e.Error,t._Symbol=e.Symbol,t._JSONStringify=JSON.stringify,t._XMLHttpRequest=e.XMLHttpRequest,t._regExpToString=RegExp.prototype.toString,t._dateToString=Date.prototype.toString,t._HTMLAllCollection=e.HTMLAllCollection,t._getOwnPropertyNames=Object.getOwnPropertyNames,t._getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,t._pauseAfterSingleTestExecution=e.navigator&&e.navigator.userAgent&&/PhantomJS/.test(e.navigator.userAgent),t._replacedConsoleLog=e.console.log=function(){t._suppressConsoleLog||t._doWhenReceiverIsReady(function(e){t._log.apply(t,e)},arguments)},e.console.warn=function(){t._doWhenReceiverIsReady(function(e){t._warn.apply(t,e)},arguments)},e.console.error=function(){t._doWhenReceiverIsReady(function(e){t._error.apply(t,e)},arguments)},e.console.dir=function(){t._doWhenReceiverIsReady(function(e){t._dir.apply(t,e)},arguments)},e.console.debug=function(){t._doWhenReceiverIsReady(function(e){t._debug.apply(t,e)},arguments)},e.console.info=function(){t._doWhenReceiverIsReady(function(e){t._info.apply(t,e)},arguments)},t._receiver=e.$_$receiver||new e.WebSocket("ws://127.0.0.1:"+e.$_$receiverPort),t._onReceiverReady=[function(){t._receiverReady=!0}],t._receiver.onopen=function(){for(var e=0,n=t._onReceiverReady.length;e<n;e++)t._onReceiverReady[e]()},t._receiver.onerror=function(e){throw new Error("Sandbox receiver error: "+e.message)},t.reset()};if(s.prototype={setGlobalErrorHandler:function(){var t=this;e.$_$reuseableTracer||(e.onerror=function(){t._globalBrowserError.apply(t,arguments)})},_globalBrowserError:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendBrowserGlobalError.apply(e,t)},arguments)},reportDeclarationError:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendDeclarationError.apply(e,t)},arguments)},sendTransformedFile:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendTransformedFile.apply(e,t)},arguments)},_sendTransformedFile:function(e){this._send("transformedFile",e)},initialSpecId:function(){return e.$_$initialSpecId},start:function(t){var n=this;if(t||!(n._delayStart||n._startRequested&&!e.$_$reuseableTracer))if(n.reset(),t)this._onStart=t,this._patchFrameworks();else{if(!this._onStart)throw new Error("Missing tracer start subscription");n._startRequested=!0,this._receiverReady?this._onStart():this._onReceiverReady.push(this._onStart)}},isInitialized:function(){return!!e.$_$coverage},statement:function(n,r){e.$_$coverage[n][r][this._spec]=t++},scopeStart:function(e){this._fileEncounter[e]||(this._fileEncounterSequence.push(e),this._fileEncounter[e]=1)},programScopeStartLoading:function(t){var n=this;this._testFileIds[t]&&(this._resetFileData(),e.$_$traceContext&&e.$_$traceContext.test&&(t===e.$_$traceContext.test[0]?n._setTraceRecordMode():n._resetTraceRecordMode())),this.scopeStart(t)},programScopeEndLoading:function(e){this._testFileIds[e]&&(this._saveCurrentTestLoadingSequence(),this._resetFileData())},_saveCurrentTestLoadingSequence:function(){this._fileEncounterSequence.length&&this._testLoadingSequence.push(this._fileEncounterSequence.slice())},entryFile:function(){return this._fileEncounterSequence[0]},started:function(t){t=t||{},t.loadingSequence=this._testLoadingSequence.slice(),this._resetLoadingData(),this._resetFileData(),e.$_$wp=this._original_$_$wp,e.$_$wpe=this._original_$_$wpe,this._send("started",t)},specStart:function(t,n){var r=this,i="string"==typeof n?n:r._format(n);this._doWhenReceiverIsReady(function(){r._sendWithHighPriority("preTest",i)}),this._spec=t,this._specName=i,this._resetFileData(),e.$_$trace&&(e.$_$trace.tests[t]={start:e.$_$trace.sequence.length})},specSyncStart:function(){if(this._specRangeStart=t,e.$_$trace&&this._spec){var n=e.$_$trace.tests[this._spec];n&&(n.start=e.$_$trace.sequence.length)}},specSyncEnd:function(){this._specRangeEnd=t-1},specEnd:function(){if(e.$_$trace){var n=e.$_$trace.tests[this._spec];n&&(n.end=Math.max(e.$_$trace.sequence.length-1,n.start),n.start>e.$_$trace.sequence.length-1&&delete e.$_$trace.tests[this._spec])}this._spec=0,delete this._specName;var r=this._specRangeStart,i=this._specRangeEnd;return this._specRangeStart=0,this._specRangeEnd=0,[r,i||t]},needToNotifySingleTestRun:function(){if(this._paused||this._onResumed||!this.hasSpecFilter()||e.$_$reuseableTracer||!this._pauseAfterSingleTestExecution)return!1;for(var t=e.$_$tests;"*"!==t;){var n=Object.keys(t);if(1!=n.length)return!1;t=t[n[0]]}return!0},notifySingleTestAfterEach:function(t){return this._paused||this._onResumed||e.$_$reuseableTracer?void t():(this._paused=!0,this._onResumed=t,void this._send("resume"))},resume:function(){this._paused&&(this._paused=!1,this._onResumed&&(this._onResumed(),delete this._onResumed))},paused:function(){return this._paused},hasSpecFilter:function(){return!!e.$_$tests&&"*"!==e.$_$tests},specFilter:function(t){var n=e.$_$tests[":?"];if(n&&n[":"+t[t.length-1]])return!0;for(var r=e.$_$tests,i=0,o=t.length;i<o;i++){var s=t[i];if(r=r[":"+s],!r)return!1;if("*"===r)return!0}return!1},complete:function(t){e.$_$coverage&&(this._sendCoverageAndTimeMeasures(),e.$_$trace&&(e.$_$trace.values={},this._send("trace",{trace:e.$_$trace}),delete e.$_$trace),this._send("complete",t),e.$_$reuseableTracer||(this._receiver.close(),this._finished=!0))},intermediateComplete:function(){this._sendCoverageAndTimeMeasures()},_sendCoverageAndTimeMeasures:function(){if(e.$_$coverage){var t,n;for(t=0,n=e.$_$coverage.length;t<n;t++){var r=e.$_$coverage[t];r&&r.length&&this._send("coverage",{id:t,ranges:r})}var i=Object.keys(a._autoTimeHits);for(t=0,n=i.length;t<n;t++){var o=a._autoTimeHits[i[t]];o.fileId&&this._sendLog("autoLog",o.value?this._formatTime(o.value)+"ms":" "+this._formatTime(o.total)+"ms,  "+this._formatTime(o.total/o.n)+"ms,  "+this._formatTime(o.min)+"ms,  "+this._formatTime(o.max)+"ms",o.context,o.fileId,o.rangeId)}}},_formatTime:function(e){return e.toFixed(3)},result:function(t){t.files=this._fileEncounterSequence,e.$_$reuseableTracer&&this._sendWithHighPriority("postTest"),this._send("test",t)},_patchFrameworks:function(){var t=this;if(!t._patchedFrameworks&&!e.$_$reuseableTracer){t._patchedFrameworks=!0;var n=e.requirejs&&"function"==typeof e.requirejs.load,r=e.System&&(e.System.fetch||e.System["import"]);if(t._shouldReportProgramScope=t._shouldReportProgramScope||n||r,n){var i=e.requirejs.load;e.requirejs.load=function(e,n,r){return i.call(this,e,n,t._urlWithFileData(r))}}if(r){var o=e.System.fetch;e.System.fetch=function(){var e=arguments[0]&&arguments[0].address;return e&&(arguments[0].address=t._urlWithFileData(e)),o.apply(this,arguments)};var s=e.fetch;s&&(e.fetch=function(){var e=arguments[0];return e&&(arguments[0]=t._urlWithFileData(e)),s.apply(this,arguments)});var a=e.System["import"];e.System["import"]=function(){var e=arguments[0];return e&&(arguments[0]=t._urlWithFileData(e)),a.apply(this,arguments)}}if(t._XMLHttpRequest){var l=t._XMLHttpRequest.prototype.open;t._XMLHttpRequest.prototype.open=function(e,n){arguments[1]=t._urlWithFileData(n),l.apply(this,arguments)}}t._Error&&!t._Error.captureStackTrace&&e.navigator&&e.navigator.userAgent&&/PhantomJS\/2/.test(e.navigator.userAgent)&&(t._Error.captureStackTrace=function(){})}},_urlWithFileData:function(e){var t=this;if(e&&~e.indexOf("wallabyFileId"))return e;for(var n=[],r=e.replace(/\\/g,"/").split("/"),i=0;i<r.length;i++)"."!==r[i]&&(".."===r[i]&&n.length&&".."!==n[n.length-1]?n.pop():n.push(r[i]));return e=n.join("/"),e=t._appendFileData(e)},_appendFileData:function(t){var n=this,r="/"===t.charAt(0)?t.substr(1):t,i=e.location&&e.location.host&&t.indexOf(e.location.host);i>=0&&(r=r.substr(i+e.location.host.length+1));var o=t.lastIndexOf("?");o>=0&&(r=r.substring(0,o));var s=r&&n._getFileMetadata(r);return s?t+(~o?"&":"?")+s.ts+"&wallabyFileId="+s.id:t},_getFileMetadata:function(t){return e.$_$files[t]||e.$_$files[t.split("\\").join("/")]},_doWhenReceiverIsReady:function(e,t){var n=this;n._receiverReady?e(t):n._onReceiverReady.push(function(){e(t)})},_log:function(){this._sendLog("log",this._format.apply(this,arguments))},_warn:function(){this._sendLog("warn",this._format.apply(this,arguments))},_error:function(){this._sendLog("error",this._format.apply(this,arguments))},_dir:function(e){this._sendLog("dir",this._inspect(e))},_debug:function(e){this._sendLog("debug",this._inspect(e));
},_info:function(e){this._sendLog("info",this._inspect(e))},_debugLog:function(){this._sendLog("debugLog",this._format.apply(this,arguments))},_sendBrowserGlobalError:function(e,t,n){e=e&&e.toString()||"",t=t&&t.toString()||"",n=n&&n.toString()||"",this._send("globalError",{message:e,stack:e+"\nat "+t+":"+n})},_sendDeclarationError:function(e){this._send("globalError",{message:e.message,stack:e.stack,declaration:!0})},setEnvGlobal:function(e){this._envGlobal=e},resetEnvGlobal:function(){delete this._envGlobal},debugLog:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._debugLog.apply(e,t)},arguments)},log:function(){var t=this,n=t._replacedConsoleLog!==e.console.log;if(n||t._envGlobal){for(var r=[],i=arguments.length-3,o=0;o<i;o++)r.push(arguments[o]);t._suppressConsoleLog=!0,t._envGlobal&&t._envGlobal.console.log.apply(t._envGlobal.console,r),n&&e.console.log.apply(console,r),t._suppressConsoleLog=!1}t._doWhenReceiverIsReady(function(e){for(var n=[],r=e.length-3,i=0;i<r;i++)n.push(e[i]);var o,s=e[r],a=e[r+1],l=e[r+2],c=a+","+l,u=t._consoleHits[c]=t._consoleHits[c]||0;u<t._evaluatedExpressionPerRangeLimit?o=t._evaluateExpressions(t._expressionId(a,c,u),n[0],s):u===t._evaluatedExpressionPerRangeLimit&&(o=t._evaluateExpressions(t._expressionId(a,c,u),n[0],s,new Error("Only the first "+u+" values are evaluated"))),t._consoleHits[c]=u+1,t._sendLog("log",t._format.apply(t,n)||"",s,a,l,o)},arguments)},_expressionId:function(e,t,n){var r=(this.entryFile()||"").toString();return e=e.toString(),t+","+n+(r===e?"":","+r)},setAssertionData:function(e,t){try{var n=Object.prototype.toString.call(e.actual);e.showDiff===!0&&n==Object.prototype.toString.call(e.expected)&&void 0!==e.expected&&"[object Boolean]"!==n&&"[object Number]"!==n&&"[object Function]"!==n&&("string"!=typeof e.actual&&(e.actual=this._inspect(e.actual,8,1e3,!0,!0),e.expected=this._inspect(e.expected,8,1e3,!0,!0)),t.actual=e.actual,t.expected=e.expected),"UnexpectedError"===e.name&&e.getErrorMessage&&(t.formattedDiff=e.getErrorMessage("ansi").toString()),e.actual&&e.actual.stack&&"string"==typeof e.actual.stack&&(t.stack=t.stack||"",t.stack+="\nFrom actual error object:\n"+e.actual.stack)}catch(r){}return t},diff:function(e,t,n,r,i){var o=this;return o._doWhenReceiverIsReady(function(){var s=o.setAssertionData({showDiff:!0,expected:e,actual:t},{});o._sendLog("diff","",n,r,i,void 0,s.expected,s.actual)},arguments),t},_sendLog:function(e,t,n,r,i,o,s,a){var l=t?t.length:0;t&&l>this._maxLogEntrySize&&(t=t.slice(0,this._maxLogEntrySize)+"...\n(truncated, total length: "+l+")"),this._send("console",{type:e,text:t||"",valueBag:o,spec:this._spec,file:r,range:i,context:n,expected:s,actual:a})},_send:function(e,t){this._receiver.send(this._JSONStringify(this._createMessage(e,t)))},_createMessage:function(t,n){return{type:t,data:n,session:e.$_$session}},_sendWithHighPriority:function(e,t){if(this._highPriorityReceiver){var n=this._createMessage(e,t);n._p="###wpm###",this._highPriorityReceiver.send(this._JSONStringify(n)+"\n")}else this._send(e,t)},_resetLoadingData:function(){this._testLoadingSequence=this._safeObject([])},_resetFileData:function(){this._fileEncounterSequence=this._safeObject([]),this._fileEncounter=this._safeObject([])},reset:function(){var e=this;t=1,e._formattingOpts={},e._consoleHits={},e._autoTimeHits={},e._spec=0,delete e._specName,e._specRangeStart=0,e._specRangeEnd=0,e._stackDepth=0,e._functionCallId=0,e._resetFileData()},_safeObject:function(e){return e.toJSON=this._undefined,e},_format:function(e){var t,r=this._formattingOpts.depth||2,i=this._formattingOpts.maxElementsPerLevel||5e3;if("string"!=typeof e){var o=[];for(t=0;t<arguments.length;t++)o.push(this._inspect(arguments[t],r,i));return o.join(" ")}t=1;for(var s=arguments,a=s.length,l=1===a?e:String(e).replace(n,function(e){if("%%"===e)return"%";if(t>=a)return e;switch(e){case"%s":return String(s[t++]);case"%d":return Number(s[t++]);case"%j":return JSON.stringify(s[t++]);case"%c":return t++&&"";default:return e}}),c=s[t];t<a;c=s[++t])l+=null===c||"object"!=typeof c?" "+c:" "+this._inspect(c,r,i);return l},_inspect:function(t,n,r,i,o){var s={seen:[],showHidden:!1,hideTypes:i,depth:n||2,stylize:function(e){return e},maxElementsPerLevel:r||5e3,customInspect:e.$_$reuseableTracer&&this._nodeUtil,sortProperties:!!o};return this._formatValue(s,t,s.depth)},_formatValue:function(e,t,n){var r=this,i=this._formatPrimitive(e,t);if(i)return i;if(e.customInspect){var o=r._nodeUtil.inspect&&t[r._nodeUtil.inspect.custom];if(o||t.inspect===r._nodeUtil.inspect||"function"!=typeof t.inspect||(o=t.inspect),"function"==typeof o&&o!==r._nodeUtil.inspect&&(!t.constructor||t.constructor.prototype!==t)){var s=o.call(t,n,e);if(s!==t)return"string"!=typeof s?r._formatValue(e,s,n):s}}var a=Object.keys(t);e.sortProperties&&a.sort();var l=this._arrayToHash(a);e.showHidden&&(a=Object.getOwnPropertyNames(t));var c=this._getOwnPropertySymbols(t);if(c.length&&(a=a.concat(c)),0===a.length){if("function"==typeof t){var u=t.name?": "+t.name:"";return e.stylize("["+u+"]","special")}if(this._isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(this._isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(this._isBigInt(t))return t.toString();if(this._isError(t))return this._formatError(t)}var h="",d=!1,p=!1,f=!1,_=["{","}"],g=t&&t.constructor&&"string"==typeof t.constructor.name&&t.constructor.name||void 0;if(("Object"===g||e.hideTypes)&&(g=void 0),this._isArray(t)?(g=void 0,d=!0,_=["[","]"]):this._isSet(t)?p=!0:this._isMap(t)&&(f=!0),"function"==typeof t){var m=t.name?": "+t.name:"";h=" ["+m+"]"}if(this._isRegExp(t)&&(h=" "+RegExp.prototype.toString.call(t)),this._isDate(t)&&(h=" "+Date.prototype.toUTCString.call(t)),this._isError(t)&&(h=" "+this._formatError(t)),""===h&&g&&(_[0]=g+("String"!==g&&"Number"!==g&&"Boolean"!==g||"function"!=typeof t.valueOf?"":" "+this._formatPrimitive(e,t.valueOf()))+" "+_[0]),d||!this._isIterator(t)||f||p||(h=" [Iterator] "),!(0!==a.length||d&&0!==t.length||p||f))return _[0]+h+_[1];if(n<0)return this._isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var v,y=!1;return a.length>e.maxElementsPerLevel&&(a.length=e.maxElementsPerLevel,d&&t&&(t=t.slice(0,e.maxElementsPerLevel)),y=!0),v=d?this._formatArray(e,t,n,l,a):p?this._formatSet(e,t,n,l,a,y):f?this._formatMap(e,t,n,l,a,y):a.map(function(i){return r._formatProperty(e,t,n,l,i,d)}),y&&v.push("..."),e.seen.pop(),this._reduceToSingleString(v,h,_)},_isArray:function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===this._objectToString(e)},_isSet:function(t){return!!(t&&e.Set&&"[object Set]"===this._objectToString(t)&&t.forEach)},_isMap:function(t){return!!(t&&e.Map&&"[object Map]"===this._objectToString(t)&&t.forEach)},_isIterator:function(t){return!!(t&&e.Symbol&&e.Symbol.iterator&&"function"==typeof t[e.Symbol.iterator])},_isRegExp:function(e){return"object"==typeof e&&"[object RegExp]"===this._objectToString(e)},_isDate:function(e){return"object"==typeof e&&"[object Date]"===this._objectToString(e)},_isBigInt:function(e){return"bigint"==typeof e},_isError:function(e){return"object"==typeof e&&("[object Error]"===this._objectToString(e)||e instanceof Error)},_objectToString:function(e){return Object.prototype.toString.call(e)},_reduceToSingleString:function(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]},_formatPrimitive:function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string");case"number":return e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean");case"symbol":return this._Symbol&&this._Symbol.prototype.toString.call(t)}if(null===t)return e.stylize("null","null")},_formatError:function(e){return"["+Error.prototype.toString.call(e)+"]"},_formatSet:function(e,t,n,r,i,o){var s=this,a=[];t.forEach(function(t){if(!(a.length>e.maxElementsPerLevel)){var r=null===n?null:n-1,i=s._formatValue(e,t,r);a.push(i)}}),!o&&a.length>e.maxElementsPerLevel&&a.push("...");for(var l=0;l<i.length;l++)a.push(s._formatProperty(e,t,n,r,i[l],!1));return a},_formatMap:function(e,t,n,r,i,o){var s=this,a=[];t.forEach(function(t,r){if(!(a.length>e.maxElementsPerLevel)){var i=null===n?null:n-1,o=s._formatValue(e,r,i);o+=" => ",o+=s._formatValue(e,t,i),a.push(o)}}),!o&&a.length>e.maxElementsPerLevel&&a.push("...");for(var l=0;l<i.length;l++)a.push(s._formatProperty(e,t,n,r,i[l],!1));return a},_formatArray:function(e,t,n,r,i){for(var o=this,s=[],a=0,l=t.length;a<l;++a)this._hasOwnProperty(t,String(a))?s.push(this._formatProperty(e,t,n,r,String(a),!0)):s.push("");return i.forEach(function(i){i.toString().match(/^\d+$/)||s.push(o._formatProperty(e,t,n,r,i,!0))}),s},_formatProperty:function(e,t,n,r,i,o){var s,a,l;if(l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},l.get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),this._hasOwnProperty(r,i)||(s="["+i.toString()+"]"),a||(e.seen.indexOf(l.value)<0?(a=null===n?this._formatValue(e,l.value,null):this._formatValue(e,l.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),"undefined"==typeof s){if(o&&i.match(/^\d+$/))return a;s=this._propertyName(i),s=e.stylize(s,"string")}return s+": "+a},_arrayToHash:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_hasOwnProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},_getOwnPropertySymbols:function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]},_propertyName:function(e){if(e.match(/^\d+$/))return e;var t=JSON.stringify(""+e);return t=t.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?t.substr(1,t.length-2):t.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'")},_evaluate:function(e,t,n,r,i){var o={};try{var s=n||{};if(s.props=s.props!==this._undefined?s.props:100,s.elements=s.elements!==this._undefined?s.elements:100,s.depth=s.depth!==this._undefined?s.depth:1,s.strLength=s.strLength!==this._undefined?s.strLength:200,s.level=0,s.expId=s.expId||r,s.rootExpression=t,s.autoExpand=s.autoExpand!==this._undefined&&s.autoExpand,s.autoExpandPreviousObjects=[],s.autoExpandPropertyCount=0,s.autoExpandLimit=s.autoExpandLimit!==this._undefined?s.autoExpandLimit:5e3,s.autoExpandMaxDepth=s.autoExpandMaxDepth!==this._undefined?s.autoExpandMaxDepth:10,s.node={current:this._undefined,parent:this._undefined,index:0},i){var a={error:i.message};this._processTreeNodeResult(a,s),o.data=a}else o.data=this._traverseObject({},e,s,s.expressionsToEvaluate||{}),this._specName&&o.data&&o.data.label&&o.data.label.value&&(o.data.label.value+=" ("+this._specName+")")}catch(l){var c={error:'Error while evaluating "'+t+'": '+(l&&l.message||"")};this._processTreeNodeResult(c,s),o.data=c}return o},_addProperty:function(e,t,n,r,i,o){var s=this;return function(a){var l=i.node.current,c=i.node.index,u=i.node.parent;i.node.parent=l,i.node.index="number"==typeof r?r:a,e.push(s._property(t,n,r,i,o)),i.node.parent=u,i.node.index=c}},_addObjectProperty:function(e,t,n,r,i,o,s){var a=this;return t["_p_"+i.toString()]=!0,function(t){var l=o.node.current,c=o.node.index,u=o.node.parent;o.node.parent=l,o.node.index=t,e.push(a._property(n,r,i,o,s)),o.node.parent=u,o.node.index=c}},_traverseObject:function(e,t,n,r){var i=this,o=n.autoExpand;try{n.level++,n.autoExpand&&n.autoExpandPreviousObjects.push(t);var s,a,l,c,u,h,d,p=[],f=[],_=this._type(t),g="array"===_,m="function"===_,v=this._isPrimitiveType(_),y=this._isPrimitiveWrapperType(_),b=v||y,k={},T=0,w=!1;if(n.depth){if(g){h=t.splice(0,t.length),a=h.length;var S=r.ranges||n.ranges;if(S&&S.length===a)p=S.props,this._traverseRanges(p,function(e,t,r){for(s=t;s<=r;s++)f.push(i._addProperty(e.props,h,_,s,n))});else if(a>n.elements)l=0,c=a-1,f.push(function(e,t,n){return function(){p=p.concat(i._createRanges(e,t,n))}}(l,c,n));else for(l=0,c=a,s=l;s<c;s++)f.push(i._addProperty(p,h,_,s,n));n.autoExpandPropertyCount+=f.length}if("null"!==_&&"undefined"!==_&&!v&&"String"!==_&&"Buffer"!==_&&"bigint"!==_){var x=r.props||n.props;this._isSet(t)?(s=0,t.forEach(function(e){return T++,n.autoExpandPropertyCount++,T>x?void(w=!0):!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit?void(w=!0):void f.push(i._addProperty(p,t,"Set",s++,n,function(e){return function(){return e}}(e)))})):this._isMap(t)&&t.forEach(function(e,r){if(T++,n.autoExpandPropertyCount++,T>x)return void(w=!0);if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit)return void(w=!0);var o=i._inspect(r,2,10).replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ");o.length>100&&(o=o.slice(0,100)+"..."),f.push(i._addProperty(p,t,"Map",o,n,function(e){return function(){return e}}(e)))});try{for(u in t)if(!this._blacklistedProperty(t,u)){if(T++,n.autoExpandPropertyCount++,T>x){w=!0;break}if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit){w=!0;break}f.push(i._addObjectProperty(p,k,t,_,u,n))}}catch(C){}if(k._p_length=!0,m&&(k._p_name=!0),!w){var F=this._getOwnPropertyNames(t).concat(this._getOwnPropertySymbols(t));for(s=0,a=F.length;s<a;s++)if(u=F[s],!this._blacklistedProperty(t,u)&&!k["_p_"+u.toString()]){if(T++,n.autoExpandPropertyCount++,T>x){w=!0;break}if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit){w=!0;break}f.push(i._addObjectProperty(p,k,t,_,u,n))}}}}if(e.type=_,b?(e.value=t.valueOf(),this._capIfString(_,e,n,r)):"date"===_?e.value=this._dateToString.call(t):"RegExp"===_?e.value=this._regExpToString.call(t):"symbol"===_&&this._Symbol?e.value=this._Symbol.prototype.toString.call(t):n.depth||"null"===_||"undefined"===_||(delete e.value,e.capped=!0),w&&(e.cappedProps=!0),d=n.node.current,n.node.current=e,this._treeNodePropertiesBeforeFullValue(e,n),f.length)for(s=0,a=f.length;s<a;s++)f[s](s);p.length&&(e.props=p)}catch(C){e.type="unknown",e.error=C.message,d=n.node.current,n.node.current=e,this._treeNodePropertiesBeforeFullValue(e,n)}finally{g&&n.depth&&t.splice.apply(t,[0,0].concat(h))}return this._additionalMetadata(t,e),this._treeNodePropertiesAfterFullValue(e,n),n.node.current=d,n.level--,n.autoExpand=o,n.autoExpand&&n.autoExpandPreviousObjects.pop(),e},_blacklistedProperty:function(t,n){if((t===e||t===this._envGlobal)&&"wallaby"===n||n.indexOf&&0===n.indexOf("$_$"))return!0},_createRanges:function(e,t,n,r){r=r||{index:0};for(var i=n.elements,o=t-e+1,s=[],a=Math.max(Math.ceil(o/i),i),l=e;l<t;l+=a){var c=l,u=Math.min(l+a-1,t);u+i/2>=t&&(u=t);var h=c+" - "+u,d=u-c+1,p={rangeNode:!0,name:h,props:d>2*i&&i>1?this._createRanges(c,u,n,r):[]};if(this._setNodeId(p,n),this._setNodeLabel(p,n),this._setNodeExpandableState(p,n),this._setNodePermissions(p,n),p.id+=" r "+r.index++,s.push(p),u===t)break}return s},_traverseRanges:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i.rangeNode=!0,i.props)if(i.props.length)this._traverseRanges(i.props,t);else if(i.props===!0){var o=i.name.split("-");i.props=[],t(i,parseInt(o[0],10),parseInt(o[1],10))}}},_capIfString:function(e,t,n,r){var i=r.strLength||n.strLength;("string"===e||"String"===e)&&t.value&&t.value.length>i&&(t.capped=t.value.substr(0,i),delete t.value)},_property:function(e,t,n,r,i){var o=this;i||(i=function(e,t){return e[t]});var s=n.toString(),a=r.expressionsToEvaluate||{},l=r.depth,c=r.isExpressionToEvaluate;try{var u=this._isMap(e),h=s;u&&"'"===h[0]&&(h=h.substr(1,h.length-2));var d=r.expressionsToEvaluate=a["_p_"+h];d&&(r.depth=r.depth+1),r.isExpressionToEvaluate=!!d;var p="symbol"==typeof n,f={name:p||u?s:this._propertyName(s)};if(p&&(f.symbol=!0),"array"!==t&&"Error"!==t){var _=this._getOwnPropertyDescriptor(e,n);if(_&&(_.set&&(f.setter=!0),_.get&&!d))return f.getter=!0,this._processTreeNodeResult(f,r),f}var g;try{g=i(e,n)}catch(m){return f={name:s,type:"unknown",error:m.message},this._processTreeNodeResult(f,r),f}var v=this._type(g),y=this._isPrimitiveType(v);if(f.type=v,y)this._processTreeNodeResult(f,r,g,function(){f.value=g.valueOf(),!d&&o._capIfString(v,f,r,{})});else{var b=r.autoExpand&&r.level<r.autoExpandMaxDepth&&r.autoExpandPreviousObjects.indexOf(g)<0&&"function"!==v&&r.autoExpandPropertyCount<r.autoExpandLimit;b||r.level<l||d?(this._traverseObject(f,g,r,d||{}),this._additionalMetadata(g,f)):this._processTreeNodeResult(f,r,g,function(){"null"!==v&&"undefined"!==v&&(delete f.value,f.capped=!0)})}return f}finally{r.expressionsToEvaluate=a,r.depth=l,r.isExpressionToEvaluate=c}},_processTreeNodeResult:function(e,t,n,r){this._treeNodePropertiesBeforeFullValue(e,t),r&&r(),this._additionalMetadata(n,e),this._treeNodePropertiesAfterFullValue(e,t)},_treeNodePropertiesBeforeFullValue:function(e,t){this._setNodeId(e,t),this._setNodeQueryPath(e,t),this._setNodeExpressionPath(e,t),this._setNodePermissions(e,t)},_treeNodePropertiesAfterFullValue:function(e,t){this._setNodeLabel(e,t),this._setNodeExpandableState(e,t),this._sortProps(e,t),this._addFunctionsNode(e,t),this._addLoadNode(e,t),this._cleanNode(e,t)},_additionalMetadata:function(e,t){try{e&&"number"==typeof e.length&&(t.length=e.length)}catch(n){}if("number"===t.type||"Number"===t.type)if(isNaN(t.value))t.nan=!0,delete t.value;else switch(t.value){case Number.POSITIVE_INFINITY:t.positiveInfinity=!0,delete t.value;break;case Number.NEGATIVE_INFINITY:t.negativeInfinity=!0,delete t.value}else"function"===t.type&&"string"==typeof e.name&&e.name&&t.name&&e.name!==t.name&&(t.funcName=e.name)},_setNodeId:function(e,t){e.id=t.node.parent?t.node.parent.id+" "+t.node.index:t.expId},_sortProps:function(e){e.props&&e.props.length&&"array"!==e.type&&"Map"!==e.type&&"Set"!==e.type&&e.props.sort(function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n<r?-1:n>r?1:0})},_addFunctionsNode:function(e,t){if(e.props&&e.props.length){for(var n=[],r=[],i=0,o=e.props.length;i<o;i++){var s=e.props[i];"function"===s.type?n.push(s):r.push(s)}if(!r.length&&t.autoExpand&&(e.capped=!0),r.length&&!(n.length<=1)){e.props=r;var a={functionsNode:!0,props:n};t.autoExpand&&(a.capped=!0),this._setNodeId(a,t),this._setNodeLabel(a,t),this._setNodeExpandableState(a,t),this._setNodePermissions(a,t),a.id+=" f",e.props.unshift(a)}}},_addLoadNode:function(e,t){if(e.props&&e.props.length&&e.cappedProps&&"string"!==e.type){var n={loadActionNode:!0};this._setNodeId(n,t),this._setNodeQueryPath(n,t),this._setNodeLabel(n,t),this._setNodeExpandableState(n,t),this._setNodePermissions(n,t),n.id+=" l",e.props.push(n)}},_setNodeExpandableState:function(e){(e.capped||e.cappedProps||e.functionsNode||e.loadActionNode||e.rangeNode||e.getter||this._isArray(e.props))&&(e.expandable=!0)},_setNodePermissions:function(e,t){var n=t.node.parent;e._hasSymbolPropertyOnItsPath=e.symbol||n&&n._hasSymbolPropertyOnItsPath;var r=n&&n._hasSetOnItsPath,i=n&&n._hasMapOnItsPath;e._hasSetOnItsPath="Set"===e.type||r,e._hasMapOnItsPath="Map"===e.type||i;var o=!(e.functionsNode||e.loadActionNode||e.rangeNode||e.error);(!o||e._hasSymbolPropertyOnItsPath||r||i)&&(e.disallowToCopyPath=!0),o&&!e.getter&&"function"!==e.type&&"symbol"!==e.type&&"Set"!==e.type&&"Map"!==e.type||(e.disallowToCopyData=!0)},_cleanNode:function(e){delete e._hasSymbolPropertyOnItsPath,delete e._hasSetOnItsPath,delete e._hasMapOnItsPath},_setNodeExpressionPath:function(e,t){if(!t.node.parent)return void(e.expressionPath=[t.rootExpression]);var n=t.node.parent.expressionPath.slice();e.expressionPath=n.concat([this._propertyAccessor(e.name)])},_propertyAccessor:function(e){return e?e.match(i)?"["+e+"]":e.match(r)?"."+e:e.match(o)?"["+e+"]":"['"+e+"']":""},_setNodeQueryPath:function(e,t){if(!t.node.parent)return void(e.queryPath=[e.id]);if(e.loadActionNode)return void(e.queryPath=t.node.current.queryPath.slice());var n=e.name;n&&"'"===n[0]&&(n=n.substr(1,n.length-2)),e.queryPath=t.node.parent.queryPath.slice().concat(["_p_"+n])},_setNodeLabel:function(e,t){return e.label={},e.rangeNode?void(e.label.name=e.name):e.loadActionNode?void(e.label.name="..."):e.functionsNode?void(e.label.name="functions"):(e.label.name=e.name,e.label.type=this._formatNodeType(e,t),void(e.label.value=this._formatNodeValue(e,t)))},_formatNodeValue:function(e,t,n){if(e.rangeNode)return e.name;if(e.error)return e.error;if(e.getter)return"(...)";if("number"===e.type.toLowerCase()){var r=e;if(r.nan)return"NaN";if(r.positiveInfinity)return"Infinity";if(r.negativeInfinity)return"-Infinity"}if("null"===e.type||"undefined"===e.type)return e.type;if("string"===e.type.toLowerCase()){var i=e.capped?e.capped+"...":e.value;return"'"+i.replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'"+(e.capped?" (total length: "+e.length+")":"")}return(this._isUndefined(e.value)?this._formatCompactObjectView(e,t,n):e.value)+(e.funcName?":"+e.funcName:"")},_formatCompactObjectView:function(e,t,n){if("function"===e.type)return"";var r="array"===e.type&&0===e.length,i=["array"===e.type?"[":"{","","array"===e.type?"]":"}"];if(n||e.capped||e.ranges)i[1]=r?"":"...";else if(e.props){for(var o=5,s=[],a=[],l=0;l<e.props.length&&a.length<=o;l++){var c=e.props[l];("function"===c.type||c.getter?s:a).push("array"===e.type?this._formatNodeValue(c,t,!0):c.name+": "+this._formatNodeValue(c,t,!0))}a.length<o&&(a=a.concat(s)),i[1]=a.join(", "),e.props.length>o&&(i[1]+=", ...")}return i.join("")},_formatNodeType:function(e){if(this._isDisplayableType(e.type))return e.error?"":"date"===e.type?"Date":"array"===e.type?e.length?"Array("+e.length+")":"":e.type},_isUndefined:function(e){return e===this._undefined},_isDisplayableType:function(e){return!("boolean"===e||"Boolean"===e||"symbol"===e||"string"===e||"String"===e||"number"===e||"Number"===e||"object"===e||"Object"===e||"function"===e||"null"===e||"undefined"===e)},_type:function(e){var t=typeof e;return"object"===t?"[object Array]"===this._objectToString(e)?t="array":"[object Date]"===this._objectToString(e)?t="date":null===e?t="null":e.constructor&&(t=e.constructor.name||t):"undefined"===t&&this._HTMLAllCollection&&e instanceof this._HTMLAllCollection&&(t="HTMLAllCollection"),t},_isPrimitiveType:function(e){return"boolean"===e||"string"===e||"number"===e},_isPrimitiveWrapperType:function(e){return"Boolean"===e||"String"===e||"Number"===e},initLoadingPhase:function(){var t=this;this._resetLoadingData(),this._testFileIds=this._safeObject({}),(e.$_$testFiles||[]).forEach(function(e){t._testFileIds[e.id]=1}),t._original_$_$wp=e.$_$wp,t._original_$_$wpe=e.$_$wpe,e.$_$wp=function(e){return t._reportProgramScope("programScopeStart",e),t.programScopeStartLoading(e),t._executionContext()},e.$_$wpe=function(e){t._reportProgramScope("programScopeEnd",e),t.programScopeEndLoading(e)},!e.$_$traceContext||e.$_$traceContext.test?t._resetTraceRecordMode():e.$_$traceContext.test||t._setTraceRecordMode()},_resetTraceRecordMode:function(){e.$_$w=a.$_$w,e.$_$wv=a.$_$wv,e.$_$wf=a.$_$wf,this._envGlobal&&(this._envGlobal.$_$w=e.$_$w,this._envGlobal.$_$wv=e.$_$wv,this._envGlobal.$_$wf=e.$_$wf)},_setTraceRecordMode:function(){e.$_$trace||(e.$_$trace={sequence:[],tests:{},values:{}}),e.$_$traceContext.currentFrame>=0||e.$_$traceContext.captureCallStackFrame>=0?(e.$_$traceContext.allowRecordingValues=!0,e.$_$w=function(e,t,n){a.$_$w(e,t),a._recordTrace(e,t,n[0]),a._recordTraceValues(e,t,n[1]),a._recordCallStack()},e.$_$wv=function(t,n,r,i,o,s,l,c,u,h){var d=a._expressionId(t,r,0);return e.$_$trace.values[d]={fileId:t,rangeId:n,fileRangeId:r,context:o,val:s,exp:l,singleHit:c,autoExpandValue:u,virtualLogContext:h},a._recordTraceValues(t,n,i[1],!0),s}):(e.$_$w=function(e,t,n){a.$_$w(e,t),a._recordTrace(e,t,n[0])},e.$_$wv=a.$_$wv),e.$_$wf=function(e){return a.scopeStart(e),a._executionContext()},this._envGlobal&&(this._envGlobal.$_$w=e.$_$w,this._envGlobal.$_$wv=e.$_$wv,this._envGlobal.$_$wf=e.$_$wf)},_executionContext:function(){return[++this._stackDepth,++this._functionCallId]},_recordCallStack:function(){e.$_$traceContext.captureCallStackFrame===e.$_$trace.sequence.length-1&&(e.$_$trace.callStack={},e.$_$trace.callStack[e.$_$traceContext.captureCallStackFrame]={stack:a._currentStack()})},_recordTraceValues:function(t,n,r,i){if(e.$_$traceContext.allowRecordingValues){var o=e.$_$traceContext.currentFrame===e.$_$trace.sequence.length-1,s=e.$_$traceContext.currentFrame<e.$_$trace.sequence.length-1;if((s&&!e.$_$traceContext.currentFrameFunctionCallId||r<=e.$_$traceContext.currentFrameFunctionCallId)&&(e.$_$traceContext.allowRecordingValues=!1),o&&!i&&(e.$_$traceContext.currentFrameFunctionCallId=r),(o||i&&e.$_$traceContext.currentFrameFunctionCallId&&r===e.$_$traceContext.currentFrameFunctionCallId)&&Object.keys(e.$_$trace.values).length){var l=e.$_$trace.values;e.$_$trace.values={},a._doWhenReceiverIsReady(function(){for(var e=Object.keys(l),t=0,n=e.length;t<n;t++){var r=e[t],i=l[r];a._autoLogImmediateValue(i.fileId,i.rangeId,0,i.context,i.val,i.exp,i.singleHit,i.autoExpandValue,i.virtualLogContext)}})}}},_recordTrace:function(t,n,r){e.$_$trace.sequence.length>999999||(e.$_$trace._stackDepth!==r&&(e.$_$trace._stackDepth=r),e.$_$trace.sequence.push([t,n,r]))},_currentStack:function(){try{throw new Error("stack trace")}catch(e){return e.stack}},_reportProgramScope:function(e,t){var n=this;this._shouldReportProgramScope&&this._doWhenReceiverIsReady(function(){n._sendWithHighPriority(e,t)})},_looksLikePromise:function(t){return t&&t.constructor&&"Promise"===t.constructor.name&&"function"==typeof t.then&&"function"==typeof t["catch"]&&(e.Promise||{}).prototype!==t},_looksLikeObservable:function(e){return e&&e.constructor&&e.constructor.name&&"string"==typeof e.constructor.name&&~e.constructor.name.indexOf("Observable")&&"function"==typeof e.forEach},_looksLikeBuffer:function(t){return t&&t.constructor&&"Buffer"===t.constructor.name&&"function"==typeof t.toString&&(e.Buffer||{}).prototype!==t},_autoLogValue:function(t,n,r,i,o,s,a,l,c){var u=this,h=e.$_$session;u._looksLikePromise(o)?o.then(function(o){e.$_$session===h&&u._autoLogResolvedValue(t,n,r,i,"then ",u._valueToFormat(o,s),a,l,c)})["catch"](function(o){e.$_$session===h&&u._autoLogResolvedValue(t,n,r,i,"catch ",(o||"<No Reason Provided>").toString(),a,l,c)}):u._looksLikeObservable(o)?o.forEach(function(o){e.$_$session===h&&u._autoLogResolvedValue(t,n,r,i,"",u._valueToFormat(o,s),a,l,c)}):u._autoLogImmediateValue(t,n,r,i,o,s,a,l,c)},_valueToFormat:function(e,t){return"$_$ne"===t?e:t(e)},_autoLogImmediateValue:function(e,t,n,r,i,o,s,a,l){var c=this;c._isBigInt(i)&&(i=i.toString()),c._autoLogResolvedValue(e,t,n,r,"",c._valueToFormat(c._looksLikeBuffer(i)?i.toString():i,o),s,a,l)},_autoLogResolvedValue:function(e,t,n,r,i,o,s,a,l){this._formattingOpts={maxElementsPerLevel:s?10:100};var c,u,h=e+","+t;l&&(u=l.changeId),n<this._evaluatedExpressionPerRangeLimit?c=this._evaluateExpressions(this._expressionId(e,h,n),o,r,void 0,a,u):n===this._evaluatedExpressionPerRangeLimit&&(c=this._evaluateExpressions(this._expressionId(e,h,n),o,r,new Error("Only the first "+n+" values are evaluated"),a,u)),c&&l&&l.traceId&&(c.traceId=l.traceId),this._sendLog("autoLog",i+(this._format(o)||""),r,e,t,c),this._formattingOpts={}},_evaluateExpressions:function(e,t,n,r,i,o){var s=this._expressionsToEvaluate&&this._expressionsToEvaluate[e],a={expressionsToEvaluate:s};s||(a.depth=0),i&&(a.autoExpand=!0,a.depth=1,a.strLength=8192);var l=this._evaluate(t,n,a,e,r);return(l.data||{}).id=e,(l.data||{}).autoExpand=!!i,(l.data||{}).changeId=o,l}},e.$_$doNotInit)e.$_$Tracer=s;else{var a=new s;a.setGlobalErrorHandler();var l=function(e,t){return t-e};e.performance?a._time=function(){return e.performance.now()}:e.process&&e.process.hrtime?(a._time=function(){return e.process.hrtime()},l=function(e,t){return 1e3*(t[0]-e[0])+(t[1]-e[1])/1e6}):a._time=function(){return+new Date},a._logTime=function(e,t,n,r,i,o,s,c){var u=l(o,c),h=a._autoTimeHits[n];return h?(h.value&&(h.n=1,h.min=h.value,h.max=h.value,h.total=h.value,delete h.value),h.min=Math.min(h.min,u),h.max=Math.max(h.max,u),h.total+=u,h.n+=1):a._autoTimeHits[n]={value:u,context:i,fileId:e,rangeId:t},s},a.$_$w=e.$_$w=e.$_$w_=function(e,t){a.statement(e,t)},e.$_$wp=function(e){return a._reportProgramScope("programScopeStart",e),a.scopeStart(e),a._executionContext()},e.$_$wpe=function(e){a._reportProgramScope("programScopeEnd",e)},a.$_$wf=e.$_$wf=function(e){a.scopeStart(e)},a.$_$wv=e.$_$wv=function(e,t,n,r,i,o,s,l,c,u){var h=a._consoleHits[n]||0;return l?a._identifierExpressionAutoLogHitLimit?h<a._identifierExpressionAutoLogHitLimit?a._doWhenReceiverIsReady(function(){a._autoLogValue(e,t,h,i,o,s,l,c,u)},arguments):h===a._identifierExpressionAutoLogHitLimit&&a._doWhenReceiverIsReady(function(){a._sendLog("log","Only the first "+a._identifierExpressionAutoLogHitLimit+" values are automatically logged, use console.log("+(i||"...")+") for the full output",i,e,t)},arguments):h||a._doWhenReceiverIsReady(function(){a._autoLogValue(e,t,h,i,o,s,l,c,u)},arguments):a._doWhenReceiverIsReady(function(){a._autoLogValue(e,t,h,i,o,s,l,c,u)},arguments),a._consoleHits[n]=h+1,o},e.$_$tracer=a,e.$_$coverage=e.$_$coverage||[],e.$_$reuseableTracer||(e.$_$tracer._expressionsToEvaluate=e.$_$expressionsToEvaluate||{});var c=function(e){return e.path},u=function(e){return e?e.replace(/\\/g,"/"):e},h=e.$_$testFiles&&(e.$_$testFiles||[]).map(c).map(u),d=e.$_$testFiles&&e.$_$testFiles.filter(function(e){return e.loaded}).map(c);a.initLoadingPhase(),e.wallaby={delayStart:function(){a._patchFrameworks(),a._delayStart=!0},start:function(){a._delayStart=!1,a.start()},_startWhenReceiverIsReady:function(e){a._shouldReportProgramScope=!0,a._doWhenReceiverIsReady(function(){e()})},tests:h,loadedTests:d,baseDir:e.$_$baseDir,slowTestThreshold:e.$_$slow||75}}}(function(){return this}()||global)},{}],45:[function(e,t,n){"use strict";var r=e("path"),i=e("node-uuid"),o=e("querystring"),s=e("http"),a={Atom:"AT",VSCode:"VSC",Sublime:"ST",IntelliJ:"IJ",VS:"VS"},l=function(){function e(e,t){if(e&&_.isString(t)){var n=e.client&&a[e.client];n&&e.edition&&(n=n+"-"+e.edition.toUpperCase());var o=e.cidFile;this._client=n||(~t.indexOf("wallaby-vscode")?"VSC":~t.indexOf(".wallaby")?"VS":~t.indexOf("atom-wallaby")?"AT":~t.indexOf("Sublime")?"ST":"IJ"),o||(o="VS"===this._client?r.join(t,"..","..","t.id"):"VSC"===this._client?r.join(t,"..","..","..",".wtid"):r.join(t,"..","t.id"));var s;try{s=e.readFileSync(o)}catch(l){s=i.v4();try{e.writeFileSync(o,s)}catch(c){}}this._cid=s||i.v4(),this._tid=process.env.quokka?"UA-58409118-5":"UA-58409118-3",this._coreVersion=e.coreVersion||"unknown",this._sendHeartbeat=!0}}return e.prototype.start=function(e){try{this._env=("browser"===e.env.type?e.env.kind:e.env.type)+" "+e.testFramework.version.substr(0,e.testFramework.version.indexOf("@"))+(e.testFramework.autoDetected?".auto":"")}catch(t){this._env="unknown"}var n=this;this._heartbeatInterval=setInterval(function(){return n._heartbeat()},3e5),n._heartbeat()},e.prototype.dispose=function(){clearInterval(this._heartbeatInterval)},e.prototype.busy=function(){this._sendHeartbeat=!0},e.prototype._heartbeat=function(){this._sendHeartbeat&&this._event(this._env,this._coreVersion,this._client),delete this._sendHeartbeat},e.prototype._event=function(e,t,n){try{var r=o.stringify({v:1,tid:this._tid,cid:this._cid,t:"event",ec:e,ea:t,el:n}),i={hostname:"www.google-analytics.com",path:"/collect",method:"POST",headers:{"Content-Length":r.length}},a=s.request(i,function(e){e.on("data",_.noop),e.on("end",_.noop)});a.on("error",_.noop),a.write(r),a.end()}catch(l){}},e}();t.exports=l},{http:void 0,"node-uuid":void 0,path:void 0,querystring:void 0}],46:[function(e,t,n){"use strict";var r,i=e("./typeScriptVisitor"),o=e("./utils"),s=e("./typeScriptUtils"),a=e("semver"),l="2.1.5",c=function(){
function e(e,t){this._useTsconfigFile=!0,this._opts=s.createOptions(r,e||{},this),this._useTsconfigFile&&(this._opts=s.mergeTsConfigOptions(r,this._opts,t)),this._opts.isolatedModules=!0,this._opts.suppressOutputPathCheck=!0,this._opts.allowNonTsExtensions=!0,this._opts.noLib=!0,this._opts.lib=void 0,this._opts.types=void 0,this._opts.noEmit=void 0,this._opts.noEmitOnError=void 0,this._opts.paths=void 0,this._opts.rootDirs=void 0,this._opts.declaration=void 0,this._opts.declarationDir=void 0,this._opts.out=void 0,this._opts.outFile=void 0,this._opts.noResolve=!0,this._visitor=new i(r)}return e.prototype.run=function(e){this._code="",this._ranges=[];var t=this._opts,n=e.path,i=r.createSourceFile(n,e.content,t.target);this._ranges=this._visitor.visit(i);var o=r.transpileModule(e.content,{fileName:n,compilerOptions:t,reportDiagnostics:!0});this._code=o.outputText;var a=o&&o.diagnostics;if(a&&a.length)throw new Error(_.reduce(a,function(e,t){var n=s.formatErrorText(r,t);return e[n]||(e[n]=n,e.message+="\n  - "+n),e},{message:"TypeScript compiler errors:"}).message);if(o.emitSkipped)return e.content;var l=o.sourceMapText&&JSON.parse(o.sourceMapText);if(!l)throw new Error("Cannot find source map for "+n);return this._noRename||e.changeExt("js"),{map:l,code:this._code,ranges:this._ranges}},e}();t.exports=function(t){return function(n){if(n.typescript)r=n.typescript;else try{r=o.requireModuleFrom(t,"typescript")}catch(i){r=e("typescript")}if(a.valid(r.version)&&a.lt(r.version,l))throw new Error("TypeScript version for compiler must be >= "+l);delete n.typescript;var s=new c(n,t);return function(e){return s.run(e)}}}},{"./typeScriptUtils":48,"./typeScriptVisitor":49,"./utils":50,semver:void 0,typescript:void 0}],47:[function(e,t,n){"use strict";var r,i=e("path"),o=e("graceful-fs"),s=e("minimatch"),a=e("semver"),l=e("./utils"),c=e("./typeScriptUtils"),u=e("./typeScriptVisitor"),h="1.5.3",d=function(){function e(e,t){var n=this,i=this;e=e||{},this._filePatterns=[],this._localProjectDir=t,this._useTsconfigFile=!0,e.files?(this._opts=!1,_.each(e.files,function(e,t){i._filePatterns.push(t),e=e||{};var o=c.createOptions(r,e,n);i._opts||(i._opts=o)})):(this._filePatterns.push("**/*.ts?(x)"),this._opts=c.createOptions(r,e,this)),this._allTrackedFiles={},this._allFiles={},this._ts=1}return e.prototype.createPostprocessor=function(){var e=this,t=this,n=function(n){var o=n.logger;t._ts++;var s=t._filesToBeCompiled(n.affectedFiles,void 0,n.dot);if(!t._compiler||n.anyFilesAdded||n.anyFilesDeleted)if(t._compiler?n.tsPostprocessorOnly||o.debug("TypeScript language service is being re-created because some tracked files were added or deleted"):o.debug("New TypeScript language service is required"),t._allTrackedFiles=t._filesToBeCompiled(n.allFiles,function(e){return t._allFiles[e.fullPath]=e},n.dot),t._compiler&&n.tsPostprocessorOnly)n.anyFilesDeleted&&(n.affectedFiles||[]).length===(n.allFiles||[]).length&&(s={});else{if(s=t._allTrackedFiles,_.isEmpty(s))return o.debug("TypeScript postprocessor will be removed because in %s project files none were found by patterns: %s",n.allFiles.length,t._filePatterns),Q.when({removePostprocessor:!0});o.trace("TypeScript compiler options module (before tsconfig.json): %s",(t._opts||{}).module),t._useTsconfigFile&&(t._opts=c.mergeTsConfigOptions(r,t._opts,t._localProjectDir,o),o.trace("TypeScript compiler options module (after tsconfig.json): %s",(t._opts||{}).module)),t._compiler=t._createLanguageService(n.baseDir),t._visitor||(t._visitor=new u(r))}else _.each(s,function(e){var n=t._allTrackedFiles[e.fullPath];n&&(n.ts=e.ts)});var a=[];return _.each(s,function(s){if(t._orderFilesByReferenceComments&&t._dependencies){var l=t._dependencies.files[s.path];l&&l.hash!==t._getFileDependencies(s).hash&&delete t._dependencies}var u=t._compiler.getEmitOutput(s.fullPath),h=t._compiler.getSyntacticDiagnostics(s.fullPath);if(u.emitSkipped){var d=h.concat(t._compiler.getSemanticDiagnostics(s.fullPath));if(e._logErrors(o,d),t._opts.noEmitOnError)throw new Error(_.reduce(d.concat(t._compiler.getCompilerOptionsDiagnostics()),function(e,t){var n=c.formatErrorText(r,t);return e[n]||(e[n]=n,e.message+="\n  - "+n),e},{message:"TypeScript compiler errors:"}).message)}else h&&h.length&&e._logErrors(o,h);var p=t._visitor.visit(t._compiler.getSourceFile?t._compiler.getSourceFile(s.fullPath):t._compiler.getProgram().getSourceFile(s.fullPath)),f={};u.outputFiles.forEach(function(e){var t=i.extname(e.name);".map"===t?f.sourceMap=e.text:".js"===t||".jsx"===t?f.code=e.text:o.debug("Unexpected output file: %s",e.name)}),f.sourceMap&&a.push(n.createFile({path:_.isUndefined(t._opts.module)||t._opts.module?t._changeExtToJs(s.path):s.path+".compiled.js",original:s,content:f.code,sourceMap:JSON.parse(f.sourceMap),ranges:p,order:s.order,load:s.initialLoad}))}),t._orderFilesByReferenceComments&&!t._dependencies&&t._updateFileOrder(),Q.all(a)};return n.filePatterns=t._filePatterns,n.ts=!0,n},e.prototype._logErrors=function(e,t){t.forEach(function(t){e.error(c.formatErrorText(r,t))})},e.prototype._updateFileOrder=function(){var e=this;e._dependencies={files:{},min:Number.POSITIVE_INFINITY},_.each(e._allTrackedFiles,function(t){return e._orderFilesByReferences(t,e._dependencies,{})});var t=e._dependencies.min;_.each(e._dependencies.files,function(e){e.file.test||e.file.setOrder(t++,!0)})},e.prototype._orderFilesByReferences=function(e,t,n){var r=this;if(!n[e.path]&&(n[e.path]=!0,!t.files[e.path])){e.test||(t.min=Math.min(t.min,e.order));var i=r._getFileDependencies(e);_.each(i.items,function(e){return r._orderFilesByReferences(e,t,n)}),t.files[e.path]||(t.files[e.path]={hash:i.hash,file:e})}},e.prototype._getFileDependencies=function(e){var t,n=this,o="";try{t=r.preProcessFile(e.getContentSync()).referencedFiles}catch(s){throw new Error("Failed to get file dependencies: "+s.stack)}var a=_(t).map(function(t){return n._allTrackedFiles[i.join(i.dirname(e.fullPath),t.fileName)]}).filter(function(e){return!_.isUndefined(e)}).map(function(e){return o+=e.path,e}).value();return{items:a,hash:l.quickHash(o)}},e.prototype._changeExtToJs=function(e){return e.substr(0,e.lastIndexOf(".")+1)+(_.endsWith(e,".js")?"jsts":"js")},e.prototype._createLanguageService=function(e){var t=this;if(!t._opts.noResolve){var n=r.resolveModuleName;r.resolveModuleName=function(i,o){var s=n.apply(this,arguments);if(s&&!s.resolvedModule){arguments[1]=o.replace(r.normalizePath&&r.normalizePath(e)||e,r.normalizePath&&r.normalizePath(t._localProjectDir)||t._localProjectDir);var a=n.apply(this,arguments);if(a&&a.resolvedModule)return a}return s}}var s={},a={};return r.createLanguageService({getScriptFileNames:function(){return Object.keys(t._allTrackedFiles)},getScriptVersion:function(e){e=i.normalize(e);var n=t._allTrackedFiles[e];return n&&n.ts.toString()},readFile:function(e){return(this.getScriptSnapshot(e)||{}).text},fileExists:function(e){if(e=i.normalize(e),t._opts.noResolve||!~e.indexOf(t._localProjectDir))return!1;var n=a[e];if(n===!1||n)return n;var r=i.dirname(e),l=s[r];return l===!1?(a[e]=!1,!1):(n=a[e]=o.existsSync(e),n?(s[r]=!0,!0):l?void 0:(s[r]=o.existsSync(r),!1))},getScriptSnapshot:function(n){n=i.normalize(n);var s=t._allFiles[n];if(s)return r.ScriptSnapshot.fromString(s.getContentSync());if(t._opts.noEmitOnError||!t._opts.noResolve)try{var a=n.replace(e,t._localProjectDir);if(o.existsSync(a))return r.ScriptSnapshot.fromString(o.readFileSync(a).toString())}catch(l){}},getCurrentDirectory:function(){return e},getCompilationSettings:function(){return t._opts},getDefaultLibFileName:function(e){return r.getDefaultLibFilePath(e)},getCustomTransformers:function(){return t._getCustomTransformers?t._getCustomTransformers(t._compiler.getProgram()):void 0},getProjectVersion:function(){return t._ts}},r.createDocumentRegistry())},e.prototype._filesToBeCompiled=function(e,t,n){var r=this;return t=t||function(){},_.reduce(e,function(e,o){var a=0===(o.path||"").indexOf("..")?i.basename(o.path):o.path;return _.find(r._filePatterns,function(e){return s(a,e,{dot:n})})&&(e[o.fullPath]=o),t(o),e},{})},e}();t.exports=function(t){return function(n){if(n.typescript)r=n.typescript;else try{r=l.requireModuleFrom(t,"typescript")}catch(i){r=e("typescript")}if(a.valid(r.version)&&a.lt(r.version,h))throw new Error("TypeScript version for compiler must be >= "+h);return delete n.typescript,new d(n,t).createPostprocessor()}}},{"./typeScriptUtils":48,"./typeScriptVisitor":49,"./utils":50,"graceful-fs":void 0,minimatch:void 0,path:void 0,semver:void 0,typescript:void 0}],48:[function(e,t,n){var r=e("path"),i=e("graceful-fs");t.exports={createOptions:function(e,t,n){t&&(n._orderFilesByReferenceComments||(n._orderFilesByReferenceComments=t.orderFilesByReferenceComments),delete t.orderFilesByReferenceComments,n._useStandardDefaults||(n._useStandardDefaults=t.useStandardDefaults),delete t.useStandardDefaults,n._getCustomTransformers||(n._getCustomTransformers=t.getCustomTransformers),delete t.getCustomTransformers,n._useTsconfigFile&&(n._useTsconfigFile=t.tsconfig!==!1),delete t.tsconfig);var r=this._normaliseOptions(e,t)||{},i={noLib:!0,noResolve:!0,declaration:!1,noEmit:!1,removeComments:!1},o={sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,rootDir:void 0,mapRoot:void 0,outFile:void 0,noEmitOnError:!1,composite:!1};return n._useStandardDefaults&&(delete i.noLib,delete i.noResolve,delete i.declaration,delete o.noEmitOnError,delete o.composite),_.extend(i,r,o)},getCompilerOptions:function(e,t){return this._normaliseOptions(e,e.parseJsonConfigFileContent?e.parseJsonConfigFileContent(e.parseConfigFileTextToJson(t,i.readFileSync(t).toString()).config,e.sys,e.getDirectoryPath(e.normalizePath(t)),{},t).options:e.readConfigFile(t,function(e){return i.readFileSync(e).toString()}).config.compilerOptions)},mergeTsConfigOptions:function(t,n,o,s){void 0===s&&(s={debug:function(){}});var a,l=r.join(o,"tsconfig.json");try{a=t.parseJsonConfigFileContent?t.parseJsonConfigFileContent(t.parseConfigFileTextToJson(l,i.readFileSync(l).toString()).config,_.extend(t.createCompilerHost(t.getDefaultCompilerOptions()),{readDirectory:t.sys.readDirectory}),t.getDirectoryPath(t.normalizePath(l)),{},l).options:t.readConfigFile(l,function(e){return i.readFileSync(e).toString()}).config.compilerOptions}catch(c){s.debug("Error parsing tsconfig file "+l+"\n("+c.message+")");try{a=e(l).compilerOptions}catch(u){s.debug("Error reading tsconfig file from "+l+"\n("+u.message+")")}}var h;return a?(a.allowJs&&!n.outDir&&delete n.outDir,h=_.extend({},this._normaliseOptions(t,a)||{},n)):h=n,h.allowJs||delete h.outDir,h},formatErrorText:function(e,t){var n=e.flattenDiagnosticMessageText(t.messageText,"\n");if(t.file){var r=t.file.getLineAndCharacterOfPosition(t.start);return"Error "+t.file.fileName+" ("+(r.line+1)+","+(r.character+1)+"): "+n}return"Error: "+n},_normaliseOptions:function(e,t){var n=this;if(t)return this._optionDeclarations||(this._optionDeclarations=_.reduce(e.optionDeclarations,function(e,t){return e[t.name]=t,e},{})),_.each(t,function(e,r){var i=n._optionDeclarations[r];i&&(_.isObject(i.type)&&_.isString(e)?t[r]=n._getNormalisedValue(e,i.type):"list"===i.type&&_.isArray(e)&&i.element&&_.isObject(i.element.type)&&(t[r]=_.map(e,function(e){return _.isString(e)?n._getNormalisedValue(e,i.element.type)||e:e})))}),t},_getNormalisedValue:function(e,t){return _.isFunction(t.get)?t.get(e.toLowerCase()):t[e.toLowerCase()]}}},{"graceful-fs":void 0,path:void 0}],49:[function(e,t,n){"use strict";var r=function(){function e(e){var t=this,n={};this._ts=e,n[e.SyntaxKind.DoStatement]=n[e.SyntaxKind.WhileStatement]=n[e.SyntaxKind.IfStatement]=n[e.SyntaxKind.SwitchStatement]=function(e){e.expression&&t._pushRange(e.expression)},n[e.SyntaxKind.ForStatement]=function(e){e.condition&&t._pushRange(e.condition)},n[e.SyntaxKind.ForInStatement]=n[e.SyntaxKind.ForOfStatement]=function(e){e.expression&&t._pushRange(e.expression)},n[e.SyntaxKind.BreakStatement]=n[e.SyntaxKind.ContinueStatement]=n[e.SyntaxKind.ThrowStatement]=function(e){t._pushRange(e)},n[e.SyntaxKind.VariableStatement]=function(n){(!t._parent||t._parent.kind!==e.SyntaxKind.ForStatement&&t._parent.kind!==e.SyntaxKind.ForInStatement&&t._parent.kind!==e.SyntaxKind.ExportAssignment)&&t._pushRange(n)},n[e.SyntaxKind.ExpressionStatement]=n[e.SyntaxKind.ReturnStatement]=function(e){t._pushRange(e)},n[e.SyntaxKind.ConditionalExpression]=function(e){t._pushRange(e.whenTrue),t._pushRange(e.whenFalse)},n[e.SyntaxKind.BinaryExpression]=function(e){t._pushRange(e.left),t._pushRange(e.right)},n[e.SyntaxKind.ArrowFunction]=function(e){e.body.statements||t._pushRange(e.body)},t._visit=function(r){var i=n[r.kind];i&&i(r),t._parent=r,e.forEachChild(r,t._visit)}}return e.prototype.visit=function(e){var t=this;return t._ranges=[],t._parent=null,t._sourceFile=e,t._visit(e),t._parent=null,t._sourceFile=null,t._ranges.slice()},e.prototype._pushRange=function(e){this._ranges.push(this._getRange(e))},e.prototype._getRange=function(e){var t=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getStart(this._sourceFile)),n=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getEnd());return[t.line+1,t.character,n.line+1,n.character]},e}();t.exports=r},{}],50:[function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(this,arguments)},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s},o=e("path"),s=e("fs"),a=e("minimatch"),l=e("source-map").SourceMapConsumer,c=e("source-map").SourceMapGenerator,u=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,h=/^\s*/,d=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g,p=/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,f=/fit[\s]*?\(|\.[\s]*?only[\s]*?\(/gm,g=/[#@] sourceMappingURL=([^\s'"]*)/,m=RegExp("(?:/\\*(?:\\s*\r?\n(?://)?)?(?:"+g.source+")\\s*\\*/|//(?:"+g.source+"))\\s*","g"),v=/^data:application\/json[^,]+base64,/,y=function(e,t){return"js"===e||"jsx"===e||"es6"===e||"es7"===e||"mjs"===e||t&&t.find(function(t){return e===t})},b=function(e){return"ts"===e||"tsx"===e},k=function(e){return"vue"===e},T=function(e,t){return"coffee"===e||/\.(litcoffee|coffee\.md)$/.test(t||"")},w={},S={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("").forEach(function(e,t){w[e]=t,S[t]=e}),t.exports={SourceMapConsumer:l,randomId:function(){return Math.random().toString(36).substr(2,5)},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&e.length>2&&"@"===e[0]&&"@"===e[1]},isLevelUpRelativePath:function(e){return e&&"."===e[0]&&"."===e[1]},docBlockComment:function(e){var t=e.match(u);return t?t[0].replace(h,"")||"":""},normalizePath:function(e){return e?e.replace("win32"===process.platform?"file:///":"file://","").split(o.sep).join("/"):e},platformDependentPath:function(e){return!e||"win32"!==process.platform||~e.indexOf(o.sep)?e:e.split("/").join(o.sep)},getSourceMapFromCode:function(e){m.lastIndex=0;for(var t;null!==(t=m.exec(e));){var n=t?t[1]||t[2]||"":null;if(n&&v.test(n)){var r=n.slice(n.indexOf(",")+1);return Buffer.from(r,"base64").toString()}}},pathMatchesPattern:function(t,n,r){if(t){if("string"==typeof n){if(!r||!r.micromatch)return a(t,n,r);var i=e("micromatch").isMatch;return i(t,n,{dot:!0})}return(this.platformDependentPath(r&&r.absolute?"":"./")+this.platformDependentPath(t)).match(n)}},escapePathForRegex:function(e){return"\\"===o.sep&&(e=e.replace(/\\/g,"/")),this.replacePathSepForRegex(this._escapeStrForRegex(e))},_escapeStrForRegex:function(e){return e.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")},replacePathSepForRegex:function(e){return"\\"===o.sep?e.replace(/(\/|(.)?\\(?![[\]{}()*+?.^$|\\]))/g,function(e,t,n){return n&&"\\"!==n?n+"\\\\":"\\\\"}):e},displayTestName:function(e){return e.replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")},getOriginalLineByGeneratedLine:function(e,t,n){var r=e[t];if(r){r=this._decodeMapping(r);var o=_.pairs(r);return o.sort(function(e,t){var n=i(e,2),r=n[1].column,o=i(t,2),s=o[1].column;return r-s}),n>=0?parseInt(_.reduce(o,function(e,t){return n>=t[1].column&&t[1].column>=e[1].column?t:e},o[0])[0],10):parseInt(o[0][0],10)}},_updateMapping:function(e,t){var n,r=t.isFirstMap,i=t.currentLineMapping,o=t.previousLineMapping,s=e.originalLine,a=e.generatedColumn,l=e.originalColumn,c=!!e.name;if(r){if(i){var u=i[s];return u?!u.better&&c&&(u.column=a,u.better=!0):i[s]={column:a,better:c},i}return n={},n[s]={column:a,better:c},n}if(o)return i?(_.each(o,function(e,t){var n=i[t];n?(!n.mapped&&(!n.better||n.better&&c)&&l===n.originalColumn||n.mapped&&!n.better&&c&&l===n.originalColumn||n.reset&&!n.better&&c&&l===n.originalColumn)&&(n.originalColumn=n.originalColumn>=0?n.originalColumn:n.column,n.column=a,n.better=c,n.mapped=!0):(e.originalColumn=e.column,l===e.column?(e.column=a,e.better=c,e.mapped=!0):(e.column=0,e.reset=!0),i[t]=e)}),i):(_.each(o,function(e){e.originalColumn=e.column,l===e.column?(e.column=a,e.better=c,e.mapped=!0):(e.column=0,e.better=c,e.reset=!0)}),o)},_decodeMapping:function(e){var t;if(_.isObject(e)||_.isUndefined(e))return e;if(e>=0)return t={},t[e]={column:0},t;for(var n,r={},i=0,o=0,s=0;s<e.length;s+=1){var a=w[e[s]],l=32&a;if(a&=31,o+=a<<i,l)i+=5;else{var c=1&o;o>>>=1;var u=c?0===o?-2147483648:-o:o;n>=0?(r[n]={column:u},n=void 0):n=u,o=i=0}}return r},_encodeMapping:function(e){var t=this;if(!_.isObject(e))return e;var n=_.pairs(e);return 1===n.length&&0===n[0][1].column?parseInt(n[0][0],10):(n.sort(function(e,t){var n=i(e,2),r=n[1],o=i(t,2),s=o[1];return r.better&&s.better||!r.better&&!s.better?0:r.better?-1:s.better?1:void 0}),_.reduce(n,function(e,n){return e+=t._encodeInteger(n[0]),e+=t._encodeInteger(n[1].column)},""))},_encodeInteger:function(e){var t="";e<0?e=-e<<1|1:e<<=1;do{var n=31&e;e>>>=5,e>0&&(n|=32),t+=S[n]}while(e>0);return t},updateFileMap:function(e,t){var n=this;e=e||{};var r=_.extend({},e);return _.each(t,function(e){var t=new l(e),i={},o=_.isEmpty(r),s=_.extend({},r);t.eachMapping(function(e){if(e.generatedLine&&e.originalLine){var t=n._decodeMapping(i[e.generatedLine]),a=n._decodeMapping(s[e.originalLine]),l=n._updateMapping(e,{isFirstMap:o,currentLineMapping:_.clone(t,!0),previousLineMapping:_.clone(a,!0)});l&&(i[e.generatedLine]=l),a&&delete r[e.originalLine]}}),r=_.extend({},r,i)}),_.object(_.map(r,function(e,t){return[t,n._encodeMapping(e)]}))},formatInstrumentationError:function(e,t,n){var r=(e&&(e.stack||e.message))+"",i=this.textLines(r),o=i[0],s=o.match(/^SyntaxError.*\((\d+):(\d+)\)$/);return s&&(i=[this.codeFrame(t,parseInt(s[1],10),parseInt(s[2],10)+1,o)]),Error("Failed to instrument "+n+"\n"+i.join("\n"))},combineSourceMaps:function(e,t){if(!e)return t;if(!t)return e;var n=new l(t),r=new l(e),i=new c;n.eachMapping(function(e){if(null!=e.originalLine){var t=r.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=t.source&&i.addMapping({original:{line:t.line,column:t.column},generated:{line:e.generatedLine,column:e.generatedColumn},source:t.source,name:t.name||e.name})}});var o=[r,n];return o.forEach(function(e){e.sources.forEach(function(t){i._sources.add(t);var n=e.sourceContentFor(t);null!=n&&i.setSourceContent(t,n)})}),i._sourceRoot=e.sourceRoot,i._file=e.file,JSON.parse(i.toString())},mapTextPosition:function(e,t){var n;return e&&(t?(e.source=t.sources&&t.sources[0]||".",e.bias=2,n=t.generatedPositionFor(e)):n=e),n},textIndexPosition:function(e,t){var n=this.textLines(e,t);return{line:n.length,column:n[n.length-1].length}},mapTransformedRangeToOriginal:function(e,t){var n=function(e,t){var n=e.originalPositionFor({line:t.line,column:t.column-1});if(null===n.source)return null;var r=e.generatedPositionFor({source:n.source,line:n.line,column:n.column+1,bias:2});return null===r.line||e.originalPositionFor(r).line!==n.line?{source:n.source,line:n.line,column:1/0}:e.originalPositionFor(r)},r={start:{line:t[0],column:t[1]},end:{line:t[2],column:t[3]}},i=e.originalPositionFor(r.start),o=n(e,r.end);return i&&o&&i.source&&o.source?i.source!==o.source?null:null===i.line||null===i.column?null:null===o.line||null===o.column?null:(i.line===o.line&&i.column===o.column&&(o=e.originalPositionFor({line:r.end.line,column:r.end.column,bias:2}),o.column=o.column-1),[i.line,i.column,o.line,o.column]):null},mapOriginalRangeToTransformed:function(e,t){var n=i(t,4),r=n[0],o=n[1],s=n[2],a=n[3];if(!e)return[r,o,s,a];var l={line:r,column:o};l.source=e.sources&&e.sources[0]||".";var c=e.generatedPositionFor(l),u={line:s,column:a};u.source=e.sources&&e.sources[0]||".",u.bias=2;var h=e.generatedPositionFor(u);return c&&h&&null!==c.line&&null!==c.column&&null!==h.line&&null!==h.column?(h.line<c.line&&(h.line=c.line),h.column<c.column&&(h.column=1/0),[c.line,c.column,h.line,h.column]):void 0},textLines:function(e,t,n){return e=_.isUndefined(t)?e:e.substr(0,t),e.split(_.isUndefined(n)?/\r\n|\r|\n/:n)},verifyLocalOrigin:function(t,n){if(!t)return!0;var r=!1;try{var i=e("url").parse(t).hostname;r="localhost"===i||"0.0.0.0"===i||"127.0.0.1"===i||"::1"===i}catch(o){}return r||n||console.error("wallaby.js refused to accept connection from "+t),r},patchModule:function(t,n){var r=e("module").Module.prototype,i=r.require;r.require=function(e){return e===t?n(i.bind(this)):i.call(this,e)}},patchModulesCode:function(e,t){var n=s.readFileSync;s.readFileSync=function(r){var i=r.replace(/\\/g,"/"),o=n.apply(this,arguments);return e.some(function(e){if(e.files.some(function(e){return~i.indexOf(e)}))return o=o.toString(),e.replacements.forEach(function(n){var r=o;o=o.replace(n.from,n.to),o===r&&console.warn(t+" ("+e.files.join(", ")+")")}),!0}),o}},requireModuleFrom:function(t,n){try{return e(o.join(t,"node_modules",n))}catch(r){var i=e("module"),s=new i(".",null);return s.filename=o.join(t,"wallaby.js"),s.paths=i._nodeModulePaths(t),i._load(n,s,!1)}},resolveModulePathFrom:function(t,n){var r=e("module"),i=new r(".",null);return i.filename=o.join(t,"wallaby.js"),i.paths=r._nodeModulePaths(t),r._resolveFilename(n,i,!1)},tryRequireModuleWithPathFrom:function(t,n,r){try{var i=e("module"),s=new i(".",null);s.filename=o.join(t,"wallaby.js"),s.paths=i._nodeModulePaths(t);var a=i._resolveFilename(n,s,!1),l=void 0;return l=process.env.WALLABY_INTEGRATION_TEST_RUN||process.env.WALLABY_UNIT_TEST_RUN?e(a):i._load(n,s,!1),{module:l&&l["default"]||l,path:a}}catch(c){if(r)throw c}},nodeModulesLookup:function(t,n){var r=e("module").Module,i=r.prototype,o=r._nodeModulePaths,s=i.require;r._nodeModulePaths=function(e){var n=o.call(this,e);return t(n,e,o,this),n},n&&(i.require=function(e){return s.call(this,n(e))})},nodeModulePaths:function(t){var n=e("module");return n._nodeModulePaths(t)},patchBabelResolve:function(e){var t=this.nodeModulePaths(e);this.patchModule("resolve",function(e){var n=e("resolve"),r=n.sync;return n.sync=function(e,n){return~e.indexOf("babel")&&n&&(arguments[1].paths=(n.paths||[]).concat(t)),r.apply(this,arguments)},n})},hasAnsi:function(e){return e&&"string"==typeof e&&e.match(d)},removeAnsi:function(e){return e&&"string"==typeof e?e.replace(d,""):e},copyToClipboard:function(t){var n=function(e){return e&&console.warn("Failed to copy to clipboard. "+(e&&e.message))};try{e("copy-paste").copy(t,n)}catch(r){n(r)}},testFileSelection:function(e,t,n,r){var i,o=!1,s=!1,a={};for(p.lastIndex=0;null!==(i=p.exec(e));){for(var l=i.index;l<i[0].length;l++)a[l]=1;o=o||t.test(i[0]),s=s||n.test(i[0])}if(!o&&r)for(f.lastIndex=0;null!==(i=f.exec(e));)if(!a[i.index]){o=!0;break}return{includedTestFile:o,excludedTestFile:s}},initServerOptions:function(t){var n=e("graceful-fs"),r=e("fs-extra");t.runnerResolver=function(t,n){return e("browser"===t?"electron"===n?"./electronRunner.js":"chrome"===n?"./chromeRunner.js":"./phantomRunner.js":"./nodeRunner.js")},t.processorPool=e("./processPool"),t.fileStructureCachePromise=function(e){return Q.nfcall(n.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},t.fileStatPromise=function(e){return Q.nfcall(n.stat,e)},t.readFilePromise=function(e){return Q.nfcall(n.readFile,e)},t.writeFilePromise=function(e,t){return Q.nfcall(n.writeFile,e,t)},t.unlinkFilePromise=function(e){return Q.nfcall(n.unlink,e)},t.unlinkFileSync=function(e){return n.unlinkSync(e)},t.writeFileSync=function(e,t){return n.writeFileSync(e,t)},t.readFileSync=function(e){return n.readFileSync(e).toString("utf8")},t.fileExistsSync=function(e){return n.existsSync(e)},t.realpathSync=function(e){return n.realpathSync(e)},t.dirRemovePromise=function(e){return Q.nfcall(r.remove,e)},t.dirRemoveSync=function(e){return r.removeSync(e)},t.dirEnsurePromise=function(e){return Q.nfcall(r.ensureDir,e)},t.dirEnsureSync=function(e){return r.ensureDirSync(e)},t.nodeModulesLookup=this.nodeModulesLookup},codeFrame:function(e,t,n,i){function o(e,t,n){var i=r({column:0,line:-1},e.start),o=r({},i,e.end),s=n||{},a=s.linesAbove,l=void 0===a?2:a,c=s.linesBelow,u=void 0===c?3:c,h=i.line,d=i.column,p=o.line,f=o.column,_=Math.max(h-(l+1),0),g=Math.min(t.length,p+u);h===-1&&(_=0),p===-1&&(g=t.length);var m=p-h,v={};if(m)for(var y=0;y<=m;y++){var b=y+h;if(d)if(0===y){var k=t[b-1].length;v[b]=[d,k-d]}else if(y===m)v[b]=[0,f];else{var k=t[b-y].length;v[b]=[0,k]}else v[b]=!0}else d===f?d?v[h]=[d,0]:v[h]=!0:v[h]=[d,f-d];return{start:_,end:g,markerLines:v}}var s=this.textLines(e),a={start:{column:n,line:t}},l=o(a,s),c=l.start,u=l.end,h=l.markerLines,d=a.start&&"number"==typeof a.start.column,p=String(u).length,f=s.slice(c,u).map(function(e,t){var n=c+1+t,r=(" "+n).slice(-p),o=" "+r+" | ",s=h[n],a=!h[n+1];if(s){var l="";if(Array.isArray(s)){var u=e.slice(0,Math.max(s[0]-1,0)).replace(/[^\t]/g," "),d=s[1]||1;l=["\n ",o.replace(/\d/g," "),u,"^".repeat(d)].join(""),a&&i&&(l+=" "+i)}return[">",o,e,l].join("")}return" "+o+e}).join("\n");return d||(f=""+" ".repeat(p+1)+i+"\n"+f),f},loadJest:function(e){var t,n,r=this,i=this.tryRequireModuleWithPathFrom(e,"react-scripts/scripts/utils/createJestConfig");t=i?this.tryRequireModuleWithPathFrom(i.path,"jest"):this.tryRequireModuleWithPathFrom(e,"jest");var s,a=t?t.path:e,l=this.tryRequireModuleWithPathFrom(a,"jest-cli");if(!l)throw new Error("Module jest-cli is not found in '"+e+"'.");if(!l.module.getVersion)throw new Error("Cannot find compatible jest-cli module.");var c="x.x.x",u=0;try{c=l.module.getVersion(),u=parseInt(c.split(".")[0])}catch(h){throw new Error("Cannot detect/parse jest-cli module version: "+h.message+".")}if(u<24)throw new Error("Only Jest v24.x or higher is supported, but found v"+c+" at '"+l.path+"'.");if(n=this.tryRequireModuleWithPathFrom(l.path,"jest-config"))try{s=n.module.readConfigs(i?{config:JSON.stringify(i.module(function(e){return o.resolve(i.path,"../../..",e)}))}:{},[e]),s.globalConfig=Object.assign({},s.globalConfig),s.configs=(s.configs||[]).filter(function(e){return"jest-runner"===e.runner||~r.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")}).map(function(e){return Object.assign({},e)})}catch(h){throw new Error("Failed to read Jest configuration from '"+e+"': "+(h.message?h.message:"unknown."))}if(!s)throw new Error("Failed to read Jest configuration from '"+e+"'.");if(!s.configs.length)throw new Error("Can not find any Jest runner configurations in '"+e+"'.");return{jestConfig:s,jestCLI:l,jestConfigLoader:n}},serializeRegExp:function(e){if(_.isRegExp(e))return"__REGEXP "+e.toString();if(_.isString(e))return e;throw new Error("Must pass a string or a regular expression")},deserializeRegExp:function(e){if(0===e.indexOf("__REGEXP ")){var t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);return new RegExp(t[1],t[2]||"")}return e},isJavaScript:y,isTypeScript:b,isVue:k,isCoffeeScript:T,isCoverable:function(e,t,n){return y(e,n)||b(e)||k(e)||T(e,t)},quickHash:function(e){var t,n,r,i=0;if(e.length>0)for(t=0,r=e.length;t<r;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}}},{"./chromeRunner.js":14,"./electronRunner.js":22,"./nodeRunner.js":27,"./phantomRunner.js":29,"./processPool":39,"copy-paste":void 0,fs:void 0,"fs-extra":void 0,"graceful-fs":void 0,micromatch:void 0,minimatch:void 0,module:void 0,path:void 0,"source-map":void 0,url:void 0}],51:[function(e,t,n){t.exports={name:"Wallaby.js",version:"1.0.816",author:"Wallaby.js",license:"Proprietary",homepage:"https://wallabyjs.com",scripts:{postinstall:"node ./node_modules/grunt/bin/grunt patchNodeModules",test:"npm run test:unit","test:unit":"jest --no-cache --config=jest.unit.config.js","test:integration":"npm run test:integration:bootstrap && jest --no-cache --silent --runInBand --config=jest.integration.config.js","test:integration:bootstrap":"cd ./test/samples/integration && npm install && npx lerna bootstrap","test:integration:reset":"cd ./test/samples/integration && npm install && npx lerna clean && npx lerna bootstrap",build:"node ./node_modules/grunt/bin/grunt bump-only && node ./node_modules/grunt/bin/grunt",release:"node ./docker/run.js"},dependencies:{"@babel/parser":"7.4.5",acorn:"7.1.0","acorn-jsx":"5.1.0","acorn-walk":"7.0.0",chokidar:"3.3.0","chrome-launcher":"0.11.1","chrome-remote-interface":"0.24.4","coffee-script":"1.10.0",commander:"2.5.0",compression:"1.7.2","copy-paste":"1.3.0",debug:"4.1.1","escodegen-wallaby":"1.6.28",esm:"3.2.25",express:"4.11.2","fs-extra":"0.12.0","graceful-fs":"4.1.3",lodash:"3.0.0","lru-cache":"2.5.0",micromatch:"^3.1.10",minimatch:"3.0.4","node-uuid":"1.4.3",phantom:"0.7.2",q:"1.5.0",semver:"4.3.3","source-map":"0.4.3",typescript:"3.4.5","underscore.string":"2.3.3","util.promisify":"1.0.0",ws:"1.1.1"},devDependencies:{"@babel/generator":"^7.6.4","@types/lodash":"^4.14.136","@types/node":"12.0.10","@types/semver":"^6.0.1","aws-sdk":"2.333.0","browserify-transform-tools":"1.5.0",chai:"4.2.0","chai-subset":"1.6.0",escodegen:"1.6.1","expect.js":"0.3.1",grunt:"1.0.3","grunt-browserify":"4.0.1","grunt-bump":"0.0.16","grunt-contrib-clean":"0.7.0","grunt-contrib-compress":"0.12.0","grunt-contrib-copy":"0.8.2","grunt-contrib-uglify":"0.11.0","grunt-run":"^0.8.1","grunt-ts":"^6.0.0-beta.22","javascript-obfuscator":"^0.18.1",jest:"^24.8.0","line-column":"^1.0.2","node-fetch":"^2.6.0",npm:"4.1.2",removeNPMAbsolutePaths:"1.0.4","ts-node":"3.1.0"},optionalDependencies:{keytar:"^4.10.0"},"private":!0}},{}],52:[function(e,t,n){var r,i,o,s=e("path"),a=function(){};try{Error.stackTraceLimit=50}catch(l){}if(process.env&&process.env.NODE_MODULES_OVERRIDE&&(console.warn(" ---- Using node modules from: "+process.env.NODE_MODULES_OVERRIDE+" ---- "),e("./lib/utils").nodeModulesLookup(function(e){e.unshift(process.env.NODE_MODULES_OVERRIDE)})),"worker"!==process.argv[2]&&"runner"!==process.argv[2]){a(),process.env.PWD=process.cwd(),process.env.DEBUG_COLORS="no",process.noDeprecation=!0,r=e("graceful-fs");var c=e("./lib/app"),u=e("commander"),h=!1;u.unknownOption=function(){},u.option("-p, --port <port>","specify port").option("-l, --projectCachePath <projectCachePath>","specify project cache location").option("-l, --configPath <configPath>","specify config file location").option("-k, --lkp [lkp]","specify lkp location").option("-c, --client [client]","specify client").option("-q, --quokka [quokka]","specify quokka").option("-q, --editorTypeScript [editorTypeScript]","specify editorTypeScript").option("-q, --homeDir <homeDir>","specify homeDir").option("-q, --cv <cv>","specify cv").parse(process.argv);var d={port:47878,location:s.join(__dirname,"lib","project")};if(u.port&&(d.port=u.port),u.projectCachePath&&(d.projectCachePath=u.projectCachePath),u.configPath&&(d.configPath=u.configPath),"win32"===process.platform&&(d.projectCachePath&&":"===d.projectCachePath[1]&&(d.projectCachePath=d.projectCachePath.charAt(0).toUpperCase()+d.projectCachePath.slice(1)),
d.configPath&&":"===d.configPath[1]&&(d.configPath=d.configPath.charAt(0).toUpperCase()+d.configPath.slice(1))),u.editorTypeScript&&(d.editorTypeScript=u.editorTypeScript),u.homeDir&&(d.homeDir=u.homeDir),u.cv&&(d.cv=u.cv),h=u.quokka,h&&(process.env.quokka=!0),e("./lib/utils").initServerOptions(d),h){var p={},f={},g={},m=function(e){return f[e]||g[s.dirname(e)]||!(!e||!~e.indexOf("quokka_fake_path")&&!~e.indexOf(s.join(process.cwd(),h.substr(0,h.lastIndexOf(".")))))};d.fileStructureCachePromise=function(e){return d.readFilePromise(e).then(function(e){return Q.when(JSON.parse(e))})};var v=d.fileStatPromise;d.fileStatPromise=function(e){return m(e)?p[e]?Q.when({}):Q.reject(new Error("File "+e+" not found")):v(e)};var y=d.readFilePromise;d.readFilePromise=function(e){if(m(e)){var t=p[e];return t?Q.when(t.content):Q.reject(new Error("File "+e+" not found"))}return y(e)};var b=d.writeFilePromise;d.writeFilePromise=function(e,t){return m(e)?(p[e]={content:t},Q.when(!0)):b(e,t)};var k=d.unlinkFilePromise;d.unlinkFilePromise=function(e){return m(e)?(delete p[e],Q.when(!0)):k(e)};var T=d.unlinkFileSync;d.unlinkFileSync=function(e){return m(e)?void delete p[e]:T(e)};var w=d.writeFileSync;d.writeFileSync=function(e,t){return m(e)?void(p[e]={content:t}):w(e,t)};var S=d.readFileSync;d.readFileSync=function(e){if(m(e)){var t=p[e];if(!t)throw new Error("File "+e+" not found");return t.content}return S(e)};var x=d.fileExistsSync;d.fileExistsSync=function(e){return m(e)?!!p[e]:x(e)};var C=d.realpathSync;d.realpathSync=function(e){return m(e)?e:C(e)};var F=d.dirRemovePromise;d.dirRemovePromise=function(e){return m(e)?Q.when(e):F(e)};var E=d.dirRemoveSync;d.dirRemoveSync=function(e){return m(e)?e:E(e)};var R=d.dirEnsurePromise;d.dirEnsurePromise=function(e){return m(e)?Q.when(e):R(e)};var P=d.dirEnsureSync;d.dirEnsureSync=function(e){return m(e)?e:P(e)},d.useMemoryFs=function(e,t){t&&(g[s.dirname(e)]=!0),f[e]=!0;for(var n=e;n!==s.dirname(n);)n=s.dirname(n),f[n]=!0}}d.onStart=_.noop,d.onConnected=_.noop;var L=e("ws/lib/Sender.fallbacks.js");if(d._init=L.create,d.coreVersion=e("./package.json").version,"extended-core"===process.argv[2]||"extended-core-ws"===process.argv[2]||h)if("extended-core"!==process.argv[2]){d.quokka=h,d.client=u.client||"Sublime",d.lkp=u.lkp,d.Receiver=L.create();var j=e("ws").Server,I=new j({port:d.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log(d.quokka?"quokka.js started":"wallaby.js started")});I.on("connection",function(t){var n={send:function(e){t.send(JSON.stringify(e))},receive:_.noop};d.onConnected(n),t.on("message",function(e){var t=JSON.parse(e);n.receive(t),"stop"===t.type&&process.exit()}),n.send({type:"started",version:e("./package.json").version})})}else{d.client=u.client||"Atom",d.lkp=u.lkp;e("util");d.Receiver=L.create(),process.nextTick(function(){var e={send:function(e){process.send(e)},receive:_.noop};process.on("message",function(t){if("connection"===t.type)d.onConnected(e);else try{e.receive(t)}finally{"stop"===t.type&&process.exit()}}),e.send({type:"started",version:d.coreVersion})})}else{d.Receiver=e("./lib/project");var O=e("ws").Server,M=new O({port:d.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log("wallaby.js started"),console.log("core v"+d.coreVersion)});M.on("connection",function(e){var t={send:function(t){e.send(JSON.stringify(t))},receive:_.noop};d.onConnected(t),e.on("message",function(e){t.receive(JSON.parse(e))})})}c.start(d)}else if("runner"!==process.argv[2])a(),process.noDeprecation=!0,e("./lib/global"),process.on("message",function(t){if(t&&"exit"===t.type)return void process.exit(0);if("instrumentor"===t.type){var n=e("./lib/instrumentor");try{var r=n(t.content,t.opts);process.send(r)}catch(i){process.send({error:{message:i&&i.message,stack:i&&i.stack}})}}else if("preprocessor"===t.type||"compiler"===t.type){var o=e("./lib/processor");try{o(t)["catch"](function(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}).then(function(e){e&&process.send(e)})}catch(i){process.send({error:{message:i&&i.message,stack:i&&i.stack}})}}}),process.send("READY");else{if(i=process.argv[7],i&&!process.env.quokka){var B=function(e,t){for(var n=[],r=0;r<t.length;r++)n.push(t[r]),e[r]&&n.push(e[r]);for(;r<e.length;r++)n.push(e[r]);return n};r=e("fs");var N=process.cwd(),D=s.dirname(i);o=s.join(N,"node_modules"),N!==D&&e("./lib/utils").nodeModulesLookup(function(e,t,n,r){var o=!1;e&&e[0]&&0===e[0].indexOf(N)&&(o=!0,Array.prototype.splice.apply(e,[0,e.length].concat(B(n.call(r,t.replace(N,D)),e)))),o||e.push(i)},function(e){var t=e.replace(o,i);return t===e||r.existsSync(t)?t:e})}e("./lib/nodeTestWorker")(process.argv[3],process.argv[4],process.argv[5],process.argv[6],i,process.argv[8],process.argv[9])}},{"./lib/app":10,"./lib/global":24,"./lib/instrumentor":25,"./lib/nodeTestWorker":28,"./lib/processor":40,"./lib/project":41,"./lib/utils":50,"./package.json":51,commander:void 0,fs:void 0,"graceful-fs":void 0,path:void 0,"ts-node":void 0,util:void 0,ws:void 0,"ws/lib/Sender.fallbacks.js":void 0}]},{},[52]);