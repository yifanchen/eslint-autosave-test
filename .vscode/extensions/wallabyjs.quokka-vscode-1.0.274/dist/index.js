/*
 * quokka-vscode - v1.0.274
 * Copyright (c) 2017-2020 WallabyJs - All Rights Reserved.
 */

!function s(r,u,c){process.env.WALLABY_PRODUCTION=!0;var l="function"==typeof require&&require;module.exports=function i(n,e){if(!u[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var a=u[n]={exports:{}};r[n][0].call(a.exports,function(e){var t=r[n][1][e];return i(t||e)},a,a.exports,s,r,u,c)}return u[n].exports}(c[0])}({1:[function(u,e,t){"use strict";var i=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function i(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(i,n)}o((u=u.apply(a,s||[])).next())})},c=this&&this.__generator||function(i,n){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=n.call(i,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},r=u("fs"),l=u("path"),h=u("vscode"),d=u("vsls/vscode"),p=u("./lib/compositeDisposable"),n=h.window,f="quokkajs",m=function(){function r(){}return r.prototype.activate=function(s){return i(this,void 0,void 0,function(){var t,i,n,o,a;return c(this,function(e){switch(e.label){case 0:return(t=this)._disposables=new p,t._setupStatusIndicator(),i=u(s.globalState.get("corePath")),n={context:s,coreClient:i,statusBar:t._statusBar,deactivate:function(){return t.deactivate()},version:r._getVersion()},[4,d.getApiAsync()];case 1:return o=e.sent(),a=u("./lib/controller"),t._controller=new a(n,o,f),t._controller.activate(),t._disposables.add(function(){return t._controller.deactivate()}),t._disposables.add(function(){return o&&o.unshareService(f)}),[2]}})})},r._getVersion=function(){var e=1,t=0;try{var i=h.version.split(".");e=parseInt(i[0],10),t=parseInt(i[1],10)}catch(e){}return{major:e,minor:t}},r.prototype._setupStatusIndicator=function(){var i=this;i._statusBar=n.createStatusBarItem(h.StatusBarAlignment.Right,Number.NEGATIVE_INFINITY),i._statusBar.show();var e=i._statusBar.hide.bind(i._statusBar),t=i._statusBar.dispose.bind(i._statusBar);i._statusBar.hide=function(){i._statusBar.stopProgress(),i._statusBar._mainText="",i._statusBar._extensionText="",i._statusBar.updateText(),e()},i._statusBar.dispose=function(){i._statusBar.stopProgress(),t()},i._statusBar.displayProgress=function(){var e=0,t=["[=-----]","[-=----]","[--=---]","[---=--]","[----=-]","[-----=]","[----=-]","[---=--]","[--=---]","[-=----]"];clearInterval(i._statusBar._progress),i._statusBar._progress=setInterval(function(){i._statusBar.setMainText(t[e=++e%t.length]+"   "),i._statusBar._doUpdateText()},150)},i._statusBar.setMainText=function(e){i._statusBar._mainText=e},i._statusBar.setExtensionText=function(e){i._statusBar._extensionText=e},i._statusBar.updateText=function(){return i._statusBar._doUpdateText()},i._statusBar._doUpdateText=function(){i._statusBar.text=(i._statusBar._mainText||"")+" "+(i._statusBar._extensionText||"")},i._statusBar.stopProgress=function(){clearInterval(i._statusBar._progress),delete i._statusBar._progress},i._statusUpdater=function(e){i._statusBar.tooltip=e},i._disposables.add(function(){i._removeStatusIndicator()}),i._statusBar.hide()},r.prototype._hideStatusIndicator=function(){this._statusBar&&(this._statusBar.text="",this._statusBar.tooltip="",this._statusBar.hide()),this._statusUpdater=function(){}},r.prototype._removeStatusIndicator=function(){this._statusBar&&this._statusBar.dispose(),this._statusUpdater=function(){}},r.prototype.deactivate=function(){this._disposables.dispose()},r}();t.activate=function(n){var e=new m;n.subscriptions.push({dispose:function(){return e.deactivate()}});var t=m._getVersion();if(t.major<=1&&t.minor<18){var i=process.exit,o=process.exit=function(){(function(){e.deactivate(),i.apply(process,arguments)}).apply(null,arguments)};process.on("SIGINT",function(){o.apply(null,arguments)}),process.on("SIGTERM",function(){o.apply(null,arguments)}),process.on("exit",function(){o.apply(null,arguments)})}try{var a=h.workspace.getConfiguration();if(a){var s=a.get("quokka.colors",{});s&&Object.keys(s).forEach(function(t){try{if(!t)return;var e=n.asAbsolutePath(l.join("images",t+".svg"));if(!r.existsSync(e))return;var i=r.readFileSync(e).toString().replace(/fill:#.[^;]*/,"fill:"+s[t]);r.writeFileSync(e,i)}catch(e){console.error("Failed to set icon "+t+" type to "+s[t]+". "+e.message)}})}}catch(e){}e.activate(n)}},{"./lib/compositeDisposable":5,"./lib/controller":6,fs:void 0,path:void 0,vscode:void 0,"vsls/vscode":void 0}],2:[function(i,e,t){"use strict";var n=i("vscode"),o=i("path");t.activate=function(e){var t=n.workspace.getConfiguration()&&n.workspace.getConfiguration().get("quokka.debug",!1);t?(global.originalRequire=i,e.globalState.update("corePath","../../wallaby/client")):e.globalState.update("corePath","./wallaby/client"),t?i("./out/extension").activate(e):"dist"===o.basename(__dirname)?i("./extension").activate(e):(global.originalRequire=i)("./dist/index").activate(e)}},{"./extension":1,path:void 0,vscode:void 0}],3:[function(u,e,t){"use strict";var n=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function i(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(i,n)}o((u=u.apply(a,s||[])).next())})},c=this&&this.__generator||function(i,n){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=n.call(i,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});var l=u("path"),h=u("fs"),d=u("os"),o=u("https"),i=function(){function e(){this.examples=[],this.disposable=void 0,this.disposed=!1,this.configPath=l.join(d.homedir(),".quokka","examples.json"),this.examplesPath=l.join(d.homedir(),".quokka","interactive-examples")}return e.prototype.httpGet=function(i){return n(this,void 0,void 0,function(){var t=this;return c(this,function(e){return[2,new Promise(function(a,s){o.get(i,{headers:{"User-Agent":"Quokka-VSCode-Extension"}},function(o){return n(t,void 0,void 0,function(){var t,i,n;return c(this,function(e){switch(e.label){case 0:if(!(o.statusCode&&300<=o.statusCode&&o.statusCode<400&&o.headers.location))return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.httpGet(o.headers.location)];case 2:return t=e.sent(),a(t),[3,4];case 3:return i=e.sent(),s(i),[3,4];case 4:return[3,6];case 5:n=Buffer.alloc(0),o.on("data",function(e){n=Buffer.concat([n,e])}),o.on("end",function(){a(n)}),e.label=6;case 6:return[2]}})})}).on("error",function(e){s(e)})})]})})},e.prototype.deleteOldExamplesFolder=function(){var n=function(i){h.existsSync(i)&&(h.readdirSync(i).forEach(function(e){var t=l.join(i,e);h.lstatSync(t).isDirectory()?n(t):h.unlinkSync(t)}),h.rmdirSync(i))};n(this.examplesPath)},e.prototype.getExampleMetaInformation=function(){var o=[],a=this.examplesPath,s=function(n){h.existsSync(n)&&h.readdirSync(n).forEach(function(e){var t=l.join(n,e);if(h.lstatSync(t).isDirectory())s(t);else if("meta.json"===e)try{var i=JSON.parse(h.readFileSync(t).toString());o=o.concat(i.map(function(e){return e.folder=l.relative(a,n),e.label=e.title,delete e.title,e}))}catch(e){}})};return s(this.examplesPath),o},e.prototype.initialize=function(){return n(this,void 0,void 0,function(){var t,i,n,o,a,s,r;return c(this,function(e){switch(e.label){case 0:try{h.existsSync(this.configPath)&&(t=JSON.parse(h.readFileSync(this.configPath).toString()),this.examples=t.examples,this.nextCheckTime=t.nextCheckTime,this.sha=t.sha,this.date=t.date)}catch(e){console.error(e)}if(this.nextCheckTime&&!((new Date).getTime()>this.nextCheckTime))return[3,6];i="https://api.github.com/repos/wallabyjs/interactive-examples/commits"+(this.date?"?since"+this.date:""),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,this.httpGet(i)];case 2:return n=e.sent(),(o=JSON.parse(n.toString())).length?this.sha===o[0].sha?[3,4]:[4,this.httpGet("https://github.com/wallabyjs/interactive-examples/archive/master.zip")]:[3,4];case 3:a=e.sent(),s=u("adm-zip"),new s(a).extractAllTo(l.join(d.homedir(),".quokka"),!0),this.deleteOldExamplesFolder(),h.renameSync(l.join(d.homedir(),".quokka","interactive-examples-master"),this.examplesPath),this.examples=this.getExampleMetaInformation(),this.sha=o[0].sha,this.date=o[0].commit.committer.date,this.nextCheckTime=(new Date).getTime()+864e5,h.writeFileSync(this.configPath,JSON.stringify({examples:this.examples,nextCheckTime:this.nextCheckTime,sha:this.sha,date:this.date})),e.label=4;case 4:return[3,6];case 5:return r=e.sent(),console.error(r),[3,6];case 6:return[2]}})})},e.prototype.getExamples=function(){return this.examples||[]},e.prototype.getContent=function(e){try{return h.readFileSync(l.join(this.examplesPath,e.folder,e.fileName)).toString()}catch(e){return""}},e.prototype.getLanguage=function(e){return"ts"===e.type?"TypeScript":"JavaScript"},e.prototype.dispose=function(){this.disposable&&this.disposable.dispose(),this.disposed=!0},e}();t.InteractiveExamples=i},{"adm-zip":void 0,fs:void 0,https:void 0,os:void 0,path:void 0}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("path"),o=e("fs"),a=e("os"),s=e("vscode"),r=function(){function e(e,t){this.disposable=void 0,this.disposed=!1,this.start=e||new Date(Date.UTC(2019,10,27,0,0,0,0)),this.end=t||new Date(Date.UTC(2019,11,4,0,0,0,0)),this.config=n.join(a.homedir(),".quokka","state.json"),this.nextCheckTime=void 0}return e.prototype.setup=function(){var e=this;new Date>this.end?this.deleteStateConfig():(this.nextCheckTime=this.getNextCheckTime()||this.start,this.nextCheckTime<this.end&&(this.checkAndShowMessage(),this.disposable=s.window.onDidChangeActiveTextEditor(function(){e.checkAndShowMessage()})))},e.prototype.saleInProgress=function(){var e=new Date;return e>this.start&&e<this.end},e.prototype.checkAndShowMessage=function(){var e=new Date;!this.disposed&&e>this.start&&e<this.end&&this.nextCheckTime&&e>=this.nextCheckTime&&(this.nextCheckTime=this.setNextCheckTime(),this.showMessageAndHandleUserResponse())},e.prototype.showMessageAndHandleUserResponse=function(){var t=this;try{s.window.showInformationMessage("Get Quokka.js PRO today with our limited time 50% Black Friday discount!",{title:"Buy License",url:s.Uri.parse("https://quokkajs.com/pro/#personal-pro")},{title:"Read More",url:s.Uri.parse("https://quokkajs.com/pro")},{title:"Do not show again",dontShow:!0}).then(function(e){return t.handleUserResponse(e)})}catch(e){}},e.prototype.handleUserResponse=function(e){e&&(e.dontShow?(this.setNextCheckTimeToEndDate(),this.dispose()):e.url&&s.commands.executeCommand("vscode.open",e.url))},e.prototype.setNextCheckTimeToEndDate=function(){try{this.nextCheckTime=this.end,o.writeFileSync(this.config,JSON.stringify({nextCheck:this.end}))}catch(e){}},e.prototype.deleteStateConfig=function(){try{o.existsSync(this.config)&&o.unlinkSync(this.config)}catch(e){}},e.prototype.dispose=function(){this.disposable&&this.disposable.dispose(),this.disposed=!0},e.prototype.setNextCheckTime=function(){var e=new Date,t=new Date(e.setDate(e.getDate()+1));try{o.writeFileSync(this.config,JSON.stringify({nextCheck:t}))}catch(e){}return t},e.prototype.getNextCheckTime=function(){try{if(o.existsSync(this.config)){var e=o.readFileSync(this.config).toString(),t=JSON.parse(e);return new Date(t.nextCheck)}return}catch(e){this.deleteStateConfig()}},e}();i.SalesEvent=r},{fs:void 0,os:void 0,path:void 0,vscode:void 0}],5:[function(e,t,i){"use strict";var n=function(){function e(){this._disposables=[]}return e.prototype.add=function(e){e.dispose?this._disposables.push(e):this._disposables.push({dispose:e})},e.prototype.dispose=function(){this._disposables.forEach(function(e){return e.dispose()})},e}();t.exports=n},{}],6:[function(s,e,t){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),l=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function i(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(i,n)}o((u=u.apply(a,s||[])).next())})},h=this&&this.__generator||function(i,n){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=n.call(i,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},p=s("path"),f=s("fs"),m=s("os"),v=s("vscode"),_=global._,o=s("./SalesEvent"),r=s("./InteractiveExamples"),a=global.EventEmitter,u=s("./valueExplorer"),g=s("./compositeDisposable"),k=s("./outputBuilder"),y=v.workspace,S=v.window,c=["showOutput","createFile","makeQuokkaFromExistingFile","runOnSave","runOnce","toggle","createJavaScriptFile","createTypeScriptFile","showInstrumentedFile","stopCurrent","stopAll","installMissingPackageToProject","installMissingPackageToQuokka","installQuokkaPlugin","goToLineInQuokkaFile","showLicense","switchToPro","switchToCommunity","selectWorkspaceFolder","addImport","addRequire","showValue","copyValue","copyExpressionPath","copyExpressionData"],x={javascript:".js",javascriptreact:".js",plaintext:".js",typescript:".ts",typescriptreact:".tsx"},C=0,w=1,b=2,d=function(a){function d(e,t,i){var n=a.call(this)||this,o=n;return n._state=e,n._context=e.context,n._statusBar=e.statusBar,n._deactivator=e.deactivate,n._Session=e.coreClient.Session,n._utils=e.coreClient.utils,n._outputDocumentSelector={language:"wallaby-output"},n._setupVersionSpecificComponents(e.version),n._disposables=new g,_.each(c,function(t){return o._disposables.add(v.commands.registerCommand("quokka."+t,function(e){try{return o[t](e)}catch(e){console.error(e)}}))}),v.commands.executeCommand("setContext","quokka.isLiveShareClient",!1),n._initializeCoverageDecorationTypes(),o._disposables.add(v.workspace.onDidChangeConfiguration(function(e){o._reInitializeCoverageDecorationTypes()})),n._hideAfterContentDecorationType=S.createTextEditorDecorationType({isWholeLine:!0,after:{margin:"0 0 0 -10000px"}}),n._debugOutputChannel={appendLine:function(e,t){console.log("%c "+e,"color: "+("error"===t?"red":"darkgreen"))}},n._activeSessions=[],n._activeSession=null,v.commands.executeCommand("setContext","quokka.hasActiveSession",!1),o._disposables.add(y.onDidOpenTextDocument(function(i){if(i&&i.uri&&"output"===i.uri.scheme){var n=function(e,t){var i=e.lineAt(0);if(i&&i.text&&i.text.length)return~i.text.indexOf("​")||~i.text.indexOf(" ")||~i.text.indexOf(" ");t&&t()};n(i,function(){var t=y.onDidChangeTextDocument(function(e){e.document===i&&(t.dispose(),n(e.document)&&v.languages.setTextDocumentLanguage(i,"wallaby-output"))})})&&v.languages.setTextDocumentLanguage(i,"wallaby-output")}})),n.outputChannel=S.createOutputChannel("Quokka"),n.outputChannel.append("​"),o._disposables.add(S.onDidChangeActiveTextEditor(function(t){if(t){var e=n._activeSessions.find(function(e){return t.document===e.textDocument});e&&n._checkAndSyncSession(e)}})),n._setupEnvironment(),n._setupLiveSharing(t,i),v.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!1),n._valueExplorer=new u(n._context),n.on("started",function(){n._liveShareClientActive()||v.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!0)}),n}return i(d,a),d.prototype._initializeCoverageDecorationTypes=function(){this._coverageDecorationTypes={1:this._createCoverageDecorationType("notCovered"),2:this._createCoverageDecorationType("covered"),3:this._createCoverageDecorationType("partiallyCovered"),4:this._createCoverageDecorationType("errorSource"),5:this._createCoverageDecorationType("errorPath")},this._coverageOverrideState=this._currentCoverageOverrideState()},d.prototype._currentCoverageOverrideState=function(){var e=v.workspace.getConfiguration();return JSON.stringify([e.get("quokka.lightTheme.log.decorationAttachmentRenderOptions",{}),e.get("quokka.lightTheme.error.decorationAttachmentRenderOptions",{}),e.get("quokka.darkTheme.log.decorationAttachmentRenderOptions",{}),e.get("quokka.darkTheme.error.decorationAttachmentRenderOptions",{})])},d.prototype._reInitializeCoverageDecorationTypes=function(){var t=this;this._coverageOverrideState!==this._currentCoverageOverrideState()&&(this._activeSessions.forEach(function(e){t._clearDecorations(e)}),this._initializeCoverageDecorationTypes(),this._activeSessions.forEach(function(e){t._updateDocuments(e,e.documentUpdates)}))},d.prototype._setupLiveSharing=function(u,c){return l(this,void 0,void 0,function(){var t,i,n,o,a,s,r=this;return h(this,function(e){switch(e.label){case 0:return u?[3,1]:(this._debugOutputChannel.appendLine("Quokka.js Live Share integration disabled, VSLS not found."),[2]);case 1:return this._liveShare={api:u},t=this._liveShare,[4,u.shareService(c)];case 2:return t.server=e.sent(),i=this._liveShare,[4,u.getSharedService(c)];case 3:if(i.client=e.sent(),!this._liveShare.server||!this._liveShare.client)return this._debugOutputChannel.appendLine('Could not create a shared service. You have to set "liveshare.features" to "experimental" in your user settings in order to use live sharing.'),delete this._liveShare,[2];e.label=4;case 4:return n=function(){return _.uniq(r._activeSessions.map(function(e){return{file:e.liveShareFileName,originalFile:e.textDocument.uri,fileName:e.fileName,documentUpdates:e.documentUpdates,stats:e.stats,mode:e.mode,headerData:e.headerData,liveConsoleOutput:e.allLiveConsoleOutput,status:e.status}}))},o=function(t){var i=r._liveShare.activeServerSessions.find(function(e){return 0===t.document.uri.scheme.localeCompare(e.file.scheme)&&0===t.document.uri.path.localeCompare(e.file.path)});if(i){r._start(t.document,t,i.mode);var e=s(i.file);r.processStarted(e),e.output.setHeaderData(i.headerData),e.headerData=i.headerData,i.documentUpdates[i.file.path]=i.documentUpdates[i.fileName],delete i.documentUpdates[i.fileName],r._updateDocuments(e,i.documentUpdates),e.stats=i.stats,e.status=i.status,r.processStats(e),e.liveConsoleOutput=i.liveConsoleOutput,e.liveConsoleOutput&&e.liveConsoleOutput.length&&r._displayLiveConsoleOutput(e,e.liveConsoleOutput),r._liveShare.activeServerSessions=r._liveShare.activeServerSessions.filter(function(e){return e!=i})}},this._liveShare.api.onDidChangePeers(function(t){return l(r,void 0,void 0,function(){return h(this,function(e){return this._liveShareServerActive()&&t.added.length&&(this._liveShare.serverAllowed||this._activeSessions.length&&(S.showWarningMessage("You have not given permission to run Quokka.js in your Live Share Session. All Quokka.js instances have been stopped."),this.stopAll())),[2]})})}),this._context.subscriptions.push(this._liveShare.server.onDidChangeIsServiceAvailable(function(i){return l(r,void 0,void 0,function(){var t=this;return h(this,function(e){return i?(this._activeSessions.forEach(function(e){e.liveShareFileName=t._liveShare.api.convertLocalUriToShared(e.textDocument.uri)}),this._liveShare.disposable=new g,this._liveShare.disposable.add(function(){return delete t._liveShare.serverAllowed}),this._liveShare.serverAllowed=!1,this._activeSessions.length&&this._showLiveShareWarningMessage()):(this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable),[2]})})})),this._context.subscriptions.push(this._liveShare.client.onDidChangeIsServiceAvailable(function(n){return l(r,void 0,void 0,function(){var t,i=this;return h(this,function(e){switch(e.label){case 0:return n?(v.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),v.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!1),this._liveShare.disposable=new g,this._liveShare.disposable.add(function(){return delete i._liveShare.activeServerSessions}),this._liveShare.disposable.add(S.onDidChangeActiveTextEditor(function(e){return o(e)})),t=this._liveShare,[4,this._liveShare.client.request("init",[])]):[3,2];case 1:return t.activeServerSessions=e.sent(),[3,3];case 2:v.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable,e.label=3;case 3:return[2]}})})})),a=function(t){return S.visibleTextEditors.find(function(e){return 0===e.document.uri.scheme.localeCompare(t.scheme)&&0===e.document.uri.path.localeCompare(t.path)})},s=function(t){return r._activeSessions.find(function(e){return e.fileName===t.path})},this._liveShare.server.onRequest("init",function(){return n()}),this._liveShare.client.onNotify("busy",function(e){var t=s(e.file);t&&r.processSessionBusy(t)}),this._liveShare.client.onNotify("stopped",function(t){var i=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});i&&r._liveShare.activeServerSessions.filter(function(e){return e!=i});var e=s(t.file);e&&(r._stop(e),r._hideStatusIndicator())}),this._liveShare.client.onNotify("started",function(t){var e=a(t.file);if(e){r._start(e.document,e,t.data.mode);var i=s(t.file);r.processStarted(i)}else{r._liveShare.activeServerSessions.find(function(e){return 0===t.file.uri.scheme.localeCompare(e.file.scheme)&&0===t.file.uri.path.localeCompare(e.file.path)})||r._liveShare.activeServerSessions.push({file:t.file,originalFile:t.originalFile,fileName:t.fileName,documentUpdates:{},stats:void 0,status:void 0,mode:t.data.mode,headerData:null})}}),this._liveShare.client.onNotify("stats",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});e&&(e.stats=t.data,delete e.status,delete e.liveConsoleOutput,delete e.allLiveConsoleOutput);var i=s(t.file);i&&(i.stats=t.data,delete i.status,delete i.liveConsoleOutput,delete i.allLiveConsoleOutput,r.processStats(i))}),this._liveShare.client.onNotify("documentUpdates",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});e&&(e.documentUpdates=t.data);var i=s(t.file);i&&(t.data[t.file.path]=t.data[t.fileName],delete t.data[t.fileName],r._updateDocuments(i,t.data))}),this._liveShare.client.onNotify("consoleOutput",function(e){var t=s(e.file);t&&r._displayLiveConsoleOutput(t,e.data)}),this._liveShare.client.onNotify("configChanged",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});e&&(e.headerData=t.data);var i=s(t.file);i&&(i.output.setHeaderData(t.data),i.headerData=t.data)}),[2]}})})},d.prototype._checkForOffers=function(n){var e=p.join(m.homedir(),".quokka","offerstate.json");if(!f.existsSync(e)){f.writeFileSync(e,JSON.stringify({time:(new Date).getTime()}));var t=s("https"),i=JSON.stringify({product:"quokka"}),o={hostname:"x55r2pae4l.execute-api.us-east-1.amazonaws.com",port:443,path:"/Prod/checkOffers",method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(i)}},a=t.request(o,function(t){var i="";t.on("data",function(e){i+=e}),t.on("end",function(){if(200===t.statusCode){var e=JSON.parse(i);e.discount=Math.floor(100-100*e.offer_price/e.list_price),5<e.discount&&n(e)}})});a.on("error",function(e){console.error(e)}),a.write(i),a.end()}},d.prototype._setupEnvironment=function(){var t=this;this._quokkaFolder=p.join(m.homedir(),".quokka"),this._wallabyFolder=p.join(m.homedir(),".wallaby"),this._lkp=p.join(this._quokkaFolder,".qlc"),this._ol=p.join(this._wallabyFolder,".ol");try{f.existsSync(this._quokkaFolder)||f.mkdirSync(this._quokkaFolder)}catch(e){}try{f.existsSync(this._wallabyFolder)||f.mkdirSync(this._wallabyFolder)}catch(e){}var i=this._loadQuokkaConfig();this._pro=!0===i.pro,!0!==this._pro?(this._salesEvent=new o.SalesEvent,this._salesEvent.setup()):(new o.SalesEvent).deleteStateConfig(),this._interactiveExamples=new r.InteractiveExamples,this._interactiveExamples.initialize(),!0!==i.pro&&!1!==i.pro&&(S.showInformationMessage("You are using Quokka.js 'Community' edition (free). Quokka.js 'Pro' edition with some advanced features is also available. Would you like to try 'Pro' edition features or to only use the 'Community' edition features?",{title:"'Pro' features as well",pro:!0},{title:"'Community' features only",pro:!1},{title:"More Info / Purchase",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")}).then(function(e){e&&(e.url?v.commands.executeCommand("vscode.open",e.url):(i.pro=e.pro,t._saveQuokkaConfig(i)))}),this._checkForOffers(function(e){v.window.showInformationMessage("Thanks for installing Quokka. If you don't already have the 'Pro' edition and want to purchase, we wanted to let you know that Quokka is currently discounted by "+e.discount+"% for users in "+d.getCountryName(e.country)+".",{title:"Purchase",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")}).then(function(e){e&&e.url&&v.commands.executeCommand("vscode.open",e.url)})}))},d.prototype._quokkaConfigPath=function(){return p.join(this._quokkaFolder,"config.json")},d.prototype._loadQuokkaConfig=function(){var t,e=this._quokkaConfigPath(),i={};try{t=f.readFileSync(e).toString(),i=JSON.parse(t)}catch(e){t&&S.showWarningMessage("Looks like your quokka config.json file has invalid syntax, it should be a valid JSON file.")}return i},d.prototype._saveQuokkaConfig=function(e){f.writeFileSync(this._quokkaConfigPath(),JSON.stringify(e))},d.prototype._getThemableDecorationRenderOptions=function(e,t){var i=e?"error":"log",n=v.workspace.getConfiguration().get("quokka."+t+"Theme."+i+".decorationAttachmentRenderOptions",{color:"light"===t?"error"===i?"#c80000":"#0000ff":"error"===i?"#fe536a":"rgba(86, 156, 214, 1)",margin:"1.2em"}),o={};return Object.keys(n).forEach(function(e){null!==n[e]&&(o[e]=n[e])}),delete o.contentText,delete o.contentIconPath,o},d.prototype._createCoverageDecorationType=function(e){return S.createTextEditorDecorationType({isWholeLine:!0,rangeBehavior:1,gutterIconPath:this._context.asAbsolutePath(p.join("images",e+".svg")).split("\\").join("/"),light:{after:this._getThemableDecorationRenderOptions("errorSource"===e,"light")},dark:{after:this._getThemableDecorationRenderOptions("errorSource"===e,"dark")}})},d.prototype.addImport=function(e){S.activeTextEditor&&d._addCode(S.activeTextEditor,"import "+e+" from '"+e+"';\n")},d.prototype.addRequire=function(e){S.activeTextEditor&&d._addCode(S.activeTextEditor,"const "+e+" = require('"+e+"');\n")},d._addCode=function(e,t){var i=new v.WorkspaceEdit;i.insert(e.document.uri,new v.Position(0,0),t),v.workspace.applyEdit(i)},d.prototype.createFile=function(){var n=this,e=["JavaScript","TypeScript"].concat(this._interactiveExamples.getExamples());S.showQuickPick(e).then(function(e){var t="",i=e;e.label&&(i=n._interactiveExamples.getLanguage(e),t=n._interactiveExamples.getContent(e)),n._createLanguageFile(i,t)})},d.prototype.showOutput=function(){this._activeSession&&this.outputChannel&&this.outputChannel.show(!0)},d.prototype.createJavaScriptFile=function(){this._createLanguageFile("JavaScript")},d.prototype.createTypeScriptFile=function(){this._createLanguageFile("TypeScript")},d.prototype.makeQuokkaFromExistingFile=function(){var e=this;this._runIfAllowed(function(){return e._runFromExistingFile(C)})},d.prototype.toggle=function(){var e=S.activeTextEditor;if(e){var t=e.document;if(t)this._activeSessions.find(function(e){return e.textDocument===t})?this.stopCurrent():this.makeQuokkaFromExistingFile()}},d.prototype.runOnSave=function(){var e=this;this._pro?this._runIfAllowed(function(){return e._runFromExistingFile(w)}):this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},d.prototype.runOnce=function(){var n=this;this._pro?this._runIfAllowed(function(){var e=S.activeTextEditor;if(e){var t=e.document;if(t){var i=n._activeSessions.find(function(e){return e.textDocument===t});i&&i.mode===b?i.changes.length?n._processDocumentContentChange(i,t,[],!0):i.runTests({file:i.fileName}):n._runFromExistingFile(b)}}}):this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},d.prototype.stopCurrent=function(){var t=S.activeTextEditor,e=t&&t.document&&this._activeSessions.find(function(e){return e.textDocument===t.document})||this._activeSession;e&&this._stop(e)},d.prototype.stopAll=function(){var t=this;this._activeSessions.slice().forEach(function(e){return t._stop(e)})},d.prototype.showInstrumentedFile=function(){var t=this;this._activeSession&&this._activeSession.requestInstrumentedFile({path:this._activeSession.fileName},function(e){t._activeSession.output.clearAndRenderHeader(),t._activeSession.output.appendConsoleMessage({text:e,type:"warn"})})},d.prototype.installMissingPackageToProject=function(){this._installPackage(!0)},d.prototype.installMissingPackageToQuokka=function(){this._installPackage()},d.prototype.installQuokkaPlugin=function(e){this._installPackage(!1,e)},d.prototype.showValue=function(){this._showValue("show",!0)},d.prototype.copyValue=function(){this._showValue("copy")},d.prototype._showValue=function(e,t){var i=S.activeTextEditor;if(i){var n=this._activeSession;if(n&&n.textDocument&&i.document===n.textDocument){var o=i.selection;if(o&&o.end){var a=n.textDocument.getText();n.evaluateExpressionInEditor(n.fileName,a,[o.start.line+1,o.start.character,o.end.line+1,o.end.character],e),t&&this._scheduleOnResultsAvailable(n.fileName,o.end,function(){return v.commands.executeCommand("editor.action.showHover")})}}}},d.prototype._scheduleOnResultsAvailable=function(e,t,i){this._runOnResultsAvailable={fileName:e,selectionEnd:t,action:i}},d.prototype._runScheduledActionOnResultsAvailable=function(){if(this._runOnResultsAvailable){var e=S.activeTextEditor;if(e){var t=this._activeSession;if(t&&t.textDocument&&e.document===t.textDocument){var i=e.selection;if(i&&i.end&&t.fileName===this._runOnResultsAvailable.fileName&&i.end===this._runOnResultsAvailable.selectionEnd)try{this._runOnResultsAvailable.action()}finally{delete this._runOnResultsAvailable}}}}},d.prototype.copyExpressionPath=function(e){e&&e.copyExpressionPath()},d.prototype.copyExpressionData=function(e){e&&e.copyExpressionData()},d.prototype.goToLineInQuokkaFile=function(e){if(this._activeSession)if(e){var i=(e=e.split(","))[0]-1,n=(e[1]||1)-1;S.showTextDocument(this._activeSession.textDocument).then(function(e){var t=new v.Position(i,n);e.revealRange(new v.Range(t,t)),e.selection=new v.Selection(t,t)})}else S.showTextDocument(this._activeSession.textDocument)},d.prototype._installPackage=function(e,t){if(this._activeSession)if(t)this._activeSession.status="progress",this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:t,plugin:{editConfig:!0}}});else{if(e&&!this._projectRoot())return void S.showWarningMessage("Cannot install a package into project because quokka is running outside of an opened project.");if(!this._pro)return void this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession);if(!this._activeSession.stats||!this._activeSession.stats.errors)return void S.showWarningMessage("No missing packages to install.");var i=_.find(this._activeSession.stats.errors,function(e){return e.missingPackage});if(!i||!i.missingPackage)return void S.showWarningMessage("No missing packages to install.");this._activeSession.status="progress",this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:i.missingPackage,local:e}})}else S.showWarningMessage("Cannot install a package because quokka is not running.")},d.prototype._setupVersionSpecificComponents=function(e){var t=e.major,i=e.minor;1<=t&&11<=i&&(this._outputDocumentSelector.scheme="*"),1<=t&&16<=i&&(this._multiFolderWorkspaces=!0)},d.prototype._createLanguageFile=function(e,t){var i=this;return e&&y.openTextDocument({language:e.toLowerCase(),content:t||""}).then(function(t){return S.showTextDocument(t).then(function(e){return i._start(t,e,C)})})},d.prototype._stop=function(t){t.disposable&&t.disposable.dispose(),this._activeSessions.splice(this._activeSessions.findIndex(function(e){return e===t}),1),this._hideStatusIndicator(),_.isEmpty(this._activeSessions)&&(this.emit("allSessionStopped"),v.commands.executeCommand("setContext","quokka.hasActiveSession",!1))},d.prototype._hideStatusIndicator=function(){this._statusBar.stopProgress(),this._statusBar.hide()},d.prototype._relativeNormalizedFilePath=function(e){return this._utils.normalizePath(p.relative(this._projectRoot(),e))},d.prototype._runFromExistingFile=function(e){var t=S.activeTextEditor;if(t){var i=t.document;if(i){var n=this._activeSessions.find(function(e){return e.textDocument===i});n&&this._stop(n),x[i.languageId]?this._start(i,t,e):"output"===i.uri.scheme&&"wallaby-output"===i.languageId?this._activeSession&&!this._activeSession.isDisposed()&&this._start(this._activeSession.textDocument,this._activeSession.editors[0],this._activeSession.mode):S.showWarningMessage('Language "'+i.languageId+'" is not supported')}}},d.prototype._runIfAllowed=function(e){!this._liveShareServerActive()||this._liveShare.serverAllowed?e():this._showLiveShareWarningMessage(e)},d.prototype._showLiveShareWarningMessage=function(t){var i=this;S.showWarningMessage("When sharing outside read-only mode, the Quokka.js extension will execute CODE WRITTEN BY OTHERS ON YOUR COMPUTER. Select 'Allow' to continue executing Quokka.js during your Live Share Session.",{title:"Allow",allow:!0},{title:"Deny",allow:!1}).then(function(e){i._liveShare.serverAllowed=!(!e||!e.allow),i._liveShare.serverAllowed?t&&t():i._activeSessions.length&&(S.showInformationMessage("All Quokka.js instances have been stopped."),i.stopAll())})},d.prototype._liveShareClientActive=function(){return!!(this._liveShare&&this._liveShare.client&&this._liveShare.client.isServiceAvailable)},d.prototype._liveShareServerActive=function(){return!!(this._liveShare&&this._liveShare.server&&this._liveShare.server.isServiceAvailable)},d.prototype._sendToLiveShareClients=function(e,t,i){this._liveShareServerActive()&&this._liveShare.server.notify(e,{file:t.liveShareFileName,originalFile:t.textDocument.uri,fileName:t.fileName,data:i})},d.prototype._start=function(n,e,t){var i=this;!1!==this._pro||this._salesEvent&&this._salesEvent.saleInProgress()||this._checkForOffers(function(e){v.window.showInformationMessage("Thanks for using Quokka. If you don't already have the 'Pro' edition and want to purchase, we wanted to let you know that Quokka is currently discounted by "+e.discount+"% for users in "+d.getCountryName(e.country)+".",{title:"More Info / Purchase",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")}).then(function(e){e&&e.url&&v.commands.executeCommand("vscode.open",e.url)})}),this._updateConfigurationFromSettings(),d._checkConfigurationSettings();var o=this._liveShareClientActive(),a=o?{}:new this._Session;o&&(a.isDisposed=function(){return!1},a.stop=function(){});var s,r,u=new g;if(this._activeSession&&this._activeSession.output.disableChannel(),u.add(function(){i._sendToLiveShareClients("stopped",a)}),u.add(function(){i._valueExplorer.remove(a)}),u.add(function(){delete i._runOnResultsAvailable}),this._watcher||o||(this._watcher=y.createFileSystemWatcher("**/*.*"),this._disposables.add(this._watcher)),o||(u.add(v.languages.registerHoverProvider(n.languageId,{provideHover:function(e,t){if(e===n&&!_.isEmpty(a.errorDataByLine)){var i=(a.errorDataByLine[t.line]||{}).hover;if(i)return new v.Hover(i.value)}}})),u.add(v.languages.registerCodeActionsProvider(n.languageId,{provideCodeActions:function(e,t){if(e===n&&!_.isEmpty(a.errorDataByLine)){var i=(a.errorDataByLine[t.start.line]||{}).commands;if(i)return i}}}))),a.mode=t,a.disposable=u,a.textDocument=n,a.changes=[],a.fileName="quokka"+x[n.languageId],a.documentUpdates={},t===C&&!o){var c=function(e){a.textDocument.uri.path!==e.path&&a.runTests({file:a.fileName,externalFileChange:!0})};u.add(this._watcher.onDidCreate(c)),u.add(this._watcher.onDidChange(c)),u.add(this._watcher.onDidDelete(c))}"file"===n.uri.scheme?s=(r=n.uri.path.split("/"))[r.length-1]:s="vsls"===n.uri.scheme?(r=n.uri.path.split("/"))[r.length-1]:n.uri.path+x[n.languageId];if(a.id=s,"file"===n.uri.scheme&&this._projectRoot(n.uri.fsPath)){var l=this._relativeNormalizedFilePath(n.uri.fsPath);l&&(a.fileName=l,this._liveShareServerActive()&&(a.liveShareFileName=this._liveShare.api.convertLocalUriToShared(n.uri)))}"vsls"===n.uri.scheme&&o&&(a.fileName=n.uri.path),a.editors=[e],a.liveConsoleOutput=[],a.allLiveConsoleOutput=[],this._activeSessions.push(a),v.commands.executeCommand("setContext","quokka.hasActiveSession",!0),u.add(y.onDidCloseTextDocument(function(e){n===e&&i._stop(a)})),u.add(y.onDidChangeTextDocument(function(e){n===e.document&&(a.mode===C?i._processDocumentContentChange(a,e.document,e.contentChanges,!0):(i._hideStatusIndicator(),i._clearDecorations(a),i._processDocumentContentChange(a,e.document,e.contentChanges,!1)))})),u.add(y.onDidSaveTextDocument(function(e){n===e&&a.mode===w&&i._processDocumentContentChange(a,e,[],!0)})),u.add(S.onDidChangeActiveTextEditor(function(e){var t=a.editors.includes(e);a.editors=a.editors.filter(function(e){return S.visibleTextEditors.includes(e)}),S.visibleTextEditors.filter(function(e){return e.document===n}).forEach(function(e){a.editors.includes(e)||(a.editors.push(e),i._updateDocuments(a,a.documentUpdates))}),t&&i._updateDocuments(a,a.documentUpdates)})),u.add(S.onDidChangeTextEditorSelection(function(e){if(i._pro&&n===e.textEditor.document&&a.mode===C&&e&&e.selections&&e.selections.length){var t=e.selections[0];t.start.line===t.end.line&&t.start.character===t.end.character||i._showValue("show")}}));var h=_.bind(this._absoluteFilePath,this);a.output=new k(this.outputChannel,a.fileName,h,this._state.coreClient.dmp,a.disposable,this._outputDocumentSelector,!!this._projectRoot(),this._liveShareClientActive(),a.id,this._compactMessageOutput),this._colorizeOutput?a.output.useMarkup():a.output.disableMarkup(),o||(a.start({localRoot:this._projectRoot(),quokkaFolder:this._quokkaFolder,client:"VSCode",cv:v.version,fileName:a.fileName,editorTypeScript:p.join(process.mainModule.filename,"../../extensions/node_modules/typescript")}),a.on("notification",function(e){return i._showNotification(e,a)}),a.on("busy",function(){i._sendToLiveShareClients("busy",a),i.processSessionBusy(a)}),a.on("stopped",function(e){i._sendToLiveShareClients("stopped",a),i._stop(a),i._hideStatusIndicator(),e.deactivate&&(i.stopAll(),i._forceDeactivate())}),a.on("started",function(){i._sendToLiveShareClients("started",a,{mode:a.mode}),i.processStarted(a)}),a.on("stats",function(e){i._sendToLiveShareClients("stats",a,e),a.stats=e,delete a.status,delete a.liveConsoleOutput,delete a.allLiveConsoleOutput,i.processStats(a),e&&e.messages&&(i._valueExplorer.update(a,e.messages),i._runScheduledActionOnResultsAvailable())}),a.on("live",function(){a.fileChangedInEditor(a.fileName,a.textDocument.getText()),a.fileOpenedInEditor(a.fileName)}),a.on("configChanged",function(e){i._pro=e&&e.pro,a.output.setHeaderData(e),a.headerData=e,i._sendToLiveShareClients("configChanged",a,e)}),a.on("documentUpdates",function(e){i._updateDocuments(a,e),i._sendToLiveShareClients("documentUpdates",a,e)}),a.on("consoleError",function(e){e&&e.split("\n").forEach(function(e){return e&&i._debugOutputChannel.appendLine("[Error] #"+a.id+" "+e,"error")}),a.emit("stats",e)}),a.on("consoleLog",function(e){e&&e.split("\n").forEach(function(e){return e&&i._debugOutputChannel.appendLine("[Info]  #"+a.id+" "+e)})}),a.on("consoleOutput",function(e){i._sendToLiveShareClients("consoleOutput",a,e),i._displayLiveConsoleOutput(a,e)})),a.status="progress",this._updateStatus(a,"progress"),u.add(function(){a.output.dispose(),a.stop(),i._clearDecorations(a),delete a.editors,delete a.disposable,delete a.output,a===i._activeSession&&delete i._activeSession,d._clearIdleSessionTimeout(a),i._debugOutputChannel.appendLine("[Info]  #"+a.id+" Quokka.js stopped"),i.outputChannel.clear()}),this.emit("started")},d.prototype.processStats=function(e){e.stats&&(d._outputResults(e.output,e.stats),this._processErrors(e)),this._updateStatus(e),d._sessionIsActive(e)},d.prototype.processStarted=function(e){this._debugOutputChannel.appendLine("[Info]  #"+e.id+" Quokka.js started"),v.workspace.getConfiguration().get("quokka.showOutputOnStart",!0)&&(this._liveShareClientActive()?this._liveShare.outputChannelShown||(this._liveShare.outputChannelShown=!0,this.outputChannel.show(!0)):this.outputChannel.show(!0)),S.showTextDocument(e.textDocument,e.editors&&(e.editors.length||void 0)&&e.editors[0]&&e.editors[0].viewColumn)},d.prototype.processSessionBusy=function(e){var t=this;clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){e.status="progress",t._updateStatus(e,"progress")},300),e.liveConsoleOutput=[],e.allLiveConsoleOutput=[],this._scheduleSessionIdleTimeout(e)},d.prototype._forceDeactivate=function(){this._deactivator(),_.each(c,function(e){return v.commands.registerCommand("quokka."+e,function(){return S.showWarningMessage("Please restart VS Code for a new trial session of Quokka.js 'Pro'.")})})},d.prototype._showNotification=function(e,t){var i=this,n=[];if(!~e.text.indexOf("expire")||"warning"!==e.type||!this._suppressExpirationNotifications){var o=function(e){return e&&e.url&&v.commands.executeCommand("vscode.open",e.url)};if(e.invalidVersion){e.text="You are not licensed to use Quokka PRO features for this version of Quokka. As your 12 months of free Quokka updates have expired, this is likely a result of VS Code updating your Quokka extension automatically.",n.push({title:"Renew",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o}),n.push({title:"Activate",command:"quokka.showLicense"}),n.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"});var a="https://quokkajs.com/docs/previous.html?expirydate="+(s=new Date(e.expiryDate)).getUTCFullYear()+"-"+(s.getUTCMonth()+1)+"-"+s.getUTCDate();n.push({title:"Help / Downgrade",url:v.Uri.parse(a),command:o})}else if(e.expiringSoon){var s=new Date(e.expiryDate);e.text="Your Quokka license free upgrades period expires on "+e.expirationDateStringFormatted+". If you would like to work with the latest version of Quokka and future versions released within the next 12 months, please visit our website to upgrade your license.",n.push({title:"Renew",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o}),n.push({title:"Activate",command:"quokka.showLicense"});a="https://quokkajs.com/docs/previous.html?expirydate="+s.getUTCFullYear()+"-"+(s.getUTCMonth()+1)+"-"+s.getUTCDate();n.push({title:"Help",url:v.Uri.parse(a),command:o})}else e.suggestProEdition?(n.push({title:"Switch to 'Pro'",command:function(){return i._switchEdition(!0,t)}}),n.push({title:"More info",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o})):(~e.text.indexOf("continue-trial-link")?n.push({title:"Continue Trial",command:function(){return t&&!t.isDisposed()&&t.continueTrial()}}):~e.text.indexOf("extended-trial-license-link")&&n.push({title:"Request License",command:"_requestTrialLicense"}),~e.text.indexOf("activate-link")&&n.push({title:"Activate",command:"quokka.showLicense"}),~e.text.indexOf("purchase")&&(n.push({title:"Purchase",url:v.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o}),n.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"})));e.allowMuting&&n.push({title:"Don't show again",command:function(){return t&&!t.isDisposed()&&t.muteNotification(e.id)}}),e.text=e.text.replace(/<br\/><br\/>/g," ").replace(/<br\/>/g," ").replace(/<[^>]*>/g,"");var r=[e.text].concat(n);S["show"+e.type.charAt(0).toUpperCase()+e.type.substr(1)+("info"===e.type?"rmation":"")+"Message"].apply(S,r).then(this._executeCommand),0===e.text.indexOf("Can not start node.js process")&&S.showInformationMessage('You may use the "node" setting to configure the location of node.',{title:"More info",url:v.Uri.parse("https://quokkajs.com/docs/configuration.html#nodejs-version")}).then(function(e){e&&e.url&&v.commands.executeCommand("vscode.open",e.url)})}},d.prototype._checkAndSyncSession=function(t){return!!S.visibleTextEditors.find(function(e){return e.document===t.textDocument})&&(t!=this._activeSession&&(this._activeSession&&this._activeSession.output.disableChannel(),(this._activeSession=t).output.enableChannel(),t.output.render(),this.processStats(t)),!0)},d.prototype._requestTrialLicense=function(){v.window.showInputBox({prompt:"Quokka.js: email address for trial license",ignoreFocusOut:!0,placeHolder:"user@domain.com"}).then(function(e){if(void 0!==e){var t=s("https"),i=JSON.stringify({email:e,type:"quokka"}),n={hostname:"x55r2pae4l.execute-api.us-east-1.amazonaws.com",port:443,path:"/Prod/bc88894221b34ae4adac5c39a51547a2",method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(i)}},o=t.request(n,function(e){200===e.statusCode?v.window.showInformationMessage("Your Quokka.js trial license request has been processed. Please check your email."):v.window.showErrorMessage("Something went wrong processing your Quokka.js trial license request. Please send us an email instead to hello@wallabyjs.com")});o.on("error",function(e){v.window.showErrorMessage("Something went wrong processing your Quokka.js trial license request. Please send us an email instead to hello@wallabyjs.com"),console.error(e)}),o.write(i),o.end()}})},d.prototype.showLicense=function(){var c=this,l="";try{l=JSON.parse(Buffer.from(f.readFileSync(this._ol).toString(),"base64"))}catch(e){l={}}var h="";try{h=f.readFileSync(this._lkp).toString()}catch(e){}S.showInputBox({value:l.email&&l.email.length?l.email:100<h.length?h:"",prompt:"Enter your Quokka.js 'Pro' license key"}).then(function(e){if(!_.isUndefined(e))if(/^[a-zA-Z0-9_+&*-]+(?:\.[a-zA-Z0-9_+&*-]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,7}$/.test(e))try{l.email=e.trim(),l.lastUpdate=(new Date).getTime(),f.writeFileSync(c._ol,Buffer.from(JSON.stringify(l)).toString("base64")),S.showInformationMessage("Quokka.js 'Pro' activation will be confirmed when Quokka is next started."),c.switchToPro()}catch(e){S.showErrorMessage("Unable to save email activation request: "+e.message)}else{try{f.unlinkSync(c._ol)}catch(e){}var t=h,i=e||"",n=!!c._parseLicenseKey(t),o=c._parseLicenseKey(i),a=!!o,s=!1;if(a||!i&&n)try{if(f.writeFileSync(c._lkp,i),o.isBundle){var r=p.join(m.homedir(),".wallaby"),u=p.join(r,"key.lic");f.existsSync(r)||f.mkdirSync(r),f.writeFileSync(u,i)}s=a}catch(e){S.showErrorMessage("Unable to save license key: "+e.message),s=!1}else S.showWarningMessage("The entered license key is not a valid Quokka.js 'Pro' license key.");s&&(S.showInformationMessage("Quokka.js 'Pro' is licensed to: "+o.licensee+". Free upgrades until: "+o.expiration+"."),c.switchToPro())}})},d.prototype._parseLicenseKey=function(e){if(_.isString(e))try{var t=this._utils.parseKey(e);if(t.licenseeName&&t.expirationDateString&&~t.licensedProduct.indexOf("Quokka"))return{licensee:t.licenseeName,isBundle:0===t.licensedProduct.indexOf("Wallaby.js + Quokka.js"),expiration:t.expirationDateStringFormatted||t.expirationDateString}}catch(e){return}},d.prototype.switchToCommunity=function(){this._switchEdition(!1,this._activeSession)},d.prototype.switchToPro=function(){this._switchEdition(!0,this._activeSession)},d.prototype._switchEdition=function(e,t){var i=this._loadQuokkaConfig();if(i.pro=e,this._pro=e,this._saveQuokkaConfig(i),this._pro&&this._salesEvent&&(this._salesEvent.deleteStateConfig(),this._salesEvent.dispose(),delete this._salesEvent),!this._liveShareClientActive()&&t&&!t.isDisposed()){var n=t.textDocument,o=t.editors[0];this.stopAll(),t.mode!=C&&t.mode!==w||this._start(n,o,t.mode)}},d.prototype._processErrors=function(e){var t=this;this._liveShareClientActive()||e.stats.errors&&(e.errorDataByLine={},d._addLineData(e,d._createLineDataObject(e,function(e){return e.missingPackage},function(e){return[{title:'Install "'+e.missingPackage+'" package for the current quokka file',command:"installMissingPackageToQuokka"},t._projectRoot()&&{title:'Install "'+e.missingPackage+'" package into the project',command:"installMissingPackageToProject"}]})),d._addLineData(e,d._createLineDataObject(e,function(e){return e.missingBrowserGlobal},function(e){return[{title:'"'+e.missingBrowserGlobal+'" looks like a browser global'},{title:"Install and use quokka browser plugin",command:"installQuokkaPlugin",arg:"jsdom-quokka-plugin"}]})),d._addLineData(e,d._createLineDataObject(e,function(e){return e.undefinedName},function(e){return[{title:'Add "import '+e.undefinedName+" from '"+e.undefinedName+"';\"",command:"addImport",arg:e.undefinedName},{title:'Add "const '+e.undefinedName+" = require('"+e.undefinedName+"');\"",command:"addRequire",arg:e.undefinedName}]})))},d._addLineData=function(e,t){t&&(e.errorDataByLine[t.line]=t)},d._createHoverObject=function(e){return e.filter(function(e){return!!e}).map(function(e){return e.command?"\n["+e.title+"]("+encodeURI("command:quokka."+e.command+(e.arg?"?"+JSON.stringify(e.arg):""))+")":e.title}).join("\n")},d._createCommands=function(e){return e.filter(function(e){return e&&e.command}).map(function(e){return{title:e.title,command:"quokka."+e.command,arguments:e.arg?[e.arg]:void 0}})},d._createLineDataObject=function(t,e,i){var n=t.stats.errors.find(e),o=n&&n.stack||[];if(o.reverse(),o.length){var a=_.find(o,function(e){return e.file===t.fileName});if(a&&a.loc&&a.loc.split){var s=i(n),r=d._createHoverObject(s);return v.MarkdownString&&((r=new v.MarkdownString(r)).isTrusted=!0),{line:parseInt(a.loc.split(":")[0],10)-1,hover:{value:r},commands:d._createCommands(s)}}}},d._checkConfigurationSettings=function(){try{var e=v.workspace.getConfiguration();if(e)e.get("quokka.suppressGlyphMarginNotifications",!1)||e.get("editor.glyphMargin",!0)||S.showWarningMessage("Quokka.js will not display coverage indicators in the gutter because the `editor.glyphMargin` setting is set to `false`. You can hide this message by setting `quokka.suppressGlyphMarginNotifications` to `false`.")}catch(e){}},d.prototype._updateConfigurationFromSettings=function(){var e="",t=!1;try{var i=this._loadQuokkaConfig();e=i.node,i.useWsl&&(t=i.useWsl)}catch(e){}try{process.env.WALLABY_USE_WSL=t;var n=v.workspace.getConfiguration();if(n){this._suppressExpirationNotifications=n.get("quokka.suppressExpirationNotifications",!1),this._colorizeOutput=n.get("quokka.colorizeOutput",!0),this._compactMessageOutput=n.get("quokka.compactMessageOutput",!1);var o=n.get("quokka.node",e);o?process.env.WALLABY_NODE=o:delete process.env.WALLABY_NODE}}catch(e){}},d.prototype.activate=function(){var e=this;this._onceDocumentStopsChanging=_.debounce(_.bind(this._onceDocumentStopsChanging,this),100),d._outputResults=_.debounce(_.bind(d._outputResults,this),100),this._statusBar.updateText=_.debounce(_.bind(this._statusBar.updateText,this._statusBar),200),this._executeCommand=_.bind(this._execute,this),this._statusBar.command="quokka.showOutput",this._disposables.add(function(){e._statusBar&&e._statusBar.hide(),e._activeSessions.forEach(function(e){return e.disposable.dispose()}),e._activeSessions.length=0,v.commands.executeCommand("setContext","quokka.hasActiveSession",!1)})},d.prototype._projectRoot=function(t){var e,i=this;if(t&&(this._multiFolderWorkspaces&&y.workspaceFolders&&y.workspaceFolders.length&&(e=_.find(y.workspaceFolders,function(e){return~t.indexOf(e.uri.fsPath+p.sep)}))))return this._currectProjectRoot=e.uri.fsPath,this._currectProjectRoot;if(this._currectProjectRoot)if(this._multiFolderWorkspaces&&y.workspaceFolders){if(e=_.find(y.workspaceFolders,function(e){return i._currectProjectRoot===e.uri.fsPath}))return e.uri.fsPath}else if(y.rootPath&&this._currectProjectRoot===y.rootPath)return y.rootPath;return this._multiFolderWorkspaces&&y.workspaceFolders?y.workspaceFolders.length?y.workspaceFolders[0].uri.fsPath:void 0:y.rootPath||""},d.prototype.selectWorkspaceFolder=function(){var t=this;this._multiFolderWorkspaces&&y.workspaceFolders&&1<y.workspaceFolders.length&&S.showWorkspaceFolderPick&&S.showWorkspaceFolderPick().then(function(e){e&&(t._currectProjectRoot=e.uri.fsPath)})},d.prototype.deactivate=function(){this._disposables.dispose()},d._sessionIsActive=function(e){d._clearIdleSessionTimeout(e)},d.prototype._sessionIsIdle=function(e){this._clearDecorations(e),delete e.stats,e.liveConsoleOutput&&!e.liveConsoleOutput.started&&e.output.clearAndRenderHeader()},d._clearIdleSessionTimeout=function(e){e.idleTimeout&&(clearTimeout(e.idleTimeout),delete e.idleTimeout)},d.prototype._clearDecorations=function(e){var i=this;e.editors.forEach(function(t){_.each(i._coverageDecorationTypes,function(e){return t.setDecorations(e,[])}),t.setDecorations(i._hideAfterContentDecorationType,[])})},d.prototype._scheduleSessionIdleTimeout=function(e){var t=this;d._clearIdleSessionTimeout(e),e.idleTimeout=setTimeout(function(){return t._sessionIsIdle(e)},3500)},d.prototype._displayLiveConsoleOutput=function(e,t){var i=this;if(e.liveConsoleOutput){var n=e.liveConsoleOutput.started;e.liveConsoleOutput=e.liveConsoleOutput.concat(t),e.liveConsoleOutput.started=n,e.liveConsoleOutput.started?e.displayLiveConsoleOutputTimeout||this._displayPendingLiveConsoleOutput(e):(e.liveConsoleOutput.started=!0,e.displayLiveConsoleOutputTimeout=setTimeout(function(){delete e.displayLiveConsoleOutputTimeout,e.liveConsoleOutput&&e.liveConsoleOutput.length&&(e.output.clearAndRenderHeader(),i._displayPendingLiveConsoleOutput(e))},150))}},d.prototype._displayPendingLiveConsoleOutput=function(t){t.allLiveConsoleOutput=t.allLiveConsoleOutput.concat(t.liveConsoleOutput),t.liveConsoleOutput.forEach(function(e){return t.output.appendConsoleMessage(e)}),t.liveConsoleOutput.length=0},d.prototype._execute=function(e){if(e&&e.command)return"function"==typeof e.command?e.command(e):~e.command.indexOf("quokka.")?v.commands.executeCommand(e.command):this[e.command]()},d.prototype._processDocumentContentChange=function(e,t,i,n){e.isDisposed()||t&&t.uri&&t.uri.scheme&&"file"!==t.uri.scheme&&"untitled"!==t.uri.scheme&&"vsls"!==t.uri.scheme||(e.changes=e.changes.concat(i),this._hideMessagesForChangedRanges(e.changes),n&&this._onceDocumentStopsChanging(e,t))},d.prototype._onceDocumentStopsChanging=function(e,t){var i=this;!e.isDisposed()&&e.changes.length&&(this._liveShareClientActive()||(clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){e.status="progress",i._updateStatus(e,"progress")},300),e.fileChangedInEditor(e.fileName,t.getText(),{start:_.chain(e.changes).map(function(e){return e.range.start.line}).min().value()+1,end:_.chain(e.changes).map(function(e){return e.range.end.line}).max().value()+1},!1),e.changes=[]))},d.prototype._updateStatus=function(e){if(!e.isDisposed()){var t,i=e.status;clearTimeout(this._statusUpdateTimeout),i||(i=_.isString(e.stats)?"failing":e.stats?e.stats.errors.length?"failing":"passing":"failing",t=e.stats&&e.stats.time),i&&("progress"===i?this._statusBar.displayProgress():(this._statusBar.stopProgress(),this._statusBar.setMainText(("failing"===i?"✗":"✔")+(t?" "+t+"ms":"")),this._statusBar.updateText()),this._statusBar.show()),this._activeSession=e}},d.prototype._updateStatusExtension=function(e){this._statusBar.setExtensionText(e),this._statusBar.updateText()},d.prototype._removeStatus=function(){this._statusBar.hide()},d.prototype._updateDocuments=function(t,n){var o=this;t.isDisposed()||t.changes.length||(t.documentUpdates=n,_.each(S.visibleTextEditors,function(i){var s=i.document;if(s===t.textDocument){var e=n[t.fileName];if(e&&e.lines){var r={1:[],2:[],3:[],4:[],5:[]};_.each(e.lines,function(e){var t=e.num-1;if(!(t<0||t>=s.lineCount)){var i=s.lineAt(t);if(i){var n={range:new v.Range(i.lineNumber,i.firstNonWhitespaceCharacterIndex,i.lineNumber,i.range.end.character)},o=e.log||e.err,a=e.longLog||o;a&&(n.hoverMessage=v.MarkdownString?new v.MarkdownString("```\n"+a+"\n```"):{value:a}),r[e.state].push(n),o&&(n.renderOptions={after:{contentText:o}})}}}),_.each(r,function(e,t){return i.setDecorations(o._coverageDecorationTypes[t],e)}),o._scheduleHiddenMessagesDisplay()}}}))},d.prototype._hideMessagesForChangedRanges=function(e){clearTimeout(this._displayHiddenMessagesTimeout),this._messagesHiddenAt=+new Date,S.activeTextEditor&&S.activeTextEditor.setDecorations(this._hideAfterContentDecorationType,e.map(function(e){return{range:new v.Range(e.range.start.line,0,e.range.end.line,Number.MAX_SAFE_INTEGER)}}))},d.prototype._scheduleHiddenMessagesDisplay=function(){var t=this;clearTimeout(this._displayHiddenMessagesTimeout);var e=this._messagesHiddenAt?+new Date-this._messagesHiddenAt:400;this._displayHiddenMessagesTimeout=setTimeout(function(){try{_.each(S.visibleTextEditors,function(e){return e&&e.setDecorations(t._hideAfterContentDecorationType,[])})}catch(e){}},Math.max(0,500-e))},d.prototype._navigate=function(e,t){if(e){var i,n,o=this._absoluteFilePath(e);_.isNumber(t)?i=t:_.isArray(t)?(i=t[0],n=t[1]):_.isString(t)&&(t=t.split(":"),i=t[0]&&parseInt(t[0],10),n=t[1]&&parseInt(t[1],10)),_.isNumber(i)?i-=1:i=0,_.isNumber(n)||(n=0),y.openTextDocument(o).then(function(e){return S.showTextDocument(e)}).then(function(e){var t=new v.Position(i,n);e.revealRange(new v.Range(t,t)),e.selection=new v.Selection(t,t)})}},d.prototype._absoluteFilePath=function(e){return p.resolve(this._projectRoot(),e)},d._outputResults=function(e,t,i){var n,o=e.lines();e.build(t);var a=e.lines();if(!(n=i||a.length!==o.length))for(var s=0,r=a.length;s<r;s++)if(e.areDifferent(a[s],o[s])){n=!0;break}n&&e.render()},d.getCountryName=function(e){return{AF:"Afghanistan",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"Brit. Indian Ocean",VG:"British Virgin Islands",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D’Ivoire",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Terr.",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard/ Mcdonald Islands",VA:"Holy See/ Vatican City",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People’s DR",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",KP:"North Korea",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RS:"Republic of Serbia",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",GS:"S. Georgia/ Sandwich Islands",SH:"Saint Helena",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent/ Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",VI:"U.S. Virgin Islands",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States (M.O.I.)",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Vietnam",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"}[e]},d}(a);e.exports=d},{"./InteractiveExamples":3,"./SalesEvent":4,"./compositeDisposable":5,"./outputBuilder":7,"./valueExplorer":8,fs:void 0,https:void 0,os:void 0,path:void 0,vscode:void 0}],7:[function(e,t,i){"use strict";var h=e("vscode"),d=global._,n={text:"",link:Array(2).join("​"),error:{start:"",end:" "},duration:Array(4).join("​"),suite:Array(5).join("​"),message:{start:"",end:" ",altEnd:" "+Array(6).join("​")},diffIns:Array(2).join("‌⁠"),diffDel:Array(2).join("‍"),tmpDiffIns:{start:"wsDiffIns",end:"weDiffIns"},tmpDiffDel:{start:"wsDiffDel",end:"weDiffDel"}},o=function(){function e(e,t,i,n,o,a,s,r,u,c){var l=this;this._lines=[],this._links=[],this._quokkaFileName=t,this._displayedFileName=u,this._contentLimit=1048576,this._channel=e,this._absolutePathResolver=i,this._dmp=n,this._hasOpenedProject=s,this.render=d.debounce(d.bind(this.render,this),300),this._header="Quokka",this.isLiveShareClient=r,this.disposed=!1,this.channelEnabled=!0,this._messageSeparator=c?"":"\n",this.useMarkup(),o.add(h.languages.registerDocumentLinkProvider(a,{provideDocumentLinks:function(e){if(!l.channelEnabled||l.disposed)return[];var t=e.lineAt(0);return t&&t.text&&~t.text.indexOf(l._header)?l._links:[]}}))}return e.prototype.enableChannel=function(){this.channelEnabled=!0},e.prototype.disableChannel=function(){this.channelEnabled=!1},e.prototype.useMarkup=function(){this._markupTokens=d.extend({},n)},e.prototype.disableMarkup=function(){this._markupTokens.text=this._markupTokens.link=this._markupTokens.error=this._markupTokens.duration=this._markupTokens.suite=this._markupTokens.message=""},e.prototype.dispose=function(){this.disposed=!0},e.prototype.build=function(e){var t=this;this._lines=[],this._links=[],this._appendLine("suite",0,this._header),d.isString(e)?this._appendLine("error",0,e):d.isObject(e)&&(d.each(e.errors,function(e){return t._outputError(e)}),d.each(e.messages,function(e){return t._outputMessage(e)}))},e.prototype.lines=function(){return this._lines},e.prototype.render=function(){this._doRender()},e.prototype._doRender=function(e){if(!this.disposed&&this.channelEnabled){!(e=e||0)&&this._channel.clear();for(var t="",i=e,n=this._lines.length;i<n;i++){if((t+=this._lines[i]+"\n").length>this._contentLimit){t+="\n--- output truncated to "+this._contentLimit+" bytes ---\n";break}}this._channel.append(t.replace(/\u0000/g,""))}},e.prototype.clear=function(){this._lines=[],this._links=[]},e.prototype.clearAndRenderHeader=function(){this.clear(),this._appendLine("suite",0,this._header),this._doRender()},e.prototype.appendConsoleMessage=function(e){var t=this._lines.length;this._outputMessage(e),this._doRender(t)},e.prototype.show=function(){this.disposed||this._channel.show(!0)},e.prototype.areDifferent=function(e,t){return e!==t},e.prototype.setContentLimit=function(e){e&&(this._contentLimit=e)},e.prototype.setHeaderData=function(e){if(!this.disposed){var t=e.plugins||[];try{this._header="Quokka '"+this._displayedFileName+"' (node: "+e.nodeVersion+(e.ts?", TypeScript: "+(e.ts.version&&"v"+e.ts.version||"unknown version"):"")+(e.babel?", babel: "+(e.babel.version&&"v"+e.babel.version||"unknown version"):"")+(t.length?", plugins: "+t.join(", "):"")+")"}catch(e){console.log(e)}}},e.prototype._markupStartToken=function(e){var t=this._markupTokens[e];return d.isObject(t)?t.start:t},e.prototype._markupEndToken=function(e){var t=this._markupTokens[e];return d.isObject(t)?t.end:t},e.prototype._markupAltEndToken=function(e){var t=this._markupTokens[e];return d.isObject(t)?t.altEnd||t.end:t},e.prototype._outputMessage=function(e){if("diff"===e.type){if(!e.context&&!e.actual&&!e.expected)return;e.text=e.context,delete e.context}e.context&&e.context.replace&&(e.context=e.context.replace(/\r\n\s*/g," ").replace(/\n\s*/g," "));var t=e.text&&(20<e.text.length||~e.text.indexOf("\n"))&&"diff"!==e.type,i="error"===e.type?"error":"warn"===e.type||"diff"===e.type?"duration":"message";if(t)this._appendLine(i,0,this._messageSeparator+e.text),this._outputLink(e,1);else{"diff"===e.type&&this._outputDiff(0,e.expected,e.actual);var n=e.text?""+this._messageSeparator+this._markupStartToken(i)+e.text+this._markupAltEndToken(i):"";if(e.file){"message"!==i&&(n+=" ");var o=this._markupStartToken("link")+e.file+(e.loc?":"+e.loc:"")+this._markupEndToken("link");n+="at "+(e.context?this._markupStartToken("duration")+e.context+this._markupEndToken("duration")+" ":""),n+=o,this._addFileLink(e.file,e.loc,o,n.length-o.length,this._lines.length+(n.split(/\r\n|\r|\n/).length-1))}this._appendLine("text",0,n)}},e.prototype._outputError=function(e){var t=e.message,i=e.stack,n=e.expected,o=e.actual,a=e.missingPackage,s=e.missingBrowserGlobal,r=this;this._outputDiff(0,n,o),a&&!this.isLiveShareClient&&(this._addEmptyLine(),this._addCustomLinkLine('Install "'+a+'" package for the current quokka file',"command:quokka.installMissingPackageToQuokka",0),this._hasOpenedProject&&this._addCustomLinkLine('Install "'+a+'" package into the project',"command:quokka.installMissingPackageToProject",0)),s&&!this.isLiveShareClient&&(this._addEmptyLine(),this._appendLine("duration",0,'"'+s+'" looks like a browser global'),this._addCustomLinkLine("Install and use quokka browser plugin","command:quokka.installQuokkaPlugin?"+JSON.stringify("jsdom-quokka-plugin"),0),this._addCustomLinkLine("Open quokka browser plugin documentation","https://github.com/wallabyjs/jsdom-quokka-plugin",0)),this._appendLine("error",0,this._messageSeparator+t),d.each(i,function(e){return r._outputLink(e,1)})},e.prototype._outputDiff=function(e,t,i){var a=this;if(this._dmp&&(t||i)){var n="\n"+this._dmp.diff_prettyHtml(this._dmp.diff_wordMode(t||"",i||"")).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,this._markupStartToken("tmpDiffIns")).replace(/<del[^>]*>/g,this._markupStartToken("tmpDiffDel")).replace(/<\/ins[^>]*>/g,this._markupEndToken("tmpDiffIns")).replace(/<\/del[^>]*>/g,this._markupEndToken("tmpDiffDel")).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),s=0,r=0;this._appendLine("none",e,n,void 0,void 0,function(e){if(!e)return e;0<s&&(e=a._markupStartToken("diffIns")+e),0<r&&(e=a._markupStartToken("diffDel")+e);var t=(e.match(new RegExp(a._markupStartToken("tmpDiffIns"),"g"))||[]).length,i=(e.match(new RegExp(a._markupEndToken("tmpDiffIns"),"g"))||[]).length;s+=t-i;var n=(e.match(new RegExp(a._markupStartToken("tmpDiffDel"),"g"))||[]).length,o=(e.match(new RegExp(a._markupEndToken("tmpDiffDel"),"g"))||[]).length;return r+=n-o,0<s&&(e+=a._markupEndToken("diffIns")),0<r&&(e+=a._markupEndToken("diffDel")),e.replace(new RegExp(a._markupStartToken("tmpDiffIns"),"g"),a._markupStartToken("diffIns")).replace(new RegExp(a._markupEndToken("tmpDiffIns"),"g"),a._markupEndToken("diffIns")).replace(new RegExp(a._markupStartToken("tmpDiffDel"),"g"),a._markupStartToken("diffDel")).replace(new RegExp(a._markupEndToken("tmpDiffDel"),"g"),a._markupEndToken("diffDel"))})}},e.prototype._outputLink=function(i,e){var n=this;if(i.file){var o=i.file+(i.loc?":"+i.loc:"");this._appendLine("link",e,o,void 0,i.context,function(e,t){n._addFileLink(i.file,i.loc,o,t)})}},e.prototype._addCustomLinkLine=function(e,t,i){var n=this._lines.length;this._appendLine("text",i,this._markupStartToken("link")+e+this._markupEndToken("link")),this._links.push({range:new h.Range(n,this._markupStartToken("link").length,n,e.length+this._markupEndToken("link").length),target:h.Uri.parse(t)})},e.prototype._addFileLink=function(e,t,i,n,o){"."!==e[0]&&e!==this._quokkaFileName||(o=o||this._lines.length,this._links.push({range:new h.Range(o,n,o,n+i.length),target:0===e.indexOf("quokka")?h.Uri.parse("command:quokka.goToLineInQuokkaFile?"+JSON.stringify(this._location(t).substring(1))):h.Uri.parse(h.Uri.file(this._absolutePathResolver(e)).toString()+this._location(t,0))}))},e.prototype._location=function(e,t){var i,n;return d.isNumber(e)?i=e:d.isArray(e)?(i=e[0],n=e[1]):d.isString(e)&&(i=(e=e.split(":"))[0]&&parseInt(e[0],10),n=e[1]&&parseInt(e[1],10)),d.isNumber(n)&&(n+=void 0!==t?t:1)<0&&(n=0),"#"+(d.isNumber(n)?i+","+n:i)},e.prototype._addEmptyLine=function(){this._appendLine("text",0,"")},e.prototype._appendLine=function(o,a,e,s,r,u){var c=this,l=this,t=e.split("\n"),h=[this._markupStartToken(o)||"",this._markupEndToken(o)||""];d.each(t,function(e){var t=(s?"["+s+"] ":"")+d.pad("",2*a,"   ")+("link"===o?"at "+(r?c._markupStartToken("duration")+r+c._markupEndToken("duration")+" ":""):"")+h[0],i=t+e+h[1];if(u){var n=u(i,t.length);n&&(i=n)}l._lines.push(i)})},e}();t.exports=o},{vscode:void 0}],8:[function(e,t,i){"use strict";var a=e("vscode"),s=global._,n=function(){function o(e){this._context=e,this._docsNode={label:"No logged values, click to see the feature docs",iconPath:this._context.asAbsolutePath("images/question.svg"),command:{command:"vscode.open",arguments:[a.Uri.parse("https://quokkajs.com/docs/#value-explorer")]}},this._treeDataProvider=new c(this._docsNode),this._treeDataProvider._rootNodes={},a.window.registerTreeDataProvider&&a.window.registerTreeDataProvider("quokkaValueExplorer",this._treeDataProvider)}return o.prototype.remove=function(e){var t=this._treeDataProvider._rootNodes,i=t[e.id];delete t[e.id],i&&i._context.cancelPendingUpdates(),this._treeDataProvider.refresh()},o.prototype.update=function(e,t){var i=this._treeDataProvider._rootNodes[e.id];if(!i){var n=new r(this._context,e);i=new u(n,{label:{name:""+e.id},id:e.id,sessionNode:!0,disallowToCopyPath:!0,disallowToCopyData:!0}),this._treeDataProvider._rootNodes[e.id]=i}i._children=s.chain(t).map(function(e){var t=(e.valueBag||{}).data;if(t){t.name||o.removeExcessiveSpacesTabsLineBreaks(e.text||"").startsWith(o.removeExcessiveSpacesTabsLineBreaks(e.context||"").replace(/\.\.\.$/g,""))||(t.name=o.removeExcessiveSpacesTabsLineBreaks(e.context||""));var i=(e.loc||"").split(":")[0];return i&&(t.name="line "+i+(t.name?": "+t.name:"")),t.label=t.label||{},t.label.name=t.name,t.context=e.context,t.rootValueNode=!0,t}}).filter(function(e){return!!e}).map(function(e){return new u(i._context,e,i,e.autoExpand)}).value(),i._context.runPendingUpdates(),i._children&&i._children.length||(i._children=[this._docsNode]),this._treeDataProvider.refresh()},o.removeExcessiveSpacesTabsLineBreaks=function(e){return e&&e.replace(/\r\n\s*/g," ").replace(/\n\s*/g," ")},o}(),r=function(){function e(e,t){this._expressionsToEvaluate={},this._onUpdate=[],this._extensionContext=e,this._session=t,this.id=t.id}return e.prototype.asAbsolutePath=function(e){return this._extensionContext.asAbsolutePath(e)},e.prototype.isPathRequested=function(e,t){var i=this._expressionsToEvaluate,n=s.every(e,function(e){return!!i[e]&&(i=i[e],!0)});return n&&t?JSON.stringify(t)===JSON.stringify(i):n},e.prototype.requestNodes=function(e,t){var i=this._expressionsToEvaluate;s.each(e,function(e){i[e]=i[e]||{},i=i[e]}),t&&(i.props=t.props,i.strLength=t.strLength,i.ranges=t.ranges),this._session.isDisposed()||(this._session.expressionsToEvaluate(this._expressionsToEvaluate),this._session.runTests({file:this._session.fileName}))},e.prototype.scheduleOnUpdate=function(e){this._onUpdate.push(e)},e.prototype.copyToClipboard=function(e){!this._session.isDisposed()&&this._session.copyToClipboard(e)},e.prototype.cancelPendingUpdates=function(){this._onUpdate=[]},e.prototype.runPendingUpdates=function(){s.each(this._onUpdate,function(e){return e()}),this._onUpdate.length=0},e}(),u=function(){function t(e,t,i,n){this._context=e,this._parent=i,this._data=t,this.label=this._createLabel(),this._queryPath=t.queryPath,this.id=(n?"A":"")+t.id,this.iconPath=this._getIconPath(),t.disallowToCopyPath||(this.contextValue+="QuokkaAllowToCopyPath"),t.disallowToCopyData||(this.contextValue+="QuokkaAllowToCopyData"),this._autoExpand=n&&!this._data.cappedProps&&!this._data.capped&&!this._data.loadActionNode&&!this._data.rangeNode&&"string"!==this._data.type&&!this._data.getter&&!this._data.setter,t.sessionNode?this.collapsibleState=2:this.collapsibleState=t.expandable?this._autoExpand?2:1:0,t.rangeNode&&(this._parentArray=i._parentArray||i,this._queryPath=this._parentArray._queryPath),t.sessionNode&&(this.iconPath=a.ThemeIcon.File,this.resourceUri=a.Uri.file(this.id))}return t.prototype.getChildren=function(){var i=this;if(this._children)return this._children;if("string"===this._data.type)return this._getChildren({strLength:Number.MAX_VALUE});if(this._data.loadActionNode)return this._getChildren({props:Number.MAX_VALUE});var e=(this._data.props||[]).map(function(e){return new t(i._context,e,i,i._autoExpand)});return e.length?Promise.resolve(e):this._data.rangeNode?this._getChildren({ranges:{props:JSON.parse(JSON.stringify(this._parentArray._data.props,function(e,t){return t.props&&(!t.props.length&&t===i._data||t.props.length&&!t.props[0].rangeNode)&&(t.props=!0),t})),length:this._parentArray._data.length}}):this._getChildren()},t.prototype.copyExpressionPath=function(){(this._data||{}).expressionPath&&this._context.copyToClipboard(this._data.expressionPath.join(""))},t.prototype.copyExpressionData=function(){this._data&&this._context.copyToClipboard(this._data)},t.prototype._getChildren=function(e){var i=this;return this._context.isPathRequested(this._queryPath,e)?[]:(this._context.requestNodes(this._queryPath,e),new Promise(function(e,t){i._context.scheduleOnUpdate(e)}))},t.prototype._getIconPath=function(){if(this._data.getter)return this._context.asAbsolutePath("images/getter.svg");if(this._data.functionsNode)return this._context.asAbsolutePath("images/function.svg");if(this._data.loadActionNode)return this._context.asAbsolutePath("images/more.svg");if(this._data.error)return this._context.asAbsolutePath("images/error.svg");if(this._data.rangeNode)return this._context.asAbsolutePath("images/range.svg");if(!this._data.sessionNode){if(this._data.type)switch(this._data.type.toLowerCase()){case"string":if(this._data.capped)return this._context.asAbsolutePath("images/cappedString.svg");case"object":case"array":case"number":case"function":case"boolean":case"date":case"regexp":case"symbol":case"null":case"undefined":return this._context.asAbsolutePath("images/"+this._data.type.toLowerCase()+".svg")}return this._context.asAbsolutePath("images/object.svg")}},t.prototype._createLabel=function(){var e=this._data.label,t="";return e.name&&(t+=e.name),e.type&&(t+=": "+e.type+" "),e.value&&(t+=(e.type?"":": ")+e.value),t},t}(),c=function(){function e(e){this._onDidChangeTreeData=new a.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._docsNode=e}return e.prototype.refresh=function(){this._onDidChangeTreeData.fire()},e.prototype.getTreeItem=function(e){return e},e.prototype.getChildren=function(e){return e?e.getChildren():s.isEmpty(this._rootNodes)?Promise.resolve([this._docsNode]):Promise.resolve(s.chain(this._rootNodes).values().sortBy(function(e){return e._data.name}).value())},e}();t.exports=n},{vscode:void 0}]},{},[2]);